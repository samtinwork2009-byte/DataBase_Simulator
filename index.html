<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>資料數據庫模擬訓練遊戲平台 | Database Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 背景科技效果 - 數據庫伺服器風格 -->
    <div class="tech-bg">
        <div class="grid-lines"></div>
        <div class="floating-elements">
            <!-- 主要浮動元素 - 模擬服務器節點 -->
            <div class="floating-element" style="width: 400px; height: 400px; top: 5%; left: 8%; animation-duration: 25s;"></div>
            <div class="floating-element" style="width: 280px; height: 280px; top: 55%; right: 12%; animation-duration: 30s; animation-delay: -5s;"></div>
            <div class="floating-element" style="width: 220px; height: 220px; bottom: 15%; left: 25%; animation-duration: 28s; animation-delay: -10s;"></div>
            <div class="floating-element" style="width: 180px; height: 180px; top: 30%; right: 35%; animation-duration: 22s; animation-delay: -15s;"></div>

            <!-- 數據流動效果 -->
            <div class="data-stream" style="left: 15%; animation-delay: 0s;"></div>
            <div class="data-stream" style="left: 35%; animation-delay: 0.5s;"></div>
            <div class="data-stream" style="left: 55%; animation-delay: 1s;"></div>
            <div class="data-stream" style="left: 75%; animation-delay: 1.5s;"></div>
            <div class="data-stream" style="right: 20%; animation-delay: 2s;"></div>
            <div class="data-stream" style="right: 10%; animation-delay: 2.5s;"></div>
        </div>
    </div>

    <!-- 主頁面 -->
    <div id="introPage" class="intro-page fade-in">
        <div class="logo">
            <div class="logo-icon pulse">
                <i class="fas fa-database"></i>
            </div>
            <h1 class="gradient-text">資料數據庫模擬訓練遊戲平台</h1>
        </div>

                <p class="intro-description">
            🎓 <strong>Oracle 數據庫模擬訓練平台</strong> - 瀏覽器即開即玩<br>
            ⚡ <strong>核心功能：</strong>PL/SQL、ACID事務、性能分析、18種智能錯誤診斷<br>
            📊 <strong>15種數據模型：</strong>關聯式、JSON   XML、圖形、空間、區塊鏈、時序等<br>
            🎯 <strong>學習增強：</strong>視覺化圖表、9種成就、多檔案管理、完整報告匯出<br>
            💾 <strong>雙模式訓練：</strong>自由練習 + 30題隨機題庫，循序漸進掌握SQL
        </p>

        <div class="btn-group">
            <button id="newFileBtn" class="btn btn-primary">
                <i class="fas fa-play btn-icon"></i> 開始Oracle Database 模擬器
            </button>
            <button id="howToPlayBtn" class="btn">
                <i class="fas fa-question-circle btn-icon"></i> 🎯 快速上手指南
            </button>
            <button id="flowchartBtn" class="btn" style="background: linear-gradient(135deg, #00d4ff, #0099ff); border: none; color: white; box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);">
                <i class="fas fa-project-diagram btn-icon"></i> 📊 此模擬資料庫流程圖
            </button>
            <button id="syntaxRefBtn" class="btn">
                <i class="fas fa-code btn-icon"></i> Database 語法參考
            </button>
            <button id="achievementsBtn" class="btn" style="background: linear-gradient(135deg, var(--accent), #ff66b2); border: none; box-shadow: 0 4px 15px rgba(255, 102, 178, 0.3);">
                <i class="fas fa-trophy btn-icon"></i> 🏆 我的成就
            </button>
        </div>

        <!-- 複習資料庫測驗按鈕 -->
        <div style="text-align: center; margin-top: 40px; margin-bottom: 30px;">
            <button id="quizBtn" class="btn" style="background: linear-gradient(135deg, #ff6b9d, #c06c84); border: none; color: white; padding: 16px 40px; font-size: 1.1rem; box-shadow: 0 6px 20px rgba(255, 107, 157, 0.4);">
                <i class="fas fa-question-circle btn-icon"></i> 📝 複習資料庫測驗 (100題)
            </button>
        </div>

        <div class="card" style="max-width: 1100px; margin-top: 50px;">
            <h3 style="font-size: 1.8rem; margin-bottom: 30px; text-align: center;">
                <i class="fas fa-star" style="color: var(--accent);"></i> 平台特色功能
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin-top: 20px;">

                <!-- 核心功能 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(0, 168, 255, 0.08), rgba(0, 102, 204, 0.08)); border-radius: 12px; border-left: 4px solid var(--primary);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-bolt" style="color: var(--primary); margin-right: 8px;"></i> 即時執行引擎</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">瀏覽器內執行，批次處理、即時預覽</p>
                </div>

                <!-- Oracle 19C 專業功能 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 69, 0, 0.08), rgba(255, 140, 0, 0.08)); border-radius: 12px; border-left: 4px solid #ff4500;">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-database" style="color: #ff4500; margin-right: 8px;"></i> Oracle 19C 特性</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">SEQUENCE、SYNONYM、PACKAGE、TABLESPACE</p>
                </div>

                <!-- PL/SQL 進階物件 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(0, 255, 204, 0.08), rgba(0, 168, 255, 0.08)); border-radius: 12px; border-left: 4px solid var(--accent);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-cogs" style="color: var(--accent); margin-right: 8px;"></i> PL/SQL 物件</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">PROCEDURE、FUNCTION、TRIGGER</p>
                </div>

                <!-- 事務與約束 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 204, 0, 0.08), rgba(255, 153, 0, 0.08)); border-radius: 12px; border-left: 4px solid var(--warning);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-shield-alt" style="color: var(--warning); margin-right: 8px;"></i> ACID事務+約束</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">COMMIT/ROLLBACK、4種隔離級別、完整約束</p>
                </div>

                <!-- JOIN 與視圖索引 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 102, 178, 0.08), rgba(153, 102, 255, 0.08)); border-radius: 12px; border-left: 4px solid #ff66b2;">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-link" style="color: #ff66b2; margin-right: 8px;"></i> 多表JOIN+視圖</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">INNER/LEFT/RIGHT JOIN、VIEW、INDEX</p>
                </div>

                <!-- 性能分析 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(0, 204, 136, 0.08), rgba(51, 255, 153, 0.08)); border-radius: 12px; border-left: 4px solid var(--success);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-tachometer-alt" style="color: var(--success); margin-right: 8px;"></i> 性能分析</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">EXPLAIN PLAN、執行成本、優化建議</p>
                </div>

                <!-- 智能錯誤診斷 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 102, 102, 0.08), rgba(255, 153, 51, 0.08)); border-radius: 12px; border-left: 4px solid #ff6666;">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-bug" style="color: #ff6666; margin-right: 8px;"></i> 智能診斷</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">18種錯誤分類、中文解釋+修正建議</p>
                </div>

                <!-- 資料視覺化 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(0, 204, 136, 0.08), rgba(0, 255, 127, 0.08)); border-radius: 12px; border-left: 4px solid var(--success);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-chart-bar" style="color: var(--success); margin-right: 8px;"></i> 視覺化圖表</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">長條圖、折線圖、圓餅圖、甜甜圈圖</p>
                </div>

                <!-- 遊戲化學習 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 102, 178, 0.08), rgba(153, 102, 255, 0.08)); border-radius: 12px; border-left: 4px solid #ff66b2;">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-trophy" style="color: #ff66b2; margin-right: 8px;"></i> 成就系統</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">9種徽章、即時動畫、進度追蹤</p>
                </div>

                <!-- 雙模式學習 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 204, 0, 0.08), rgba(255, 152, 0, 0.08)); border-radius: 12px; border-left: 4px solid var(--warning);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-graduation-cap" style="color: var(--warning); margin-right: 8px;"></i> 雙模式訓練</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">自由練習 + 30題隨機題庫</p>
                </div>

                <!-- 中英對照 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(0, 168, 255, 0.08), rgba(51, 153, 255, 0.08)); border-radius: 12px; border-left: 4px solid var(--info);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-language" style="color: var(--info); margin-right: 8px;"></i> 語法庫</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">基本/進階/高階三級語法表+實例</p>
                </div>

                <!-- 多資料庫管理 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 51, 102, 0.08), rgba(255, 102, 153, 0.08)); border-radius: 12px; border-left: 4px solid var(--error);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-database" style="color: var(--error); margin-right: 8px;"></i> 多檔案管理</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">多資料庫檔案、快速切換、獨立儲存</p>
                </div>

                <!-- 完整資料匯出 -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(0, 204, 136, 0.08), rgba(0, 255, 154, 0.08)); border-radius: 12px; border-left: 4px solid var(--success);">
                    <h4 style="font-size: 1.05rem; margin-bottom: 10px;"><i class="fas fa-download" style="color: var(--success); margin-right: 8px;"></i> 報告匯出</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">數據、表結構、歷史、圖表→HTML</p>
                </div>

            </div>

            <!-- 15種數據模型 + 9種表格視圖 (橫跨全寬) -->
            <div style="display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px;">
                <!-- 15種數據模型 -->
                <div style="padding: 25px; background: linear-gradient(135deg, rgba(0, 255, 204, 0.1), rgba(0, 168, 255, 0.1)); border-radius: 16px; border-left: 5px solid var(--accent); box-shadow: 0 3px 15px rgba(0, 255, 204, 0.2);">
                    <h4 style="font-size: 1.2rem; margin-bottom: 15px;"><i class="fas fa-layer-group" style="color: var(--accent); margin-right: 10px;"></i> 15種數據模型全支援</h4>
                    <p style="color: var(--text-secondary); line-height: 1.7; margin-bottom: 15px; font-size: 0.95rem;">從基礎到專業全方位覆蓋，體驗不同數據庫技術的特性和應用場景</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px;">
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">📊 關聯式</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">📄 JSON文件</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">📋 XML</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🔗 圖形</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🗺️ 空間</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">⛓️ 區塊鏈</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🔑 鍵值</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">📈 時間序列</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🔍 全文檢索</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">📦 物件</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🔀 半結構化</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">💧 串流</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">⚡ 內存</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🌐 分散式</div>
                        <div style="padding: 10px 14px; background: rgba(0, 168, 255, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🏢 多租戶</div>
                    </div>
                </div>

                <!-- 9種表格視圖 -->
                <div style="padding: 25px; background: linear-gradient(135deg, rgba(255, 153, 204, 0.1), rgba(255, 102, 178, 0.1)); border-radius: 16px; border-left: 5px solid #ff99cc; box-shadow: 0 3px 15px rgba(255, 153, 204, 0.2);">
                    <h4 style="font-size: 1.2rem; margin-bottom: 15px;"><i class="fas fa-th-large" style="color: #ff99cc; margin-right: 10px;"></i> 9種表格視圖切換</h4>
                    <p style="color: var(--text-secondary); line-height: 1.7; margin-bottom: 15px; font-size: 0.95rem;">查詢結果支援多種視圖模式   深入理解不同表格類型的特性</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px;">
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">📋 標準表格</div>
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🗂️ 分區表</div>
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🔗 叢集表</div>
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🔑 索引組織表</div>
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">📁 外部表</div>
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">⏱️ 臨時表</div>
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">📦 巢狀表</div>
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">🎯 物件表</div>
                        <div style="padding: 10px 14px; background: rgba(255, 102, 178, 0.12); border-radius: 8px; font-size: 0.9rem; text-align: center; font-weight: 500;">⛓️ 區塊鏈表</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 重要提示 -->
        <!-- 重要提示 -->
        <div style="margin-top: 60px; padding: 25px 20px; text-align: center;">
            <div style="max-width: 800px; margin: 0 auto; padding: 20px 30px; background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 87, 34, 0.1)); border-radius: 12px; border-left: 5px solid var(--warning); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 12px;">
                    <i class="fas fa-info-circle" style="font-size: 1.8rem; color: var(--warning); margin-right: 12px;"></i>
                    <h3 style="font-size: 1.3rem; font-weight: 700; color: var(--warning); margin: 0;">重要提示</h3>
                </div>
                <p style="font-size: 1.05rem; color: var(--text-primary); line-height: 1.8; margin-bottom: 10px; font-weight: 500;">
                    📌 本平台為<strong style="color: var(--accent);">數據庫學習模擬器</strong>，所有數據僅<strong style="color: var(--warning);">臨時存儲於瀏覽器內存</strong>中
                </p>
                <p style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin: 0;">
                    <i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i> 刷新或關閉頁面後，所有數據將<strong>不會保存</strong>，請注意備份重要的 SQL 語句
                </p>
            </div>
        </div>

        <!-- 版權信息 -->
        <div style="margin-top: 40px; padding: 30px 20px; border-top: 1px solid var(--border-color); text-align: center;">
            <div style="margin-bottom: 15px;">
                <p style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">
                    © 2025 Create By【 Sam. T 】
                </p>
                <p style="font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 5px;">
                    Copyright © 2025 Sam. T. All rights reserved.
                </p>
                <p style="font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 5px;">
                    版權所有 © 2025 Sam. T
                </p>
            </div>
            <div style="padding: 15px 20px; background: rgba(255, 204, 0, 0.1); border-radius: 8px; border: 1px solid rgba(255, 204, 0, 0.3); display: inline-block;">
                <p style="font-size: 0.9rem; color: var(--warning); font-weight: 500; margin: 0;">
                    <i class="fas fa-shield-alt"></i> 此平台已受版權保護
                </p>
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 5px 0 0 0;">
                    未經擁有者同意，禁止複製、修改或商業使用
                </p>
            </div>
        </div>
    </div>

    <!-- 模擬器頁面 -->
    <div id="simulatorPage" class="simulator-page container">
        <!-- 模擬器標題欄 -->
        <div class="simulator-header">
            <div>
                <h2 class="gradient-text" id="fileName">未命名訓   檔案</h2>
                <div class="status-indicator status-online">
                    <div class="status-dot"></div>
                    <span>數據庫連接正常</span>
                </div>
            </div>

            <div class="user-info">
                <div class="user-avatar">
                    <span id="userInitial">U</span>
                </div>
                <div>
                    <div style="font-weight: 600;" id="usernameDisplay">User</div>
                    <div style="font-size: 14px; color: var(--text-muted);" id="modeDisplay">訓練模式</div>
                </div>
                <button id="backToIntroBtn" class="btn" style="padding: 10px 20px;">
                    <i class="fas fa-home"></i> 返回主頁
                </button>
            </div>
        </div>

        <!-- 資料庫檔案標籤頁 -->
        <div class="database-tabs-container">
            <!-- 上方控制區域：標籤頁和管理按鈕 -->
            <div style="display: flex; justify-content: space-between; align-items: center; gap: 15px; margin-bottom: 10px; flex-wrap: wrap;">
                <!-- 左側：資料庫標籤 -->
                <div class="database-tabs" id="databaseTabs" style="flex: 1; min-width: 300px; margin-bottom: 0;">
                    <!-- 標籤頁將由 JavaScript 動態生成 -->
                </div>

                <!-- 右側：管理按鈕組 -->
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="saveAllBtn" class="btn" style="padding: 10px 18px; background: var(--gradient-primary); border: none; white-space: nowrap;">
                        <i class="fas fa-database"></i> 所有儲存
                    </button>
                    <button id="exportBtn" class="btn" style="padding: 10px 18px; white-space: nowrap;">
                        <i class="fas fa-file-download"></i> 匯出報告
                    </button>
                    <button id="freePracticeBtn" class="btn btn-primary" style="padding: 10px 18px; white-space: nowrap;">
                        <i class="fas fa-edit"></i> 自由模式
                    </button>
                    <button id="exerciseModeBtn" class="btn" style="padding: 10px 18px; white-space: nowrap;">
                        <i class="fas fa-tasks"></i> 訓練模式
                    </button>
                </div>
            </div>

            <div class="database-tabs-info">
                <span><i class="fas fa-info-circle"></i> 你可以創建多個資料庫檔案，並在它們之間快速切換</span>
                <span id="currentTabInfo">目前檔案：<strong>檔案 1</strong></span>
            </div>
        </div>

        <!-- 訓練題   卡片 -->
        <div id="exerciseCard">
            <h3><i class="fas fa-tasks"></i> 訓練題目</h3>

            <!-- 題目資訊表格 -->
            <div id="exerciseContent" style="margin-top: 15px;">
                <table style="width: 100%; border-collapse: collapse; background: rgba(0, 168, 255, 0.05); border: 2px solid var(--border-color); border-radius: 8px; overflow: hidden;">
                    <tr style="background: rgba(0, 102, 204, 0.2);">
                        <td colspan="2" style="padding: 12px; font-weight: 600; font-size: 1.1em; border-bottom: 2px solid var(--secondary);">
                            <i class="fas fa-book"></i> <span id="exerciseTitleDisplay"></span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; width: 120px; font-weight: 600; background: rgba(0, 168, 255, 0.08); border-right: 1px solid var(--border-color);">
                            難度等級
                        </td>
                        <td style="padding: 10px;">
                            <span id="exerciseDifficulty" style="padding: 4px 12px; border-radius: 4px; font-weight: 600;"></span>
                            <span id="difficultyStars" style="margin-left: 10px; color: #FFD700; font-size: 18px;"></span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; font-weight: 600; background: rgba(0, 168, 255, 0.08); border-right: 1px solid var(--border-color); border-top: 1px solid rgba(0, 168, 255, 0.1);">
                            分類
                        </td>
                        <td style="padding: 10px; border-top: 1px solid rgba(0, 168, 255, 0.1);">
                            <span id="exerciseCategory"></span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; font-weight: 600; background: rgba(0, 168, 255, 0.08); border-right: 1px solid var(--border-color); border-top: 1px solid rgba(0, 168, 255, 0.1); vertical-align: top;">
                            題目要求
                        </td>
                        <td style="padding: 15px; border-top: 1px solid rgba(0, 168, 255, 0.1);">
                            <div id="exerciseDescription" style="color: var(--text-secondary); line-height: 1.8;"></div>
                        </td>
                    </tr>
                    <tr id="exerciseDataPreviewRow" style="display: none;">
                        <td style="padding: 10px; font-weight: 600; background: rgba(0, 204, 136, 0.08); border-right: 1px solid var(--border-color); border-top: 1px solid rgba(0, 204, 136, 0.3); vertical-align: top;">
                            📊 已提供資料
                        </td>
                        <td style="padding: 15px; border-top: 1px solid rgba(0, 204, 136, 0.3); background: rgba(0, 204, 136, 0.02);">
                            <div id="exerciseDataPreview" style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9em;"></div>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; font-weight: 600; background: rgba(0, 168, 255, 0.08); border-right: 1px solid var(--border-color); border-top: 1px solid rgba(0, 168, 255, 0.1); vertical-align: top;">
                            💡 提示
                        </td>
                        <td style="padding: 15px; border-top: 1px solid rgba(0, 168, 255, 0.1);">
                            <div id="exerciseHint" style="color: var(--warning); font-style: italic; line-height: 1.6;"></div>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; font-weight: 600; background: rgba(0, 168, 255, 0.08); border-right: 1px solid var(--border-color); border-top: 1px solid rgba(0, 168, 255, 0.1); vertical-align: top;">
                            ⚠️ 注意事項
                        </td>
                        <td style="padding: 15px; border-top: 1px solid rgba(0, 168, 255, 0.1);">
                            <div style="color: var(--error); line-height: 1.6;">
                                • 執行每一句語句後會自動檢查是否符合要求<br>
                                • <strong style="color: var(--warning);">⚠️ 提交要求：</strong>必須先執行SQL語句才能提交答案<br>
                                • 可以提交任何SQL答案，系統會自動評分<br>
                                • 即使題目有預設資料，仍需執行自己的SQL<br>
                                • 完成後請點擊「提交答案」按鈕進行評分<br>
                                • 每題滿分30分，評分標準見下方評分表
                            </div>
                        </td>
                    </tr>
                </table>

                <!-- 評分標準表 -->
                <div style="margin-top: 15px; padding: 15px; background: rgba(0, 204, 136, 0.05); border: 1px solid rgba(0, 204, 136, 0.3); border-radius: 8px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--success);">
                        <i class="fas fa-clipboard-check"></i> 評分標準（滿分30分）
                    </div>

                    <!-- 四大評分類別 -->
                    <div style="background: rgba(0, 168, 255, 0.05); padding: 12px; border-radius: 6px; margin-bottom: 12px; border-left: 4px solid var(--info);">
                        <div style="font-weight: 600; color: var(--info); margin-bottom: 8px;">📊 評分類別：</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; font-size: 0.9em;">
                            <div>• 正確性與完整性 (0-10分)</div>
                            <div>• 技術深度與最佳實踐 (0-8分)</div>
                            <div>• 邏輯與問題解決 (0-7分)</div>
                            <div>• 可讀性與結構 (0-5分)</div>
                        </div>
                    </div>

                    <div id="requirementsTable"></div>

                    <!-- 新增：評分準則詳細說明 -->
                    <div style="margin-top: 15px; padding: 15px; background: rgba(255, 204, 0, 0.08); border: 2px solid rgba(255, 204, 0, 0.4); border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: var(--warning); font-size: 1.05em;">
                            <i class="fas fa-exclamation-triangle"></i> 📌 重要提醒：提交答案前必讀
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.2); padding: 12px; border-radius: 6px; margin-bottom: 10px;">
                            <div style="font-weight: 600; color: var(--accent); margin-bottom: 8px;">✅ 提交答案的條件：</div>
                            <ol style="margin-left: 20px; line-height: 1.8; color: var(--text-secondary);">
                                <li><strong style="color: var(--warning);">必須先執行SQL語句</strong> - 點擊「執行 SQL」按鈕測試您的答案</li>
                                <li><strong style="color: var(--info);">可以提交任何答案</strong> - 不論SQL語法對錯都可以提交評分</li>
                                <li><strong style="color: var(--success);">即使有預設資料</strong> - 仍需執行自己的SQL才能提交</li>
                            </ol>
                        </div>

                        <div style="background: rgba(0, 168, 255, 0.1); padding: 12px; border-radius: 6px; margin-bottom: 10px;">
                            <div style="font-weight: 600; color: var(--info); margin-bottom: 8px;">📋 評分準則   明（每題30分）：</div>
                            <ul style="margin-left: 20px; line-height: 1.8; color: var(--text-secondary); font-size: 0.95em;">
                                <li><strong>完整數據資料</strong> - 檢查表格是否真實存在於資料庫，不只是SQL文字</li>
                                <li><strong>語句語法</strong> - 檢查SQL語法正確性，括號配對，關鍵字使用</li>
                                <li><strong>表格擺位位置</strong> - 檢查欄位定義的順序和結構</li>
                                <li><strong>欄位屬性檢測</strong> - 精確檢測主鍵、外鍵、非空、唯一、CHECK、DEFAULT等約束</li>
                            </ul>
                        </div>

                        <div style="background: rgba(0, 204, 136, 0.1); padding: 12px; border-radius: 6px;">
                            <div style="font-weight: 600; color: var(--success); margin-bottom: 8px;">🎯 評分改進說明：</div>
                            <ul style="margin-left: 20px; line-height: 1.8; color: var(--text-secondary); font-size: 0.95em;">
                                <li><strong>表格名稱檢查</strong> - 不僅檢查SQL文字，還驗證表格是否真的在資料庫中創建</li>
                                <li><strong>欄位及屬性檢查</strong> - 例如「包含 EMP_ID 欄位（主鍵）」會同時檢查：
                                    <ul style="margin-left: 20px; margin-top: 5px;">
                                        <li>✓ 欄位 EMP_ID 是否存在</li>
                                        <li>✓ 該欄位是否定義為 PRIMARY KEY</li>
                                        <li>✓ 兩者是否在同一個欄位定義中</li>
                                    </ul>
                                </li>
                                <li><strong>約束檢測</strong> - 使用正則表達式確保約束（NOT NULL、UNIQUE、CHECK、DEFAULT等）確實應用於正確的欄位</li>
                                <li><strong>嚴格驗證</strong> - SQL語法正確但表格未成功創建的情況將無法得分</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 即時反饋區域 -->
                <div id="feedbackArea" style="margin-top: 15px; padding: 15px; background: rgba(0, 168, 255, 0.03); border: 1px solid var(--border-color); border-radius: 8px; display: none;">
                    <div style="font-weight: 600; margin-bottom: 10px;">
                        <i class="fas fa-comment-dots"></i> 執行反饋
                    </div>
                    <div id="feedbackContent"></div>
                </div>

                <!-- 當前得分顯示 -->
                <div id="currentScoreDisplay" style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, rgba(0, 204, 136, 0.2), rgba(0, 168, 255, 0.2)); border: 2px solid var(--success); border-radius: 8px; display: none;">
                    <div style="text-align: center; font-size: 1.3em; font-weight: 600; margin-bottom: 10px;">
                        當前得分：<span id="currentScore">0</span> / 30 分
                    </div>
                    <div style="text-align: center; font-size: 1.1em; margin-bottom: 8px;">
                        等級：<span id="gradeLevel" style="font-weight: 700; padding: 4px 12px; border-radius: 6px;"></span>
                    </div>
                    <div id="categoryScoreBreakdown" style="font-size: 0.9em; background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 6px; margin-top: 10px;"></div>

                    <!-- 重做選項 (分數低於15分時顯示) -->
                    <div id="retakeOptions" style="display: none; margin-top: 12px; padding: 12px; background: rgba(255, 204, 0, 0.1); border: 2px solid var(--warning); border-radius: 6px;">
                        <div style="color: var(--warning); font-weight: 600; margin-bottom: 8px; text-align: center;">
                            <i class="fas fa-exclamation-triangle"></i> 分數未達標準（需15分以上）
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button id="retakeSameBtn" class="btn" style="background: var(--warning); color: #000;">
                                <i class="fas fa-redo"></i> 重做本題
                            </button>
                            <button id="retakeNewBtn" class="btn btn-primary">
                                <i class="fas fa-random"></i> 換新題目
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                <button id="confirmQuestionBtn" class="btn" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, rgba(0, 204, 136, 0.2), rgba(0, 168, 255, 0.2)); border: 2px solid var(--success);">
                    <i class="fas fa-clipboard-check"></i> 確定作答此題目
                </button>
                <button id="submitAnswerBtn" class="btn btn-primary" style="flex: 1; min-width: 200px;">
                    <i class="fas fa-check-circle"></i> 提交答案
                </button>
                <button id="nextExerciseBtn" class="btn" style="flex: 1; min-width: 200px;">
                    <i class="fas fa-arrow-right"></i> 下一題
                </button>
            </div>

            <!-- 🆕 題目模式新功能提示 -->
            <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, rgba(255, 102, 178, 0.05), rgba(153, 102, 255, 0.05)); border-radius: 8px; border: 1px solid rgba(255, 102, 178, 0.3);">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                    <i class="fas fa-star" style="color: #ff66b2; font-size: 16px;"></i>
                    <h4 style="color: #ff66b2; margin: 0; font-size: 13px;">💡 錯誤診斷系統</h4>
                </div>
                <p style="color: var(--text-secondary); font-size: 11px; margin: 0 0 8px 0; line-height: 1.6;">
                    執行出錯？系統會自動分析錯誤類型，提供中文解釋和3條修正建議！
                </p>
                <div style="display: flex; gap: 6px; flex-wrap: wrap; font-size: 10px;">
                    <span style="background: rgba(0, 204, 136, 0.15); padding: 4px 8px; border-radius: 4px; color: var(--success);">✓ 18種錯誤分類</span>
                    <span style="background: rgba(0, 168, 255, 0.15); padding: 4px 8px; border-radius: 4px; color: var(--accent);">✓ 智能建議</span>
                    <span style="background: rgba(255, 204, 0, 0.15); padding: 4px 8px; border-radius: 4px; color: var(--warning);">✓ 錯誤追蹤</span>
                </div>
            </div>
        </div>

        <!-- 模擬器主內容 -->
        <div class="simulator-layout">
            <!-- 數據模型選擇器 -->
            <div class="model-selector-container card">
                <div class="model-selector-header">
                    <div class="model-selector-title">
                        <i class="fas fa-database"></i>
                        <span>數據模型</span>
                        <span class="current-model-badge" id="currentModelBadge">關聯式</span>
                    </div>
                </div>

                <div class="quick-model-tabs" id="quickModelTabs">
                    <!-- 所有15種數據模型 -->
                    <div class="model-tab active" data-model="relational">
                        <span class="model-icon">📊</span>
                        <span>關聯式</span>
                    </div>
                    <div class="model-tab" data-model="json">
                        <span class="model-icon">📄</span>
                        <span>JSON文件</span>
                    </div>
                    <div class="model-tab" data-model="xml">
                        <span class="model-icon">📋</span>
                        <span>XML</span>
                    </div>
                    <div class="model-tab" data-model="graph">
                        <span class="model-icon">🔗</span>
                        <span>圖形DB</span>
                    </div>
                    <div class="model-tab" data-model="spatial">
                        <span class="model-icon">🗺️</span>
                        <span>空間資料</span>
                    </div>
                    <div class="model-tab" data-model="blockchain">
                        <span class="model-icon">⛓️</span>
                        <span>區塊鏈</span>
                    </div>
                    <div class="model-tab" data-model="keyvalue">
                        <span class="model-icon">🔑</span>
                        <span>鍵值儲存</span>
                    </div>
                    <div class="model-tab" data-model="timeseries">
                        <span class="model-icon">📈</span>
                        <span>時間序列</span>
                    </div>
                    <div class="model-tab" data-model="fulltext">
                        <span class="model-icon">🔍</span>
                        <span>文字搜尋</span>
                    </div>
                    <div class="model-tab" data-model="object">
                        <span class="model-icon">📦</span>
                        <span>物件關聯</span>
                    </div>
                    <div class="model-tab" data-model="semistructured">
                        <span class="model-icon">🔀</span>
                        <span>半結構化</span>
                    </div>
                    <div class="model-tab" data-model="streaming">
                        <span class="model-icon">💧</span>
                        <span>流資料</span>
                    </div>
                    <div class="model-tab" data-model="inmemory">
                        <span class="model-icon">⚡</span>
                        <span>記憶體DB</span>
                    </div>
                    <div class="model-tab" data-model="distributed">
                        <span class="model-icon">🌐</span>
                        <span>分佈式</span>
                    </div>
                    <div class="model-tab" data-model="multitenant">
                        <span class="model-icon">🏢</span>
                        <span>多租戶</span>
                    </div>
                </div>

                <!-- 模型說明區域 -->
                <div id="modelDescription" style="margin-top: 20px; padding: 15px; background: rgba(0, 168, 255, 0.05); border-radius: 10px; border-left: 4px solid var(--secondary);">
                    <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.8;">
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">
                            <i class="fas fa-info-circle"></i> <span id="modelDescTitle">關聯式模型</span>
                        </div>
                        <div id="modelDescContent">
                            <strong>用途：</strong>傳統的關聯式數據庫，使用表格執行和列來存儲數據，支持 ACID 特性。<br>
                            <strong>語法：</strong>標準 SQL 語法 - CREATE TABLE, INSERT, SELECT, UPDATE, DELETE<br>
                            <strong>適用場景：</strong>結構化數據、多表關聯查詢、事務處理
                        </div>
                    </div>
                </div>
            </div>

            <!-- SQL編輯器區域 -->
            <div class="sql-editor-container card">
                <div class="sql-editor-header">
                    <h3><i class="fas fa-terminal"></i> SQL編輯器</h3>
                    <div class="sql-actions">
                        <button id="executeBtn" class="btn btn-primary">
                            <i class="fas fa-play"></i> 執行查詢
                        </button>
                        <button id="clearBtn" class="btn">
                            <i class="fas fa-eraser"></i> 清除
                        </button>
                    </div>
                </div>

                <div class="sql-editor">
                    <div class="sql-input-container">
                        <div style="margin-bottom: 10px; color: var(--text-secondary); font-size: 14px;">
                            <i class="fas fa-info-circle"></i> 輸入SQL語句，每句以分號(;)結束，然後點擊"執行查詢"
                        </div>
                        <textarea id="sqlInput" placeholder="-- 輸入SQL查詢，例如：SELECT * FROM employees;&#10;-- 每條語句必須以分號(;)結束&#10;-- 輸入框無字數限制"></textarea>
                        <div id="sqlErrorDisplay"></div>
                    </div>

                    <div style="color: var(--text-muted); font-size: 14px; margin-top: 15px;">
                        <div><i class="fas fa-lightbulb"></i> 提示：使用 Ctrl+Enter 快速執行查詢 | 每條SQL語句必須以 ; 結束</div>
                    </div>
                </div>

                <!-- 表格預覽區域 -->
                <div id="tablePreview" class="table-preview-container">
                    <div class="table-preview-header">
                        <div class="table-preview-title">
                            <i class="fas fa-table"></i>
                            <span>多用途資料表預覽</span>
                        </div>
                        <div id="tablePreviewBadge" class="table-preview-badge" style="display: none;">
                            <i class="fas fa-check-circle"></i>
                            <span id="previewTableName"></span>
                        </div>
                    </div>
                    <div id="tablePreviewContent" class="table-preview-content">
                        <div class="table-preview-empty">
                            <i class="fas fa-inbox"></i>
                            <p>執行 CREATE TABLE 或 INSERT 語句後，這裡將顯示資料表的完成品預覽</p>
                            <p style="font-size: 0.9rem; margin-top: 10px; opacity: 0.7;">建議：先創建表格結構，再插入資料</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- 完整數據模型面板 (15種) -->
            <div class="all-models-panel" id="allModelsPanel">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">
                    <i class="fas fa-layer-group"></i> 所有數據模型 (15種)
                </h3>
                <div class="models-grid" id="modelsGrid">
                    <!-- 模型卡片將由 JavaScript 動態生成 -->
                </div>
            </div>

            <!-- 資料庫狀態顯示區域 -->
            <div class="result-container card">
                <div class="sql-editor-header">
                    <h3><i class="fas fa-info-circle"></i> 執行結果</h3>
                    <div>
                        <button id="showTablesBtn" class="btn" style="display: none;">
                            <i class="fas fa-eye"></i> 顯示資料表
                        </button>
                    </div>
                </div>

                <div id="output">
                    <div style="text-align: center; padding: 50px 20px; color: var(--text-muted);">
                        <i class="fas fa-database" style="font-size: 48px; margin-bottom: 20px; display: block; opacity: 0.5;"></i>
                        <h3>資料庫狀態將顯示在這裡</h3>
                        <p>請在左側編輯器中輸入SQL語句（以分號 ; 結束）並執行</p>
                    </div>
                </div>

                <!-- 🆕 新功能快速訪問提示 -->
                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, rgba(0, 255, 204, 0.05), rgba(0, 168, 255, 0.05)); border-radius: 10px; border: 1px solid rgba(0, 168, 255, 0.3);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <i class="fas fa-rocket" style="color: var(--accent); font-size: 18px;"></i>
                        <h4 style="color: var(--accent); margin: 0; font-size: 14px;">✨ 試試新功能</h4>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                        <button class="btn" onclick="insertExampleSQL('procedure')" style="font-size: 12px; padding: 8px; background: rgba(0, 204, 136, 0.1); border: 1px solid var(--success);">
                            ⚙️ 存儲過程
                        </button>
                        <button class="btn" onclick="insertExampleSQL('trigger')" style="font-size: 12px; padding: 8px; background: rgba(255, 204, 0, 0.1); border: 1px solid var(--warning);">
                            ⚡ 觸發器
                        </button>
                        <button class="btn" onclick="insertExampleSQL('transaction')" style="font-size: 12px; padding: 8px; background: rgba(255, 102, 178, 0.1); border: 1px solid #ff66b2;">
                            🛡️ 事務管理
                        </button>
                        <button class="btn" onclick="insertExampleSQL('explain')" style="font-size: 12px; padding: 8px; background: rgba(0, 168, 255, 0.1); border: 1px solid var(--info);">
                            📊 性能分析
                        </button>
                    </div>
                    <p style="color: var(--text-muted); font-size: 11px; margin: 8px 0 0 0; text-align: center;">
                        💡 一鍵插入範例代碼到編輯器
                    </p>
                </div>
            </div>

            <!-- 側邊功能區域 -->
            <div class="sidebar">
                <!-- 成就進度顯示 - 緊湊版 -->
                <div class="card" style="background: linear-gradient(135deg, rgba(255, 102, 178, 0.08), rgba(153, 102, 255, 0.08)); border: 1px solid rgba(255, 102, 178, 0.3); padding: 12px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-trophy" style="color: #ff66b2; font-size: 16px;"></i>
                            <span style="color: #ff66b2; font-weight: 600; font-size: 13px;">成就進度</span>
                        </div>
                        <div style="font-size: 18px; font-weight: 700; color: #ff66b2;" id="sidebarAchievements">0/9</div>
                    </div>
                    <button class="btn" onclick="document.getElementById('achievementsBtn').click()" style="width: 100%; font-size: 12px; padding: 8px; background: linear-gradient(135deg, var(--accent), #ff66b2); border: none;">
                        <i class="fas fa-eye"></i> 查看所有成就
                    </button>
                </div>

                <!-- 完整語法參考按鈕 -->
                <div class="card" style="margin-top: 15px;">
                    <button id="fullSyntaxBtn" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-book"></i> 查看完整語法參考
                    </button>
                </div>


            </div>
        </div>

    </div>

    <!-- 新建檔案模態框 -->
    <div id="newFileModal" class="modal">
        <div class="modal-content fade-in">
            <div class="modal-header">
                <h2 class="gradient-text">新建訓練檔案</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="databaseNameInput">
                    <i class="fas fa-database"></i> 資料庫名稱
                </label>
                <input type="text" id="databaseNameInput" class="form-input" placeholder="預設為 Database_Simulator" value="Database_Simulator">
                <div style="margin-top: 5px; color: var(--text-muted); font-size: 0.85em;">
                    💡 可自訂資料庫名稱，預設為「Database_Simulator」
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" for="usernameInput">
                    <i class="fas fa-user-circle"></i> 使用者名稱
                </label>
                <input type="text" id="usernameInput" class="form-input" placeholder="請輸入使用者名稱" value="">
                <div style="margin-top: 5px; color: var(--text-muted); font-size: 0.85em;">
                    ⚠️ 使用者名   為必填項目
                </div>
            </div>
            <button id="createFileBtn" class="btn btn-primary" style="width: 100%; padding: 18px; margin-top: 20px;">
                <i class="fas fa-plus"></i> 、始練習
            </button>
        </div>
    </div>

    <!-- 複習測驗模態框 -->
    <div id="quizModal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="gradient-text"><i class="fas fa-question-circle"></i> 📝 複習資料庫測驗</h2>
                <button class="close-modal">&times;</button>
            </div>

            <!-- 測驗說明 -->
            <div id="quizIntro" style="padding: 20px; background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(192, 108, 132, 0.1)); border-radius: 12px; margin-bottom: 20px;">
                <h3 style="color: var(--accent); margin-bottom: 15px;">📚 測驗說明</h3>
                <ul style="color: var(--text-secondary); line-height: 1.8; margin-left: 20px;">
                    <li>✅ 共100道選擇題，涵蓋資料庫核心知識</li>
                    <li>⏱️ 建議時間：60-90分鐘（不限時）</li>
                    <li>🎯 題目包含：DDL、DML、DQL、事務、索引、優化等</li>
                    <li>📊 完成後會顯示詳細成績和錯題解析</li>
                    <li>🔄 可重複測驗，鞏固知識</li>
                </ul>
                <div style="text-align: center; margin-top: 20px;">
                    <button id="startQuizBtn" class="btn btn-primary" style="font-size: 1.1rem; padding: 14px 40px;">
                        <i class="fas fa-play"></i> 開始測驗
                    </button>
                </div>
            </div>

            <!-- 測驗內容 -->
            <div id="quizContent" style="display: none;">
                <!-- 進度條 -->
                <div style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span style="font-size: 1.1rem; font-weight: 600;">題目 <span id="currentQuestionNum">1</span> / 100</span>
                        <span style="color: var(--text-secondary);">已答：<span id="answeredCount">0</span> 題</span>
                    </div>
                    <div style="width: 100%; height: 8px; background: rgba(0, 168, 255, 0.2); border-radius: 4px; overflow: hidden;">
                        <div id="quizProgress" style="width: 1%; height: 100%; background: var(--gradient-primary); transition: width 0.3s ease;"></div>
                    </div>
                </div>

                <!-- 題目顯示 -->
                <div id="questionDisplay" style="padding: 25px; background: rgba(0, 168, 255, 0.05); border-radius: 12px; border-left: 4px solid var(--accent); margin-bottom: 25px;">
                    <h3 id="questionText" style="color: var(--text-primary); margin-bottom: 20px; line-height: 1.6;"></h3>
                    <div id="optionsContainer"></div>
                </div>

                <!-- 導航按鈕 -->
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <button id="prevQuestionBtn" class="btn" style="flex: 1; min-width: 150px;">
                        <i class="fas fa-arrow-left"></i> 上一題
                    </button>
                    <button id="nextQuestionBtn" class="btn btn-primary" style="flex: 1; min-width: 150px;">
                        下一題 <i class="fas fa-arrow-right"></i>
                    </button>
                    <button id="submitQuizBtn" class="btn" style="flex: 1; min-width: 150px; background: linear-gradient(135deg, #00cc88, #00aa66); border: none; display: none;">
                        <i class="fas fa-check-circle"></i> 提交測驗
                    </button>
                </div>
            </div>

            <!-- 測驗結果 -->
            <div id="quizResults" style="display: none;">
                <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, rgba(0, 204, 136, 0.1), rgba(0, 168, 255, 0.1)); border-radius: 12px; margin-bottom: 20px;">
                    <h2 style="font-size: 2.5rem; margin-bottom: 15px;" id="quizScoreDisplay"></h2>
                    <p style="font-size: 1.3rem; color: var(--text-secondary);" id="quizResultMessage"></p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                    <div style="padding: 20px; background: rgba(0, 204, 136, 0.1); border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; color: var(--success); margin-bottom: 5px;" id="correctCount">0</div>
                        <div style="color: var(--text-secondary);">答對題數</div>
                    </div>
                    <div style="padding: 20px; background: rgba(255, 51, 102, 0.1); border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; color: var(--error); margin-bottom: 5px;" id="wrongCount">0</div>
                        <div style="color: var(--text-secondary);">答錯題數</div>
                    </div>
                    <div style="padding: 20px; background: rgba(255, 204, 0, 0.1); border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; color: var(--warning); margin-bottom: 5px;" id="accuracyRate">0%</div>
                        <div style="color: var(--text-secondary);">正確率</div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button id="retakeQuizBtn" class="btn btn-primary" style="margin-right: 15px;">
                        <i class="fas fa-redo"></i> 重新測驗
                    </button>
                    <button id="reviewWrongBtn" class="btn" style="background: linear-gradient(135deg, rgba(255, 51, 102, 0.3), rgba(255, 102, 153, 0.3));">
                        <i class="fas fa-list"></i> 查看錯題
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 成就系統模態框 -->
    <div id="achievementsModal" class="modal">
        <div class="modal-content fade-in" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="gradient-text"><i class="fas fa-trophy"></i> 🏆 我的成就</h2>
                <button class="close-modal">&times;</button>
            </div>

            <div id="achievementsContent" style="padding: 20px;">
                <!-- 總體進度 -->
                <div style="margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, rgba(0, 255, 204, 0.1), rgba(0, 168, 255, 0.1)); border-radius: 16px; border: 2px solid var(--accent);">
                    <h3 style="color: var(--accent); margin-bottom: 15px;"><i class="fas fa-chart-line"></i> 學習進度總覽</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: rgba(0, 168, 255, 0.1); border-radius: 10px;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--accent);" id="totalAchievements">0/9</div>
                            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 5px;">已解鎖成就</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(0, 204, 136, 0.1); border-radius: 10px;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--success);" id="sqlExecutions">0</div>
                            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 5px;">SQL 執行次數</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255, 204, 0, 0.1); border-radius: 10px;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--warning);" id="tablesCreated">0</div>
                            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 5px;">創建表格數</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255, 102, 178, 0.1); border-radius: 10px;">
                            <div style="font-size: 32px; font-weight: 700; color: #ff66b2;" id="joinsPerformed">0</div>
                            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 5px;">JOIN 查詢次數</div>
                        </div>
                    </div>
                </div>

                <!-- 成就列表 -->
                <h3 style="color: var(--text-primary); margin-bottom: 20px;"><i class="fas fa-award"></i> 成就徽章</h3>
                <div id="achievementsList" style="display: grid; gap: 15px;">
                    <!-- 動態生成成就卡片 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 流程圖模態框 -->
    <div id="flowchartModal" class="modal">
        <div class="modal-content fade-in" style="max-width: 1400px; max-height: 95vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="gradient-text">📊 模擬資料庫流程圖</h2>
                <button class="close-modal">&times;</button>
            </div>

            <!-- 總覽說明 -->
            <div style="margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 153, 255, 0.1)); border-radius: 12px; border-left: 5px solid #00d4ff;">
                <h3 style="color: #00d4ff; margin-bottom: 12px;"><i class="fas fa-info-circle"></i> 系統架構總覽</h3>
                <p style="color: var(--text-primary); line-height: 1.8; font-size: 1.05rem;">
                    本模擬器採用<strong>瀏覽器端模擬架構</strong>，使用 JavaScript 實現完整的 Oracle 資料庫功能，
                    所有數據存儲於<strong>瀏覽器內存</strong>中。以下流程圖展示了系統的完整運作流程。
                </p>
            </div>

                        <!-- 主流程圖 -->
            <div style="margin-bottom: 40px;">
                <h3 style="color: var(--accent); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">
                    <i class="fas fa-sitemap"></i> 核心執行流程
                </h3>

                <!-- 提示區域 -->
                <div style="text-align: center; margin-bottom: 15px; padding: 12px; background: rgba(0, 212, 255, 0.1); border-radius: 8px;">
                    <p style="color: var(--text-secondary); font-size: 0.95rem;">
                        <i class="fas fa-mouse-pointer"></i> 電腦上可用<strong>滑鼠滾輪</strong>縮放，手機上可用<strong>雙指縮放</strong>查看細節
                    </p>
                </div>

                <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 16px; position: relative; overflow: auto; max-height: 900px;">
                    <!-- SVG 容器支援縮放 -->
                    <div id="flowchartContainer" style="transform-origin: center top; transition: transform 0.3s ease; min-width: 100%; cursor: grab;">
                        <svg width="100%" viewBox="0 0 1000 1600" style="max-width: 100%; height: auto; min-height: 800px;" preserveAspectRatio="xMidYMid meet">
                            <defs>
                                <linearGradient id="flowGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#0099ff;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="flowGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#00ff7f;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#00cc88;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="flowGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ffcc00;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#ff9900;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="flowGrad4" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ff66b2;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#ff3385;stop-opacity:1" />
                                </linearGradient>
                                <marker id="flowArrow" markerWidth="12" markerHeight="12" refX="10" refY="4" orient="auto">
                                    <polygon points="0 0, 12 4, 0 8" fill="#00ffcc" />
                                </marker>
                            </defs>

                            <!-- 開始節點 -->
                            <ellipse cx="500" cy="60" rx="140" ry="45" fill="url(#flowGrad1)" stroke="#00d4ff" stroke-width="3"/>
                            <text x="500" y="70" text-anchor="middle" fill="white" font-size="22" font-weight="bold">🚀 開始使用</text>

                            <!-- 箭頭1 -->
                            <line x1="500" y1="105" x2="500" y2="170" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>

                            <!-- 1. SQL 輸入 -->
                            <rect x="350" y="170" width="300" height="100" rx="15" fill="url(#flowGrad1)" stroke="#00d4ff" stroke-width="3"/>
                            <text x="500" y="205" text-anchor="middle" fill="white" font-size="20" font-weight="bold">1️⃣ 用戶輸入 SQL</text>
                            <text x="500" y="235" text-anchor="middle" fill="white" font-size="16">編寫查詢語句</text>
                            <text x="500" y="255" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="13">支援多條語句批次執行</text>

                            <!-- 箭頭2 -->
                            <line x1="500" y1="270" x2="500" y2="340" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>

                            <!-- 2. 語法檢查 -->
                            <rect x="350" y="340" width="300" height="100" rx="15" fill="url(#flowGrad2)" stroke="#00ff7f" stroke-width="3"/>
                            <text x="500" y="375" text-anchor="middle" fill="white" font-size="20" font-weight="bold">2️⃣ 智能語法檢查</text>
                            <text x="500" y="405" text-anchor="middle" fill="white" font-size="16">18種錯誤類型診斷</text>
                            <text x="500" y="425" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="13">提供修正建議</text>

                            <!-- 箭頭3 -->
                            <line x1="500" y1="440" x2="500" y2="510" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>

                            <!-- 判斷節點 -->
                            <path d="M 500 510 L 620 580 L 500 650 L 380 580 Z" fill="url(#flowGrad3)" stroke="#ffcc00" stroke-width="3"/>
                            <text x="500" y="575" text-anchor="middle" fill="white" font-size="19" font-weight="bold">語法正確?</text>
                            <text x="500" y="600" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-size="14">檢查結構、約束</text>

                            <!-- 錯誤路徑 -->
                            <line x1="620" y1="580" x2="780" y2="580" stroke="#ff6666" stroke-width="3" marker-end="url(#flowArrow)"/>
                            <text x="700" y="565" text-anchor="middle" fill="#ff6666" font-size="17" font-weight="bold">✗ 否</text>

                            <rect x="780" y="530" width="200" height="100" rx="15" fill="#ff6666" stroke="#ff3333" stroke-width="3"/>
                            <text x="880" y="565" text-anchor="middle" fill="white" font-size="18" font-weight="bold">❌ 顯示錯誤</text>
                            <text x="880" y="590" text-anchor="middle" fill="white" font-size="14">中文錯誤說明</text>
                            <text x="880" y="610" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="12">提供3條修正建議</text>

                            <!-- 正確路徑 -->
                            <line x1="500" y1="650" x2="500" y2="720" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>
                            <text x="540" y="690" text-anchor="start" fill="#00ff7f" font-size="17" font-weight="bold">✓ 是</text>

                            <!-- 3. SQL 解析 -->
                            <rect x="350" y="720" width="300" height="100" rx="15" fill="url(#flowGrad1)" stroke="#00d4ff" stroke-width="3"/>
                            <text x="500" y="755" text-anchor="middle" fill="white" font-size="20" font-weight="bold">3️⃣ SQL 解析</text>
                            <text x="500" y="785" text-anchor="middle" fill="white" font-size="16">分析語句類型</text>
                            <text x="500" y="805" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="13">DDL/DML/DQL/DCL/PL-SQL</text>

                            <!-- 箭頭4 -->
                            <line x1="500" y1="820" x2="500" y2="890" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>

                            <!-- 4. 執行引擎 -->
                            <rect x="330" y="890" width="340" height="120" rx="15" fill="url(#flowGrad4)" stroke="#ff66b2" stroke-width="4"/>
                            <text x="500" y="930" text-anchor="middle" fill="white" font-size="22" font-weight="bold">4️⃣ 執行引擎</text>
                            <text x="500" y="960" text-anchor="middle" fill="white" font-size="16">資料庫核心處理</text>
                            <text x="500" y="985" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-size="14">事務管理 + 約束驗證 + 索引優化</text>

                            <!-- 分支到不同操作類型 -->
                            <line x1="300" y1="950" x2="100" y2="1080" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>
                            <line x1="500" y1="1010" x2="500" y2="1080" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>
                            <line x1="700" y1="950" x2="900" y2="1080" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>

                            <!-- DDL: CREATE/ALTER/DROP -->
                            <rect x="0" y="1080" width="200" height="90" rx="12" fill="#9966ff" stroke="#7744dd" stroke-width="3"/>
                            <text x="100" y="1110" text-anchor="middle" fill="white" font-size="17" font-weight="bold">DDL 資料定義</text>
                            <text x="100" y="1135" text-anchor="middle" fill="white" font-size="14">CREATE/ALTER</text>
                            <text x="100" y="1155" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="12">DROP TABLE/VIEW</text>

                            <!-- DML: INSERT/UPDATE/DELETE -->
                            <rect x="400" y="1080" width="200" height="90" rx="12" fill="#00cc88" stroke="#00aa66" stroke-width="3"/>
                            <text x="500" y="1110" text-anchor="middle" fill="white" font-size="17" font-weight="bold">DML 資料操作</text>
                            <text x="500" y="1135" text-anchor="middle" fill="white" font-size="14">INSERT/UPDATE</text>
                            <text x="500" y="1155" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="12">DELETE 數據</text>

                            <!-- DQL: SELECT/JOIN -->
                            <rect x="800" y="1080" width="200" height="90" rx="12" fill="#3399ff" stroke="#0066cc" stroke-width="3"/>
                            <text x="900" y="1110" text-anchor="middle" fill="white" font-size="17" font-weight="bold">DQL 資料查詢</text>
                            <text x="900" y="1135" text-anchor="middle" fill="white" font-size="14">SELECT/JOIN</text>
                            <text x="900" y="1155" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="12">聚合函數</text>

                            <!-- 匯聚到結果處理 -->
                            <line x1="100" y1="1170" x2="500" y2="1250" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>
                            <line x1="500" y1="1170" x2="500" y2="1250" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>
                            <line x1="900" y1="1170" x2="500" y2="1250" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>

                            <!-- 5. 結果處理 -->
                            <rect x="350" y="1250" width="300" height="100" rx="15" fill="url(#flowGrad2)" stroke="#00ff7f" stroke-width="3"/>
                            <text x="500" y="1285" text-anchor="middle" fill="white" font-size="20" font-weight="bold">5️⃣ 結果處理</text>
                            <text x="500" y="1315" text-anchor="middle" fill="white" font-size="16">格式化輸出</text>
                            <text x="500" y="1335" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="13">表格 + 視覺化圖表</text>

                            <!-- 箭頭5 -->
                            <line x1="500" y1="1350" x2="500" y2="1420" stroke="#00ffcc" stroke-width="3" marker-end="url(#flowArrow)"/>

                            <!-- 結束節點 -->
                            <ellipse cx="500" cy="1480" rx="140" ry="45" fill="url(#flowGrad2)" stroke="#00ff7f" stroke-width="3"/>
                            <text x="500" y="1490" text-anchor="middle" fill="white" font-size="22" font-weight="bold">✅ 顯示結果</text>
                        </svg>
                    </div>
                </div>

                <!-- 添加縮放腳本 -->
                <script>
                (function() {
                    const container = document.getElementById('flowchartContainer');
                    if (!container) return;

                    let scale = 1;
                    const minScale = 0.5;
                    const maxScale = 2.5;

                    // 滑鼠滾輪縮放（僅桌面）
                    container.parentElement.addEventListener('wheel', (e) => {
                        if (window.innerWidth > 768) { // 僅在桌面啟用
                            e.preventDefault();
                            const delta = e.deltaY > 0 ? -0.1 : 0.1;
                            scale = Math.min(Math.max(scale + delta, minScale), maxScale);
                            container.style.transform = `scale(${scale})`;
                        }
                    }, { passive: false });
                })();
                </script>
            </div>

            <!-- 功能分類腦圖 -->
            <div style="margin-bottom: 40px;">
                <h3 style="color: var(--accent); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">
                    <i class="fas fa-brain"></i> 功能分類腦圖
                </h3>
                <div class="flowchart-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px;">

                    <!-- DDL 分支 -->
                    <div style="background: linear-gradient(135deg, rgba(153, 102, 255, 0.1), rgba(119, 68, 221, 0.1)); padding: 25px; border-radius: 16px; border-left: 5px solid #9966ff;">
                        <h4 style="color: #9966ff; margin-bottom: 15px; font-size: 1.2rem;"><i class="fas fa-database"></i> DDL - 資料定義語言</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="background: rgba(153, 102, 255, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">CREATE</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">TABLE, VIEW, INDEX, SEQUENCE, SYNONYM, PACKAGE, TABLESPACE</p>
                            </div>
                            <div style="background: rgba(153, 102, 255, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">ALTER</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">ADD COLUMN, MODIFY, DROP COLUMN</p>
                            </div>
                            <div style="background: rgba(153, 102, 255, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">DROP</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">刪除資料庫物件</p>
                            </div>
                        </div>
                    </div>

                    <!-- DML 分支 -->
                    <div style="background: linear-gradient(135deg, rgba(0, 204, 136, 0.1), rgba(0, 170, 102, 0.1)); padding: 25px; border-radius: 16px; border-left: 5px solid #00cc88;">
                        <h4 style="color: #00cc88; margin-bottom: 15px; font-size: 1.2rem;"><i class="fas fa-edit"></i> DML - 資料操作語言</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="background: rgba(0, 204, 136, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">INSERT</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">新增數據，支援 NEXTVAL/CURRVAL</p>
                            </div>
                            <div style="background: rgba(0, 204, 136, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">UPDATE</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">更新數據，支援 WHERE 條件</p>
                            </div>
                            <div style="background: rgba(0, 204, 136, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">DELETE</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">刪除數據，支援條件過濾</p>
                            </div>
                        </div>
                    </div>

                    <!-- DQL 分支 -->
                    <div style="background: linear-gradient(135deg, rgba(51, 153, 255, 0.1), rgba(0, 102, 204, 0.1)); padding: 25px; border-radius: 16px; border-left: 5px solid #3399ff;">
                        <h4 style="color: #3399ff; margin-bottom: 15px; font-size: 1.2rem;"><i class="fas fa-search"></i> DQL - 資料查詢語言</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="background: rgba(51, 153, 255, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">SELECT</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">基本查詢，WHERE, ORDER BY, GROUP BY</p>
                            </div>
                            <div style="background: rgba(51, 153, 255, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">JOIN</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">INNER, LEFT, RIGHT JOIN</p>
                            </div>
                            <div style="background: rgba(51, 153, 255, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">聚合函數</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">COUNT, SUM, AVG, MAX, MIN</p>
                            </div>
                        </div>
                    </div>

                    <!-- PL/SQL 分支 -->
                    <div style="background: linear-gradient(135deg, rgba(255, 102, 178, 0.1), rgba(255, 51, 133, 0.1)); padding: 25px; border-radius: 16px; border-left: 5px solid #ff66b2;">
                        <h4 style="color: #ff66b2; margin-bottom: 15px; font-size: 1.2rem;"><i class="fas fa-cogs"></i> PL/SQL - 程序化語言</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="background: rgba(255, 102, 178, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">PROCEDURE</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">存儲過程，封裝業務邏輯</p>
                            </div>
                            <div style="background: rgba(255, 102, 178, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">FUNCTION</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">函數，返回計算結果</p>
                            </div>
                            <div style="background: rgba(255, 102, 178, 0.2); padding: 12px; border-radius: 8px;">
                                <strong style="color: var(--text-primary);">TRIGGER</strong>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">觸發器，自動執行操作</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- 數據模型分類 -->
            <div style="margin-bottom: 40px;">
                <h3 style="color: var(--accent); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">
                    <i class="fas fa-layer-group"></i> 15種數據模型分類
                </h3>
                <div style="background: rgba(0, 0, 0, 0.2); padding: 25px; border-radius: 16px;">
                    <div class="models-grid-3col" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(0, 168, 255, 0.15), rgba(0, 102, 204, 0.15)); border-radius: 10px; border: 2px solid #00a8ff;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">📊</div>
                            <strong style="color: var(--text-primary);">關聯式</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">表格結構</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(255, 204, 0, 0.15), rgba(255, 153, 0, 0.15)); border-radius: 10px; border: 2px solid #ffcc00;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">📄</div>
                            <strong style="color: var(--text-primary);">JSON</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">文件存儲</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(255, 153, 0, 0.15), rgba(255, 102, 0, 0.15)); border-radius: 10px; border: 2px solid #ff9900;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">📋</div>
                            <strong style="color: var(--text-primary);">XML</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">標籤結構</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(0, 255, 127, 0.15), rgba(0, 204, 102, 0.15)); border-radius: 10px; border: 2px solid #00ff7f;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">🔗</div>
                            <strong style="color: var(--text-primary);">圖形</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">節點關係</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(51, 153, 255, 0.15), rgba(0, 204, 255, 0.15)); border-radius: 10px; border: 2px solid #3399ff;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">🗺️</div>
                            <strong style="color: var(--text-primary);">空間</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">地理數據</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(255, 99, 71, 0.15), rgba(255, 69, 0, 0.15)); border-radius: 10px; border: 2px solid #ff6347;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">⛓️</div>
                            <strong style="color: var(--text-primary);">區塊鏈</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">鏈式存儲</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(255, 102, 178, 0.15), rgba(255, 51, 153, 0.15)); border-radius: 10px; border: 2px solid #ff66b2;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">🔑</div>
                            <strong style="color: var(--text-primary);">鍵值</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">Key-Value</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(0, 204, 136, 0.15), rgba(0, 255, 154, 0.15)); border-radius: 10px; border: 2px solid #00cc88;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">📈</div>
                            <strong style="color: var(--text-primary);">時間序列</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">時序數據</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(0, 255, 127, 0.15), rgba(0, 250, 154, 0.15)); border-radius: 10px; border: 2px solid #00ff7f;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">🔍</div>
                            <strong style="color: var(--text-primary);">全文檢索</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">文本搜索</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(255, 20, 147, 0.15), rgba(199, 21, 133, 0.15)); border-radius: 10px; border: 2px solid #ff1493;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">📦</div>
                            <strong style="color: var(--text-primary);">物件</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">OOP模型</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(64, 224, 208, 0.15), rgba(72, 209, 204, 0.15)); border-radius: 10px; border: 2px solid #40e0d0;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">🔀</div>
                            <strong style="color: var(--text-primary);">半結構化</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">彈性結構</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 223, 0, 0.15)); border-radius: 10px; border: 2px solid #ffd700;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">💧</div>
                            <strong style="color: var(--text-primary);">串流</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">實時數據</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(147, 112, 219, 0.15), rgba(138, 43, 226, 0.15)); border-radius: 10px; border: 2px solid #9370db;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">⚡</div>
                            <strong style="color: var(--text-primary);">內存</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">極速讀寫</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(30, 144, 255, 0.15), rgba(65, 105, 225, 0.15)); border-radius: 10px; border: 2px solid #1e90ff;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">🌐</div>
                            <strong style="color: var(--text-primary);">分散式</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">分布存儲</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, rgba(255, 140, 0, 0.15), rgba(255, 165, 0, 0.15)); border-radius: 10px; border: 2px solid #ff8c00;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">🏢</div>
                            <strong style="color: var(--text-primary);">多租戶</strong>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">數據隔離</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 操作流程步驟 -->
            <div style="margin-bottom: 40px;">
                <h3 style="color: var(--accent); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">
                    <i class="fas fa-tasks"></i> 典型操作流程
                </h3>
                <div class="operations-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">

                    <!-- 創建表流程 -->
                    <div style="background: linear-gradient(135deg, rgba(153, 102, 255, 0.1), rgba(119, 68, 221, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #9966ff;">
                        <h4 style="color: #9966ff; margin-bottom: 15px;"><i class="fas fa-table"></i> 創建表流程</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #9966ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                                <div style="color: var(--text-secondary);">輸入 CREATE TABLE 語句</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #9966ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                                <div style="color: var(--text-secondary);">解析表名、欄位、約束</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #9966ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                                <div style="color: var(--text-secondary);">創建元數據結構</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #9966ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                                <div style="color: var(--text-secondary);">初始化空數據陣列</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #9966ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">5</div>
                                <div style="color: var(--text-secondary);">顯示表格預覽</div>
                            </div>
                        </div>
                    </div>

                    <!-- 查詢數據流程 -->
                    <div style="background: linear-gradient(135deg, rgba(51, 153, 255, 0.1), rgba(0, 102, 204, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #3399ff;">
                        <h4 style="color: #3399ff; margin-bottom: 15px;"><i class="fas fa-search"></i> 查詢數據流程</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #3399ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                                <div style="color: var(--text-secondary);">輸入 SELECT 語句</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #3399ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                                <div style="color: var(--text-secondary);">解析表名、欄位、條件</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #3399ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                                <div style="color: var(--text-secondary);">WHERE 過濾數據</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #3399ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                                <div style="color: var(--text-secondary);">ORDER BY 排序</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #3399ff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">5</div>
                                <div style="color: var(--text-secondary);">返   結果集 + 視覺化</div>
                            </div>
                        </div>
                    </div>

                    <!-- JOIN 查詢流程 -->
                    <div style="background: linear-gradient(135deg, rgba(255, 102, 178, 0.1), rgba(255, 51, 133, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #ff66b2;">
                        <h4 style="color: #ff66b2; margin-bottom: 15px;"><i class="fas fa-link"></i> JOIN 查詢流程</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ff66b2; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                                <div style="color: var(--text-secondary);">解析 JOIN 類型和條件</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ff66b2; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                                <div style="color: var(--text-secondary);">讀取左右兩表數據</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ff66b2; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                                <div style="color: var(--text-secondary);">執行 ON 條件匹配</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ff66b2; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                                <div style="color: var(--text-secondary);">合併結果，加表名前綴</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ff66b2; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">5</div>
                                <div style="color: var(--text-secondary);">返回連接結果</div>
                            </div>
                        </div>
                    </div>

                    <!-- 事務處理流程 -->
                    <div style="background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 153, 0, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #ffcc00;">
                        <h4 style="color: #ffcc00; margin-bottom: 15px;"><i class="fas fa-shield-alt"></i> 事務處理流程</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ffcc00; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                                <div style="color: var(--text-secondary);">BEGIN 開始事務</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ffcc00; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                                <div style="color: var(--text-secondary);">創建數據快照備份</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ffcc00; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                                <div style="color: var(--text-secondary);">執行多條 DML 語句</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ffcc00; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                                <div style="color: var(--text-secondary);">COMMIT 提交 / ROLLBACK 回滾</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="min-width: 30px; height: 30px; border-radius: 50%; background: #ffcc00; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">5</div>
                                <div style="color: var(--text-secondary);">應用或還原更改</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- 進階功能說明 - 快速上手指南未涵蓋的內容 -->
            <div style="margin-bottom: 40px;">
                <h3 style="color: var(--accent); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">
                    <i class="fas fa-graduation-cap"></i> 進階功能說明
                </h3>
                <div style="background: linear-gradient(135deg, rgba(0, 255, 204, 0.1), rgba(0, 212, 255, 0.1)); padding: 25px; border-radius: 16px; border-left: 5px solid var(--accent); margin-bottom: 20px;">
                    <p style="color: var(--text-secondary); font-size: 1rem; line-height: 1.8; margin-bottom: 15px;">
                        以下功能在<strong style="color: var(--accent);">快速上手指南</strong>中未詳細說明，但對進階學習非常重要：
                    </p>
                </div>

                <div class="operations-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">

                    <!-- 進階索引功能 -->
                    <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #ffd700;">
                        <h4 style="color: #ffd700; margin-bottom: 15px;"><i class="fas fa-bolt"></i> 進階索引功能</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem; margin-left: 20px;">
                            <li><strong style="color: var(--text-primary);">複合索引 (Composite Index)</strong><br>
                                <span style="font-size: 0.85rem;">CREATE INDEX idx_name ON table(col1, col2);</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">唯一索引 (Unique Index)</strong><br>
                                <span style="font-size: 0.85rem;">CREATE UNIQUE INDEX idx_name ON table(col);</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">函數索引 (Function-Based Index)</strong><br>
                                <span style="font-size: 0.85rem;">CREATE INDEX idx_name ON table(UPPER(col));</span>
                            </li>
                        </ul>
                    </div>

                    <!-- 視圖與物化視圖 -->
                    <div style="background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(147, 112, 219, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #9370db;">
                        <h4 style="color: #9370db; margin-bottom: 15px;"><i class="fas fa-eye"></i> 視圖與物化視圖</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem; margin-left: 20px;">
                            <li><strong style="color: var(--text-primary);">一般視圖 (VIEW)</strong><br>
                                <span style="font-size: 0.85rem;">虛擬表，每次查詢時動態生成結果</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">物化視圖 (MATERIALIZED VIEW)</strong><br>
                                <span style="font-size: 0.85rem;">實體存儲查詢結果，提升查詢效能</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">視圖更新</strong><br>
                                <span style="font-size: 0.85rem;">REFRESH MATERIALIZED VIEW view_name;</span>
                            </li>
                        </ul>
                    </div>

                    <!-- 序列與自動編號 -->
                    <div style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1), rgba(30, 144, 255, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #00bfff;">
                        <h4 style="color: #00bfff; margin-bottom: 15px;"><i class="fas fa-sort-numeric-up"></i> 序列與自動編號</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem; margin-left: 20px;">
                            <li><strong style="color: var(--text-primary);">SEQUENCE 序列</strong><br>
                                <span style="font-size: 0.85rem;">CREATE SEQUENCE seq_name START WITH 1;</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">NEXTVAL 取下一個值</strong><br>
                                <span style="font-size: 0.85rem;">INSERT INTO t VALUES (seq_name.NEXTVAL, 'data');</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">CURRVAL 取當前值</strong><br>
                                <span style="font-size: 0.85rem;">SELECT seq_name.CURRVAL FROM DUAL;</span>
                            </li>
                        </ul>
                    </div>

                    <!-- 同   詞與套件 -->
                    <div style="background: linear-gradient(135deg, rgba(255, 99, 71, 0.1), rgba(255, 127, 80, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #ff6347;">
                        <h4 style="color: #ff6347; margin-bottom: 15px;"><i class="fas fa-link"></i> 同義詞與套件</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem; margin-left: 20px;">
                            <li><strong style="color: var(--text-primary);">同義詞 (SYNONYM)</strong><br>
                                <span style="font-size: 0.85rem;">為表、視圖等創建別名，簡化訪問</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">套件 (PACKAGE)</strong><br>
                                <span style="font-size: 0.85rem;">封裝相關的程序、函數和變數</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">套件規範與主體</strong><br>
                                <span style="font-size: 0.85rem;">PACKAGE SPECIFICATION + PACKAGE BODY</span>
                            </li>
                        </ul>
                    </div>

                    <!-- 觸發器與事件 -->
                    <div style="background: linear-gradient(135deg, rgba(255, 20, 147, 0.1), rgba(219, 112, 147, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #ff1493;">
                        <h4 style="color: #ff1493; margin-bottom: 15px;"><i class="fas fa-magic"></i> 觸發器進階應用</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem; margin-left: 20px;">
                            <li><strong style="color: var(--text-primary);">BEFORE / AFTER 觸發器</strong><br>
                                <span style="font-size: 0.85rem;">在操作前後自動執行特定邏輯</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">ROW 級別 vs STATEMENT 級別</strong><br>
                                <span style="font-size: 0.85rem;">FOR EACH ROW 或 FOR EACH STATEMENT</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">:NEW 和 :OLD 變數</strong><br>
                                <span style="font-size: 0.85rem;">訪問修改前後的數據值</span>
                            </li>
                        </ul>
                    </div>

                    <!-- 分區表與表空間 -->
                    <div style="background: linear-gradient(135deg, rgba(34, 139, 34, 0.1), rgba(50, 205, 50, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #32cd32;">
                        <h4 style="color: #32cd32; margin-bottom: 15px;"><i class="fas fa-layer-group"></i> 分區表與表空間</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem; margin-left: 20px;">
                            <li><strong style="color: var(--text-primary);">TABLESPACE 表空間</strong><br>
                                <span style="font-size: 0.85rem;">物理存儲空間的邏輯劃分</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">PARTITION 分區表</strong><br>
                                <span style="font-size: 0.85rem;">將大表分割成多個物理段以提升性能</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">分區類型</strong><br>
                                <span style="font-size: 0.85rem;">RANGE, LIST, HASH, COMPOSITE 分區</span>
                            </li>
                        </ul>
                    </div>

                    <!-- 資料匯入匯出 -->
                    <div style="background: linear-gradient(135deg, rgba(64, 224, 208, 0.1), rgba(72, 209, 204, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #40e0d0;">
                        <h4 style="color: #40e0d0; margin-bottom: 15px;"><i class="fas fa-file-export"></i> 資料匯入匯出</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem; margin-left: 20px;">
                            <li><strong style="color: var(--text-primary);">完整資料匯出 (JSON)</strong><br>
                                <span style="font-size: 0.85rem;">匯出所有表結構、數據、索引等完整資訊</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">專業 PDF 報告</strong><br>
                                <span style="font-size: 0.85rem;">生成包含統計、圖表的完整報告</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">SQL 腳本匯出</strong><br>
                                <span style="font-size: 0.85rem;">匯出可執行的 CREATE 和 INSERT 語句</span>
                            </li>
                        </ul>
                    </div>

                    <!-- 15種數據模型 -->
                    <div style="background: linear-gradient(135deg, rgba(186, 85, 211, 0.1), rgba(147, 112, 219, 0.1)); padding: 20px; border-radius: 12px; border-left: 5px solid #ba55d3;">
                        <h4 style="color: #ba55d3; margin-bottom: 15px;"><i class="fas fa-database"></i> 15種數據模型支援</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem; margin-left: 20px;">
                            <li><strong style="color: var(--text-primary);">多模型資料庫</strong><br>
                                <span style="font-size: 0.85rem;">支援關聯式、JSON、XML、圖形等15種模型</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">JSON 存儲與查詢</strong><br>
                                <span style="font-size: 0.85rem;">JSON_VALUE, JSON_QUERY 函數</span>
                            </li>
                            <li><strong style="color: var(--text-primary);">空間數據與區塊鏈</strong><br>
                                <span style="font-size: 0.85rem;">地理資訊系統和分散式帳本技術</span>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>

            <!-- 關鍵提示 -->
            <div style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 87, 34, 0.1)); padding: 25px; border-radius: 12px; border-left: 5px solid #ff9800;">
                <h3 style="color: #ff9800; margin-bottom: 15px;"><i class="fas fa-lightbulb"></i> 重要提示</h3>
                <ul style="color: var(--text-secondary); line-height: 2; font-size: 1.05rem; margin-left: 20px;">
                    <li>所有數據存儲於<strong style="color: var(--text-primary);">瀏覽器內存</strong>，關閉頁面後將不保存</li>
                    <li>建議使用<strong style="color: var(--text-primary);">「完整資料匯出」</strong>功能保存學習成果</li>
                    <li>支援<strong style="color: var(--text-primary);">多條 SQL 語句</strong>同時執行，用分號分隔</li>
                    <li>每個功能都有<strong style="color: var(--text-primary);">詳細錯誤提示</strong>和修正建議</li>
                    <li>使用<strong style="color: var(--text-primary);">成就系統</strong>追蹤學習進度</li>
                </ul>
            </div>

        </div>
    </div>

    <!-- 玩、說明模態框 -->
    <div id="howToPlayModal" class="modal">
        <div class="modal-content fade-in" style="max-width: 1100px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="gradient-text">🎯 快速上手指南</h2>
                <button class="close-modal">&times;</button>
            </div>

            <!-- 快速介紹 -->
            <div style="margin-bottom: 25px; padding: 20px; background: linear-gradient(135deg, rgba(0, 255, 204, 0.1), rgba(0, 168, 255, 0.1)); border-radius: 12px; border-left: 4px solid var(--accent);">
                <h3 style="color: var(--accent); margin-bottom: 10px;"><i class="fas fa-rocket"></i> 這是什麼？</h3>
                <p style="color: var(--text-primary); line-height: 1.8; font-size: 1.05rem;">
                    <strong>免費的 Oracle SQL 學習平台</strong>，在瀏覽器直接練習，無需安裝任何軟件。
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px; margin-top: 15px;">
                    <div style="background: rgba(0,255,204,0.1); padding: 12px; border-radius: 8px;">
                        ✅ <strong>即時檢查</strong> - 語法錯誤立即提示
                    </div>
                    <div style="background: rgba(0,255,204,0.1); padding: 12px; border-radius: 8px;">
                        ✅ <strong>完全免費</strong> - 所有功能永久免費
                    </div>
                    <div style="background: rgba(0,255,204,0.1); padding: 12px; border-radius: 8px;">
                        ✅ <strong>多平台</strong> - 電腦、手機、平板都能用
                    </div>
                </div>
            </div>

            <!-- 三步驟開始 -->
            <div style="margin-bottom: 25px;">
                <h3 style="color: var(--accent); margin-bottom: 15px;"><i class="fas fa-play-circle"></i> 三步驟開始</h3>
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; align-items: start; gap: 15px; padding: 15px; background: rgba(0,168,255,0.05); border-radius: 10px;">
                        <div style="min-width: 40px; height: 40px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem;">1</div>
                        <div>
                            <h4 style="color: var(--text-primary); margin-bottom: 5px;">輸入 SQL</h4>
                            <p style="color: var(--text-secondary); font-size: 0.95rem;">在編輯器寫 SQL，每句結尾加分號 <code>;</code></p>
                            <code style="display: block; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px; margin-top: 8px; font-size: 0.9rem;">
                                CREATE TABLE students (id NUMBER, name VARCHAR2(50));
                            </code>
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 15px; padding: 15px; background: rgba(0,168,255,0.05); border-radius: 10px;">
                        <div style="min-width: 40px; height: 40px; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem;">2</div>
                        <div>
                            <h4 style="color: var(--text-primary); margin-bottom: 5px;">執行查詢</h4>
                            <p style="color: var(--text-secondary); font-size: 0.95rem;">按 <code>Ctrl+Enter</code> 或點「執行查詢」按鈕</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 15px; padding: 15px; background: rgba(0,168,255,0.05); border-radius: 10px;">
                        <div style="min-width: 40px; height: 40px; background: var(--warning); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem;">3</div>
                        <div>
                            <h4 style="color: var(--text-primary); margin-bottom: 5px;">查看結果</h4>
                            <p style="color: var(--text-secondary); font-size: 0.95rem;">成功顯示綠色✅，錯誤顯示紅色❌和修正建議</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 主要功能按鈕 -->
            <div style="margin-bottom: 25px;">
                <h3 style="color: var(--accent); margin-bottom: 15px;"><i class="fas fa-magic"></i> 主要功能</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <div style="padding: 12px; background: rgba(0,204,136,0.1); border-radius: 8px; border-left: 3px solid var(--success);">
                        <strong style="color: var(--success);">🚀 執行查詢</strong>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">運行 SQL 語句</p>
                    </div>
                    <div style="padding: 12px; background: rgba(0,168,255,0.1); border-radius: 8px; border-left: 3px solid var(--info);">
                        <strong style="color: var(--info);">👁 顯示資料表</strong>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">查看所有表和對象</p>
                    </div>
                    <div style="padding: 12px; background: rgba(255,204,0,0.1); border-radius: 8px; border-left: 3px solid var(--warning);">
                        <strong style="color: var(--warning);">💾 所有儲存</strong>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">臨時保存（記憶體）</p>
                    </div>
                    <div style="padding: 12px; background: rgba(255,51,102,0.1); border-radius: 8px; border-left: 3px solid var(--error);">
                        <strong style="color: var(--error);">📥 匯出報告</strong>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">永久保存（PDF檔案）</p>
                    </div>
                </div>
            </div>

            <!-- 新功能速覽 -->
            <div style="margin-bottom: 25px;">
                <h3 style="color: var(--accent); margin-bottom: 15px;"><i class="fas fa-star"></i> Oracle 專業功能</h3>
                <div style="display: grid; gap: 10px;">
                    <details style="background: rgba(0,255,204,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid var(--accent);">
                        <summary style="cursor: pointer; font-weight: 600; color: var(--accent);">🔢 SEQUENCE（自動序號）</summary>
                        <div style="margin-top: 10px; padding-left: 10px; color: var(--text-secondary);">
                            <p style="margin-bottom: 8px;">自動生成遞增數字，常用於主鍵 ID</p>
                            <code style="display: block; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; font-size: 0.85rem; white-space: pre-wrap;">CREATE SEQUENCE emp_seq START WITH 1;
INSERT INTO emp VALUES (emp_seq.NEXTVAL, '張三');</code>
                        </div>
                    </details>

                    <details style="background: rgba(0,255,204,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid var(--success);">
                        <summary style="cursor: pointer; font-weight: 600; color: var(--success);">⚙️ PL/SQL（程序、函數、觸發器）</summary>
                        <div style="margin-top: 10px; padding-left: 10px; color: var(--text-secondary);">
                            <p style="margin-bottom: 8px;">創建存儲過程、函數、觸發器</p>
                            <code style="display: block; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; font-size: 0.85rem; white-space: pre-wrap;">CREATE PROCEDURE add_emp(name VARCHAR2) AS
BEGIN
    INSERT INTO emp VALUES (name);
END;
EXEC add_emp('李四');</code>
                        </div>
                    </details>

                    <details style="background: rgba(0,255,204,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid var(--warning);">
                        <summary style="cursor: pointer; font-weight: 600; color: var(--warning);">💾 事務管理（COMMIT / ROLLBACK）</summary>
                        <div style="margin-top: 10px; padding-left: 10px; color: var(--text-secondary);">
                            <p style="margin-bottom: 8px;">控制數據一致性，可回滾錯誤</p>
                            <code style="display: block; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; font-size: 0.85rem; white-space: pre-wrap;">BEGIN;
UPDATE accounts SET balance = balance - 100;
COMMIT; -- 確認保存
ROLLBACK; -- 取消更改</code>
                        </div>
                    </details>

                    <details style="background: rgba(0,255,204,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid var(--info);">
                        <summary style="cursor: pointer; font-weight: 600; color: var(--info);">📊 性能分析（EXPLAIN PLAN）</summary>
                        <div style="margin-top: 10px; padding-left: 10px; color: var(--text-secondary);">
                            <p style="margin-bottom: 8px;">查看 SQL 執行計畫和優化建議</p>
                            <code style="display: block; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; font-size: 0.85rem;">EXPLAIN PLAN FOR SELECT * FROM emp WHERE salary > 50000;</code>
                        </div>
                    </details>

                    <details style="background: rgba(0,255,204,0.05); padding: 12px; border-radius: 8px; border-left: 3px solid #9966ff);">
                        <summary style="cursor: pointer; font-weight: 600; color: #9966ff;">🎯 完整 Oracle 對象支持</summary>
                        <div style="margin-top: 10px; padding-left: 10px; color: var(--text-secondary);">
                            <ul style="line-height: 1.8; margin-left: 15px;">
                                <li><strong>VIEW</strong> - 虛擬視圖</li>
                                <li><strong>INDEX</strong> - B-tree 索引</li>
                                <li><strong>SYNONYM</strong> - 對象別名</li>
                                <li><strong>PACKAGE</strong> - 程序包</li>
                                <li><strong>TABLESPACE</strong> - 表空間</li>
                            </ul>
                        </div>
                    </details>
                </div>
            </div>

            <!-- 重要提示 -->
            <div style="margin-bottom: 25px;">
                <h3 style="color: var(--error); margin-bottom: 15px;"><i class="fas fa-exclamation-triangle"></i> 重要提示</h3>
                <div style="background: rgba(255,51,102,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid var(--error);">
                    <ul style="color: var(--text-secondary); line-height: 2; margin-left: 20px;">
                        <li><strong style="color: var(--error);">分號必須加</strong> - 每句 SQL 結尾加 <code>;</code></li>
                        <li><strong style="color: var(--error);">字串用單引號</strong> - 用 <code>'張三'</code> 不是 <code>"張三"</code></li>
                        <li><strong style="color: var(--warning);">關閉會遺失</strong> - 關閉分頁前請「匯出報告」保存</li>
                        <li><strong style="color: var(--warning);">日期要格式化</strong> - 用 <code>TO_DATE('2024-01-15', 'YYYY-MM-DD')</code></li>
                    </ul>
                </div>
            </div>

            <!-- 快捷鍵 -->
            <div style="margin-bottom: 25px;">
                <h3 style="color: var(--accent); margin-bottom: 15px;"><i class="fas fa-keyboard"></i> 快捷鍵</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <div style="background: rgba(0,168,255,0.08); padding: 10px; border-radius: 6px;">
                        <code style="color: var(--accent);">Ctrl + Enter</code>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 3px;">執行 SQL</p>
                    </div>
                    <div style="background: rgba(0,168,255,0.08); padding: 10px; border-radius: 6px;">
                        <code style="color: var(--accent);">多分頁</code>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 3px;">點頂部標籤切換資料庫</p>
                    </div>
                </div>
            </div>

            <!-- 學習建議 -->
            <div style="margin-bottom: 25px;">
                <h3 style="color: var(--success); margin-bottom: 15px;"><i class="fas fa-lightbulb"></i> 學習建議</h3>
                <ol style="color: var(--text-secondary); line-height: 2.2; margin-left: 20px;">
                    <li>從 <code>CREATE TABLE</code> 開始，創建第一個資料表</li>
                    <li>用 <code>INSERT</code> 插入資料，用 <code>SELECT</code> 查詢</li>
                    <li>試試 <code>JOIN</code>、<code>GROUP BY</code>、子查詢等進階語法</li>
                    <li>嘗試創建 SEQUENCE、PROCEDURE、TRIGGER 等 Oracle 對象</li>
                    <li>定期用「匯出報告」保存成果</li>
                    <li><strong>多練習，不怕犯錯！</strong>錯誤是最好的老師</li>
                </ol>
            </div>

            <!-- 數據模型完整指南 -->
            <div style="margin-bottom: 30px;">
                <h3 style="color: var(--accent); margin-bottom: 20px; font-size: 1.5rem; text-align: center;">
                    <i class="fas fa-database"></i> 15種數據模型完整指南
                </h3>
                <p style="color: var(--text-secondary); text-align: center; margin-bottom: 25px; font-size: 1.05rem;">
                    每種模型都有不同的用途和特點，選擇適合的模型能大幅提升效率！
                </p>

                <!-- 模型1: 關聯式 -->
                <details open style="margin-bottom: 15px; background: linear-gradient(135deg, rgba(0, 168, 255, 0.1), rgba(0, 102, 204, 0.1)); padding: 18px; border-radius: 12px; border-left: 5px solid var(--primary); cursor: pointer;">
                    <summary style="font-size: 1.2rem; font-weight: 700; color: var(--primary); cursor: pointer; user-select: none;">
                        <i class="fas fa-table"></i> 1. 關聯式模型 (Relational Model)
                    </summary>
                    <div style="margin-top: 15px; padding-left: 10px;">
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--accent); margin-bottom: 8px;">📝 這是什麼？</h4>
                            <p style="color: var(--text-secondary); line-height: 1.7;">
                                最常見的數據庫模型，用<strong>表格（Table）</strong>儲存數據，每行是一筆記錄，每列是一個屬性。
                                就像 Excel 表格一樣！
                            </p>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--success); margin-bottom: 8px;">✅ 適合用途</h4>
                            <ul style="color: var(--text-secondary); line-height: 1.8; margin-left: 20px;">
                                <li>員工管理系統</li>
                                <li>訂單處理系統</li>
                                <li>學生成績系統</li>
                                <li>銀行交易記錄</li>
                            </ul>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--warning); margin-bottom: 8px;">📋 操作步驟</h4>
                            <div style="background: rgba(0, 0, 0, 0.5); padding: 12px; border-radius: 6px; font-family: monospace;">
                                <div style="color: var(--text-muted); margin-bottom: 8px;">-- 步驟1: 創建表</div>
                                <code style="color: var(--accent); display: block; margin-bottom: 10px;">CREATE TABLE employees (
    id NUMBER PRIMARY KEY,
    name VARCHAR2(50) NOT NULL,
    department VARCHAR2(30),
    salary NUMBER(10,2)
);</code>

                                <div style="color: var(--text-muted); margin-bottom: 8px;">-- 步驟2: 插入數據</div>
                                <code style="color: var(--success); display: block; margin-bottom: 10px;">INSERT INTO employees VALUES (1, '張三', 'IT部', 50000);
INSERT INTO employees VALUES (2, '李四', '財務部', 45000);</code>

                                <div style="color: var(--text-muted); margin-bottom: 8px;">-- 步驟3: 查詢數據</div>
                                <code style="color: var(--info); display: block; margin-bottom: 10px;">SELECT * FROM employees WHERE salary > 40000;</code>

                                <div style="color: var(--text-muted); margin-bottom: 8px;">-- 步驟4: 更新數據</div>
                                <code style="color: var(--warning); display: block; margin-bottom: 10px;">UPDATE employees SET salary = 55000 WHERE id = 1;</code>

                                <div style="color: var(--text-muted); margin-bottom: 8px;">-- 步驟5: 刪除數據</div>
                                <code style="color: var(--error); display: block;">DELETE FROM employees WHERE id = 2;</code>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div style="background: rgba(0, 204, 136, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--success);">
                                <h4 style="color: var(--success); margin-bottom: 8px;">👍 優點</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>結構清晰易懂</li>
                                    <li>數據完整性高</li>
                                    <li>支持複雜查詢</li>
                                    <li>工具   熟豐富</li>
                                </ul>
                            </div>
                            <div style="background: rgba(255, 51, 102, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--error);">
                                <h4 style="color: var(--error); margin-bottom: 8px;">👎 限制</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>結構變更較麻煩</li>
                                    <li>處理層次數據較複雜</li>
                                    <li>大數據擴展性受限</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>

                <!-- 模型2: JSON -->
                <details style="margin-bottom: 15px; background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 153, 0, 0.1)); padding: 18px; border-radius: 12px; border-left: 5px solid var(--warning); cursor: pointer;">
                    <summary style="font-size: 1.2rem; font-weight: 700; color: var(--warning); cursor: pointer; user-select: none;">
                        <i class="fas fa-file-code"></i> 2. JSON 文件模型 (JSON Document Model)
                    </summary>
                    <div style="margin-top: 15px; padding-left: 10px;">
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--accent); margin-bottom: 8px;">📝 這是什麼？</h4>
                            <p style="color: var(--text-secondary); line-height: 1.7;">
                                儲存 <strong>JSON 格式</strong>的數據，適合<strong>半結構化</strong>數據。每筆記錄可以有不同的   位結構。
                            </p>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--success); margin-bottom: 8px;">✅ 適合用途</h4>
                            <ul style="color: var(--text-secondary); line-height: 1.8; margin-left: 20px;">
                                <li>產品目錄（規格各異）</li>
                                <li>用戶配置文件</li>
                                <li>API 數據存儲</li>
                                <li>日誌記錄</li>
                            </ul>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--warning); margin-bottom: 8px;">📋 操作步驟</h4>
                            <div style="background: rgba(0, 0, 0, 0.5); padding: 12px; border-radius: 6px; font-family: monospace;">
                                <code style="color: var(--accent); display: block; margin-bottom: 10px;">-- 創建JSON數據表
CREATE TABLE products (
    id NUMBER,
    data VARCHAR2(1000)
);</code>

                                <code style="color: var(--success); display: block; margin-bottom: 10px;">-- 插入JSON數據
INSERT INTO products VALUES (1,
    '{"name":"筆記本電腦","price":25000,"specs":{"cpu":"i7","ram":"16GB"}}');</code>

                                <code style="color: var(--info); display: block;">-- 查詢數據
SELECT * FROM products;</code>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div style="background: rgba(0, 204, 136, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--success);">
                                <h4 style="color: var(--success); margin-bottom: 8px;">👍 優點</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>靈活的結構</li>
                                    <li>易於擴展欄位</li>
                                    <li>適合變化的數據</li>
                                </ul>
                            </div>
                            <div style="background: rgba(255, 51, 102, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--error);">
                                <h4 style="color: var(--error); margin-bottom: 8px;">👎 限制</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>查詢效率較低</li>
                                    <li>數據完整   弱</li>
                                    <li>佔用空間較大</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>

                <!-- 模型3: 圖數據庫 -->
                <details style="margin-bottom: 15px; background: linear-gradient(135deg, rgba(0, 255, 204, 0.1), rgba(0, 204, 136, 0.1)); padding: 18px; border-radius: 12px; border-left: 5px solid var(--success); cursor: pointer;">
                    <summary style="font-size: 1.2rem; font-weight: 700; color: var(--success); cursor: pointer; user-select: none;">
                        <i class="fas fa-project-diagram"></i> 3. 圖數據庫模型 (Graph Model)
                    </summary>
                    <div style="margin-top: 15px; padding-left: 10px;">
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--accent); margin-bottom: 8px;">📝 這是什麼？</h4>
                            <p style="color: var(--text-secondary); line-height: 1.7;">
                                用<strong>節點（Nodes）</strong>和<strong>邊（Edges）</strong>表示數據之間的關係。
                                就像社交網絡的朋友關係圖！
                            </p>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--success); margin-bottom: 8px;">✅ 適合用途</h4>
                            <ul style="color: var(--text-secondary); line-height: 1.8; margin-left: 20px;">
                                <li>社交網絡（Facebook、LinkedIn）</li>
                                <li>推薦系統</li>
                                <li>知識圖譜</li>
                                <li>路徑查找（導航）</li>
                            </ul>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--warning); margin-bottom: 8px;">📋 操作步驟</h4>
                            <div style="background: rgba(0, 0, 0, 0.5); padding: 12px; border-radius: 6px; font-family: monospace;">
                                <code style="color: var(--accent); display: block; margin-bottom: 10px;">-- 創建節點表
CREATE TABLE nodes (
    id NUMBER,
    type VARCHAR2(50),
    name VARCHAR2(100)
);</code>

                                <code style="color: var(--accent); display: block; margin-bottom: 10px;">-- 創建關係表
CREATE TABLE edges (
    from_id NUMBER,
    to_id NUMBER,
    relationship VARCHAR2(50)
);</code>

                                <code style="color: var(--success); display: block; margin-bottom: 10px;">-- 插入節點（人）
INSERT INTO nodes VALUES (1, 'Person', 'Alice');
INSERT INTO nodes VALUES (2, 'Person', 'Bob');
INSERT INTO nodes VALUES (3, 'Person', 'Charlie');</code>

                                <code style="color: var(--success); display: block; margin-bottom: 10px;">-- 插入關係（朋友）
INSERT INTO edges VALUES (1, 2, 'FRIEND');
INSERT INTO edges VALUES (2, 3, 'FRIEND');</code>

                                <code style="color: var(--info); display: block;">-- 查詢Alice的朋友
SELECT n.name
FROM nodes n
JOIN edges e ON n.id = e.to_id
WHERE e.from_id = 1;</code>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div style="background: rgba(0, 204, 136, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--success);">
                                <h4 style="color: var(--success); margin-bottom: 8px;">👍 優點</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>關係查詢快速</li>
                                    <li>適合複雜網絡</li>
                                    <li>直觀表示關聯</li>
                                </ul>
                            </div>
                            <div style="background: rgba(255, 51, 102, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--error);">
                                <h4 style="color: var(--error); margin-bottom: 8px;">👎 限制</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>學習曲線陡峭</li>
                                    <li>傳統SQL不太適合</li>
                                    <li>工具較少</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>

                <!-- 模型4: 時間序列 -->
                <details style="margin-bottom: 15px; background: linear-gradient(135deg, rgba(255, 102, 178, 0.1), rgba(153, 102, 255, 0.1)); padding: 18px; border-radius: 12px; border-left: 5px solid #ff66b2; cursor: pointer;">
                    <summary style="font-size: 1.2rem; font-weight: 700; color: #ff66b2; cursor: pointer; user-select: none;">
                        <i class="fas fa-chart-line"></i> 4. 時間序列模型 (Time Series Model)
                    </summary>
                    <div style="margin-top: 15px; padding-left: 10px;">
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--accent); margin-bottom: 8px;">📝 這是什麼？</h4>
                            <p style="color: var(--text-secondary); line-height: 1.7;">
                                儲存<strong>按時間排序</strong>的數據，每筆記錄都有時間戳記。
                                適合分析數據隨時間的變化趨勢。
                            </p>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--success); margin-bottom: 8px;">✅ 適合用途</h4>
                            <ul style="color: var(--text-secondary); line-height: 1.8; margin-left: 20px;">
                                <li>股票價格追蹤</li>
                                <li>IoT 感測器數據</li>
                                <li>系統監控指標</li>
                                <li>網站流量分析</li>
                            </ul>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--warning); margin-bottom: 8px;">📋 操作步驟</h4>
                            <div style="background: rgba(0, 0, 0, 0.5); padding: 12px; border-radius: 6px; font-family: monospace;">
                                <code style="color: var(--accent); display: block; margin-bottom: 10px;">-- 創建時間序列表
CREATE TABLE sensor_data (
    sensor_id NUMBER,
    timestamp VARCHAR2(50),
    temperature NUMBER,
    humidity NUMBER
);</code>

                                <code style="color: var(--success); display: block; margin-bottom: 10px;">-- 插入時間序列數據
INSERT INTO sensor_data VALUES (1, '2024-12-25 10:00:00', 25.5, 60.2);
INSERT INTO sensor_data VALUES (1, '2024-12-25 10:01:00', 25.7, 60.5);
INSERT INTO sensor_data VALUES (1, '2024-12-25 10:02:00', 25.6, 60.3);</code>

                                <code style="color: var(--info); display: block;">-- 查詢最近數據
SELECT * FROM sensor_data
ORDER BY timestamp DESC;</code>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div style="background: rgba(0, 204, 136, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--success);">
                                <h4 style="color: var(--success); margin-bottom: 8px;">👍 優點</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>時間查詢快速</li>
                                    <li>適合趨勢分析</li>
                                    <li>自動時間索引</li>
                                </ul>
                            </div>
                            <div style="background: rgba(255, 51, 102, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--error);">
                                <h4 style="color: var(--error); margin-bottom: 8px;">👎 限制</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>只適合時間數據</li>
                                    <li>歷史數據龐大</li>
                                    <li>刪除不常見</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>

                <!-- 模型5: 鍵值存儲 -->
                <details style="margin-bottom: 15px; background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(186, 85, 211, 0.1)); padding: 18px; border-radius: 12px; border-left: 5px solid #8a2be2; cursor: pointer;">
                    <summary style="font-size: 1.2rem; font-weight: 700; color: #8a2be2; cursor: pointer; user-select: none;">
                        <i class="fas fa-key"></i> 5. 鍵值存儲模型 (Key-Value Model)
                    </summary>
                    <div style="margin-top: 15px; padding-left: 10px;">
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--accent); margin-bottom: 8px;">📝 這是什麼？</h4>
                            <p style="color: var(--text-secondary); line-height: 1.7;">
                                最簡單的數據模型，就像<strong>字典</strong>一樣，用<strong>鍵（Key）</strong>存取<strong>值（Value）</strong>。
                            </p>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--success); margin-bottom: 8px;">✅ 適合用途</h4>
                            <ul style="color: var(--text-secondary); line-height: 1.8; margin-left: 20px;">
                                <li>緩存數據（Redis）</li>
                                <li>Session 存儲</li>
                                <li>配置文件</li>
                                <li>購物車數據</li>
                            </ul>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <h4 style="color: var(--warning); margin-bottom: 8px;">📋 操作步驟</h4>
                            <div style="background: rgba(0, 0, 0, 0.5); padding: 12px; border-radius: 6px; font-family: monospace;">
                                <code style="color: var(--accent); display: block; margin-bottom: 10px;">-- 創建鍵值表
CREATE TABLE kv_store (
    key VARCHAR2(100),
    value VARCHAR2(500)
);</code>

                                <code style="color: var(--success); display: block; margin-bottom: 10px;">-- 存儲配置
INSERT INTO kv_store VALUES ('app_name', 'Database Simulator');
INSERT INTO kv_store VALUES ('version', '2.0');
INSERT INTO kv_store VALUES ('theme', 'dark');</code>

                                <code style="color: var(--info); display: block;">-- 查詢值
SELECT value FROM kv_store WHERE key = 'app_name';</code>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div style="background: rgba(0, 204, 136, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--success);">
                                <h4 style="color: var(--success); margin-bottom: 8px;">👍 優點</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>極快的讀寫速度</li>
                                    <li>結構超級簡單</li>
                                    <li>易於擴展</li>
                                </ul>
                            </div>
                            <div style="background: rgba(255, 51, 102, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--error);">
                                <h4 style="color: var(--error); margin-bottom: 8px;">👎 限制</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-left: 18px;">
                                    <li>無複雜查詢</li>
                                    <li>無關係支持</li>
                                    <li>只能按鍵查找</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>

                <!-- 快速對比表 -->
                <div style="margin-top: 30px; padding: 20px; background: rgba(0, 0, 0, 0.5); border-radius: 12px; border: 2px solid var(--accent);">
                    <h3 style="color: var(--accent); margin-bottom: 15px; text-align: center;">
                        <i class="fas fa-balance-scale"></i> 模型快速對比
                    </h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; color: var(--text-secondary);">
                            <thead>
                                <tr style="background: rgba(0, 168, 255, 0.2);">
                                    <th style="padding: 12px; border: 1px solid var(--border-color); text-align: left;">模型</th>
                                    <th style="padding: 12px; border: 1px solid var(--border-color);">查詢速度</th>
                                    <th style="padding: 12px; border: 1px solid var(--border-color);">靈活性</th>
                                    <th style="padding: 12px; border: 1px solid var(--border-color);">學習難度</th>
                                    <th style="padding: 12px; border: 1px solid var(--border-color);">最適合</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong style="color: var(--primary);">關聯式</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">傳統業務系統</td>
                                </tr>
                                <tr style="background: rgba(255, 255, 255, 0.02);">
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong style="color: var(--warning);">JSON</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">API   配置文件</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong style="color: var(--success);">圖數據庫</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">社交網絡、推薦</td>
                                </tr>
                                <tr style="background: rgba(255, 255, 255, 0.02);">
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong style="color: #ff66b2;">時間序列</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">監控、IoT</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong style="color: #8a2be2;">鍵值存儲</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐⭐⭐⭐⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); text-align: center;">⭐</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">緩存、Session</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 選擇建議 -->
                <div style="margin-top: 20px; padding: 18px; background: linear-gradient(135deg, rgba(0, 255, 204, 0.15), rgba(0, 168, 255, 0.15)); border-radius: 12px; border: 2px solid var(--accent);">
                    <h4 style="color: var(--accent); margin-bottom: 12px; text-align: center;">
                        <i class="fas fa-lightbulb"></i> 如何選擇合適的模型？
                    </h4>
                    <div style="display: grid; gap: 10px;">
                        <div style="padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px;">
                            <strong style="color: var(--primary);">🏢 業務系統？</strong>
                            <span style="color: var(--text-secondary);"> → 用<strong>關聯式模型</strong></span>
                        </div>
                        <div style="padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px;">
                            <strong style="color: var(--success);">👥 社交網絡？</strong>
                            <span style="color: var(--text-secondary);"> → 用<strong>圖數據庫模型</strong></span>
                        </div>
                        <div style="padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px;">
                            <strong style="color: var(--warning);">📦 API數據？</strong>
                            <span style="color: var(--text-secondary);"> → 用<strong>JSON模型</strong></span>
                        </div>
                        <div style="padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px;">
                            <strong style="color: #ff66b2;">📈 監控數據？</strong>
                            <span style="color: var(--text-secondary);"> → 用<strong>時間序列模型</strong></span>
                        </div>
                        <div style="padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px;">
                            <strong style="color: #8a2be2;">⚡ 高速緩存？</strong>
                            <span style="color: var(--text-secondary);"> → 用<strong>鍵值存儲模型</strong></span>
                        </div>
                    </div>
                </div>
            </div>


            <!-- 常見錯誤 -->
            <div>
                <h3 style="color: var(--warning); margin-bottom: 15px;"><i class="fas fa-bug"></i> 常見錯誤</h3>
                <div style="display: grid; gap: 8px;">
                    <div style="padding: 10px; background: rgba(255,51,102,0.08); border-radius: 6px;">
                        <strong style="color: var(--error);">❌</strong> <code>SELECT * FROM students</code>
                        <span style="color: var(--success); margin-left: 10px;"><strong>✅</strong> <code>SELECT * FROM students;</code></span>
                    </div>
                    <div style="padding: 10px; background: rgba(255,51,102,0.08); border-radius: 6px;">
                        <strong style="color: var(--error);">❌</strong> <code>INSERT INTO t VALUES ("John")</code>
                        <span style="color: var(--success); margin-left: 10px;"><strong>✅</strong> <code>INSERT INTO t VALUES ('John');</code></span>
                    </div>
                    <div style="padding: 10px; background: rgba(255,51,102,0.08); border-radius: 6px;">
                        <strong style="color: var(--error);">❌</strong> 先 SELECT 後 CREATE TABLE
                        <span style="color: var(--success); margin-left: 10px;"><strong>✅</strong> 先 CREATE TABLE 後 SELECT</span>
                    </div>
                </div>
            </div>

            </div>
        </div>
    </div>

    <!-- 語法參考模態框 -->
    <div id="syntaxModal" class="modal">
        <div class="modal-content fade-in" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 class="gradient-text">Oracle Database SQL 語法參考（中英對照）</h2>
                <button class="close-modal">&times;</button>
            </div>

            <!-- 難度分類選擇 -->
            <div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="syntax-level-btn active" data-level="basic">
                    <i class="fas fa-star"></i> 基、需要學習
                </button>
                <button class="syntax-level-btn" data-level="intermediate">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i> 進階語法
                </button>
                <button class="syntax-level-btn" data-level="advanced">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i> 高階語法
                </button>
            </div>

            <!-- 基本語法 -->
            <div class="syntax-level active" data-level="basic">
                <div style="margin-bottom: 25px;">
                    <h3>基本數據類型 (Data Types)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="code">VARCHAR2(n)</span></td>
                                <td>儲存可變長度字符串</td>
                                <td>可變字符，最大 n 個字符</td>
                                <td>VARCHAR2(50) - 最多50字符</td>
                            </tr>
                            <tr>
                                <td><span class="code">NUMBER(p,s)</span></td>
                                <td>儲存數值型資料</td>
                                <td>數字，p=總位數，s=小數位</td>
                                <td>NUMBER(10,2) - 如 12345.67</td>
                            </tr>
                            <tr>
                                <td><span class="code">DATE</span></td>
                                <td>儲存日期和時間</td>
                                <td>日期時間</td>
                                <td>DATE - 存儲年月日時分秒</td>
                            </tr>
                            <tr>
                                <td><span class="code">CHAR(n)</span></td>
                                <td>儲存固定長度字符串</td>
                                <td>固定字符，長度 n</td>
                                <td>CHAR(10) - 固定10字符</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>基本查詢語句 (Basic SELECT)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>、用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">SELECT</span></td>
                                <td>選擇要查詢的欄位</td>
                                <td>選擇 / 查詢</td>
                                <td>SELECT name, age FROM students;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">FROM</span></td>
                                <td>指定資料來源表</td>
                                <td>從...資料表</td>
                                <td>SELECT * FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">WHERE</span></td>
                                <td>設定篩、條件</td>
                                <td>條件篩選</td>
                                <td>WHERE salary > 50000;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ORDER BY</span></td>
                                <td>排序查詢結果</td>
                                <td>按...排序</td>
                                <td>ORDER BY name ASC;</td>
                            </tr>
                            <tr>
                                <td><span class="code">*</span></td>
                                <td>選擇所有欄位</td>
                                <td>全部欄位</td>
                                <td>SELECT * FROM table_name;</td>
                            </tr>
                            <tr>
                                <td><span class="code">;</span></td>
                                <td>SQL語句結束符號</td>
                                <td>語句結束</td>
                                <td>每條 SQL 語句必須用 ; 結束</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>數據操作語言 (DML - Data Manipulation)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">INSERT INTO</span></td>
                                <td>向表中插入新資料</td>
                                <td>插入資料</td>
                                <td>INSERT INTO users VALUES (1, 'John');</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">UPDATE</span></td>
                                <td>更新現有資料</td>
                                <td>更新資料</td>
                                <td>UPDATE users SET age = 25 WHERE id = 1;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">DELETE</span></td>
                                <td>刪除資料</td>
                                <td>刪除資料</td>
                                <td>DELETE FROM users WHERE id = 1;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">COMMIT</span></td>
                                <td>確認並儲存、易</td>
                                <td>提交事務</td>
                                <td>COMMIT; - 永久保存更改</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ROLLBACK</span></td>
                                <td>取消未提交的更改</td>
                                <td>回滾事務</td>
                                <td>ROLLBACK; - 撤銷更改</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>數據定義語言 (DDL - Data Definition)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">CREATE TABLE</span></td>
                                <td>創建新資料表</td>
                                <td>創建表</td>
                                <td>CREATE TABLE users (id NUMBER, name VARCHAR2(50));</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">DROP TABLE</span></td>
                                <td>刪除整個資料表</td>
                                <td>刪除表</td>
                                <td>DROP TABLE users;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ALTER TABLE</span></td>
                                <td>修改表結構</td>
                                <td>修改表</td>
                                <td>ALTER TABLE users ADD email VARCHAR2(100);</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">TRUNCATE</span></td>
                                <td>清空表中所有資料</td>
                                <td>截斷表</td>
                                <td>TRUNCATE TABLE users;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 進階語法 -->
            <div class="syntax-level" data-level="intermediate">
                <div style="margin-bottom: 25px;">
                    <h3>進階查詢 (Advanced Queries)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">JOIN</span></td>
                                <td>連接多個資料表</td>
                                <td>表連接</td>
                                <td>SELECT * FROM users JOIN orders ON users.id = orders.user_id;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">GROUP BY</span></td>
                                <td>按欄位分組資料</td>
                                <td>分組</td>
                                <td>SELECT dept, COUNT(*) FROM emp GROUP BY dept;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">HAVING</span></td>
                                <td>對分組結果進行篩選</td>
                                <td>分組條件</td>
                                <td>HAVING COUNT(*) > 5;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">UNION</span></td>
                                <td>合併多個查詢結果</td>
                                <td>聯合查詢</td>
                                <td>SELECT name FROM t1 UNION SELECT name FROM t2;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">DISTINCT</span></td>
                                <td>去除重複記錄</td>
                                <td>去重</td>
                                <td>SELECT DISTINCT department FROM employees;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>聚合函數 (Aggregate Functions)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-function">COUNT()</span></td>
                                <td>計算記錄數量</td>
                                <td>計數</td>
                                <td>SELECT COUNT(*) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">SUM()</span></td>
                                <td>計算總和</td>
                                <td>求和</td>
                                <td>SELECT SUM(salary) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">AVG()</span></td>
                                <td>計算平均值</td>
                                <td>平均</td>
                                <td>SELECT AVG(price) FROM products;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">MAX()</span></td>
                                <td>找出最大值</td>
                                <td>最大值</td>
                                <td>SELECT MAX(salary) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">MIN()</span></td>
                                <td>找出最小值</td>
                                <td>最小值</td>
                                <td>SELECT MIN(price) FROM products;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>約束條件 (Constraints)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">PRIMARY KEY</span></td>
                                <td>設定主、，唯一標識</td>
                                <td>主鍵</td>
                                <td>id NUMBER PRIMARY KEY</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">FOREIGN KEY</span></td>
                                <td>設定外鍵，參照其他表</td>
                                <td>外鍵</td>
                                <td>FOREIGN KEY (user_id) REFERENCES users(id)</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">NOT NULL</span></td>
                                <td>欄位不可為空值</td>
                                <td>非空</td>
                                <td>name VARCHAR2(50) NOT NULL</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">UNIQUE</span></td>
                                <td>欄位值必須唯一</td>
                                <td>唯一</td>
                                <td>email VARCHAR2(100) UNIQUE</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CHECK</span></td>
                                <td>檢查條件約束</td>
                                <td>檢查約束</td>
                                <td>CHECK (age >= 18)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>子查詢 (Subqueries)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">IN</span></td>
                                <td>檢查值是否在列表中</td>
                                <td>在...之中</td>
                                <td>WHERE id IN (SELECT user_id FROM orders)</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">EXISTS</span></td>
                                <td>檢查子查詢是否返回結果</td>
                                <td>存在</td>
                                <td>WHERE EXISTS (SELECT 1 FROM orders WHERE user_id = u.id)</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ANY</span></td>
                                <td>與子查詢任一值比較</td>
                                <td>任何</td>
                                <td>WHERE salary > ANY (SELECT avg_salary FROM departments)</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ALL</span></td>
                                <td>與子查詢所有值、較</td>
                                <td>全部</td>
                                <td>WHERE salary > ALL (SELECT salary FROM interns)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 高階語法 -->
            <div class="syntax-level" data-level="advanced">
                <div style="margin-bottom: 25px;">
                    <h3>Oracle 專有語法 ✅ 已完整支持</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">ROWNUM</span></td>
                                <td>Oracle 行號，限制查詢結果</td>
                                <td>行號</td>
                                <td>SELECT * FROM emp WHERE ROWNUM <= 10;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CREATE SEQUENCE</span></td>
                                <td>創建自動遞增序列</td>
                                <td>序列</td>
                                <td>CREATE SEQUENCE emp_seq START WITH 1 INCREMENT BY 1;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">NEXTVAL / CURRVAL</span></td>
                                <td>取得序列的下一個值/當前值</td>
                                <td>序列值</td>
                                <td>INSERT INTO emp VALUES (emp_seq.NEXTVAL, 'John');</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CREATE SYNONYM</span></td>
                                <td>創建同義詞（別名）</td>
                                <td>同義詞</td>
                                <td>CREATE SYNONYM emp FOR employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CREATE PACKAGE</span></td>
                                <td>創建包（組織相關程序）</td>
                                <td>包</td>
                                <td>CREATE PACKAGE emp_pkg AS ... END emp_pkg;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CREATE TABLESPACE</span></td>
                                <td>創建表空間（概念性）</td>
                                <td>表空間</td>
                                <td>CREATE TABLESPACE users_ts;</td>
                            </tr>
                            <tr>
                                <td><span class="code">DUAL</span></td>
                                <td>Oracle 虛擬單行表</td>
                                <td>虛擬表</td>
                                <td>SELECT SYSDATE FROM DUAL;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">NVL()</span></td>
                                <td>空值處理函數</td>
                                <td>空值轉換</td>
                                <td>SELECT NVL(commission, 0) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">TO_DATE()</span></td>
                                <td>字符串轉日期</td>
                                <td>日期轉換</td>
                                <td>TO_DATE('2024-01-15', 'YYYY-MM-DD')</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>視圖與索引 (Views & Indexes)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">CREATE VIEW</span></td>
                                <td>創建視圖（虛擬表）</td>
                                <td>創建視圖</td>
                                <td>CREATE VIEW emp_view AS SELECT * FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CREATE INDEX</span></td>
                                <td>創建索引提升查詢速度</td>
                                <td>創建索引</td>
                                <td>CREATE INDEX idx_name ON employees(name);</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">DROP VIEW</span></td>
                                <td>刪除視圖</td>
                                <td>刪除視圖</td>
                                <td>DROP VIEW emp_view;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">DROP INDEX</span></td>
                                <td>刪除索引</td>
                                <td>刪除索引</td>
                                <td>DROP INDEX idx_name;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>進階函數 (Advanced Functions)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-function">NVL()</span></td>
                                <td>處理 NULL 值</td>
                                <td>空值替換</td>
                                <td>SELECT NVL(commission, 0) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">DECODE()</span></td>
                                <td>條件判斷函數</td>
                                <td>解碼/條件</td>
                                <td>DECODE(gender, 'M', 'Male', 'F', 'Female')</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">CASE WHEN</span></td>
                                <td>多條件判斷</td>
                                <td>條件判斷</td>
                                <td>CASE WHEN age < 18 THEN 'Minor' ELSE 'Adult' END</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">ROW_NUMBER()</span></td>
                                <td>窗函數，生成行號</td>
                                <td>行號窗</td>
                                <td>ROW_NUMBER() OVER (ORDER BY salary DESC)</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">RANK()</span></td>
                                <td>排名函數</td>
                                <td>排名</td>
                                <td>RANK() OVER (ORDER BY score DESC)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>事務控制 (Transaction Control)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">SAVEPOINT</span></td>
                                <td>設置保存點</td>
                                <td>保存點</td>
                                <td>SAVEPOINT sp1;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ROLLBACK TO</span></td>
                                <td>回滾到保存點</td>
                                <td>回滾至</td>
                                <td>ROLLBACK TO sp1;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">SET TRANSACTION</span></td>
                                <td>設置事務屬性</td>
                                <td>設置事務</td>
                                <td>SET TRANSACTION READ ONLY;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">SET TRANSACTION ISOLATION LEVEL</span></td>
                                <td>設置隔離級別</td>
                                <td>隔離級別</td>
                                <td>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>🔥 冷門但實用的語句 (Advanced & Rare)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">MERGE INTO</span></td>
                                <td>合併數據（更新或插入）</td>
                                <td>UPSERT 操作</td>
                                <td>MERGE INTO target USING source ON (condition) WHEN MATCHED THEN UPDATE SET ... WHEN NOT MATCHED THEN INSERT ...;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CONNECT BY</span></td>
                                <td>階層式查詢（樹狀結構）</td>
                                <td>層次查詢</td>
                                <td>SELECT * FROM employees START WITH manager_id IS NULL CONNECT BY PRIOR employee_id = manager_id;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">LISTAGG()</span></td>
                                <td>將多行聚合為一行字符串</td>
                                <td>字符串聚合</td>
                                <td>SELECT dept, LISTAGG(name, ', ') FROM emp GROUP BY dept;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">PIVOT</span></td>
                                <td>行轉列（交叉表）</td>
                                <td>數據透視</td>
                                <td>SELECT * FROM sales PIVOT (SUM(amount) FOR quarter IN ('Q1', 'Q2', 'Q3', 'Q4'));</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">UNPIVOT</span></td>
                                <td>列   行（反透視）</td>
                                <td>反透視</td>
                                <td>SELECT * FROM sales UNPIVOT (amount FOR quarter IN (q1, q2, q3, q4));</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">COALESCE()</span></td>
                                <td>返回第一個非 NULL 值</td>
                                <td>合併非空值</td>
                                <td>SELECT COALESCE(phone, mobile, email, 'N/A') FROM contacts;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">NULLIF()</span></td>
                                <td>兩值相等返回 NULL</td>
                                <td>空值判斷</td>
                                <td>SELECT NULLIF(salary, 0) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">REGEXP_LIKE()</span></td>
                                <td>正則表達式匹配</td>
                                <td>正則匹配</td>
                                <td>SELECT * FROM users WHERE REGEXP_LIKE(email, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z]{2,}$', 'i');</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">REGEXP_REPLACE()</span></td>
                                <td>正則表達式替換</td>
                                <td>正則替換</td>
                                <td>SELECT REGEXP_REPLACE(phone, '[^0-9]', '') FROM contacts;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">LEAD() / LAG()</span></td>
                                <td>取得前後行的值</td>
                                <td>窗口前後值</td>
                                <td>SELECT name, salary, LAG(salary, 1, 0) OVER (ORDER BY hire_date) AS prev_salary FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">FIRST_VALUE() / LAST_VALUE()</span></td>
                                <td>取得窗口首尾值</td>
                                <td>首尾值</td>
                                <td>SELECT FIRST_VALUE(salary) OVER (PARTITION BY dept ORDER BY salary DESC) AS max_dept_salary FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">NTILE(n)</span></td>
                                <td>將數據分成 n 個桶</td>
                                <td>分桶函數</td>
                                <td>SELECT name, NTILE(4) OVER (ORDER BY salary) AS quartile FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">CUME_DIST()</span></td>
                                <td>累積分佈（百分位）</td>
                                <td>累積分佈</td>
                                <td>SELECT name, CUME_DIST() OVER (ORDER BY salary) AS percentile FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">PERCENT_RANK()</span></td>
                                <td>百分比排名</td>
                                <td>百分比排名</td>
                                <td>SELECT name, PERCENT_RANK() OVER (ORDER BY score) AS pct_rank FROM students;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>🎯 分析函數 (Analytical Functions)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-function">RATIO_TO_REPORT()</span></td>
                                <td>計算比例</td>
                                <td>比例計算</td>
                                <td>SELECT name, salary, RATIO_TO_REPORT(salary) OVER () AS salary_ratio FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">DENSE_RANK()</span></td>
                                <td>密集排名（無間隙）</td>
                                <td>密集排名</td>
                                <td>SELECT name, DENSE_RANK() OVER (ORDER BY score DESC) AS rank FROM students;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">PARTITION BY</span></td>
                                <td>窗口函數分組</td>
                                <td>分區</td>
                                <td>SELECT dept, name, RANK() OVER (PARTITION BY dept ORDER BY salary DESC) AS dept_rank FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ROWS BETWEEN</span></td>
                                <td>定義窗口範圍</td>
                                <td>行範圍</td>
                                <td>SELECT name, AVG(salary) OVER (ORDER BY hire_date ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS moving_avg FROM employees;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>🔧 字符串與日期函數 (String & Date Functions)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-function">SUBSTR()</span></td>
                                <td>截取子字符串</td>
                                <td>子串</td>
                                <td>SELECT SUBSTR(name, 1, 3) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">INSTR()</span></td>
                                <td>查找字符位置</td>
                                <td>字符位置</td>
                                <td>SELECT INSTR(email, '@') FROM users;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">LPAD() / RPAD()</span></td>
                                <td>左右填充字符</td>
                                <td>填充</td>
                                <td>SELECT LPAD(id, 6, '0') FROM orders; -- 000123</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">TRIM() / LTRIM() / RTRIM()</span></td>
                                <td>去除空格</td>
                                <td>修剪空格</td>
                                <td>SELECT TRIM(BOTH ' ' FROM name) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">REPLACE()</span></td>
                                <td>字符串替換</td>
                                <td>替換</td>
                                <td>SELECT REPLACE(phone, '-', '') FROM contacts;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">TRANSLATE()</span></td>
                                <td>字符映射替換</td>
                                <td>字符轉換</td>
                                <td>SELECT TRANSLATE(phone, '0123456789', 'ABCDEFGHIJ') FROM contacts;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">ADD_MONTHS()</span></td>
                                <td>日期加減月份</td>
                                <td>月份計算</td>
                                <td>SELECT ADD_MONTHS(hire_date, 3) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">MONTHS_BETWEEN()</span></td>
                                <td>計算月份差</td>
                                <td>月份差</td>
                                <td>SELECT MONTHS_BETWEEN(SYSDATE, hire_date) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">NEXT_DAY()</span></td>
                                <td>下一個指定星期</td>
                                <td>下週幾</td>
                                <td>SELECT NEXT_DAY(SYSDATE, 'MONDAY') FROM DUAL;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">LAST_DAY()</span></td>
                                <td>月份最後一天</td>
                                <td>月末日期</td>
                                <td>SELECT LAST_DAY(hire_date) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">EXTRACT()</span></td>
                                <td>提取日期部分</td>
                                <td>日期提取</td>
                                <td>SELECT EXTRACT(YEAR FROM hire_date) FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">TO_CHAR()</span></td>
                                <td>日期/數字轉字符</td>
                                <td>格式化輸出</td>
                                <td>SELECT TO_CHAR(salary, '999,999.99') FROM employees;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-function">TO_NUMBER()</span></td>
                                <td>字符轉數字</td>
                                <td>數字轉換</td>
                                <td>SELECT TO_NUMBER('12345') FROM DUAL;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>⚡ 性能優化與提示 (Performance Hints)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">EXPLAIN PLAN</span></td>
                                <td>分析執行計劃</td>
                                <td>執行計劃</td>
                                <td>EXPLAIN PLAN FOR SELECT * FROM employees WHERE dept = 'IT';</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">/*+ INDEX(table index) */</span></td>
                                <td>強制使用索引</td>
                                <td>索引提示</td>
                                <td>SELECT /*+ INDEX(emp idx_name) */ * FROM emp WHERE name = 'John';</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">/*+ FULL(table) */</span></td>
                                <td>強制全表掃描</td>
                                <td>全表提示</td>
                                <td>SELECT /*+ FULL(emp) */ * FROM emp;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">/*+ PARALLEL(n) */</span></td>
                                <td>並行查詢</td>
                                <td>並行提示</td>
                                <td>SELECT /*+ PARALLEL(4) */ * FROM large_table;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ANALYZE TABLE</span></td>
                                <td>收集統計信息</td>
                                <td>分析表</td>
                                <td>ANALYZE TABLE employees COMPUTE STATISTICS;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3>🔐 數據安全與權限 (Security & Privileges)</h3>
                    <table class="syntax-table">
                        <thead>
                            <tr>
                                <th>語法</th>
                                <th>應用</th>
                                <th>中文意思</th>
                                <th>範例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="sql-keyword">GRANT</span></td>
                                <td>授予權限</td>
                                <td>授權</td>
                                <td>GRANT SELECT, INSERT ON employees TO user1;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">REVOKE</span></td>
                                <td>撤銷權限</td>
                                <td>撤權</td>
                                <td>REVOKE INSERT ON employees FROM user1;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CREATE USER</span></td>
                                <td>創建用戶</td>
                                <td>創建用戶</td>
                                <td>CREATE USER john IDENTIFIED BY password123;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">ALTER USER</span></td>
                                <td>修改用戶</td>
                                <td>修改用戶</td>
                                <td>ALTER USER john IDENTIFIED BY newpass456;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">CREATE ROLE</span></td>
                                <td>創建角色</td>
                                <td>角色</td>
                                <td>CREATE ROLE manager;</td>
                            </tr>
                            <tr>
                                <td><span class="sql-keyword">GRANT ROLE</span></td>
                                <td>授予角色</td>
                                <td>角色授權</td>
                                <td>GRANT manager TO john;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局變數
        let currentDatabase = {};
        let currentUser = "Sam";
        let currentDatabaseName = "Test";
        let currentMode = "free"; // free or exercise
        let currentExerciseIndex = 0;
        let savedData = {}; // 儲存的資料
        let executionHistory = []; // SQL 執行歷史
        let currentChart = null; // 當前圖表實例
        let lastQueryResult = null; // 最後查詢結果
        let currentDataModel = 'relational'; // 當   數據模型

        // 成就系統
        let userAchievements = {
            earned: [],
            progress: {
                sqlExecutions: 0,
                tablesCreated: 0,
                joinsPerformed: 0,
                proceduresCreated: 0,
                triggersCreated: 0,
                transactionsUsed: 0,
                errorsEncountered: 0,
                errorsFixed: 0,
                modelsExplored: []
            }
        };

        const achievements = {
            first_query: {
                id: 'first_query',
                name: 'SQL 初學者',
                description: '執行第一個 SQL 查詢',
                icon: '🌟',
                requirement: { sqlExecutions: 1 }
            },
            table_creator: {
                id: 'table_creator',
                name: '建表大師',
                description: '創建 5 個資料表',
                icon: '📊',
                requirement: { tablesCreated: 5 }
            },
            join_master: {
                id: 'join_master',
                name: 'JOIN 查詢大師',
                description: '執行 10 次 JOIN 查詢',
                icon: '🔗',
                requirement: { joinsPerformed: 10 }
            },
            procedure_expert: {
                id: 'procedure_expert',
                name: '存儲過程專家',
                description: '創建 3 個存儲過程或函數',
                icon: '⚙️',
                requirement: { proceduresCreated: 3 }
            },
            trigger_wizard: {
                id: 'trigger_wizard',
                name: '觸發器巫師',
                description: '創建 3 個觸發器',
                icon: '⚡',
                requirement: { triggersCreated: 3 }
            },
            transaction_pro: {
                id: 'transaction_pro',
                name: '事務處理專家',
                description: '使用 COMMIT/ROLLBACK 10 次',
                icon: '💾',
                requirement: { transactionsUsed: 10 }
            },
            error_fixer: {
                id: 'error_fixer',
                name: '調試高手',
                description: '修復 20 個錯誤',
                icon: '🐛',
                requirement: { errorsFixed: 20 }
            },
            model_explorer: {
                id: 'model_explorer',
                name: '數據模型探索者',
                description: '嘗試 5 種不同的數據模型',
                icon: '🗺️',
                requirement: { modelsExploredCount: 5 }
            },
            sql_veteran: {
                id: 'sql_veteran',
                name: 'SQL 老手',
                description: '執行 100 個 SQL 語句',
                icon: '🏆',
                requirement: { sqlExecutions: 100 }
            }
        };

        // 增強的數據庫元數據結構
        let databaseMetadata = {
            tables: {},      // 表格元數據
            views: {},       // 視圖定義
            indexes: {},     // 索引定義
            constraints: {}, // 約束定義
            triggers: {},    // 觸發器定義
            procedures: {},  // 存儲過程定義
            sequences: {},   // 序列定義 (Oracle SEQUENCE)
            packages: {},    // 包定義 (Oracle PACKAGE)
            synonyms: {},    // 同義詞定義 (Oracle SYNONYM)
            tablespaces: {}  // 表空間定義 (Oracle TABLESPACE, 概念性)
        };

        // 15種數據模型定義
        const dataModels = {
            relational: {
                id: 'relational',
                name: '關聯式模型',
                icon: '📊',
                category: '基礎模型',
                description: '傳統的關聯式數據庫，使用表格執行和列來存儲數據，支持 ACID 特性',
                examples: [
                    "-- 關聯式數據庫模型\n-- 您可以在這裡自由編寫 SQL 、句\n-- 例如：CREATE TABLE, INSERT, SELECT, UPDATE, DELETE 等\n\n"
                ]
            },
            json: {
                id: 'json',
                name: 'JSON、件模型',
                icon: '📄',
                category: '基礎模型',
                description: 'JSON 資料類型與查詢，支持半結構化數據存儲和 JSON 路徑查詢',
                examples: [
                    "-- 創建 JSON 文件表\nCREATE TABLE products (\n    id INT,\n    data JSON\n);\n\n-- 插入 JSON 數據\nINSERT INTO products VALUES (1, '{\"name\":\"Laptop\",\"price\":1200,\"specs\":{\"cpu\":\"i7\",\"ram\":\"16GB\"}}');\n\n-- JSON 路徑查詢（模擬）\nSELECT * FROM products;"
                ]
            },
            xml: {
                id: 'xml',
                name: 'XML模型',
                icon: '📋',
                category: '基礎模型',
                description: 'XML 數據庫    XQuery 支援，用於處理 XML 格式的文檔數據',
                examples: [
                    "-- 創建 XML 文件表\nCREATE TABLE documents (\n    id INT,\n    title VARCHAR(100),\n    content VARCHAR(500)\n);\n\n-- 插入 XML 數據\nINSERT INTO documents VALUES (1, 'Product Catalog', '<products><product id=\"1\"><name>Laptop</name></product></products>');\n\n-- 查詢\nSELECT * FROM documents;"
                ]
            },
            graph: {
                id: 'graph',
                name: '圖形資料庫',
                icon: '🔗',
                category: '基礎模型',
                description: '屬性圖與 PGQL 查詢語言，適合處理關係密集的數據（如社交網絡）',
                examples: [
                    "-- 創建節點表（模擬圖數據庫）\nCREATE TABLE nodes (\n    id INT,\n    type VARCHAR(50),\n    name VARCHAR(100)\n);\n\n-- 創建邊表\nCREATE TABLE edges (\n    from_id INT,\n    to_id INT,\n    relationship VARCHAR(50)\n);\n\n-- 插入節點\nINSERT INTO nodes VALUES (1, 'Person', 'Alice');\nINSERT INTO nodes VALUES (2, 'Person', 'Bob');\n\n-- 插入關係\nINSERT INTO edges VALUES (1, 2, 'FRIEND');\n\n-- 查詢\nSELECT * FROM edges;"
                ]
            },
            spatial: {
                id: 'spatial',
                name: '空間資料',
                icon: '🗺️',
                category: '基礎模型',
                description: 'Spatial and Graph 空間資料處理，支持地理位置查詢和空間分析',
                examples: [
                    "-- 創建位置表\nCREATE TABLE locations (\n    id INT,\n    name VARCHAR(100),\n    latitude DECIMAL,\n    longitude DECIMAL\n);\n\n-- 插入地理數據\nINSERT INTO locations VALUES (1, 'Taipei 101', 25.0340, 121.5645);\nINSERT INTO locations VALUES (2, 'National Palace Museum', 25.1023, 121.5485);\n\n-- 查詢\nSELECT * FROM locations;"
                ]
            },
            blockchain: {
                id: 'blockchain',
                name: '區塊鏈表',
                icon: '⛓️',
                category: '進階模型',
                description: '防竄改區塊鏈表格，數據一旦寫入便無法修改，保證數據完整性',
                examples: [
                    "-- 創建區塊鏈表（只允許 INSERT）\nCREATE TABLE transactions (\n    id INT,\n    timestamp VARCHAR(50),\n    from_account VARCHAR(50),\n    to_account VARCHAR(50),\n    amount INT\n);\n\n-- 插入交易記錄（不可修改）\nINSERT INTO transactions VALUES (1, '2024-12-07 10:00:00', 'Alice', 'Bob', 1000);\nINSERT INTO transactions VALUES (2, '2024-12-07 10:05:00', 'Bob', 'Charlie', 500);\n\n-- 查詢交易歷史\nSELECT * FROM transactions;"
                ]
            },
            keyvalue: {
                id: 'keyvalue',
                name: '、值儲存',
                icon: '🔑',
                category: '進階   型',
                description: 'SODA（Simple Oracle Document Access），簡單的鍵值對存儲',
                examples: [
                    "-- 創建鍵值表\nCREATE TABLE kv_store (\n    key VARCHAR(100),\n    value VARCHAR(500)\n);\n\n-- 存儲配置\nINSERT INTO kv_store VALUES ('app_name', 'Database Simulator');\nINSERT INTO kv_store VALUES ('version', '1.0.0');\nINSERT INTO kv_store VALUES ('theme', 'dark');\n\n-- 查詢值\nSELECT * FROM kv_store WHERE key = 'app_name';"
                ]
            },
            timeseries: {
                id: 'timeseries',
                name: '時間序列',
                icon: '📈',
                category: '進階模、',
                description: '時間序列資料處理，適合處理   聯網、監控等時序數據',
                examples: [
                    "-- 創建時間序列表\nCREATE TABLE sensor_data (\n    sensor_id INT,\n    timestamp VARCHAR(50),\n    temperature DECIMAL,\n    humidity DECIMAL\n);\n\n-- 插入感測器數據\nINSERT INTO sensor_data VALUES (1, '2024-12-07 10:00:00', 25.5, 60.2);\nINSERT INTO sensor_data VALUES (1, '2024-12-07 10:01:00', 25.7, 60.5);\nINSERT INTO sensor_data VALUES (1, '2024-12-07 10:02:00', 25.6, 60.3);\n\n-- 查詢最近數據\nSELECT * FROM sensor_data;"
                ]
            },
            fulltext: {
                id: 'fulltext',
                name: '文字搜尋',
                icon: '🔍',
                category: '進階模型',
                description: 'Oracle Text 全文檢索，支持強大的文本搜索和分析功能',
                examples: [
                    "-- 創建文檔表\nCREATE TABLE articles (\n    id INT,\n    title VARCHAR(200),\n    content VARCHAR(1000)\n);\n\n-- 插入文章\nINSERT INTO articles VALUES (1, 'Database Introduction', 'Databases are essential for modern applications...');\nINSERT INTO articles VALUES (2, 'SQL Tutorial', 'SQL is a powerful language for querying databases...');\n\n-- 全文搜索\nSELECT * FROM articles WHERE content LIKE '%database%';"
                ]
            },
            object: {
                id: 'object',
                name: '物件關聯模型',
                icon: '📦',
                category: '進階模型',
                description: '物、類型與物件表格，結合物件導向與關聯式數據庫的優點',
                examples: [
                    "-- 創建物件表（模擬）\nCREATE TABLE employees_obj (\n    id INT,\n    name VARCHAR(50),\n    address VARCHAR(200),\n    skills VARCHAR(200)\n);\n\n-- 插入物件數據\nINSERT INTO employees_obj VALUES (1, 'Alice', '{\"city\":\"Taipei\",\"street\":\"Xinyi Rd.\"}', '[\"Python\",\"SQL\",\"JavaScript\"]');\n\n-- 查詢\nSELECT * FROM employees_obj;"
                ]
            },
            semistructured: {
                id: 'semistructured',
                name: '半結構化資料',
                icon: '🔀',
                category: '專業模型',
                description: '混合結構支援，可以在同一表格中存儲不同結構的數據',
                examples: [
                    "-- 創建半結構化表\nCREATE TABLE mixed_data (\n    id INT,\n    type VARCHAR(50),\n    data VARCHAR(500)\n);\n\n-- 插入不同結構的數據\nINSERT INTO mixed_data VALUES (1, 'user', '{\"name\":\"Alice\",\"age\":30}');\nINSERT INTO mixed_data VALUES (2, 'product', '{\"name\":\"Laptop\",\"price\":1200,\"specs\":{}}');\n\n-- 查詢\nSELECT * FROM mixed_data;"
                ]
            },
            streaming: {
                id: 'streaming',
                name: '流資料處理',
                icon: '💧',
                category: '專業模型',
                description: 'Continuous Query Notification（CQN）持續、詢通知，實時處理流數據',
                examples: [
                    "-- 創建事件流表\nCREATE TABLE event_stream (\n    event_id INT,\n    timestamp VARCHAR(50),\n    event_type VARCHAR(50),\n    data VARCHAR(200)\n);\n\n-- 插入即時事件\nINSERT INTO event_stream VALUES (1, '2024-12-07 10:00:00', 'user_login', '{\"user\":\"Alice\"}');\nINSERT INTO event_stream VALUES (2, '2024-12-07 10:00:05', 'purchase', '{\"user\":\"Bob\",\"amount\":100}');\n\n-- 查詢事、流\nSELECT * FROM event_stream;"
                ]
            },
            inmemory: {
                id: 'inmemory',
                name: '記憶體資料庫',
                icon: '⚡',
                category: '專業、型',
                description: 'In-Memory Column Store，將數據存儲在內存中以實現極快的查詢速度',
                examples: [
                    "-- 創建內存表（高速查詢）\nCREATE TABLE cache_data (\n    id INT,\n    key VARCHAR(100),\n    value VARCHAR(200),\n    access_count INT\n);\n\n-- 插   緩存數據\nINSERT INTO cache_data VALUES (1, 'session_123', '{\"user\":\"Alice\"}', 150);\nINSERT INTO cache_data VALUES (2, 'session_456', '{\"user\":\"Bob\"}', 89);\n\n-- 快速查詢\nSELECT * FROM cache_data WHERE access_count > 100;"
                ]
            },
            distributed: {
                id: 'distributed',
                name: '分佈式資料',
                icon: '🌐',
                category: '專業模型',
                description: 'Database Link 與 Sharding，將數據分佈在多個節點上以提高可擴展性',
                examples: [
                    "-- 創建分片表\nCREATE TABLE users_shard1 (\n    id INT,\n    name VARCHAR(50),\n    region VARCHAR(50)\n);\n\n-- 插入區域數據（亞洲分片）\nINSERT INTO users_shard1 VALUES (1, 'Alice', 'Asia');\nINSERT INTO users_shard1 VALUES (2, 'Bob', 'Asia');\n\n-- 查詢\nSELECT * FROM users_shard1;"
                ]
            },
            multitenant: {
                id: 'multitenant',
                name: '多租戶模型',
                icon: '🏢',
                category: '專業模型',
                description: 'Pluggable Database（PDB）架構，一個數據庫實例支持多個獨立租戶',
                examples: [
                    "-- 創建租戶表\nCREATE TABLE tenant_data (\n    tenant_id INT,\n    tenant_name VARCHAR(100),\n    data VARCHAR(200)\n);\n\n-- 插入租戶數據\nINSERT INTO tenant_data VALUES (1, 'Company A', '{\"employees\":100}');\nINSERT INTO tenant_data VALUES (2, 'Company B', '{\"employees\":50}');\n\n-- 查詢特定租戶\nSELECT * FROM tenant_data WHERE tenant_id = 1;"
                ]
            }
        };

        // 多檔案管理系統
        let databaseFiles = []; // 所有資料庫檔案
        let currentFileIndex = 0; // 當前活動檔案索引
        let nextFileId = 1; // 下一個檔案ID

        // 、習題目（擴展題庫）
        const exercisesPool = [
            {
                title: "創建部門表格",
                description: `<strong>📋 表格名稱：</strong>DEPARTMENTS<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. DEPT_ID - 部門編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. DEPT_NAME - 部門名稱（字串，非空）<br>
  &nbsp;&nbsp;3. LOCATION - 所在地點（字串）<br>
  &nbsp;&nbsp;4. BUDGET - 年度預算（數字，小數點兩位）<br>
• 部門名稱必須是唯一值<br>
• 預算不能為負數`,
                hint: "💡 提示：使用 CREATE TABLE 語句建立表格，使用 PRIMARY KEY 定義主鍵，使用 UNIQUE 確保部門名稱唯一，使    CHECK 約束確保預算為正數",
                solution: "CREATE TABLE DEPARTMENTS (DEPT_ID NUMBER PRIMARY KEY, DEPT_NAME VARCHAR2(50) NOT NULL UNIQUE, LOCATION VARCHAR2(50), BUDGET NUMBER(12,2) CHECK(BUDGET >= 0));",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 DEPARTMENTS", points: 3 },
                    { text: "包含 DEPT_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 DEPT_NAME 欄位（非空、唯一）", points: 5 },
                    { text: "包含 LOCATION 欄位", points: 3 },
                    { text: "包含 BUDGET 欄位（小數點兩位）", points: 4 },
                    { text: "DEPT_NAME 設定 UNIQUE 約束", points: 5 },
                    { text: "BUDGET 設定 CHECK 約束（>= 0）", points: 5 }
                ]
            },
            {
                title: "創建產品目錄表",
                description: `<strong>📋 表格名稱：</strong>PRODUCTS<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. PROD_ID - 產品編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. PROD_NAME -    品名稱（字串，非空）<br>
  &nbsp;&nbsp;3. CATEGORY - 產品類別（字串）<br>
  &nbsp;&nbsp;4. PRICE - 單價（數字，小數點兩位）<br>
  &nbsp;&nbsp;5. STOCK - 庫存數量（數字，預設為0）<br>
  &nbsp;&nbsp;6. STATUS - 狀態（只能輸入 '上架' 或 '下架'）`,
                hint: "💡 提示：使用 PRIMARY KEY 定義主鍵，使用 CHECK 約束限制狀態值，使用 DEFAULT 設定預設庫存",
                solution: "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')));",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 PRODUCTS", points: 3 },
                    { text: "包含 PROD_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 PROD_NAME 欄位（非空）", points: 4 },
                    { text: "包含 PRICE 欄位（小數點兩位）", points: 5 },
                    { text: "包含 STOCK 欄位（預設為0）", points: 5 },
                    { text: "包含 STATUS 欄位（CHECK 約束限制上架/下架）", points: 8 }
                ]
            },
            {
                title: "創建客戶資料表",
                description: `<strong>📋 表格名稱：</strong>CUSTOMERS<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. CUST_ID - 客戶編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. CUST_NAME - 客戶姓名（字串，非空）<br>
  &nbsp;&nbsp;3. EMAIL - 電子郵件（字串，必須唯一）<br>
  &nbsp;&nbsp;4. PHONE - 聯絡電話（字串）<br>
  &nbsp;&nbsp;5. CITY - 所在城市（字串）<br>
  &nbsp;&nbsp;6. VIP_LEVEL - VIP等級（數字，範圍1-5）`,
                hint: "💡 提示：使用 UNIQUE 確保電子郵件唯一   使用 CHECK 約束限制 VIP 等級範圍",
                solution: "CREATE TABLE CUSTOMERS (CUST_ID NUMBER PRIMARY KEY, CUST_NAME VARCHAR2(50) NOT NULL, EMAIL VARCHAR2(100) UNIQUE, PHONE VARCHAR2(20), CITY VARCHAR2(50), VIP_LEVEL NUMBER CHECK(VIP_LEVEL BETWEEN 1 AND 5));",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 CUSTOMERS", points: 3 },
                    { text: "包含 CUST_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 CUST_NAME 欄位（非空）", points: 4 },
                    { text: "包含 EMAIL 欄位（唯一）", points: 5 },
                    { text: "包含 VIP_LEVEL 欄位（CHECK 約束 1-5）", points: 8 },
                    { text: "正確使用 BETWEEN 語法", points: 5 }
                ]
            },
            {
                title: "創建訂單表",
                description: `<strong>📋 表格名稱：</strong>ORDERS<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. ORDER_ID - 訂單編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. ORDER_DATE - 訂單日期（日期，預設為系統日期）<br>
  &nbsp;&nbsp;3. TOTAL_AMOUNT - 訂單總額（數字，小數點兩位）<br>
  &nbsp;&nbsp;4. PAYMENT_STATUS - 付款狀態（只能輸入 '未付款'、'已付款'、'退款'）<br>
  &nbsp;&nbsp;5. DELIVERY_STATUS - 配送狀態（只能輸入 '待出貨'、'配送中'、'已送達'）`,
                hint: "💡 提示：使用 DEFAULT SYSDATE 設定預設訂單日期，使用 CHECK 約束限制狀態值",
                solution: "CREATE TABLE ORDERS (ORDER_ID NUMBER PRIMARY KEY, ORDER_DATE DATE DEFAULT SYSDATE, TOTAL_AMOUNT NUMBER(12,2), PAYMENT_STATUS VARCHAR2(20) CHECK(PAYMENT_STATUS IN ('未付款','已付款','退款')), DELIVERY_STATUS VARCHAR2(20) CHECK(DELIVERY_STATUS IN ('待出貨','配送中','已送達')));",
                difficulty: "中級",
                difficultyStars: 2.5,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 ORDERS", points: 3 },
                    { text: "包含 ORDER_ID 欄位（主鍵）", points: 4 },
                    { text: "包含 ORDER_DATE 欄位（預設 SYSDATE）", points: 5 },
                    { text: "包含 PAYMENT_STATUS 欄位（CHECK 約束）", points: 9 },
                    { text: "包含 DELIVERY_STATUS 欄位（CHECK 約束）", points: 9 }
                ]
            },
            {
                title: "創建書籍資料表",
                description: `<strong>📋 表格名稱：</strong>BOOKS<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. BOOK_ID - 書籍編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. TITLE - 書名（字串，非空）<br>
  &nbsp;&nbsp;3. AUTHOR - 作者（字串）<br>
  &nbsp;&nbsp;4. PUBLISHER - 出版社（字串）<br>
  &nbsp;&nbsp;5. PRICE - 售價（數字，小數點兩位）<br>
  &nbsp;&nbsp;6. PUBLISH_YEAR - 出版年份（數字，範圍1900-2100）`,
                hint: "💡 提示：使用 CHECK 約束限制出版年份範圍",
                solution: "CREATE TABLE BOOKS (BOOK_ID NUMBER PRIMARY KEY, TITLE VARCHAR2(200) NOT NULL, AUTHOR VARCHAR2(100), PUBLISHER VARCHAR2(100), PRICE NUMBER(10,2), PUBLISH_YEAR NUMBER CHECK(PUBLISH_YEAR BETWEEN 1900 AND 2100));",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 BOOKS", points: 3 },
                    { text: "包含 BOOK_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 TITLE 欄位（非空）", points: 4 },
                    { text: "包含 PRICE 欄位（小數點兩位）", points: 5 },
                    { text: "包含 PUBLISH_YEAR 欄位（CHECK 約束 1900-2100）", points: 8 },
                    { text: "正確使用 BETWEEN 語法", points: 5 }
                ]
            },
            {
                title: "創建學生成績表",
                description: `<strong>📋 表格名稱：</strong>STUDENT_GRADES<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. STUDENT_ID - 學號（數字，主鍵）<br>
  &nbsp;&nbsp;2. STUDENT_NAME - 學生姓名（字串，非空）<br>
  &nbsp;&nbsp;3. SUBJECT - 科目（字串）<br>
  &nbsp;&nbsp;4. SCORE - 分數（數字，範圍0-100）<br>
  &nbsp;&nbsp;5. GRADE - 等級（只能   入 'A'、'B'、'C'、'D'、'F'）`,
                hint: "💡 提示：使用 CHECK 約束限制分數範圍和等級值",
                solution: "CREATE TABLE STUDENT_GRADES (STUDENT_ID NUMBER PRIMARY KEY, STUDENT_NAME VARCHAR2(50) NOT NULL, SUBJECT VARCHAR2(50), SCORE NUMBER CHECK(SCORE BETWEEN 0 AND 100), GRADE CHAR(1) CHECK(GRADE IN ('A','B','C','D','F')));",
                difficulty: "中級",
                difficultyStars: 2.5,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 STUDENT_GRADES", points: 3 },
                    { text: "包含 STUDENT_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 STUDENT_NAME 欄位（非空）", points: 4 },
                    { text: "包含 SCORE 欄位（CHECK 約束 0-100）", points: 9 },
                    { text: "包含 GRADE 欄位（CHECK 約束 A/B/C/D/F）", points: 9 }
                ]
            },
            {
                title: "創建員工出勤表",
                description: `<strong>📋 表格名稱：</strong>ATTENDANCE<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. ATT_ID - 記錄編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. EMP_NAME - 員工姓名（字串，非空）<br>
  &nbsp;&nbsp;3. ATT_DATE - 出勤日期（日期）<br>
  &nbsp;&nbsp;4. CHECK_IN - 打卡上班時間（字串）<br>
  &nbsp;&nbsp;5. CHECK_OUT - 打卡下班時間（字串）<br>
  &nbsp;&nbsp;6. STATUS - 出勤狀態（只能輸入 '正常'、'遲到'、'早退'、'請假'、'曠職'）`,
                hint: "💡 提示：使用 CHECK 約束限制出勤狀態值",
                solution: "CREATE TABLE ATTENDANCE (ATT_ID NUMBER PRIMARY KEY, EMP_NAME VARCHAR2(50) NOT NULL, ATT_DATE DATE, CHECK_IN VARCHAR2(10), CHECK_OUT VARCHAR2(10), STATUS VARCHAR2(10) CHECK(STATUS IN ('正常','遲到','早退','請假','曠職')));",
                difficulty: "中級",
                difficultyStars: 2.5,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 ATTENDANCE", points: 3 },
                    { text: "包含 ATT_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 EMP_NAME 欄位（非空）", points: 4 },
                    { text: "包含 ATT_DATE 欄位", points: 5 },
                    { text: "包含 STATUS 欄位（CHECK 約束）", points: 13 }
                ]
            },
            {
                title: "創建課程表",
                description: `<strong>📋 表格名稱：</strong>COURSES<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. COURSE_ID - 課程編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. COURSE_NAME - 課程名稱（字串，非空，唯一）<br>
  &nbsp;&nbsp;3. CREDITS - 學分（數字，範圍1-6）<br>
  &nbsp;&nbsp;4. INSTRUCTOR - 授課教師（字串）<br>
  &nbsp;&nbsp;5. MAX_STUDENTS - 最大學生數（數字，預設為30）`,
                hint: "💡 提示：使用 UNIQUE 確保課程名稱唯一，使用 CHECK 約束限制學分範圍，使用 DEFAULT 設定預設值",
                solution: "CREATE TABLE COURSES (COURSE_ID NUMBER PRIMARY KEY, COURSE_NAME VARCHAR2(100) NOT NULL UNIQUE, CREDITS NUMBER CHECK(CREDITS BETWEEN 1 AND 6), INSTRUCTOR VARCHAR2(50), MAX_STUDENTS NUMBER DEFAULT 30);",
                difficulty: "中級",
                difficultyStars: 3,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 COURSES", points: 3 },
                    { text: "包含 COURSE_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 COURSE_NAME 欄位（非空、唯一）", points: 6 },
                    { text: "包含 CREDITS 欄位（CHECK 約束 1-6）", points: 8 },
                    { text: "包含 MAX_STUDENTS 欄位（預設為30）", points: 8 }
                ]
            },
            {
                title: "創建供應商表",
                description: `<strong>📋 表格名稱：</strong>SUPPLIERS<br><br>
<strong>📌 要求：</strong><br>
• 包、以下欄位：<br>
  &nbsp;&nbsp;1. SUPPLIER_ID - 供應商編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. SUPPLIER_NAME - 供應商名稱（字串，非空，唯一）<br>
  &nbsp;&nbsp;3. CONTACT_PERSON - 聯絡人（字串）<br>
  &nbsp;&nbsp;4. PHONE - 聯絡電話（字串）<br>
  &nbsp;&nbsp;5. ADDRESS - 地址（字串）<br>
  &nbsp;&nbsp;6. RATING - 評級（數字，範圍1-10）`,
                hint: "💡 提示：使用 UNIQUE 確保供應商名稱唯一，使用 CHECK 約束限制評級範圍",
                solution: "CREATE TABLE SUPPLIERS (SUPPLIER_ID NUMBER PRIMARY KEY, SUPPLIER_NAME VARCHAR2(100) NOT NULL UNIQUE, CONTACT_PERSON VARCHAR2(50), PHONE VARCHAR2(20), ADDRESS VARCHAR2(200), RATING NUMBER CHECK(RATING BETWEEN 1 AND 10));",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 SUPPLIERS", points: 3 },
                    { text: "   含 SUPPLIER_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 SUPPLIER_NAME 欄位（非空、唯一）", points: 6 },
                    { text: "包含 RATING 欄位（CHECK 約束 1-10）", points: 8 },
                    { text: "正確使用 BETWEEN 語法", points: 8 }
                ]
            },
            {
                title: "插入部門資料",
                description: `<strong>📋 操作目標：</strong>向 DEPARTMENTS 表插入資料<br><br>
<strong>📊 系統已提供：</strong>DEPARTMENTS 空表<br><br>
<strong>📌 要求：</strong>插入以下部門資料：<br>
• 部門1：IT部門，地點：九龍，預算：1,000,000<br>
• 部門2：人事部，地點：港島，預算：500,000<br>
• 部門3：財務部，地點：新界，預算：800,000<br>
• 部門4：市場部，地點：九龍，預算：700,000`,
                hint: "💡 提示：使用 INSERT INTO 語句，可以一次插入一筆資料",
                solution: "INSERT INTO DEPARTMENTS VALUES (1, 'IT部門', '九龍', 1000000); INSERT INTO DEPARTMENTS VALUES (2, '人事部', '港島', 500000); INSERT INTO DEPARTMENTS VALUES (3, '財務部', '新界', 800000); INSERT INTO DEPARTMENTS VALUES (4, '市場部', '九龍', 700000);",
                difficulty: "基礎",
                difficultyStars: 1.5,
                category: "DML - 插入",
                initialData: [
                    "CREATE TABLE DEPARTMENTS (DEPT_ID NUMBER PRIMARY KEY, DEPT_NAME VARCHAR2(50) NOT NULL UNIQUE, LOCATION VARCHAR2(50), BUDGET NUMBER(12,2) CHECK(BUDGET >= 0))"
                ],
                requirements: [
                    { text: "使用 INSERT INTO 語句", points: 5 },
                    { text: "插入 IT部門 資料", points: 6 },
                    { text: "插入 人事部 資料", points: 6 },
                    { text: "插入 財務部 資料", points: 6 },
                    { text: "插入 市場部 資料", points: 7 }
                ]
            },
            {
                title: "插入客戶資料",
                description: `<strong>📋 操作目標：</strong>向 CUSTOMERS 表插入資料<br><br>
<strong>📊 系統已提供：</strong>CUSTOMERS 空表<br><br>
<strong>📌 要求：</strong>插入以下客戶資料：<br>
1. 陳小明，郵箱：chen@email.com，電話：91234567，城市：香港，VIP等級：3<br>
2. 李美玲，郵箱：li@email.com，電話：98765432，城市：九龍，VIP等級：5<br>
3. 王大偉，郵箱：wang@email.com，電話：92345678，城市：新界，VIP等級：2`,
                hint: "💡 提示：使用 INSERT INTO 語句，確保 VIP 等級在 1-5 範圍內",
                solution: "INSERT INTO CUSTOMERS VALUES (1, '陳小明', 'chen@email.com', '91234567', '香港', 3); INSERT INTO CUSTOMERS VALUES (2, '李美玲', 'li@email.com', '98765432', '九龍', 5); INSERT INTO CUSTOMERS VALUES (3, '王大偉', 'wang@email.com', '92345678', '新界', 2);",
                difficulty: "基礎",
                difficultyStars: 1,
                category: "DML - 插入",
                initialData: [
                    "CREATE TABLE CUSTOMERS (CUST_ID NUMBER PRIMARY KEY, CUST_NAME VARCHAR2(50) NOT NULL, EMAIL VARCHAR2(100) UNIQUE, PHONE VARCHAR2(20), CITY VARCHAR2(50), VIP_LEVEL NUMBER CHECK(VIP_LEVEL BETWEEN 1 AND 5))"
                ],
                requirements: [
                    { text: "使用 INSERT INTO 語句", points: 5 },
                    { text: "插入陳小明資料", points: 8 },
                    { text: "插入李美玲資料", points: 8 },
                    { text: "插入王大偉資料", points: 9 }
                ]
            },
            {
                title: "插入書籍資料",
                description: `<strong>📋 操作目標：</strong>向 BOOKS 表插入資料<br><br>
<strong>📊 系統已提供：</strong>BOOKS 空表<br><br>
<strong>📌 要求：</strong>插入以下書籍資料：<br>
1. SQL基礎教程，作者：張明，出版社：資訊出版社，售價：350，出版年份：2023<br>
2. 資料庫設計，作者：李華，出版社：技術出版社，售價：450，出版年份：2022<br>
3. 進階SQL技巧，作者：王強，出版社：資訊出版社，售價：520，出版年份：2024`,
                hint: "💡 提示：使用 INSERT INTO 語句，確保出版年份在 1900-2100 範圍內",
                solution: "INSERT INTO BOOKS VALUES (1, 'SQL基礎教程', '張明', '資訊出版社', 350, 2023); INSERT INTO BOOKS VALUES (2, '資料庫設計', '李華', '技術出版社', 450, 2022); INSERT INTO BOOKS VALUES (3, '進階SQL技巧', '王強', '資訊出版社', 520, 2024);",
                difficulty: "基礎",
                difficultyStars: 1,
                category: "DML - 插入",
                initialData: [
                    "CREATE TABLE BOOKS (BOOK_ID NUMBER PRIMARY KEY, TITLE VARCHAR2(200) NOT NULL, AUTHOR VARCHAR2(100), PUBLISHER VARCHAR2(100), PRICE NUMBER(10,2), PUBLISH_YEAR NUMBER CHECK(PUBLISH_YEAR BETWEEN 1900 AND 2100))"
                ],
                requirements: [
                    { text: "使用 INSERT INTO 語句", points: 5 },
                    { text: "插入SQL基礎教程資料", points: 8 },
                    { text: "插入資料庫設計資料", points: 8 },
                    { text: "插入進階SQL技巧資料", points: 9 }
                ]
            },
            {
                title: "查詢客戶資料",
                description: `<strong>📋 操作目標：</strong>查詢 CUSTOMERS 表中的客戶<br><br>
<strong>📊 系統已提供：</strong>CUSTOMERS 表（3 位客戶）<br><br>
<strong>📌 要求：</strong><br>
• 查詢 VIP等級 >= 3 的客戶<br>
• 顯示客戶姓名、城市、VIP等級<br>
• 按照 VIP等級 降序排序`,
                hint: "💡 提示：使用 SELECT 語句配合 WHERE 條件，使用 ORDER BY 排序",
                solution: "SELECT CUST_NAME, CITY, VIP_LEVEL FROM CUSTOMERS WHERE VIP_LEVEL >= 3 ORDER BY VIP_LEVEL DESC;",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DQL - 查詢",
                initialData: [
                    "CREATE TABLE CUSTOMERS (CUST_ID NUMBER PRIMARY KEY, CUST_NAME VARCHAR2(50) NOT NULL, EMAIL VARCHAR2(100) UNIQUE, PHONE VARCHAR2(20), CITY VARCHAR2(50), VIP_LEVEL NUMBER CHECK(VIP_LEVEL BETWEEN 1 AND 5))",
                    "INSERT INTO CUSTOMERS VALUES (1, '陳小明', 'chen@email.com', '91234567', '香港', 3)",
                    "INSERT INTO CUSTOMERS VALUES (2, '李美玲', 'li@email.com', '98765432', '九   ', 5)",
                    "INSERT INTO CUSTOMERS VALUES (3, '王大偉', 'wang@email.com', '92345678', '新界', 2)"
                ],
                requirements: [
                    { text: "使用 SELECT 語句", points: 4 },
                    { text: "使用 WHERE 篩選 VIP >= 3", points: 8 },
                    { text: "選擇正確的欄位", points: 8 },
                    { text: "使用 ORDER BY 降序排序", points: 10 }
                ]
            },
            {
                title: "更新書籍資料",
                description: `<strong>📋 操作目標：</strong>更新 BOOKS 表中的書籍售價<br><br>
<strong>📊 系統已提供：</strong>BOOKS 表（3 本書籍）<br><br>
<strong>📌 要求：</strong><br>
• 將 '資訊出版社' 出版的書籍售價上調 15%<br>
• 使用 UPDATE 語句搭配 WHERE 條件`,
                hint: "💡 提示：使用 UPDATE 語句，PRICE = PRICE * 1.15 表示上調 15%",
                solution: "UPDATE BOOKS SET PRICE = PRICE * 1.15 WHERE PUBLISHER = '資訊出版社';",
                difficulty: "中級",
                difficultyStars: 2.5,
                category: "DML - 更新",
                initialData: [
                    "CREATE TABLE BOOKS (BOOK_ID NUMBER PRIMARY KEY, TITLE VARCHAR2(200) NOT NULL, AUTHOR VARCHAR2(100), PUBLISHER VARCHAR2(100), PRICE NUMBER(10,2), PUBLISH_YEAR NUMBER CHECK(PUBLISH_YEAR BETWEEN 1900 AND 2100))",
                    "INSERT INTO BOOKS VALUES (1, 'SQL基礎教程', '張明', '資訊出版社', 350, 2023)",
                    "INSERT INTO BOOKS VALUES (2, '資料庫設計', '李華', '技術出版社', 450, 2022)",
                    "INSERT INTO BOOKS VALUES (3, '進階SQL技巧', '王強', '資訊出版社', 520, 2024)"
                ],
                requirements: [
                    { text: "使用 UPDATE 語句", points: 5 },
                    { text: "使用 WHERE 篩選資訊出版社", points: 8 },
                    { text: "正確計算售價上調 15%", points: 10 },
                    { text: "使用乘法運算", points: 7 }
                ]
            },
            {
                title: "統計客戶數量",
                description: `<strong>📋 操作目標：</strong>統計 CUSTOMERS 表中的客戶數量<br><br>
<strong>📊 系統已提供：</strong>CUSTOMERS 表（3 位客戶）<br><br>
<strong>📌 要求：</strong><br>
• 計算每個城市的客戶數量<br>
• 使用 GROUP BY 分組<br>
• 使用 COUNT 函數計算數量<br>
• 按城市名稱排序`,
                hint: "💡 提示：SELECT CITY, COUNT(*) ... GROUP BY CITY",
                solution: "SELECT CITY, COUNT(*) AS CUSTOMER_COUNT FROM CUSTOMERS GROUP BY CITY ORDER BY CITY;",
                difficulty: "中級",
                difficultyStars: 3,
                category: "DQL - 聚合查詢",
                initialData: [
                    "CREATE TABLE CUSTOMERS (CUST_ID NUMBER PRIMARY KEY, CUST_NAME VARCHAR2(50) NOT NULL, EMAIL VARCHAR2(100) UNIQUE, PHONE VARCHAR2(20), CITY VARCHAR2(50), VIP_LEVEL NUMBER CHECK(VIP_LEVEL BETWEEN 1 AND 5))",
                    "INSERT INTO CUSTOMERS VALUES (1, '陳小明', 'chen@email.com', '91234567', '香港', 3)",
                    "INSERT INTO CUSTOMERS VALUES (2, '李美玲', 'li@email.com', '98765432', '九龍', 5)",
                    "INSERT INTO CUSTOMERS VALUES (3, '王大偉', 'wang@email.com', '92345678', '新界', 2)"
                ],
                requirements: [
                    { text: "使用 SELECT 語句", points: 4 },
                    { text: "使用 COUNT 函數", points: 8 },
                    { text: "使用 GROUP BY 分組", points: 10 },
                    { text: "使用 ORDER BY 排序", points: 8 }
                ]
            },
            {
                title: "刪除特定客戶",
                description: `<strong>📋 操作目標：</strong>從 CUSTOMERS 表刪除特定客戶<br><br>
<strong>📊 系統已提供：</strong>CUSTOMERS 表（3 位客戶）<br><br>
<strong>📌 要求：</strong><br>
• 刪除 VIP等級 < 3 的客戶<br>
• 使用 DELETE 語句搭配 WHERE 條件`,
                hint: "💡 提示：DELETE FROM table WHERE condition",
                solution: "DELETE FROM CUSTOMERS WHERE VIP_LEVEL < 3;",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DML - 刪除",
                initialData: [
                    "CREATE TABLE CUSTOMERS (CUST_ID NUMBER PRIMARY KEY, CUST_NAME VARCHAR2(50) NOT NULL, EMAIL VARCHAR2(100) UNIQUE, PHONE VARCHAR2(20), CITY VARCHAR2(50), VIP_LEVEL NUMBER CHECK(VIP_LEVEL BETWEEN 1 AND 5))",
                    "INSERT INTO CUSTOMERS VALUES (1, '陳小明', 'chen@email.com', '91234567', '香港', 3)",
                    "INSERT INTO CUSTOMERS VALUES (2, '李美玲', 'li@email.com', '98765432', '九龍', 5)",
                    "INSERT INTO CUSTOMERS VALUES (3, '王大偉', 'wang@email.com', '92345678', '新界', 2)"
                ],
                requirements: [
                    { text: "使用 DELETE FROM 語句", points: 8 },
                    { text: "使用 WHERE 篩選 VIP < 3", points: 12 },
                    { text: "正確刪除記錄", points: 10 }
                ]
            },
            {
                title: "子查詢練習",
                description: `<strong>📋 操作目標：</strong>使用子查詢查找書籍<br><br>
<strong>📊 系統已提供：</strong>BOOKS 表（3 本書籍）<br><br>
<strong>📌 要求：</strong><br>
• 查詢售價高於平均售價的書籍<br>
• 使用子查詢計算平均售價<br>
• 顯示書名和售價`,
                hint: "💡 提示：WHERE PRICE > (SELECT AVG(PRICE) FROM BOOKS)",
                solution: "SELECT TITLE, PRICE FROM BOOKS WHERE PRICE > (SELECT AVG(PRICE) FROM BOOKS);",
                difficulty: "進階",
                difficultyStars: 4,
                category: "DQL - 子查詢",
                initialData: [
                    "CREATE TABLE BOOKS (BOOK_ID NUMBER PRIMARY KEY, TITLE VARCHAR2(200) NOT NULL, AUTHOR VARCHAR2(100), PUBLISHER VARCHAR2(100), PRICE NUMBER(10,2), PUBLISH_YEAR NUMBER CHECK(PUBLISH_YEAR BETWEEN 1900 AND 2100))",
                    "INSERT INTO BOOKS VALUES (1, 'SQL基礎教程', '張明', '資訊出版社', 350, 2023)",
                    "INSERT INTO BOOKS VALUES (2, '資料庫設計', '李華', '技術出版社', 450, 2022)",
                    "INSERT INTO BOOKS VALUES (3, '進階SQL技巧', '王強', '資訊出版社', 520, 2024)"
                ],
                requirements: [
                    { text: "使用 SELECT 語句", points: 4 },
                    { text: "使用子查詢", points: 10 },
                    { text: "使用 AVG 函數計算平均值", points: 8 },
                    { text: "正確比較售價", points: 8 }
                ]
            },
            {
                title: "創建會員積分表",
                description: `<strong>📋 表格名稱：</strong>MEMBER_POINTS<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. MEMBER_ID -    員編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. MEMBER_NAME - 會員姓名（字串，非空）<br>
  &nbsp;&nbsp;3. TOTAL_POINTS - 累積積分（數字，預設為0）<br>
  &nbsp;&nbsp;4. TIER - 會員等級（只能輸入 '普通'、'銀卡'、'金卡'、'白金'）<br>
  &nbsp;&nbsp;5. JOIN_DATE - 加入日期（日期，預設為系統日期）`,
                hint: "💡 提示：使用 DEFAULT 設定預設值，使用 CHECK 約束限制會員等級",
                solution: "CREATE TABLE MEMBER_POINTS (MEMBER_ID NUMBER PRIMARY KEY, MEMBER_NAME VARCHAR2(50) NOT NULL, TOTAL_POINTS NUMBER DEFAULT 0, TIER VARCHAR2(10) CHECK(TIER IN ('普通','銀卡','金卡','白金')), JOIN_DATE DATE DEFAULT SYSDATE);",
                difficulty: "中級",
                difficultyStars: 3,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 MEMBER_POINTS", points: 3 },
                    { text: "包含 MEMBER_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 TOTAL_POINTS 欄位（預設為0）", points: 6 },
                    { text: "包含 TIER 欄位（CHECK 約束）", points: 10 },
                    { text: "包含 JOIN_DATE 欄位（預設 SYSDATE）", points: 6 }
                ]
            },
            {
                title: "創建考試記錄表",
                description: `<strong>📋 表格名稱：</strong>EXAM_RECORDS<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. EXAM_ID - 考試編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. STUDENT_NAME - 學生姓名（字串，非空）<br>
  &nbsp;&nbsp;3. EXAM_DATE - 考試日期（日期）<br>
  &nbsp;&nbsp;4. SCORE - 得分（數字，範圍0-100）<br>
  &nbsp;&nbsp;5. PASS_STATUS - 及格狀態（只能輸入 '及格' 或 '不及格'）`,
                hint: "💡 提示：使用 CHECK 約束限制分數範圍和及格狀態",
                solution: "CREATE TABLE EXAM_RECORDS (EXAM_ID NUMBER PRIMARY KEY, STUDENT_NAME VARCHAR2(50) NOT NULL, EXAM_DATE DATE, SCORE NUMBER CHECK(SCORE BETWEEN 0 AND 100), PASS_STATUS VARCHAR2(10) CHECK(PASS_STATUS IN ('及格','不及格')));",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 EXAM_RECORDS", points: 3 },
                    { text: "包含 EXAM_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 SCORE 欄位（CHECK 約束 0-100）", points: 10 },
                    { text: "包含 PASS_STATUS 欄位（CHECK 約束）", points: 12 }
                ]
            },
            {
                title: "創建停車場記錄表",
                description: `<strong>📋 表格名稱：</strong>PARKING_RECORDS<br><br>
<strong>📌 要求：</strong><br>
• 包含以下欄位：<br>
  &nbsp;&nbsp;1. RECORD_ID - 記錄編號（數字，主鍵）<br>
  &nbsp;&nbsp;2. CAR_PLATE - 車牌號碼（字串，非空，唯一）<br>
  &nbsp;&nbsp;3. ENTRY_TIME - 入場時間（字串）<br>
  &nbsp;&nbsp;4. EXIT_TIME - 出場時間（字串）<br>
  &nbsp;&nbsp;5. PARKING_FEE - 停車費用（數字，小數點兩位）`,
                hint: "💡 提示：使用 UNIQUE 確保車牌號碼唯一",
                solution: "CREATE TABLE PARKING_RECORDS (RECORD_ID NUMBER PRIMARY KEY, CAR_PLATE VARCHAR2(20) NOT NULL UNIQUE, ENTRY_TIME VARCHAR2(20), EXIT_TIME VARCHAR2(20), PARKING_FEE NUMBER(8,2));",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DDL - 建表",
                requirements: [
                    { text: "表格名稱為 PARKING_RECORDS", points: 3 },
                    { text: "包含 RECORD_ID 欄位（主鍵）", points: 5 },
                    { text: "包含 CAR_PLATE 欄位（非空、唯一）", points: 10 },
                    { text: "包含 PARKING_FEE 欄位（小數點兩位）", points: 12 }
                ]
            },
            {
                title: "聚合函數練習",
                description: `<strong>📋 操作目標：</strong>計算產品統計資料<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（4 個產品）<br><br>
<strong>📌 要求：</strong><br>
• 計算所有產品的總庫存量<br>
• 計算產品的平均單價<br>
• 顯示最高和最低價格<br>
• 使用 SELECT 一次顯示所有統計數據`,
                hint: "💡 提示：SELECT SUM(STOCK), AVG(PRICE), MAX(PRICE), MIN(PRICE) FROM PRODUCTS",
                solution: "SELECT SUM(STOCK) AS 總庫存, AVG(PRICE) AS 平均價格, MAX(PRICE) AS 最高價, MIN(PRICE) AS 最低價 FROM PRODUCTS;",
                difficulty: "中級",
                difficultyStars: 3,
                category: "DQL - 聚合函數",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', '配件', 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', '電子產品', 3500, 20, '上架')"
                ],
                requirements: [
                    { text: "使用 SUM 函數計算總庫存", points: 8 },
                    { text: "使用 AVG 函數計算平均價格", points: 7 },
                    { text: "使用 MAX 函數找最高價", points: 7 },
                    { text: "使用 MIN 函數找最低價", points: 8 }
                ]
            },
            {
                title: "GROUP BY 分組統計",
                description: `<strong>📋 操作目標：</strong>按類別統計產品<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（4 個產品）<br><br>
<strong>📌 要求：</strong><br>
• 按產品類別分組<br>
• 計算每個類別的產品數量<br>
• 計算每個類別的平均價格<br>
• 顯示類別名稱、產品數量、平均價格`,
                hint: "💡 提示：SELECT CATEGORY, COUNT(*), AVG(PRICE) FROM PRODUCTS GROUP BY CATEGORY",
                solution: "SELECT CATEGORY AS 類別, COUNT(*) AS 產品數量, AVG(PRICE) AS 平均價格 FROM PRODUCTS GROUP BY CATEGORY;",
                difficulty: "進階",
                difficultyStars: 3.5,
                category: "DQL - 分組查詢",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', '配件', 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', '電子產品', 3500, 20, '上架')"
                ],
                requirements: [
                    { text: "使用 GROUP BY 分組", points: 10 },
                    { text: "使用 COUNT 函數計算數量", points: 7 },
                    { text: "使用 AVG 函數計算平均值", points: 7 },
                    { text: "顯示類別名稱", points: 6 }
                ]
            },
            {
                title: "HAVING 篩選分組",
                description: `<strong>📋 操作目標：</strong>篩選平均價格高的類別<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（4 個產品）<br><br>
<strong>📌 要求：</strong><br>
• 按產品類別分組<br>
• 計算每個類別的平均價格<br>
• 只顯示平均價格大於1000的類別<br>
• 使用 HAVING 子句篩選`,
                hint: "💡 提示：GROUP BY CATEGORY HAVING AVG(PRICE) > 1000",
                solution: "SELECT CATEGORY AS 類別, AVG(PRICE) AS 平均價格 FROM PRODUCTS GROUP BY CATEGORY HAVING AVG(PRICE) > 1000;",
                difficulty: "進階",
                difficultyStars: 4,
                category: "DQL - 分組篩選",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', '配件', 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', '電子產品', 3500, 20, '上架')"
                ],
                requirements: [
                    { text: "使用 GROUP BY 分組", points: 8 },
                    { text: "使用 HAVING 篩選", points: 12 },
                    { text: "正確篩選平均價格 > 1000", points: 10 }
                ]
            },
            {
                title: "ORDER BY 排序查詢",
                description: `<strong>📋 操作目標：</strong>按價格排序產品<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（4 個產品）<br><br>
<strong>📌 要求：</strong><br>
• 查詢所有產品的名稱和價格<br>
• 按價格從高到低排序<br>
• 使用 ORDER BY DESC`,
                hint: "💡 提示：SELECT PROD_NAME, PRICE FROM PRODUCTS ORDER BY PRICE DESC",
                solution: "SELECT PROD_NAME, PRICE FROM PRODUCTS ORDER BY PRICE DESC;",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DQL - 排序",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', '配件', 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', '電子產品', 3500, 20, '上架')"
                ],
                requirements: [
                    { text: "使用 SELECT 語句", points: 5 },
                    { text: "查詢產品名稱和價格", points: 10 },
                    { text: "使用 ORDER BY DESC 降序排序", points: 15 }
                ]
            },
            {
                title: "LIMIT 限制查詢結果",
                description: `<strong>📋 操作目標：</strong>查詢最貴的3個產品<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（4 個產品）<br><br>
<strong>📌 要求：</strong><br>
• 查詢產品名稱和價格<br>
• 按價格從高到低排序<br>
• 只顯示前3個結果<br>
• 使用 ROWNUM 限制結果`,
                hint: "💡 提示：WHERE ROWNUM <= 3",
                solution: "SELECT PROD_NAME, PRICE FROM (SELECT PROD_NAME, PRICE FROM PRODUCTS ORDER BY PRICE DESC) WHERE ROWNUM <= 3;",
                difficulty: "進階",
                difficultyStars: 3.5,
                category: "DQL - 限制結果",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', '配件', 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', '電子產品', 3500, 20, '上架')"
                ],
                requirements: [
                    { text: "使用 ORDER BY DESC 排序", points: 8 },
                    { text: "使用 ROWNUM 限制結果", points: 12 },
                    { text: "正確查詢前3個產品", points: 10 }
                ]
            },
            {
                title: "LIKE 模糊查詢",
                description: `<strong>📋 操作目標：</strong>搜尋特定名稱的產品<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（4 個產品）<br><br>
<strong>📌 要求：</strong><br>
• 查詢產品名稱包含「電」字的產品<br>
• 顯示產品名稱和類別<br>
• 使用 LIKE 進行模糊搜尋`,
                hint: "💡 提示：WHERE PROD_NAME LIKE '%電%'",
                solution: "SELECT PROD_NAME, CATEGORY FROM PRODUCTS WHERE PROD_NAME LIKE '%電%';",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DQL - 模糊查詢",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', '配件', 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', '電子產品', 3500, 20, '上架')"
                ],
                requirements: [
                    { text: "使用 SELECT 語句", points: 5 },
                    { text: "使用 WHERE 條件", points: 8 },
                    { text: "使用 LIKE '%電%' 模糊搜尋", points: 17 }
                ]
            },
            {
                title: "IN 多值查詢",
                description: `<strong>📋 操作目標：</strong>查詢指定類別的產品<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（4 個產品）<br><br>
<strong>📌 要求：</strong><br>
• 查詢類別為「電子產品」或「配件」的產品<br>
• 顯示產品名稱、類別和價格<br>
• 使用 IN 語句`,
                hint: "💡 提示：WHERE CATEGORY IN ('電子產品', '配件')",
                solution: "SELECT PROD_NAME, CATEGORY, PRICE FROM PRODUCTS WHERE CATEGORY IN ('電子產品', '配件');",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DQL - 多值查詢",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', '配件', 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', '電子產品', 3500, 20, '上架')"
                ],
                requirements: [
                    { text: "使用 SELECT 語句", points: 5 },
                    { text: "使用 WHERE 條件", points: 8 },
                    { text: "使用 IN 查詢多個值", points: 17 }
                ]
            },
            {
                title: "BETWEEN 範圍查詢",
                description: `<strong>📋 操作目標：</strong>查詢特定價格範圍的產品<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（4 個產品）<br><br>
<strong>📌 要求：</strong><br>
• 查詢價格在1000到5000之間的產品<br>
• 顯示產品名稱和價格<br>
• 使用 BETWEEN 語句`,
                hint: "💡 提示：WHERE PRICE BETWEEN 1000 AND 5000",
                solution: "SELECT PROD_NAME, PRICE FROM PRODUCTS WHERE PRICE BETWEEN 1000 AND 5000;",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DQL - 範圍查詢",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', '配件', 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', '電子產品', 3500, 20, '上架')"
                ],
                requirements: [
                    { text: "使用 SELECT 語句", points: 5 },
                    { text: "使用 WHERE 條件", points: 8 },
                    { text: "使用 BETWEEN 1000 AND 5000", points: 17 }
                ]
            },
            {
                title: "IS NULL 空值查詢",
                description: `<strong>📋 操作目標：</strong>查詢沒有類別的產品<br><br>
<strong>📊 系統已提供：</strong>PRODUCTS 表（5 個產品，其中有空值）<br><br>
<strong>📌 要求：</strong><br>
• 查詢類別為空值的產品<br>
• 顯示產品編號和產品名稱<br>
• 使用 IS NULL`,
                hint: "💡 提示：WHERE CATEGORY IS NULL",
                solution: "SELECT PROD_ID, PROD_NAME FROM PRODUCTS WHERE CATEGORY IS NULL;",
                difficulty: "基礎",
                difficultyStars: 2,
                category: "DQL - 空值查詢",
                initialData: [
                    "CREATE TABLE PRODUCTS (PROD_ID NUMBER PRIMARY KEY, PROD_NAME VARCHAR2(100) NOT NULL, CATEGORY VARCHAR2(50), PRICE NUMBER(10,2), STOCK NUMBER DEFAULT 0, STATUS VARCHAR2(10) CHECK(STATUS IN ('上架','下架')))",
                    "INSERT INTO PRODUCTS VALUES (1, '筆記型電腦', '電子產品', 8500, 15, '上架')",
                    "INSERT INTO PRODUCTS VALUES (2, '無線滑鼠', NULL, 250, 50, '上架')",
                    "INSERT INTO PRODUCTS VALUES (3, '機械鍵盤', '配件', 1200, 30, '上架')",
                    "INSERT INTO PRODUCTS VALUES (4, '顯示器', NULL, 3500, 20, '上架')",
                    "INSERT INTO PRODUCTS VALUES (5, '耳機', '配件', 800, 40, '上架')"
                ],
                requirements: [
                    { text: "使用 SELECT 語句", points: 5 },
                    { text: "使用 WHERE 條件", points: 8 },
                    { text: "使用 IS NULL 查詢空值", points: 17 }
                ]
            }
        ];



        // 複習測驗題庫 (100題)
        const quizQuestions = [
            // DDL 相關 (1-20)
            {q: "CREATE TABLE 語句用於創建什麼？", o: ["A. 資料庫", "B. 表格", "C. 索引", "D. 視圖"], a: 1},
            {q: "ALTER TABLE 語句的主要用途是？", o: ["A. 刪除表格", "B. 修改表格結構", "C. 查詢數據", "D. 插入數據"], a: 1},
            {q: "DROP TABLE 語句會？", o: ["A. 刪除表格數據", "B. 刪除整個表格", "C. 清空表格", "D. 修改表格"], a: 1},
            {q: "PRIMARY KEY 約束的作用是？", o: ["A. 允許重複值", "B. 唯一且非空", "C. 僅唯一", "D. 僅非空"], a: 1},
            {q: "FOREIGN KEY 用於？", o: ["A. 創建索引", "B. 建立表間關聯", "C. 加速查詢", "D. 數據加密"], a: 1},
            {q: "UNIQUE 約束允許多少個 NULL 值？", o: ["A. 0個", "B. 1個", "C. 多個", "D. 無限個"], a: 2},
            {q: "NOT NULL 約束表示？", o: ["A. 可以為空", "B. 不能為空", "C. 必須唯一", "D. 必須是數字"], a: 1},
            {q: "CHECK 約束用於？", o: ["A. 檢查語法", "B. 限制欄位值範圍", "C. 檢查索引", "D. 驗證用戶"], a: 1},
            {q: "DEFAULT 關鍵字的作用是？", o: ["A. 設定預設值", "B. 刪除數據", "C. 查詢數據", "D. 更新數據"], a: 0},
            {q: "VARCHAR2(50) 中的 50 表示？", o: ["A. 字節數", "B. 最大字符數", "C. 固定長度", "D. 最小長度"], a: 1},
            {q: "NUMBER(10,2) 表示？", o: ["A. 10位整數", "B. 總共10位，小數2位", "C. 10個數字", "D. 2位整數"], a: 1},
            {q: "DATE 類型存儲什麼？", o: ["A. 僅日期", "B. 僅時間", "C. 日期和時間", "D. 僅年份"], a: 2},
            {q: "BLOB 類型用於存儲？", o: ["A. 文字", "B. 數字", "C. 二進制大對象", "D. 日期"], a: 2},
            {q: "CLOB 類型用於存儲？", o: ["A. 大量文字", "B. 圖片", "C. 數字", "D. 日期"], a: 0},
            {q: "TRUNCATE TABLE 與 DELETE FROM 的主要區別？", o: ["A. 無區別", "B. TRUNCATE更快且不可回滾", "C. DELETE更快", "D. TRUNCATE可回滾"], a: 1},
            {q: "SEQUENCE 的作用是？", o: ["A. 排序數據", "B. 生成序列號", "C. 創建索引", "D. 查詢數據"], a: 1},
            {q: "SYNONYM 是什麼？", o: ["A. 同義詞/別名", "B. 索引", "C. 視圖", "D. 表格"], a: 0},
            {q: "TABLESPACE 用於？", o: ["A. 存儲數據文件", "B. 查詢數據", "C. 創建用戶", "D. 備份數據"], a: 0},
            {q: "COMMENT ON 語句用於？", o: ["A. 添加註釋", "B. 查詢數據", "C. 刪除數據", "D. 更新數據"], a: 0},
            {q: "RENAME 語句用於？", o: ["A. 刪除對象", "B. 重命名對象", "C. 複製對象", "D. 查詢對象"], a: 1},

            // DML 相關 (21-40)
            {q: "INSERT INTO 語句用於？", o: ["A. 查詢數據", "B. 插入數據", "C. 更新數據", "D. 刪除數據"], a: 1},
            {q: "UPDATE 語句必須配合什麼使用才安全？", o: ["A. SELECT", "B. WHERE", "C. ORDER BY", "D. GROUP BY"], a: 1},
            {q: "DELETE FROM 不帶 WHERE 會？", o: ["A. 報錯", "B. 刪除所有數據", "C. 不執行", "D. 刪除第一行"], a: 1},
            {q: "INSERT ALL 語句用於？", o: ["A. 單行插入", "B. 多行插入", "C. 更新數據", "D. 刪除數據"], a: 1},
            {q: "MERGE 語句的作用是？", o: ["A. 合併表格", "B. 插入或更新", "C. 刪除數據", "D. 查詢數據"], a: 1},
            {q: "UPSERT 的含義是？", o: ["A. 更新", "B. 插入", "C. 更新或插入", "D. 刪除"], a: 2},
            {q: "RETURNING 子句用於？", o: ["A. 返回受影響的行", "B. 返回結果集", "C. 返回錯誤", "D. 返回計數"], a: 0},
            {q: "DUAL 表是什麼？", o: ["A. 用戶表", "B. 虛擬表", "C. 臨時表", "D. 系統表"], a: 1},
            {q: "SAVEPOINT 用於？", o: ["A. 保存數據", "B. 設置事務保存點", "C. 備份表格", "D. 創建視圖"], a: 1},
            {q: "ROLLBACK TO 語句用於？", o: ["A. 全部回滾", "B. 回滾到保存點", "C. 提交事務", "D. 刪除數據"], a: 1},
            {q: "批次插入使用什麼語句最高效？", o: ["A. 多個INSERT", "B. INSERT ALL", "C. UPDATE", "D. MERGE"], a: 1},
            {q: "NULL 值在運算中會？", o: ["A. 變成0", "B. 結果為NULL", "C. 報錯", "D. 被忽略"], a: 1},
            {q: "NVL 函數的作用是？", o: ["A. 計算總和", "B. 處理NULL值", "C. 查詢數據", "D. 刪除數據"], a: 1},
            {q: "COALESCE 函數返回？", o: ["A. 所有值", "B. 第一個非NULL值", "C. 最後一個值", "D. NULL值"], a: 1},
            {q: "INSERT INTO SELECT 用於？", o: ["A. 查詢", "B. 從查詢結果插入", "C. 更新", "D. 刪除"], a: 1},
            {q: "UPDATE 時使用子查詢可以？", o: ["A. 加速查詢", "B. 動態更新值", "C. 刪除數據", "D. 創建索引"], a: 1},
            {q: "DELETE 和 TRUNCATE 的性能對比？", o: ["A. DELETE更快", "B. TRUNCATE更快", "C. 相同", "D. 不確定"], a: 1},
            {q: "INSERT 語句中的 VALUES 可以包含？", o: ["A. 僅常量", "B. 常量和表達式", "C. 僅表達式", "D. 僅NULL"], a: 1},
            {q: "ON CONFLICT 子句用於處理？", o: ["A. 錯誤", "B. 衝突", "C. NULL", "D. 索引"], a: 1},
            {q: "REPLACE INTO 是哪個資料庫的語法？", o: ["A. Oracle", "B. MySQL", "C. PostgreSQL", "D. SQL Server"], a: 1},

            // DQL 相關 (41-60)
            {q: "SELECT 語句的基本語法順序是？", o: ["A. FROM-WHERE-SELECT", "B. SELECT-FROM-WHERE", "C. WHERE-SELECT-FROM", "D. SELECT-WHERE-FROM"], a: 1},
            {q: "DISTINCT 關鍵字用於？", o: ["A. 排序", "B. 去重", "C. 分組", "D. 過濾"], a: 1},
            {q: "WHERE 子句用於？", o: ["A. 排序", "B. 過濾行", "C. 分組", "D. 計算"], a: 1},
            {q: "ORDER BY 默認是？", o: ["A. 降序", "B. 升序", "C. 隨機", "D. 不排序"], a: 1},
            {q: "GROUP BY 用於？", o: ["A. 排序", "B. 分組", "C. 過濾", "D. 去重"], a: 1},
            {q: "HAVING 子句用於？", o: ["A. 過濾行", "B. 過濾分組", "C. 排序", "D. 去重"], a: 1},
            {q: "聚合函數包括？", o: ["A. SUBSTR", "B. COUNT", "C. CONCAT", "D. REPLACE"], a: 1},
            {q: "COUNT(*) 和 COUNT(column) 的區別？", o: ["A. 無區別", "B. COUNT(*)包含NULL", "C. COUNT(column)包含NULL", "D. 都不包含NULL"], a: 1},
            {q: "AVG 函數會？", o: ["A. 包含NULL計算", "B. 忽略NULL計算", "C. 將NULL當0", "D. 報錯"], a: 1},
            {q: "MAX 和 MIN 函數可用於？", o: ["A. 僅數字", "B. 數字和字符", "C. 僅字符", "D. 僅日期"], a: 1},
            {q: "SUM 函數用於？", o: ["A. 計數", "B. 求和", "C. 求平均", "D. 求最大值"], a: 1},
            {q: "LIKE 運算符中 % 表示？", o: ["A. 單個字符", "B. 任意字符", "C. 數字", "D. 空格"], a: 1},
            {q: "LIKE 運算符中 _ 表示？", o: ["A. 任意字符", "B. 單個字符", "C. 空格", "D. 數字"], a: 1},
            {q: "IN 運算符用於？", o: ["A. 範圍查詢", "B. 多值匹配", "C. 模糊查詢", "D. 排序"], a: 1},
            {q: "BETWEEN 運算符是？", o: ["A. 不包含邊界", "B. 包含邊界", "C. 僅包含下界", "D. 僅包含上界"], a: 1},
            {q: "IS NULL 用於判斷？", o: ["A. 空字符串", "B. NULL值", "C. 0", "D. 空格"], a: 1},
            {q: "CASE WHEN 語句用於？", o: ["A. 循環", "B. 條件判斷", "C. 分組", "D. 排序"], a: 1},
            {q: "UNION 和 UNION ALL 的區別？", o: ["A. 無區別", "B. UNION去重", "C. UNION ALL去重", "D. 都去重"], a: 1},
            {q: "INTERSECT 用於求？", o: ["A. 並集", "B. 交集", "C. 差集", "D. 笛卡爾積"], a: 1},
            {q: "MINUS/EXCEPT 用於求？", o: ["A. 並集", "B. 交集", "C. 差集", "D. 笛卡爾積"], a: 2},

            // JOIN 相關 (61-75)
            {q: "INNER JOIN 返回？", o: ["A. 所有行", "B. 匹配的行", "C. 左表所有行", "D. 右表所有行"], a: 1},
            {q: "LEFT JOIN 返回？", o: ["A. 右表所有行", "B. 左表所有行", "C. 匹配的行", "D. 所有行"], a: 1},
            {q: "RIGHT JOIN 與什麼等價？", o: ["A. INNER JOIN", "B. 交換表的LEFT JOIN", "C. FULL JOIN", "D. CROSS JOIN"], a: 1},
            {q: "FULL OUTER JOIN 返回？", o: ["A. 匹配的行", "B. 兩表所有行", "C. 左表所有行", "D. 右表所有行"], a: 1},
            {q: "CROSS JOIN 產生？", o: ["A. 交集", "B. 笛卡爾積", "C. 並集", "D. 差集"], a: 1},
            {q: "SELF JOIN 是指？", o: ["A. 不同表", "B. 同一表自連接", "C. 多表連接", "D. 外連接"], a: 1},
            {q: "NATURAL JOIN 會自動？", o: ["A. 匹配所有列", "B. 匹配同名列", "C. 不匹配", "D. 報錯"], a: 1},
            {q: "ON 子句用於？", o: ["A. 排序", "B. 指定連接條件", "C. 分組", "D. 過濾"], a: 1},
            {q: "USING 子句要求？", o: ["A. 列名不同", "B. 列名相同", "C. 無要求", "D. 必須主鍵"], a: 1},
            {q: "多表 JOIN 的執行順序？", o: ["A. 隨機", "B. 從左到右", "C. 從右到左", "D. 優化器決定"], a: 3},
            {q: "JOIN 性能優化應？", o: ["A. 增加JOIN數量", "B. 在連接列建索引", "C. 不使用WHERE", "D. 使用*"], a: 1},
            {q: "LEFT JOIN 中 WHERE 過濾右表 NULL 等於？", o: ["A. RIGHT JOIN", "B. INNER JOIN", "C. FULL JOIN", "D. CROSS JOIN"], a: 1},
            {q: "ANTI JOIN 用於查找？", o: ["A. 匹配的行", "B. 不匹配的行", "C. 所有行", "D. NULL行"], a: 1},
            {q: "SEMI JOIN 返回？", o: ["A. 兩表數據", "B. 僅左表數據", "C. 僅右表數據", "D. 笛卡爾積"], a: 1},
            {q: "JOIN 的表數量上限？", o: ["A. 2個", "B. 無限制", "C. 10個", "D. 100個"], a: 1},

            // 索引相關 (76-85)
            {q: "CREATE INDEX 用於？", o: ["A. 創建表", "B. 創建索引", "C. 創建視圖", "D. 創建用戶"], a: 1},
            {q: "索引的主要作用是？", o: ["A. 佔用空間", "B. 加速查詢", "C. 減慢查詢", "D. 備份數據"], a: 1},
            {q: "B-Tree 索引適合？", o: ["A. 全表掃描", "B. 範圍查詢", "C. 全文檢索", "D. 圖片存儲"], a: 1},
            {q: "BITMAP 索引適合？", o: ["A. 高基數列", "B. 低基數列", "C. 主鍵", "D. 外鍵"], a: 1},
            {q: "UNIQUE 索引保證？", o: ["A. 性能", "B. 唯一性", "C. 非空", "D. 排序"], a: 1},
            {q: "複合索引的列順序？", o: ["A. 無關緊要", "B. 很重要", "C. 隨機", "D. 按字母"], a: 1},
            {q: "索引會影響什麼操作的性能？", o: ["A. SELECT", "B. INSERT/UPDATE/DELETE", "C. 都不影響", "D. 僅SELECT"], a: 1},
            {q: "EXPLAIN PLAN 用於？", o: ["A. 創建計劃", "B. 查看執行計劃", "C. 刪除計劃", "D. 更新計劃"], a: 1},
            {q: "FULL TABLE SCAN 表示？", o: ["A. 使用索引", "B. 全表掃描", "C. 部分掃描", "D. 錯誤"], a: 1},
            {q: "INDEX RANGE SCAN 表示？", o: ["A. 全表掃描", "B. 索引範圍掃描", "C. 全索引掃描", "D. 不使用索引"], a: 1},

            // 事務與優化 (86-100)
            {q: "COMMIT 用於？", o: ["A. 回滾", "B. 提交事務", "C. 開始事務", "D. 結束會話"], a: 1},
            {q: "ROLLBACK 用於？", o: ["A. 提交", "B. 回滾事務", "C. 創建事務", "D. 刪除事務"], a: 1},
            {q: "ACID 中的 A 代表？", o: ["A. Atomicity原子性", "B. Availability", "C. Accuracy", "D. Authorization"], a: 0},
            {q: "ACID 中的 C 代表？", o: ["A. Capacity", "B. Consistency一致性", "C. Continuity", "D. Concurrency"], a: 1},
            {q: "ACID 中的 I 代表？", o: ["A. Integration", "B. Isolation隔離性", "C. Inheritance", "D. Implementation"], a: 1},
            {q: "ACID 中的 D 代表？", o: ["A. Duration", "B. Durability持久性", "C. Distribution", "D. Declaration"], a: 1},
            {q: "READ UNCOMMITTED 可能導致？", o: ["A. 最安全", "B. 髒讀", "C. 不可重複讀", "D. 幻讀"], a: 1},
            {q: "READ COMMITTED 可以避免？", o: ["A. 幻讀", "B. 髒讀", "C. 不可重複讀", "D. 都不能"], a: 1},
            {q: "REPEATABLE READ 可以避免？", o: ["A. 髒讀和不可重複讀", "B. 僅髒讀", "C. 僅幻讀", "D. 都不能"], a: 0},
            {q: "SERIALIZABLE 隔離級別？", o: ["A. 最低", "B. 最高", "C. 中等", "D. 不隔離"], a: 1},
            {q: "死鎖發生的條件包括？", o: ["A. 互斥", "B. 請求與保持", "C. 不剝奪", "D. 以上都是"], a: 3},
            {q: "避免死鎖的方法？", o: ["A. 增加鎖", "B. 統一加鎖順序", "C. 隨機加鎖", "D. 不使用事務"], a: 1},
            {q: "VIEW 視圖的優點？", o: ["A. 佔用空間", "B. 簡化查詢", "C. 減慢速度", "D. 增加複雜度"], a: 1},
            {q: "物化視圖與普通視圖的區別？", o: ["A. 無區別", "B. 物化視圖存儲數據", "C. 普通視圖存儲數據", "D. 都存儲數據"], a: 1},
            {q: "TRIGGER 觸發器在什麼時候執行？", o: ["A. 手動執行", "B. 特定事件發生時", "C. 定時執行", "D. 從不執行"], a: 1},
        ];

        // 複習測驗狀態
        let currentQuizIndex = 0;
        let quizAnswers = new Array(100).fill(null);
        let quizStartTime = null;

        // 隨機選擇題目
        let exercises = [];
        let currentQuestionScore = 0;
        let currentQuestionFeedback = [];
        let hasExecutedSQLInCurrentQuestion = false; // 追踪用户是否在当前题目中执行过SQL

        function shuffleExercises() {
            // Fisher-Yates 洗牌算法
            const shuffled = [...exercisesPool];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            exercises = shuffled;
        }

        // 預設數據庫資料（空資料表結構）
        const sampleDatabase = {
            employees: {
                columns: ['id', 'name', 'department', 'salary', 'hire_date'],
                data: []
            },
            departments: {
                columns: ['dept_id', 'dept_name', 'manager', 'budget'],
                data: []
            },
            products: {
                columns: ['product_id', 'product_name', 'category', 'price', 'stock_quantity'],
                data: []
            }
        };

        // DOM元   引用
        const introPage = document.getElementById('introPage');
        const simulatorPage = document.getElementById('simulatorPage');
        const newFileModal = document.getElementById('newFileModal');
        const syntaxModal = document.getElementById('syntaxModal');
        const howToPlayModal = document.getElementById('howToPlayModal');
        const sqlInput = document.getElementById('sqlInput');
        const output = document.getElementById('output');
        const usernameDisplay = document.getElementById('usernameDisplay');
        const userInitial = document.getElementById('userInitial');
        const fileName = document.getElementById('fileName');
        const exerciseCard = document.getElementById('exerciseCard');
        const exerciseDescription = document.getElementById('exerciseDescription');
        const modeDisplay = document.getElementById('modeDisplay');

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            initDataModels();
            currentDatabase = JSON.parse(JSON.stringify(sampleDatabase));
            updateTablePreview();
        });

        // 初始化數據模型面板
        function initDataModels() {
            // 渲染所有模型卡片
            renderAllModelsGrid();

            // 快速選擇標籤事件
            document.querySelectorAll('.model-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const modelId = this.getAttribute('data-model');
                    switchDataModel(modelId);
                });
            });

            // 查看全部模型按鈕已移除
        }

        // 渲染所有模型卡片網格
        function renderAllModelsGrid() {
            const grid = document.getElementById('modelsGrid');
            grid.innerHTML = '';

            Object.values(dataModels).forEach(model => {
                const card = document.createElement('div');
                card.className = 'model-card';
                card.innerHTML = `
                    <span class="model-card-category">${model.category}</span>
                    <div class="model-card-header">
                        <span class="model-card-icon">${model.icon}</span>
                        <div class="model-card-title">${model.name}</div>
                    </div>
                    <div class="model-card-description">${model.description}</div>
                    <button class="model-card-btn" onclick="switchDataModel('${model.id}')">
                        <i class="fas fa-arrow-right"></i> 進入此模型
                    </button>
                `;
                grid.appendChild(card);
            });
        }

        // 切換數據模型
        function switchDataModel(modelId) {
            currentDataModel = modelId;
            const model = dataModels[modelId];

            // 更新當前模型標記
            document.getElementById('currentModelBadge').textContent = model.name;

            // 、新快速選擇標籤的活動狀態
            document.querySelectorAll('.model-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-model') === modelId) {
                    tab.classList.add('active');
                }
            });

            // 更新、型說明
            updateModelDescription(modelId);

            // 載入範例 SQL
            if (model.examples && model.examples.length > 0) {
                document.getElementById('sqlInput').value = model.examples[0];
            }

            // 、即更新表格預覽以顯示新模型、格式
            updateTablePreview();

            // 收起模型面板
            document.getElementById('allModelsPanel').classList.remove('expanded');

            // 顯示提示訊息
            showMessage(`✨ 已切換到 ${model.name} 模式！範例 SQL 已載入，表格預覽已更新為 ${model.name} 格式`, 'success');

            // 滾動到 SQL 編輯器
            document.querySelector('.sql-editor-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // 更新模型說明
        function updateModelDescription(modelId) {
            const descriptions = {
                relational: {
                    title: '關聯式模型',
                    content: `<strong>用途：</strong>傳統的關聯式數據庫，使用表格執行和列來存儲數據，支持 ACID 特性。<br>
                              <strong>語法：</strong>標準 SQL 語法 - CREATE TABLE, INSERT, SELECT, UPDATE, DELETE<br>
                              <strong>適用場景：</strong>結構化數據、多表關聯查詢、事務處理`
                },
                json: {
                    title: 'JSON文件模型',
                    content: `<strong>用途：</strong>存儲和查詢 JSON 格式的半結構化數據，支持靈活的數   結構。<br>
                              <strong>語法：</strong>CREATE TABLE 配合 JSON 欄位，可使用 JSON 路徑查詢<br>
                              <strong>適用場景：</strong>靈活的文檔存儲、配置管理、API 數據緩存`
                },
                xml: {
                    title: 'XML模型',
                    content: `<strong>用途：</strong>XML 數據庫與 XQuery 支援，用於處理 XML 格式的文檔數據。<br>
                              <strong>語法：</strong>CREATE TABLE 配合 VARCHAR 欄位存儲 XML 內容<br>
                              <strong>適用場景：</strong>文檔管理、配置文件、數據交換、Web服務`
                },
                graph: {
                    title: '圖形資料庫',
                    content: `<strong>用途：</strong>處理節點和關係數據，適合社交網絡、推薦系統等關係密集場景。<br>
                              <strong>語法：</strong>建立節點表和邊表，模擬圖數據結構<br>
                              <strong>適用場景：</strong>社交網絡、知識圖譜、路徑查詢、推薦系統`
                },
                spatial: {
                    title: '空間資料模型',
                    content: `<strong>用途：</strong>存儲和查詢地理位置數據，支持空間分析和地圖應用。<br>
                              <strong>語法：</strong>使用經緯度欄位存儲位置信息<br>
                              <strong>適用場景：</strong>地圖應用、位置服務必地理分析、導航系統`
                },
                blockchain: {
                    title: '區塊鏈表',
                    content: `<strong>用途：</strong>創建防竄改的數據記錄，數據一旦寫入便無法修改，確保完整性。<br>
                              <strong>語法：</strong>僅允許 INSERT 操作，不支持 UPDATE 和 DELETE<br>
                              <strong>適用場景：</strong>交易記錄、審計日誌、數據溯、、合規記錄`
                },
                keyvalue: {
                    title: '鍵值儲存',
                    content: `<strong>用途：</strong>SODA（Simple Oracle Document Access），簡單的鍵值對存儲。<br>
                              <strong>語法：</strong>CREATE TABLE 配合 key-value 欄位結構<br>
                              <strong>適用場景：</strong>配置管理、快取系統、會話存儲、簡單數據存取`
                },
                timeseries: {
                    title: '時間序列',
                    content: `<strong>用途：</strong>處理按時間順序、列的數據，適合物聯網、監控等時序   據。<br>
                              <strong>語法：</strong>包含時間戳欄位，按時間順序組織數據<br>
                              <strong>適用場景：</strong>物聯網感測器、系統監控、股票行情   溫度記錄`
                },
                fulltext: {
                    title: '文字搜尋',
                    content: `<strong>用途：</strong>Oracle Text 全文檢索，支持強大的文本搜索和分析功能。<br>
                              <strong>語法：</strong>使用 LIKE 或全文檢索語法進行文本搜索<br>
                              <strong>適用場景：</strong>文章搜索、內容管理系統、知識庫、文檔檢索`
                },
                object: {
                    title: '物件關聯模型',
                    content: `<strong>用途：</strong>物件類型與物件表格，結   物件導向與關聯式數據庫的優點。<br>
                              <strong>語法：</strong>CREATE TABLE 配合複雜數據類型（模擬物件）<br>
                              <strong>適用場景：</strong>複雜業務對象、ORM 映射、層次化數據結構`
                },
                semistructured: {
                    title: '半結   化資料',
                    content: `<strong>用途：</strong>混合結構支援，可以在同一表格中存儲不同結構的數據。<br>
                              <strong>語法：</strong>使用靈活的欄位結構存儲各種格式數據<br>
                              <strong>適用場景：</strong>異構數據整合、靈活的數據模型、快速原型開發`
                },
                streaming: {
                    title: '流資料處理',
                    content: `<strong>用途：</strong>Continuous Query Notification（CQN）持續查詢通知，實時處理流數據。<br>
                              <strong>語法：</strong>CREATE TABLE 配合時間戳和事件類型欄位<br>
                              <strong>適用場景：</strong>實時事件處理、日誌分析、即時通知、數據流處理`
                },
                inmemory: {
                    title: '記憶體資料庫',
                    content: `<strong>用途：</strong>In-Memory Column Store，將數據存儲在內存中以實現極快的查詢速度。<br>
                              <strong>語法：</strong>標準 SQL，但查詢性能極高（模擬內存存取）<br>
                              <strong>適用場景：</strong>高速緩存、會話管理、實時分析、熱點數據存取`
                },
                distributed: {
                    title: '分佈式資料',
                    content: `<strong>用途：</strong>Database Link 與 Sharding，將數據分佈在多個節點上以提高可擴展性。<br>
                              <strong>語法：</strong>按區域或分片鍵組織數據表<br>
                              <strong>適用場景：</strong>大規模數據存儲、負載均衡、地理分佈、高可用架構`
                },
                multitenant: {
                    title: '多租戶模型',
                    content: `<strong>用途：</strong>Pluggable Database（PDB）架構，一個數據庫實例支持多個獨立租戶。<br>
                              <strong>語、：</strong>使用 tenant_id 區分不同租戶的數據<br>
                              <strong>適用場景：</strong>SaaS 應用、多客戶系統、資源隔離、雲端服務`
                }
            };

            const desc = descriptions[modelId] || descriptions.relational;
            document.getElementById('modelDescTitle').textContent = desc.title;
            document.getElementById('modelDescContent').innerHTML = desc.content;
        }

        // 初始化事件監聽器
        function initEventListeners() {
            // Helper function to safely add event listener
            function safeAddEventListener(id, event, handler) {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener(event, handler);
                } else {
                    console.warn(`Element with id '${id}' not found`);
                }
            }

            // 新建檔案按鈕
            safeAddEventListener('newFileBtn', 'click', () => {
                newFileModal.classList.add('active');
            });

            // 玩法說明按鈕
            safeAddEventListener('howToPlayBtn', 'click', () => {
                howToPlayModal.classList.add('active');
            });

            // 流程圖按鈕
            safeAddEventListener('flowchartBtn', 'click', () => {
                const flowchartModal = document.getElementById('flowchartModal');
                if (flowchartModal) {
                    flowchartModal.classList.add('active');
                }
            });

            // 語法參考按鈕
            safeAddEventListener('syntaxRefBtn', 'click', () => {
                syntaxModal.classList.add('active');
            });

            // 測驗按鈕
            safeAddEventListener('quizBtn', 'click', () => {
                document.getElementById('quizModal').classList.add('active');
                resetQuiz();
            });

            // 開始測驗
            safeAddEventListener('startQuizBtn', 'click', () => {
                document.getElementById('quizIntro').style.display = 'none';
                document.getElementById('quizContent').style.display = 'block';
                quizStartTime = Date.now();
                showQuizQuestion();
            });

            // 上一題
            safeAddEventListener('prevQuestionBtn', 'click', () => {
                if (currentQuizIndex > 0) {
                    currentQuizIndex--;
                    showQuizQuestion();
                }
            });

            // 下一題
            safeAddEventListener('nextQuestionBtn', 'click', () => {
                if (currentQuizIndex < 99) {
                    currentQuizIndex++;
                    showQuizQuestion();
                }
            });

            // 提交測驗
            safeAddEventListener('submitQuizBtn', 'click', () => {
                submitQuiz();
            });

            // 重新測驗
            safeAddEventListener('retakeQuizBtn', 'click', () => {
                resetQuiz();
                document.getElementById('quizResults').style.display = 'none';
                document.getElementById('quizIntro').style.display = 'block';
            });

            // 查看錯題
            safeAddEventListener('reviewWrongBtn', 'click', () => {
                showWrongQuestions();
            });

            // 成就按鈕
            safeAddEventListener('achievementsBtn', 'click', () => {
                renderAchievementsModal();
                document.getElementById('achievementsModal').classList.add('active');
            });

            // 創建檔案按鈕
            safeAddEventListener('createFileBtn', 'click', createNewFile);

            // 執行查詢按鈕
            safeAddEventListener('executeBtn', 'click', executeSQL);

            // 清除按鈕
            safeAddEventListener('clearBtn', 'click', () => {
                sqlInput.value = '';
                const errorDisplay = document.getElementById('sqlErrorDisplay');
                if (errorDisplay) errorDisplay.innerHTML = '';
                sqlInput.classList.remove('error');
            });

            // 顯示資料表按鈕
            safeAddEventListener('showTablesBtn', 'click', showTables);

            // 完整語法參考按鈕
            safeAddEventListener('fullSyntaxBtn', 'click', () => {
                syntaxModal.classList.add('active');
            });

            // 返回主頁、鈕
            safeAddEventListener('backToIntroBtn', 'click', () => {
                // 保存當前檔案狀態
                saveCurrentFileState();

                simulatorPage.style.display = 'none';
                introPage.style.display = 'flex';
            });

            // 自由練習模式按鈕
            safeAddEventListener('freePracticeBtn', 'click', () => {
                currentMode = "free";
                exerciseCard.classList.remove('active');
                modeDisplay.textContent = "自由練習模式";
                sqlInput.value = '';
                document.getElementById('freePracticeBtn').classList.add('btn-primary');
                document.getElementById('exerciseModeBtn').classList.remove('btn-primary');
                // 隱藏懸浮按鈕和快速面板
                updateFloatingQuestionButton();
                const panel = document.getElementById('quickQuestionPanel');
                if (panel) panel.classList.remove('active');
            });

            // 訓練題目模式按鈕
            safeAddEventListener('exerciseModeBtn', 'click', () => {
                currentMode = "exercise";
                currentExerciseIndex = 0;
                // 隨機化題目順序
                shuffleExercises();
                showExercise();
                modeDisplay.textContent = "訓練題目模式";
                document.getElementById('exerciseModeBtn').classList.add('btn-primary');
                document.getElementById('freePracticeBtn').classList.remove('btn-primary');
                showMessage('✨ 題目已隨機排序！開始挑戰吧！<br><br>📱 <strong>手機用戶提示：</strong>點擊右下角的 <span style="color: var(--accent);">❓</span> 按鈕可隨時快速查看題目內容！', 'success');
                // 更新懸浮按鈕
                updateFloatingQuestionButton();
            });

            // 下一題按鈕
            safeAddEventListener('nextExerciseBtn', 'click', () => {
                currentExerciseIndex = (currentExerciseIndex + 1) % exercises.length;
                const nextExercise = exercises[currentExerciseIndex];
                console.log(`🔄 切換到下一題 [${currentExerciseIndex + 1}/${exercises.length}]: ${nextExercise.title}`);
                showMessage(`⏭️ 切換到題目 ${currentExerciseIndex + 1}: ${nextExercise.title}`, 'info');
                showExercise();
            });

            // 確定作答此題目按鈕
            safeAddEventListener('confirmQuestionBtn', 'click', () => {
                const exercise = exercises[currentExerciseIndex];
                if (!exercise) {
                    showMessage('❌ 沒有可作答的題目，請先選擇訓練題目模式', 'error');
                    return;
                }

                // 顯示確認訊息
                showMessage(`✅ 已確定作答題目：${exercise.title}<br><br>📝 題目資訊：<br>• 難度：${exercise.difficulty} ${'⭐'.repeat(Math.floor(exercise.difficultyStars))}<br>• 類別：${exercise.category}<br>• 滿分：30分<br><br>💡 請在 SQL 編輯器中輸入您的答案，執行測試後再提交評分`, 'success');

                // 滾動到 SQL 編輯器
                const sqlEditor = document.querySelector('.sql-editor-container');
                if (sqlEditor) {
                    sqlEditor.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });

            // 提交答案按鈕
            safeAddEventListener('submitAnswerBtn', 'click', () => {
                submitExerciseAnswer();
            });

            // 重做本題按鈕
            safeAddEventListener('retakeSameBtn', 'click', () => {
                // 清除當前答案和結果
                sqlInput.value = '';
                const output = document.getElementById('output');
                const feedbackArea = document.getElementById('feedbackArea');
                const scoreDisplay = document.getElementById('currentScoreDisplay');
                const retakeOptions = document.getElementById('retakeOptions');

                if (output) output.innerHTML = '';
                if (feedbackArea) feedbackArea.style.display = 'none';
                if (scoreDisplay) scoreDisplay.style.display = 'none';
                if (retakeOptions) retakeOptions.style.display = 'none';

                // 重置評分表狀態
                const exercise = exercises[currentExerciseIndex];
                if (exercise && exercise.requirements) {
                    exercise.requirements.forEach((req, index) => {
                        const statusCell = document.getElementById(`req-status-${index}`);
                        if (statusCell) {
                            statusCell.innerHTML = '-';
                        }
                    });
                }

                showMessage('🔄 已重置本題，請重新作答', 'info');
            });

            // 換新題目按鈕
            safeAddEventListener('retakeNewBtn', 'click', () => {
                // 隨機選擇不同的題目
                const newIndex = Math.floor(Math.random() * exercises.length);
                currentExerciseIndex = newIndex;
                loadExercise(currentExerciseIndex);

                // 清除結果
                const output = document.getElementById('output');
                const feedbackArea = document.getElementById('feedbackArea');
                const scoreDisplay = document.getElementById('currentScoreDisplay');
                const retakeOptions = document.getElementById('retakeOptions');

                if (output) output.innerHTML = '';
                if (feedbackArea) feedbackArea.style.display = 'none';
                if (scoreDisplay) scoreDisplay.style.display = 'none';
                if (retakeOptions) retakeOptions.style.display = 'none';

                showMessage('🎲 已切換到新題目，請開始作答', 'info');
            });

            // 關閉模態框按鈕 - 包含流程圖和測驗模態框
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    newFileModal.classList.remove('active');
                    syntaxModal.classList.remove('active');
                    howToPlayModal.classList.remove('active');
                    document.getElementById('achievementsModal').classList.remove('active');
                    const flowchartModal = document.getElementById('flowchartModal');
                    if (flowchartModal) {
                        flowchartModal.classList.remove('active');
                    }
                    const quizModal = document.getElementById('quizModal');
                    if (quizModal) {
                        quizModal.classList.remove('active');
                    }
                });
            });

            // 點擊模態框背景關閉 - 包含流程圖和測驗模態框
            const allModals = [newFileModal, syntaxModal, howToPlayModal, document.getElementById('achievementsModal'), document.getElementById('flowchartModal'), document.getElementById('quizModal')].filter(m => m);
            allModals.forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });

            // SQL編輯器快捷鍵：Ctrl+Enter 執行查詢
            sqlInput.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    executeSQL();
                }
            });

            // SQL 輸入檢查
            sqlInput.addEventListener('input', () => {
                checkSQLSyntax();
            });

            // 語法難度切換按鈕
            document.querySelectorAll('.syntax-level-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const level = btn.getAttribute('data-level');

                    // 更新按鈕狀態
                    document.querySelectorAll('.syntax-level-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    // 顯示對應難度內容
                    document.querySelectorAll('.syntax-level').forEach(section => {
                        if (section.getAttribute('data-level') === level) {
                            section.classList.add('active');
                        } else {
                            section.classList.remove('active');
                        }
                    });
                });
            });

            // 所有儲存按鈕
            safeAddEventListener('saveAllBtn', 'click', saveAllData);

            // 匯出按鈕
            safeAddEventListener('exportBtn', 'click', exportData);

            // 圖表將在執行 SELECT 查詢後自動生成
            // 當圖表類型改變時，自動重新生成圖表
            safeAddEventListener('chartType', 'change', () => {
                if (lastQueryResult && lastQueryResult.data && lastQueryResult.data.length > 0) {
                    generateChart();
                }
            });
        }

        // ========== 多檔案管理系統 ==========

        // 創建新的資料庫檔案
        function createDatabaseFile(name = null) {
            const fileId = nextFileId++;
            const fileName = name || `檔案 ${fileId}`;

            const newFile = {
                id: fileId,
                name: fileName,
                user: currentUser,
                databaseName: currentDatabaseName,
                database: {},
                executionHistory: [],
                lastQueryResult: null,
                sqlContent: '', // 儲存 SQL 編輯器的內容
                createdAt: new Date().toISOString()
            };

            databaseFiles.push(newFile);
            return databaseFiles.length - 1; // 返回新檔案的索引
        }

        // 保存當前檔案狀態
        function saveCurrentFileState() {
            if (databaseFiles.length > 0 && currentFileIndex < databaseFiles.length) {
                databaseFiles[currentFileIndex].database = JSON.parse(JSON.stringify(currentDatabase));
                databaseFiles[currentFileIndex].executionHistory = [...executionHistory];
                databaseFiles[currentFileIndex].lastQueryResult = lastQueryResult ? {...lastQueryResult} : null;
                databaseFiles[currentFileIndex].user = currentUser;
                databaseFiles[currentFileIndex].databaseName = currentDatabaseName;
                // 保存 SQL 編輯器內容
                databaseFiles[currentFileIndex].sqlContent = sqlInput.value;
            }
        }

        // 載入檔案狀態
        function loadFileState(index) {
            if (index >= 0 && index < databaseFiles.length) {
                const file = databaseFiles[index];

                // 載入資料庫狀態
                currentDatabase = JSON.parse(JSON.stringify(file.database));
                executionHistory = [...file.executionHistory];
                lastQueryResult = file.lastQueryResult ? {...file.lastQueryResult} : null;
                currentUser = file.user;
                currentDatabaseName = file.databaseName;

                // 載入 SQL 編輯器內容
                sqlInput.value = file.sqlContent || '';

                // 更新UI
                currentFileIndex = index;
                updateUIAfterFileSwitch();
                renderDatabaseTabs();
            }
        }

        // 切換到指定檔案
        function switchToFile(index) {
            if (index === currentFileIndex) return;

            // 保存當前檔案狀態
            saveCurrentFileState();

            // 載入新檔案
            loadFileState(index);

            // 清空所有UI狀態
            clearAllUIStates();

            // 更   表格預覽和圖表
            updateTablePreview();

            // 如果有查詢結果，重新生成圖表
            if (lastQueryResult && lastQueryResult.data && lastQueryResult.data.length > 0) {
                setTimeout(() => {
                    try {
                        generateChart();
                    } catch (error) {
                        console.log('切換檔案後圖表生成跳過：', error.message);
                    }
                }, 100);
            }

            // 清空輸出區域，顯示歡迎訊息
            output.innerHTML = createMessage(`✅ 已切換到「${databaseFiles[index].name}」`, 'success');
        }

        // 清空所有UI狀態（切換檔案時使用）
        function clearAllUIStates() {
            // 清空SQL輸入區域的錯誤狀態
            const sqlInput = document.getElementById('sqlInput');
            const sqlErrorDisplay = document.getElementById('sqlErrorDisplay');
            if (sqlInput) {
                sqlInput.classList.remove('error');
            }
            if (sqlErrorDisplay) {
                sqlErrorDisplay.innerHTML = '';
            }

            // 清空輸出區域
            const output = document.getElementById('output');
            if (output) {
                output.innerHTML = '';
            }

            // 清空圖表區域
            const chartCanvas = document.getElementById('chartCanvas');
            if (chartCanvas && currentChart) {
                try {
                    currentChart.destroy();
                    currentChart = null;
                } catch (error) {
                    console.log('清除圖表時發生錯誤:', error);
                }
            }

            // 清空訓練模式相關的UI
            const feedbackArea = document.getElementById('feedbackArea');
            const currentScoreDisplay = document.getElementById('currentScoreDisplay');
            const retakeOptions = document.getElementById('retakeOptions');
            if (feedbackArea) feedbackArea.style.display = 'none';
            if (currentScoreDisplay) currentScoreDisplay.style.display = 'none';
            if (retakeOptions) retakeOptions.style.display = 'none';
        }

        // 更新UI（檔案切換後）
        function updateUIAfterFileSwitch() {
            const file = databaseFiles[currentFileIndex];

            // 更新顯示
            document.getElementById('usernameDisplay').textContent = file.user;
            document.getElementById('userInitial').textContent = file.user.charAt(0).toUpperCase();

            // 顯示檔案名稱（包含連接埠名稱、如果有的話）
            let fileNameText = `${file.databaseName} - ${file.user}`;
            if (file.portName) {
                fileNameText += ` [${file.portName}]`;
            }
            fileNameText += ' 的練習檔案';
            document.getElementById('fileName').textContent = fileNameText;

            document.getElementById('currentTabInfo').innerHTML = `目前檔案：<strong>${file.name}</strong>`;
        }

        // 渲染資料庫標籤頁
        function renderDatabaseTabs() {
            const tabsContainer = document.getElementById('databaseTabs');
            tabsContainer.innerHTML = '';

            // 渲染每個檔案的標籤
            databaseFiles.forEach((file, index) => {
                const tab = document.createElement('div');
                tab.className = `database-tab ${index === currentFileIndex ? 'active' : ''}`;

                // 如果有、接埠名稱，顯示在檔案名稱旁邊
                const displayName = file.portName ? `${file.name} [${file.portName}]` : file.name;

                tab.innerHTML = `
                    <i class="fas fa-database database-tab-icon"></i>
                    <span>${displayName}</span>
                    ${databaseFiles.length > 1 ? `<span class="database-tab-close" onclick="event.stopPropagation(); closeFile(${index})"><i class="fas fa-times"></i></span>` : ''}
                `;
                tab.onclick = () => switchToFile(index);
                tabsContainer.appendChild(tab);
            });

            // 新增檔案按鈕
            const newTabBtn = document.createElement('div');
            newTabBtn.className = 'database-tab-new';
            newTabBtn.innerHTML = '<i class="fas fa-plus"></i> 新增資料庫檔案';
            newTabBtn.onclick = addNewDatabaseFile;
            tabsContainer.appendChild(newTabBtn);

            // Default File 按鈕
            const defaultFileBtn = document.createElement('div');
            defaultFileBtn.className = 'database-tab-new';
            defaultFileBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            defaultFileBtn.innerHTML = '<i class="fas fa-database"></i> Default File';
            defaultFileBtn.onclick = loadDefaultDatabaseFile;
            tabsContainer.appendChild(defaultFileBtn);
        }

        //    入預設資料庫檔案（Default File）
        function loadDefaultDatabaseFile() {
            // 創建輸入用戶名稱的對話框
            const inputDialog = document.createElement('div');
            inputDialog.className = 'modal active';
            inputDialog.innerHTML = `
                <div class="modal-content" style="max-width: 450px;">
                    <h3 style="margin-bottom: 20px;">
                        <i class="fas fa-user" style="color: var(--secondary);"></i>
                        Default File - 設定使用者名稱
                    </h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        資料庫名稱：<strong style="color: var(--accent);">Data_System</strong>（預設，無法更改）
                    </p>
                    <p style="color: var(--text-muted); margin-bottom: 10px; font-size: 0.9em;">
                        ℹ️ 正確的使用者名稱為 <strong style="color: var(--accent);">User</strong>，必須輸入正確才能進入
                    </p>
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px;">
                            <i class="fas fa-user-circle"></i> 請、入使用者名稱：
                        </label>
                        <input
                            type="text"
                            id="defaultFileUsername"
                            placeholder="請輸入 User"
                            style="width: 100%; padding: 12px; background: var(--terminal-bg); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;"
                            value=""
                            onkeypress="if(event.key === 'Enter') { confirmLoadDefaultFile(); }"
                        />
                        <div id="defaultFileUsernameWarning" style="margin-top: 8px; color: var(--error); font-size: 0.85em; display: none;">
                            ❌ 使用者名稱錯誤！必須輸入「User」才能進入
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="btn" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> 取消
                        </button>
                        <button class="btn btn-primary" onclick="if(confirmLoadDefaultFile() !== false) { this.closest('.modal').remove(); }">
                            <i class="fas fa-check"></i> 確認載入
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(inputDialog);

            // 自動聚焦到輸入框
            setTimeout(() => {
                const usernameInput = document.getElementById('defaultFileUsername');
                const warningDiv = document.getElementById('defaultFileUsernameWarning');

                usernameInput.focus();

                // 監聽輸入變化，顯示警告
                usernameInput.addEventListener('input', function() {
                    const value = this.value.trim();
                    if (value && value !== 'User') {
                        warningDiv.style.display = 'block';
                        this.style.borderColor = 'var(--error)';
                    } else {
                        warningDiv.style.display = 'none';
                        this.style.borderColor = 'var(--border-color)';
                    }
                });
            }, 100);
        }

        // 確認載入 Default File
        function confirmLoadDefaultFile() {
            let username = document.getElementById('defaultFileUsername').value.trim();
            const warningDiv = document.getElementById('defaultFileUsernameWarning');
            const usernameInput = document.getElementById('defaultFileUsername');

            // 驗證使用者名稱必須為 "User"
            if (username !== 'User') {
                // 顯示錯誤訊息
                if (warningDiv) {
                    warningDiv.style.display = 'block';
                }
                if (usernameInput) {
                    usernameInput.style.borderColor = 'var(--error)';
                    usernameInput.focus();
                }

                // 創建錯誤提示模態框
                const errorModal = document.createElement('div');
                errorModal.className = 'modal active';
                errorModal.style.zIndex = '10001';
                errorModal.innerHTML = `
                    <div class="modal-content" style="max-width: 400px; border: 2px solid var(--error);">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: var(--error);"></i>
                        </div>
                        <h3 style="margin-bottom: 15px; color: var(--error); text-align: center;">
                            ❌ 使用者名稱錯誤
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: 20px; text-align: center;">
                            您輸入的使用者名稱為「<strong style="color: var(--error);">${username || '(空白)'}</strong>」<br>
                            正確的使用者名稱必須是「<strong style="color: var(--accent);">User</strong>」
                        </p>
                        <div style="display: flex; justify-content: center;">
                            <button class="btn btn-primary" onclick="this.closest('.modal').remove();" style="background: var(--error);">
                                <i class="fas fa-check"></i> 、知道了
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(errorModal);

                // 防止關閉原對話框
                return false;
            }

            // 保存當前檔案
            saveCurrentFileState();

            // 創建新檔案，固定資料庫名稱為 "Default_File"
            const newIndex = createDatabaseFile("Default_File");

            // 切換到新檔案
            currentFileIndex = newIndex;
            currentDatabase = {};
            executionHistory = [];
            lastQueryResult = null;

            // 設置用戶名稱為用戶輸入的值（已通過驗證，必定為 "User"）
            currentUser = username;
            currentDatabaseName = "Default_File";
            databaseFiles[newIndex].username = username;
            databaseFiles[newIndex].user = username;

            // 更新顯示
            const usernameDisplay = document.getElementById('usernameDisplay');
            const userInitial = document.getElementById('userInitial');
            const fileName = document.getElementById('fileName');
            if (usernameDisplay) usernameDisplay.textContent = username;
            if (userInitial) userInitial.textContent = username.charAt(0).toUpperCase();
            if (fileName) fileName.textContent = `Default_File - ${username} 的練習檔案`;

            // 銷毀舊圖表
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }

            // 隱藏圖表，顯示空狀態
            const chartCanvas = document.getElementById('dataChart');
            const chartEmptyState = document.getElementById('chartEmptyState');
            if (chartCanvas && chartEmptyState) {
                chartCanvas.style.display = 'none';
                chartEmptyState.style.display = 'block';
            }

            // 預設的完整SQL語句
            const defaultSQL = `CREATE TABLE Data_System (
    ID NUMBER PRIMARY KEY,
    Chinese_Name VARCHAR2(20) NOT NULL,
    English_Name VARCHAR2(30) NOT NULL,
    HKID_Number VARCHAR2(10) UNIQUE NOT NULL,
    Position VARCHAR2(50) NOT NULL,
    Basic_Salary NUMBER(8,2) NOT NULL,
    Gender VARCHAR2(2) DEFAULT 'M',
    Late_Days NUMBER(3) DEFAULT 0,
    Daily_Deduction NUMBER(6,2) DEFAULT 100,
    Total_Deduction NUMBER(8,2) DEFAULT 0,
    Actual_Salary NUMBER(8,2),
    Join_Date DATE DEFAULT SYSDATE
);
INSERT INTO Data_System (ID, Chinese_Name, English_Name, HKID_Number, Position, Basic_Salary, Gender) VALUES (1, '田海星', 'Sam Tin', 'S1234567(8)', '總經理及老闆級別', 25000, 'M');
INSERT INTO Data_System (ID, Chinese_Name, English_Name, HKID_Number, Position, Basic_Salary, Gender) VALUES (2, '陳天寶', 'Franky Chan', 'S2345678(9)', '總經理秘書及助手', 23000, 'M');
INSERT INTO Data_System (ID, Chinese_Name, English_Name, HKID_Number, Position, Basic_Salary, Gender, Late_Days, Daily_Deduction, Total_Deduction, Actual_Salary) VALUES (3, '徐梓朗', 'Ben Chui', 'S3456789(0)', '雜務級別', 8900, 'M', 3, 100, 300, 8600);
INSERT INTO Data_System (ID, Chinese_Name, English_Name, HKID_Number, Position, Basic_Salary, Gender) VALUES (4, '陳皮', 'Chen Pi', 'S4567890(1)', '一般職員', 10050, 'M');
UPDATE Data_System SET Total_Deduction = Late_Days * Daily_Deduction;
UPDATE Data_System SET Actual_Salary = Basic_Salary - Total_Deduction;
SELECT * FROM Data_System;`;

            // 將預設SQL填入編輯器
            sqlInput.value = defaultSQL;

            // 更新UI
            updateUIAfterFileSwitch();
            renderDatabaseTabs();

            // 自動執行SQL語句
            executeSQL();

            // 更新表格預覽
            updateTablePreview();

            // 顯示成功訊息
            output.innerHTML = createMessage(`✅ 已、入「Default_File」檔案！<br>📊 資料庫: Default_File | 使用者: ${username}<br>📊 資料表已自動建立完成，你可以在下方預覽表格，也可以修改SQL語句重新執行`, 'success');

            // 返回 true 表示驗證成功，可以關閉對話框
            return true;
        }

        // 新增資料庫檔案
        function addNewDatabaseFile() {
            // 創建輸入對話框
            const inputDialog = document.createElement('div');
            inputDialog.className = 'modal active';
            inputDialog.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <h3 style="margin-bottom: 20px;">
                        <i class="fas fa-plus-circle" style="color: var(--success);"></i>
                        新建資料庫檔案
                    </h3>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px;">
                            <i class="fas fa-database"></i> 資料庫名稱：
                        </label>
                        <input
                            type="text"
                            id="newDatabaseName"
                            placeholder="預設為 Database_Simulator"
                            style="width: 100%; padding: 12px; background: var(--terminal-bg); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;"
                            value="Database_Simulator"
                        />
                        <div style="margin-top: 5px; color: var(--text-muted); font-size: 0.85em;">
                            💡 可、訂資料庫名稱，預設為「Database_Simulator」
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px;">
                            <i class="fas fa-user-circle"></i> 使用者名稱：
                        </label>
                        <input
                            type="text"
                            id="newDatabaseUsername"
                            placeholder="請輸入使用者名稱"
                            style="width: 100%; padding: 12px; background: var(--terminal-bg); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;"
                            value=""
                        />
                        <div style="margin-top: 5px; color: var(--text-muted); font-size: 0.85em;">
                            ⚠️ 使用者名稱為必填項目
                        </div>
                    </div>
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px;">
                            <i class="fas fa-plug"></i> 連接埠名稱：
                        </label>
                        <input
                            type="text"
                            id="newDatabasePort"
                            placeholder="請輸入連接埠名稱 (例如：oracle)"
                            style="width: 100%; padding: 12px; background: var(--terminal-bg); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;"
                            value=""
                            onkeypress="if(event.key === 'Enter') { confirmAddNewDatabaseFile(); }"
                        />
                        <div style="margin-top: 5px; color: var(--text-muted); font-size: 0.85em;">
                            💡 請輸入相關的連接埠名稱才能建立新檔案（例如：oracle、mysql、postgresql）
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="btn" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> 取消
                        </button>
                        <button class="btn btn-primary" onclick="confirmAddNewDatabaseFile();">
                            <i class="fas fa-check"></i> 確認建立
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(inputDialog);

            // 自動聚焦到資料庫名稱、入框
            setTimeout(() => {
                document.getElementById('newDatabaseName').focus();
            }, 100);
        }

        // 確認新建資料庫檔案
        function confirmAddNewDatabaseFile() {
            let databaseName = document.getElementById('newDatabaseName').value.trim();
            let username = document.getElementById('newDatabaseUsername').value.trim();
            let portName = document.getElementById('newDatabasePort').value.trim();

            // 驗證使用者名稱（必填）
            if (!username) {
                // 移除舊的警告訊息
                const existingWarning = document.getElementById('newDatabaseUsernameError');
                if (existingWarning) {
                    existingWarning.remove();
                }

                const warningDiv = document.createElement('div');
                warningDiv.id = 'newDatabaseUsernameError';
                warningDiv.style.cssText = 'margin-top: 8px; color: var(--error); font-size: 0.85em; padding: 8px; background: rgba(255, 51, 102, 0.1); border-left: 3px solid var(--error); border-radius: 4px;';
                warningDiv.innerHTML = '❌ 請輸入使用者名稱！';

                const usernameInput = document.getElementById('newDatabaseUsername');
                usernameInput.parentNode.appendChild(warningDiv);
                usernameInput.focus();
                return;
            }

            // 驗證   接埠名稱（必填）
            if (!portName) {
                // 移除舊的警告訊   
                const existingWarning = document.getElementById('newDatabasePortError');
                if (existingWarning) {
                    existingWarning.remove();
                }

                const warningDiv = document.createElement('div');
                warningDiv.id = 'newDatabasePortError';
                warningDiv.style.cssText = 'margin-top: 8px; color: var(--error); font-size: 0.85em; padding: 8px; background: rgba(255, 51, 102, 0.1); border-left: 3px solid var(--error); border-radius: 4px;';
                warningDiv.innerHTML = '❌ 請輸入連接埠名稱！';

                const portInput = document.getElementById('newDatabasePort');
                portInput.parentNode.appendChild(warningDiv);
                portInput.focus();
                return;
            }

            // 如果資料庫名稱為空，使用預設值
            if (!databaseName) {
                databaseName = 'Database_Simulator';
            }

            // 關閉對話框
            const modal = document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }

            // 保存當前檔案
            saveCurrentFileState();

            // 創建新檔案
            const newIndex = createDatabaseFile(databaseName);

            // 設置使用者名稱和連接埠名稱
            databaseFiles[newIndex].username = username;
            databaseFiles[newIndex].portName = portName;

            // 切換到新檔案
            currentFileIndex = newIndex;
            currentDatabase = {};
            executionHistory = [];
            lastQueryResult = null;

            // 銷毀舊圖表
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }

            // 隱藏圖表，示空狀態
            const chartCanvas = document.getElementById('dataChart');
            const chartEmptyState = document.getElementById('chartEmptyState');
            if (chartCanvas && chartEmptyState) {
                chartCanvas.style.display = 'none';
                chartEmptyState.style.display = 'block';
            }

            // 更新UI
            updateUIAfterFileSwitch();
            renderDatabaseTabs();
            updateTablePreview();

            // 清空編輯器和輸出
            sqlInput.value = '';
            output.innerHTML = createMessage(`✅ 已創建新檔案！<br>📊 資料庫：${databaseName} | 使用者：${username} | 連接埠：${portName}<br>開始你的SQL練習吧！`, 'success');
        }

        // 關閉檔案
        function closeFile(index) {
            if (databaseFiles.length <= 1) {
                output.innerHTML = createMessage('❌ 至少需要保留一個檔案', 'error');
                return;
            }

            // 創建確認對話框
            const confirmDialog = document.createElement('div');
            confirmDialog.className = 'modal active';
            confirmDialog.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <h3 style="margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
                        確認關閉檔案
                    </h3>
                    <p style="color: var(--text-secondary); margin-bottom: 25px;">
                        確定要關閉「${databaseFiles[index].name}」嗎？<br>
                        <strong style="color: var(--error);">所有未匯出的資料將會遺失！</strong>
                    </p>
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="btn" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> 取消
                        </button>
                        <button class="btn" style="background: var(--error); border: none;" onclick="confirmCloseFile(${index}); this.closest('.modal').remove();">
                            <i class="fas fa-trash"></i> 確認關閉
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDialog);
        }

        // 確認關閉檔案
        function confirmCloseFile(index) {
            // 移除檔案
            databaseFiles.splice(index, 1);

            // 如果關閉的是當前檔案，切換到前一個或下一個檔案
            if (index === currentFileIndex) {
                currentFileIndex = Math.max(0, index - 1);
                loadFileState(currentFileIndex);
                updateTablePreview();
            } else if (index < currentFileIndex) {
                // 如果關閉的檔案在當前檔案之前，需要調整索引
                currentFileIndex--;
            }

            // 重新渲染標籤頁
            renderDatabaseTabs();

            output.innerHTML = createMessage('✅ 檔案已關閉', 'success');
        }

        // ========== 原有功能 ==========

        // 創建新檔案
        function createNewFile() {
            let usernameInput = document.getElementById('usernameInput').value.trim();
            let databaseNameInput = document.getElementById('databaseNameInput').value.trim();

            // 驗證使用者名稱（必填）
            if (!usernameInput) {
                output.innerHTML = createMessage('❌ 請輸入使用者名稱！', 'error');
                return;
            }

            // 如果資料庫名稱為空，使用預設值
            if (!databaseNameInput) {
                databaseNameInput = 'Database_Simulator';
            }

            currentUser = usernameInput;
            currentDatabaseName = databaseNameInput;
            usernameDisplay.textContent = currentUser;
            userInitial.textContent = currentUser.charAt(0).toUpperCase();
            fileName.textContent = currentDatabaseName + " - " + currentUser + " 的練習檔案";

            // 初始化第一個資料庫檔案
            databaseFiles = [];
            currentFileIndex = 0;
            nextFileId = 1;
            createDatabaseFile("檔案 1");

            // 渲染標籤頁
            renderDatabaseTabs();

            newFileModal.classList.remove('active');
            introPage.style.display = 'none';
            simulatorPage.style.display = 'block';

            showMessage(`歡迎 ${currentUser}！開始在 ${currentDatabaseName} 資料庫的 SQL 學習之旅吧！`, 'success');
            updateTablePreview();
        }

        // 顯示訓練題目
        function showExercise() {
            const exercise = exercises[currentExerciseIndex];
            exerciseCard.classList.add('active');

            // 重置當前題目分數和反饋
            currentQuestionScore = 0;
            currentQuestionFeedback = [];
            hasExecutedSQLInCurrentQuestion = false; // 重置SQL执行标志
            document.getElementById('feedbackArea').style.display = 'none';
            document.getElementById('currentScoreDisplay').style.display = 'none';

            // 🔥 清空數據庫，確保每道題目獨立運作
            currentDatabase = {};
            executionHistory = [];
            lastQueryResult = null;

            // 清空表格數據緩存，防止顯示舊題目的表格
            if (window.tableDataCache) {
                window.tableDataCache = {};
            }

            output.innerHTML = `<div style="color: var(--text-muted); font-style: italic;"><i class="fas fa-info-circle"></i> 資料庫已重置，正在載入新題目「${exercise.title}」...</div>`;
            console.log(`🔄 資料庫已清空（包含表格緩存），準備加載新題目：${exercise.title}`);

            // 立即更新表格預覽，顯示空狀態
            updateTablePreview();

            // 🆕 自動加載題目的初始數據
            if (exercise.initialData && exercise.initialData.length > 0) {
                console.log(`📊 正在為題目「${exercise.title}」加載初始數據...`);
                let loadedCount = 0;
                let errorCount = 0;
                const createdTables = [];

                // 將所有 SQL 語句合併並執行
                const combinedSQL = exercise.initialData.join(';\n') + ';';

                // 暫存當前 SQL 編輯器內容
                const originalSQL = sqlInput.value;

                // 設置 SQL 內容並執行
                sqlInput.value = combinedSQL;

                try {
                    // 使用系統的 executeSQL 函數執行
                    executeSQL();

                    // 統計創建的表格
                    exercise.initialData.forEach((sql, index) => {
                        const createTableMatch = sql.match(/CREATE\s+TABLE\s+(\w+)/i);
                        if (createTableMatch) {
                            createdTables.push(createTableMatch[1]);
                            loadedCount++;
                            console.log(`✅ [${index + 1}/${exercise.initialData.length}] 已執行: ${sql.substring(0, 50)}...`);
                        } else {
                            loadedCount++;
                            console.log(`✅ [${index + 1}/${exercise.initialData.length}] 已執行: ${sql.substring(0, 50)}...`);
                        }
                    });

                    console.log(`✅ 成功加載 ${loadedCount} 條初   數據`);
                } catch (error) {
                    errorCount = exercise.initialData.length;
                    console.warn(`⚠️ 加載失、: ${error.message}`);
                }

                // 恢復原始 SQL 編輯器內容
                sqlInput.value = originalSQL;

                // 🔥 重要：重置執行標志，系統自動加載的數據不算用戶執行
                hasExecutedSQLInCurrentQuestion = false;
                console.log('🔄 初始數據加載完成，已重置執行標志，用戶需手動執行SQL才能提交');

                // 更新表格預覽
                updateTablePreview();

                // 顯示已提供的資料預覽
                if (createdTables.length > 0) {
                    const previewRow = document.getElementById('exerciseDataPreviewRow');
                    const previewContent = document.getElementById('exerciseDataPreview');

                    let previewHTML = '<div style="margin-bottom: 10px;"><strong style="color: var(--success);">✅ 系統已自動創建以下表格並插入示例數據：</strong></div>';

                    createdTables.forEach(tableName => {
                        try {
                            // 獲取表格數據預覽（使用 currentDatabase）
                            const tableNameLower = tableName.toLowerCase();
                            if (currentDatabase[tableNameLower]) {
                                const table = currentDatabase[tableNameLower];
                                const rowCount = table.data.length;
                                const columns = table.columns;
                                previewHTML += `<div style="margin: 8px 0; padding: 10px; background: rgba(0, 204, 136, 0.08); border-left: 3px solid var(--success); border-radius: 4px;">`;
                                previewHTML += `<strong style="color: var(--accent);">📋 ${tableName.toUpperCase()}</strong> `;
                                previewHTML += `<span style="color: var(--text-muted);">(${columns.length} 個欄位, ${rowCount} 筆記錄)</span><br>`;
                                previewHTML += `<span style="color: var(--text-muted); font-size: 0.85em;">欄位: ${columns.join(', ')}</span>`;
                                previewHTML += `</div>`;
                            } else {
                                previewHTML += `<div style="margin: 8px 0; padding: 10px; background: rgba(0, 204, 136, 0.08); border-left: 3px solid var(--success); border-radius: 4px;">`;
                                previewHTML += `<strong style="color: var(--accent);">📋 ${tableName.toUpperCase()}</strong> <span style="color: var(--text-muted);">(已創建)</span>`;
                                previewHTML += `</div>`;
                            }
                        } catch (e) {
                            previewHTML += `<div style="margin: 8px 0; padding: 10px; background: rgba(0, 204, 136, 0.08); border-left: 3px solid var(--success); border-radius: 4px;">`;
                            previewHTML += `<strong style="color: var(--accent);">📋 ${tableName.toUpperCase()}</strong> <span style="color: var(--text-muted);">(已創建)</span>`;
                            previewHTML += `</div>`;
                        }
                    });

                    previewHTML += '<div style="margin-top: 10px; padding: 8px; background: rgba(0, 168, 255, 0.08); border-radius: 4px; font-size: 0.85em;">';
                    previewHTML += '<i class="fas fa-info-circle"></i> 您可以直接在右側「資料表預覽」查看完整數據，或執行 SELECT 語句查詢';
                    previewHTML += '</div>';

                    previewContent.innerHTML = previewHTML;
                    previewRow.style.display = '';
                } else {
                    document.getElementById('exerciseDataPreviewRow').style.display = 'none';
                }
            } else {
                // 題目沒有初始數據，也要更新表格預覽（顯示空狀態）
                document.getElementById('exerciseDataPreviewRow').style.display = 'none';
                updateTablePreview();
            }

            // 顯示題目標題
            document.getElementById('exerciseTitleDisplay').textContent =
                `題目 ${currentExerciseIndex + 1}/${exercises.length}: ${exercise.title}`;

            // 顯示難度（如果有）
            const difficultySpan = document.getElementById('exerciseDifficulty');
            const difficultyStarsSpan = document.getElementById('difficultyStars');
            if (exercise.difficulty) {
                difficultySpan.textContent = exercise.difficulty;
                const difficultyColors = {
                    '基礎': 'background: rgba(0, 204, 136, 0.2); color: var(--success);',
                    '中級': 'background: rgba(255, 204, 0, 0.2); color: var(--warning);',
                    '進階': 'background: rgba(255, 51, 102, 0.2); color: var(--error);'
                };
                difficultySpan.setAttribute('style',
                    `padding: 4px 12px; border-radius: 4px; font-weight: 600; ${difficultyColors[exercise.difficulty] || ''}`);

                // 顯示難度星星
                if (exercise.difficultyStars) {
                    const fullStars = Math.floor(exercise.difficultyStars);
                    const hasHalfStar = exercise.difficultyStars % 1 !== 0;
                    const emptyStars = 5 - Math.ceil(exercise.difficultyStars);
                    let starsHTML = '';
                    for (let i = 0; i < fullStars; i++) {
                        starsHTML += '★';
                    }
                    if (hasHalfStar) {
                        starsHTML += '⯨';
                    }
                    for (let i = 0; i < emptyStars; i++) {
                        starsHTML += '☆';
                    }
                    difficultyStarsSpan.innerHTML = starsHTML;
                } else {
                    difficultyStarsSpan.innerHTML = '';
                }
            } else {
                difficultySpan.textContent = '未分級';
                difficultyStarsSpan.innerHTML = '';
            }

            // 顯示分類（如果有）
            document.getElementById('exerciseCategory').textContent = exercise.category || '一般';

            // 顯示題目描述
            document.getElementById('exerciseDescription').innerHTML = exercise.description;

            // 顯示提示
            document.getElementById('exerciseHint').textContent = exercise.hint;

            // 顯示評分標準表（如果有）
            const requirementsTable = document.getElementById('requirementsTable');
            if (exercise.requirements && exercise.requirements.length > 0) {
                let tableHTML = '<table style="width: 100%; border-collapse: collapse;">';
                tableHTML += '<tr style="background: rgba(0, 204, 136, 0.15); font-weight: 600;">';
                tableHTML += '<td style="padding: 8px; border: 1px solid rgba(0, 204, 136, 0.3); width: 60px; text-align: center;">分數</td>';
                tableHTML += '<td style="padding: 8px; border: 1px solid rgba(0, 204, 136, 0.3);">評分項目</td>';
                tableHTML += '<td style="padding: 8px; border: 1px solid rgba(0, 204, 136, 0.3); width: 80px; text-align: center;">狀態</td>';
                tableHTML += '</tr>';

                exercise.requirements.forEach((req, index) => {
                    tableHTML += '<tr>';
                    tableHTML += `<td style="padding: 8px; border: 1px solid rgba(0, 204, 136, 0.2); text-align: center; font-weight: 600; color: var(--warning);">${req.points}分</td>`;
                    tableHTML += `<td style="padding: 8px; border: 1px solid rgba(0, 204, 136, 0.2);">${req.text}</td>`;
                    tableHTML += `<td id="req-status-${index}" style="padding: 8px; border: 1px solid rgba(0, 204, 136, 0.2); text-align: center;">-</td>`;
                    tableHTML += '</tr>';
                });

                tableHTML += '</table>';
                requirementsTable.innerHTML = tableHTML;
            } else {
                requirementsTable.innerHTML = '<div style="color: var(--text-muted); font-style: italic;">本題目暫無詳細評分標準</div>';
            }

            sqlInput.value = '';

            // 🆕 更新手機版懸浮按鈕和快速題目面板
            updateFloatingQuestionButton();
            updateQuickQuestionPanel();
        }

        // 提交答案並評分
        function submitExerciseAnswer() {
            const exercise = exercises[currentExerciseIndex];
            if (!exercise || !exercise.requirements) {
                showMessage('⚠️ 本題目沒有評分、準，無法評分', 'warning');
                return;
            }

            // 獲取當前 SQL 內容
            const userSQL = sqlInput.value.trim().toUpperCase();

            // 🔥 【重要檢查】用戶必須在當前題目中執行過SQL才能提交
            if (!hasExecutedSQLInCurrentQuestion) {
                showMessage('⚠️ 請先執行您的SQL語句！<br><br>📌 提交答案前必須：<br>1. 在SQL編輯器中輸入您的答案<br>2. 點擊「執行 SQL」按鈕測試您的語句<br>3. 確認執行結果無誤後再提交<br><br>💡 即使題目已提供預設資料，您仍需執行自己的SQL語句才能提交答案', 'warning');
                return;
            }

            // 檢查是否有表格存在於資料庫中
            const hasTablesInDatabase = Object.keys(currentDatabase).length > 0;

            if (!hasTablesInDatabase) {
                showMessage('⚠️ 資料庫中沒有任何表格！<br><br>📌 請確保：<br>1. 已經創建了表格（使用 CREATE TABLE）<br>2. 或使用題目提供的初始數據<br>3. 資料表預覽中顯示了表格', 'warning');
                return;
            }

            // 允許提交答案
            console.log('✅ 用戶已執行SQL，資料庫中有表格，允許提交答案進行評分');

            let totalScore = 0;
            const feedbacks = [];

            // 根據評分標準逐項檢查
            exercise.requirements.forEach((req, index) => {
                let passed = false;
                const reqText = req.text;

                // 更嚴格的檢查邏輯
                if (reqText.includes('表格名稱')) {
                    // 檢查表格名稱：確認CREATE TABLE語句存在且表格在currentDatabase中存在
                    const tableName = reqText.match(/表格名稱為\s+(\w+)/);
                    if (tableName) {
                        const tableNameUpper = tableName[1].toUpperCase();
                        // 檢查SQL中是否有CREATE TABLE語句
                        const createTablePattern = new RegExp('CREATE\\s+TABLE\\s+' + tableNameUpper, 'i');
                        if (createTablePattern.test(userSQL)) {
                            // 檢查表格是否真的存在於資料庫中
                            if (currentDatabase && currentDatabase.tables && currentDatabase.tables[tableNameUpper]) {
                                passed = true;
                            }
                        }
                    }
                }
                else if (reqText.includes('包含') && reqText.includes('欄位')) {
                    // 檢查欄位及其屬性：需要同時檢查欄位名稱和屬性
                    const fieldMatch = reqText.match(/包含\s+(\w+)\s+欄位[（(](.+?)[)）]/);
                    if (fieldMatch) {
                        const fieldName = fieldMatch[1].toUpperCase();
                        const attribute = fieldMatch[2];

                        if (attribute.includes('主鍵')) {
                            // 確認欄位定義中有PRIMARY KEY
                            const primaryKeyPattern = new RegExp(fieldName + '[^,;)]*PRIMARY\\s+KEY', 'i');
                            if (primaryKeyPattern.test(userSQL)) {
                                passed = true;
                            }
                        }
                        else if (attribute.includes('非空')) {
                            // 確認欄位定義中有NOT NULL
                            const notNullPattern = new RegExp(fieldName + '[^,;)]*NOT\\s+NULL', 'i');
                            if (notNullPattern.test(userSQL)) {
                                passed = true;
                            }
                        }
                        else if (attribute.includes('唯一')) {
                            // 確認欄位定義中有UNIQUE約束
                            const uniquePattern = new RegExp(fieldName + '[^,;)]*UNIQUE', 'i');
                            if (uniquePattern.test(userSQL)) {
                                passed = true;
                            }
                        }
                        else if (attribute.includes('外鍵')) {
                            // 確認有FOREIGN KEY或REFERENCES
                            const foreignKeyPattern = new RegExp(fieldName + '[^,;)]*REFERENCES', 'i');
                            const foreignKeyPattern2 = new RegExp('FOREIGN\\s+KEY\\s*\\([^)]*' + fieldName, 'i');
                            if (foreignKeyPattern.test(userSQL) || foreignKeyPattern2.test(userSQL)) {
                                passed = true;
                            }
                        }
                        else if (attribute.includes('CHECK')) {
                            // 確認有CHECK約束
                            const checkPattern = new RegExp(fieldName + '[^,;)]*CHECK', 'i');
                            const checkPattern2 = new RegExp('CHECK\\s*\\([^)]*' + fieldName, 'i');
                            if (checkPattern.test(userSQL) || checkPattern2.test(userSQL)) {
                                passed = true;
                            }
                        }
                        else if (attribute.includes('預設') || attribute.includes('DEFAULT')) {
                            // 確認有DEFAULT值
                            const defaultPattern = new RegExp(fieldName + '[^,;)]*DEFAULT', 'i');
                            if (defaultPattern.test(userSQL)) {
                                passed = true;
                            }
                        }
                        else {
                            // 如果只是檢查欄位存在，不檢查特定屬性
                            if (userSQL.includes(fieldName)) {
                                passed = true;
                            }
                        }
                    } else {
                        // 舊格式：只有欄位名稱，沒有屬性
                        const simpleFieldMatch = reqText.match(/包含\s+(\w+)\s+欄位/);
                        if (simpleFieldMatch && userSQL.includes(simpleFieldMatch[1].toUpperCase())) {
                            passed = true;
                        }
                    }
                }
                else if (reqText.includes('主鍵') && !reqText.includes('欄位')) {
                    // 一般性的主鍵檢查
                    if (userSQL.includes('PRIMARY KEY')) {
                        passed = true;
                    }
                }
                else if (reqText.includes('外鍵') && !reqText.includes('欄位')) {
                    // 一般性的外鍵檢查
                    if (userSQL.includes('FOREIGN KEY') || userSQL.includes('REFERENCES')) {
                        passed = true;
                    }
                }
                else if (reqText.includes('唯一') && !reqText.includes('欄位')) {
                    // 一般性的唯一約束檢查
                    if (userSQL.includes('UNIQUE')) {
                        passed = true;
                    }
                }
                else if (reqText.includes('非空') && !reqText.includes('欄位')) {
                    // 一般性的非空檢查
                    if (userSQL.includes('NOT NULL')) {
                        passed = true;
                    }
                }
                else if (reqText.includes('CHECK') && !reqText.includes('欄位')) {
                    // 一般性的CHECK約束檢查
                    if (userSQL.includes('CHECK')) {
                        passed = true;
                    }
                }
                else if ((reqText.includes('預設') || reqText.includes('DEFAULT')) && !reqText.includes('欄位')) {
                    // 一般性的DEFAULT檢查
                    if (userSQL.includes('DEFAULT')) {
                        passed = true;
                    }
                }
                else {
                    // 模糊匹配：檢查關鍵字是否出現在 SQL 中
                    const keywords = reqText.match(/[A-Z_]+/g);
                    if (keywords && keywords.some(kw => userSQL.includes(kw))) {
                        passed = true;
                    }
                }

                // 更新狀態和分數
                const statusCell = document.getElementById(`req-status-${index}`);
                if (passed) {
                    totalScore += req.points;
                    statusCell.innerHTML = '<span style="color: var(--success); font-weight: 600;">✓ 通過</span>';
                    feedbacks.push(`✓ ${reqText} - 獲得 ${req.points} 分`);
                } else {
                    statusCell.innerHTML = '<span style="color: var(--error); font-weight: 600;">✗ 未通過</span>';
                    feedbacks.push(`✗ ${reqText} - 未滿足要求`);
                }
            });

            // 顯示總分
            currentQuestionScore = totalScore;
            document.getElementById('currentScore').textContent = totalScore;

            // 確定等級和顏色
            let grade = '';
            let gradeColor = '';
            let gradeBackground = '';
            if (totalScore >= 22) {
                grade = 'A-（優秀）';
                gradeColor = '#00ff88';
                gradeBackground = 'rgba(0, 255, 136, 0.2)';
            } else if (totalScore >= 16) {
                grade = 'A+（良好）';
                gradeColor = '#00cc88';
                gradeBackground = 'rgba(0, 204, 136, 0.2)';
            } else if (totalScore === 15) {
                grade = 'B（合格）';
                gradeColor = '#ffcc00';
                gradeBackground = 'rgba(255, 204, 0, 0.2)';
            } else if (totalScore > 0) {
                grade = 'C（不合格）';
                gradeColor = '#ff3366';
                gradeBackground = 'rgba(255, 51, 102, 0.2)';
            } else {
                grade = 'F（無認知）';
                gradeColor = '#666';
                gradeBackground = 'rgba(128, 128, 128, 0.2)';
            }

            const gradeLevelSpan = document.getElementById('gradeLevel');
            gradeLevelSpan.textContent = grade;
            gradeLevelSpan.style.color = gradeColor;
            gradeLevelSpan.style.background = gradeBackground;

            // 顯示分類評分（模擬 - 實際應根據題目類型細分）
            const categoryBreakdown = document.getElementById('categoryScoreBreakdown');
            const correctnessScore = Math.min(10, Math.round(totalScore * 0.33));
            const technicalScore = Math.min(8, Math.round(totalScore * 0.27));
            const logicScore = Math.min(7, Math.round(totalScore * 0.23));
            const readabilityScore = Math.min(5, totalScore - correctnessScore - technicalScore - logicScore);

            categoryBreakdown.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 6px; color: var(--info);">評分細項：</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; font-size: 0.95em;">
                    <div>• 正確性與完整性：${correctnessScore}/10</div>
                    <div>• 技術深度與實踐：${technicalScore}/8</div>
                    <div>• 邏輯與問題解決：${logicScore}/7</div>
                    <div>• 可讀性與結構：${readabilityScore}/5</div>
                </div>
            `;

            document.getElementById('currentScoreDisplay').style.display = 'block';

            // 顯示反饋
            const feedbackArea = document.getElementById('feedbackArea');
            const feedbackContent = document.getElementById('feedbackContent');
            feedbackContent.innerHTML = feedbacks.map(fb => `<div style="margin: 5px 0; padding: 8px; background: rgba(0, 168, 255, 0.05); border-left: 3px solid ${fb.startsWith('✓') ? 'var(--success)' : 'var(--error)'}; border-radius: 4px;">${fb}</div>`).join('');
            feedbackArea.style.display = 'block';

            // 根據分數顯示不同的消息
            const percentage = (totalScore / 30) * 100;
            let message = '';
            if (totalScore >= 22) {
                message = `🎉 優秀！得分：${totalScore}/30 分 - ${grade}`;
                showMessage(message, 'success');
            } else if (totalScore >= 16) {
                message = `👍 良好！得分：${totalScore}/30 分 - ${grade}`;
                showMessage(message, 'success');
            } else if (totalScore === 15) {
                message = `📝 合格！得分：${totalScore}/30 分 - ${grade}`;
                showMessage(message, 'warning');
            } else {
                message = `⚠️ 不合格！得分：${totalScore}/30 分 - ${grade}`;
                showMessage(message, 'error');
            }

            // 顯示/隱藏重做選項（分數低於15分時顯示）
            const retakeOptions = document.getElementById('retakeOptions');
            if (totalScore < 15) {
                retakeOptions.style.display = 'block';
            } else {
                retakeOptions.style.display = 'none';
            }

            // 滾動到反饋區域
            feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // 檢查 SQL 語法（每條語句檢查）
        function checkSQLSyntax() {
            const sql = sqlInput.value.trim();
            const errorDisplay = document.getElementById('sqlErrorDisplay');

            if (!sql || sql.startsWith('--')) {
                sqlInput.classList.remove('error');
                errorDisplay.innerHTML = '';
                return;
            }

            // 分割多條SQL語句（以分號分隔）
            const statements = sql.split(';').map(s => s.trim()).filter(s => s && !s.startsWith('--'));

            let errors = [];

            statements.forEach((stmt, index) => {
                const stmtUpper = stmt.toUpperCase();

                // 基本語法檢查
                const keywords = ['SELECT', 'INSERT', 'UPDATE', 'DELETE', 'CREATE', 'DROP', 'ALTER', 'TRUNCATE', 'SHOW', 'DESCRIBE', 'DESC', 'COMMIT', 'ROLLBACK'];
                const hasKeyword = keywords.some(kw => stmtUpper.includes(kw));

                if (!hasKeyword) {
                    errors.push(`語句 ${index + 1}: 必須包含有效的SQL關鍵字（如 SELECT, INSERT, CREATE 等）`);
                    return;
                }

                // 檢查括號配對
                const openParens = (stmt.match(/\(/g) || []).length;
                const closeParens = (stmt.match(/\)/g) || []).length;
                if (openParens !== closeParens) {
                    errors.push(`語句 ${index + 1}: 括號不匹配（左括號: ${openParens}, 右括號: ${closeParens}）`);
                }

                // SELECT 語句檢查
                if (stmtUpper.includes('SELECT') && !stmtUpper.includes('FROM') && !stmtUpper.includes('DUAL')) {
                    errors.push(`語句 ${index + 1}: SELECT 語句通常需要 FROM 子句指定資料表`);
                }

                // INSERT 語句檢查
                if (stmtUpper.includes('INSERT') && !stmtUpper.includes('INTO')) {
                    errors.push(`、句 ${index + 1}: INSERT 語句必須使用 INSERT INTO 語法`);
                }

                // INSERT 值檢查
                if (stmtUpper.includes('INSERT INTO') && !stmtUpper.includes('VALUES') && !stmtUpper.includes('SELECT')) {
                    errors.push(`語句 ${index + 1}: INSERT INTO 語句需要 VALUES 或 SELECT 子句`);
                }

                // UPDATE 語句檢查
                if (stmtUpper.includes('UPDATE') && !stmtUpper.includes('SET')) {
                    errors.push(`語句 ${index + 1}: UPDATE 語句必須包含 SET 子句`);
                }

                // CREATE TABLE 語句檢查
                if (stmtUpper.includes('CREATE TABLE')) {
                    if (!stmt.includes('(') || !stmt.includes(')')) {
                        errors.push(`語句 ${index + 1}: CREATE TABLE 語句需要括號定義欄位`);
                    }
                }

                // DELETE 語句檢查
                if (stmtUpper.includes('DELETE') && !stmtUpper.includes('FROM')) {
                    errors.push(`語句 ${index + 1}: DELETE 語句需要 FROM 子句`);
                }
            });

            // 顯示錯誤
            if (errors.length > 0) {
                sqlInput.classList.add('error');
                errorDisplay.innerHTML = '<div class="sql-error-message">⚠️ 語法錯誤:<br>' + errors.join('<br>') + '</div>';
            } else if (statements.length > 0) {
                sqlInput.classList.remove('error');
                errorDisplay.innerHTML = '<div style="color: var(--success); font-size: 14px; margin-top: 10px; padding: 10px; background: rgba(0, 204, 136, 0.1); border-left: 3px solid var(--success); border-radius: 4px;">✓ 語法檢查通過（共 ' + statements.length + ' 條語句）</div>';
            } else {
                sqlInput.classList.remove('error');
                errorDisplay.innerHTML = '';
            }
        }

        // 獲取SQL語句解釋
        function explainSQL(stmt) {
            const stmtUpper = stmt.toUpperCase();
            let explanation = '';

            if (stmtUpper.includes('SELECT')) {
                const fromMatch = stmtUpper.match(/FROM\s+(\w+)/i);
                const whereMatch = stmtUpper.includes('WHERE');
                const orderMatch = stmtUpper.includes('ORDER BY');
                const groupMatch = stmtUpper.includes('GROUP BY');

                explanation = '<strong>SELECT 語句解釋：</strong><br>';
                explanation += '• 這是、個查詢語句，用於從資料表中檢索資料<br>';

                if (stmtUpper.includes('SELECT *')) {
                    explanation += '• SELECT * 表示選擇所有欄位<br>';
                } else {
                    explanation += '• SELECT 後面指定了要查詢的特定欄位<br>';
                }

                if (fromMatch) {
                    explanation += `• FROM ${fromMatch[1]} 表示從 "${fromMatch[1]}" 資料表中查詢<br>`;
                }

                if (whereMatch) {
                    explanation += '• WHERE 子句用於篩選符合條件的記錄<br>';
                }

                if (orderMatch) {
                    explanation += '• ORDER BY 用於對查詢結果進行排序<br>';
                }

                if (groupMatch) {
                    explanation += '• GROUP BY 用於將結果按某個欄位分組<br>';
                }
            } else if (stmtUpper.includes('INSERT INTO')) {
                const tableMatch = stmtUpper.match(/INSERT\s+INTO\s+(\w+)/i);
                explanation = '<strong>INSERT INTO 語句解釋：</strong><br>';
                explanation += '• 這是一個插入語句，用於向資料表中添加新的記錄<br>';
                if (tableMatch) {
                    explanation += `• 將新資料插入到 "${tableMatch[1]}" 資料表中<br>`;
                }
                explanation += '• VALUES 子句指定要插入的具體數據值<br>';
            } else if (stmtUpper.includes('UPDATE')) {
                const tableMatch = stmtUpper.match(/UPDATE\s+(\w+)/i);
                explanation = '<strong>UPDATE 語句解釋：</strong><br>';
                explanation += '• 這是一個更新語句，用於修改資料表中的現有記錄<br>';
                if (tableMatch) {
                    explanation += `• 更新 "${tableMatch[1]}" 資、表中的資料<br>`;
                }
                explanation += '• SET 子句指定要更新的欄位和新值<br>';
                if (stmtUpper.includes('WHERE')) {
                    explanation += '• WHERE 子句指定要更新哪些記錄（符合條件的記錄）<br>';
                } else {
                    explanation += '• ⚠️ 沒有 WHERE 子句，將更新資料表中的所有記錄<br>';
                }
            } else if (stmtUpper.includes('DELETE FROM')) {
                const tableMatch = stmtUpper.match(/DELETE\s+FROM\s+(\w+)/i);
                explanation = '<strong>DELETE FROM 語句解釋：</strong><br>';
                explanation += '• 這是一個刪除語句，用於從資料、中刪除記錄<br>';
                if (tableMatch) {
                    explanation += `• 從 "${tableMatch[1]}" 資料表中刪除資料<br>`;
                }
                if (stmtUpper.includes('WHERE')) {
                    explanation += '• WHERE 子句指定要刪除哪些記錄（符合條件的記錄）<br>';
                } else {
                    explanation += '• ⚠️ 沒有 WHERE 子句，將刪除資料表中的所有記錄<br>';
                }
            } else if (stmtUpper.includes('CREATE TABLE')) {
                const tableMatch = stmtUpper.match(/CREATE\s+TABLE\s+(\w+)/i);
                explanation = '<strong>CREATE TABLE 語句解釋：</strong><br>';
                explanation += '• 這是一個資料定義語句，用於創建新的資料表<br>';
                if (tableMatch) {
                    explanation += `• 創建名為 "${tableMatch[1]}" 的資料表<br>`;
                }
                explanation += '• 括號內定義了資料表的欄位名稱和資料類型<br>';
            } else if (stmtUpper.includes('DROP TABLE')) {
                const tableMatch = stmtUpper.match(/DROP\s+TABLE\s+(\w+)/i);
                explanation = '<strong>DROP TABLE 語句解釋：</strong><br>';
                explanation += '• 這是一個刪除資料表、語句<br>';
                if (tableMatch) {
                    explanation += `• 完全刪除 "${tableMatch[1]}" 資料表及其所有資料<br>`;
                }
                explanation += '• ⚠️ 此操作、可恢復，請謹慎使用<br>';
            } else if (stmtUpper.includes('ALTER TABLE')) {
                const tableMatch = stmtUpper.match(/ALTER\s+TABLE\s+(\w+)/i);
                explanation = '<strong>ALTER TABLE 語句解釋：</strong><br>';
                explanation += '• 這是一個修改資料表結構的語句<br>';
                if (tableMatch) {
                    explanation += `• 修改 "${tableMatch[1]}" 資料表的結構<br>`;
                }
                if (stmtUpper.includes('ADD')) {
                    explanation += '• ADD 用於添加新的欄位<br>';
                } else if (stmtUpper.includes('DROP')) {
                    explanation += '• DROP 用於刪除現有欄位<br>';
                } else if (stmtUpper.includes('MODIFY')) {
                    explanation += '• MODIFY 用於修改現有欄位的屬性<br>';
                }
            } else if (stmtUpper.includes('TRUNCATE')) {
                const tableMatch = stmtUpper.match(/TRUNCATE\s+TABLE\s+(\w+)/i);
                explanation = '<strong>TRUNCATE TABLE 語句解釋：</strong><br>';
                explanation += '• 這是一個清空資料表的語句<br>';
                if (tableMatch) {
                    explanation += `• 清空 "${tableMatch[1]}" 資料表中的所有資料<br>`;
                }
                explanation += '• 保留資料表結構，但刪除所有記錄<br>';
                explanation += '• 比 DELETE 更快，但無法回滾<br>';
            } else if (stmtUpper.includes('COMMIT')) {
                explanation = '<strong>COMMIT 語句解釋：</strong><br>';
                explanation += '• 這是、個事務控制語句<br>';
                explanation += '• 用於提交當前事務，永久保存所有更改<br>';
                explanation += '• 提交後的更改無法使用 ROLLBACK 撤銷<br>';
            } else if (stmtUpper.includes('ROLLBACK')) {
                explanation = '<strong>ROLLBACK 語句解釋：</strong><br>';
                explanation += '• 這是一個事務控制語句<br>';
                explanation += '• 用於回滾（撤銷）當前事務的所有更改<br>';
                explanation += '• 將資料庫恢復到事務開始前的狀態<br>';
            } else {
                explanation = '<strong>SQL 語句解釋：</strong><br>';
                explanation += '• 這是一條有效的 SQL 語句<br>';
                explanation += '• 具體功能、決於使用的關鍵字和語法<br>';
            }

            return explanation;
        }

        // JOIN操作執行函數
        function performJoin(leftTable, rightTable, leftCol, rightCol, joinType, leftTableName, rightTableName) {
            const leftColIndex = leftTable.columns.indexOf(leftCol);
            const rightColIndex = rightTable.columns.indexOf(rightCol);

            if (leftColIndex === -1) {
                throw new Error(`欄位 "${leftCol}" 在表格 "${leftTableName}" 中不存在`);
            }
            if (rightColIndex === -1) {
                throw new Error(`欄位 "${rightCol}" 在表格 "${rightTableName}" 中不存在`);
            }

            // 合併欄位名稱（加上表格前綴避免重複）
            const combinedColumns = [
                ...leftTable.columns.map(col => `${leftTableName}.${col}`),
                ...rightTable.columns.map(col => `${rightTableName}.${col}`)
            ];

            const resultData = [];

            if (joinType === 'INNER JOIN' || joinType === 'JOIN') {
                // INNER JOIN：只返回兩表匹配的記錄
                leftTable.data.forEach(leftRow => {
                    rightTable.data.forEach(rightRow => {
                        if (leftRow[leftColIndex] === rightRow[rightColIndex]) {
                            resultData.push([...leftRow, ...rightRow]);
                        }
                    });
                });
            } else if (joinType === 'LEFT JOIN') {
                // LEFT JOIN：返回左表所有記錄，右表無匹配則填null
                leftTable.data.forEach(leftRow => {
                    let matched = false;
                    rightTable.data.forEach(rightRow => {
                        if (leftRow[leftColIndex] === rightRow[rightColIndex]) {
                            resultData.push([...leftRow, ...rightRow]);
                            matched = true;
                        }
                    });
                    if (!matched) {
                        resultData.push([...leftRow, ...new Array(rightTable.columns.length).fill(null)]);
                    }
                });
            } else if (joinType === 'RIGHT JOIN') {
                // RIGHT JOIN：返回右表所有記錄，左表無匹配則填null
                rightTable.data.forEach(rightRow => {
                    let matched = false;
                    leftTable.data.forEach(leftRow => {
                        if (leftRow[leftColIndex] === rightRow[rightColIndex]) {
                            resultData.push([...leftRow, ...rightRow]);
                            matched = true;
                        }
                    });
                    if (!matched) {
                        resultData.push([...new Array(leftTable.columns.length).fill(null), ...rightRow]);
                    }
                });
            }

            return {
                columns: combinedColumns,
                data: resultData
            };
        }

        // 執行SQL查詢（支持多條語句）
        function executeSQL() {
            const sql = sqlInput.value.trim();

            if (!sql) {
                showMessage('⚠️ 請輸入SQL語句', 'error');
                return;
            }

            // 標記用戶已在當前題目中執行過SQL
            hasExecutedSQLInCurrentQuestion = true;

            // 分割多條SQL語句（以分號分隔）
            const statements = sql.split(';').map(s => s.trim()).filter(s => s && !s.startsWith('--'));

            if (statements.length === 0) {
                showMessage('⚠️ 請輸入有效的SQL語句', 'error');
                return;
            }

            // 記錄執行歷史
            statements.forEach(stmt => {
                executionHistory.push(stmt + ';');
            });

            // 儲存執行結果到歷史記錄（最新的在前）
            let executionResults = [];
            let hasError = false;

            statements.forEach((stmt, index) => {
                const stmtUpper = stmt.toUpperCase();
                const isSelect = stmtUpper.includes('SELECT');

                let executionResult = {
                    statement: stmt,
                    success: false,
                    message: '',
                    explanation: '',
                    tableName: '',
                    details: ''
                };

                try {
                    // 檢查括號配對
                    const openParens = (stmt.match(/\(/g) || []).length;
                    const closeParens = (stmt.match(/\)/g) || []).length;
                    if (openParens !== closeParens) {
                        throw new Error(`括號不匹配（左括號: ${openParens}, 右   號: ${closeParens}）`);
                    }

                    if (stmtUpper.includes('EXPLAIN PLAN') || stmtUpper.startsWith('EXPLAIN ')) {
                        // 查詢執行計畫分析
                        const queryMatch = stmt.match(/EXPLAIN\s+(?:PLAN\s+FOR\s+)?(.+)/is);
                        if (queryMatch) {
                            const query = queryMatch[1].trim();
                            const queryUpper = query.toUpperCase();

                            // 模擬執行時間 (基於查詢複雜度)
                            let estimatedCost = 10;
                            let estimatedRows = 100;
                            let operations = [];

                            // 分析查詢類型
                            if (queryUpper.includes(' JOIN ')) {
                                estimatedCost += 50;
                                estimatedRows *= 2;
                                operations.push('HASH JOIN');
                                operations.push('TABLE ACCESS FULL (兩表掃描)');
                            }
                            if (queryUpper.includes('WHERE')) {
                                estimatedCost += 20;
                                operations.push('FILTER (條件篩選)');
                            }
                            if (queryUpper.includes('ORDER BY')) {
                                estimatedCost += 30;
                                operations.push('SORT (排序操作)');
                            }
                            if (queryUpper.includes('GROUP BY')) {
                                estimatedCost += 40;
                                operations.push('GROUP BY (分組聚合)');
                            }
                            if (!queryUpper.includes(' JOIN ') && queryUpper.includes('FROM')) {
                                operations.push('TABLE ACCESS FULL (全表掃描)');
                            }

                            const executionTime = (estimatedCost / 10).toFixed(2);

                            executionResult.success = true;
                            executionResult.message = `執行計畫分析完成`;
                            executionResult.explanation = '顯示SQL查詢的執行計畫和性能預估';
                            executionResult.details = `
                                <div style="padding:15px; background: rgba(0,168,255,0.1); border-radius:8px; margin-top:10px;">
                                    <h4 style="color: var(--accent); margin-bottom:10px;"><i class="fas fa-chart-line"></i> 執行計畫 (Execution Plan)</h4>
                                    <div style="font-family: monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius:6px; margin-bottom:10px;">
                                        ${operations.map((op, i) => `${i + 1}. ${op}`).join('<br>')}
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top:15px;">
                                        <div style="background: rgba(0,204,136,0.1); padding:10px; border-radius:6px; border-left: 3px solid var(--success);">
                                            <div style="font-size:12px; color: var(--text-secondary);">預估成本</div>
                                            <div style="font-size:20px; font-weight:600; color: var(--success);">${estimatedCost}</div>
                                        </div>
                                        <div style="background: rgba(0,168,255,0.1); padding:10px; border-radius:6px; border-left: 3px solid var(--secondary);">
                                            <div style="font-size:12px; color: var(--text-secondary);">預估行數</div>
                                            <div style="font-size:20px; font-weight:600; color: var(--secondary);">${estimatedRows}</div>
                                        </div>
                                        <div style="background: rgba(255,204,0,0.1); padding:10px; border-radius:6px; border-left: 3px solid var(--warning);">
                                            <div style="font-size:12px; color: var(--text-secondary);">預估時間</div>
                                            <div style="font-size:20px; font-weight:600; color: var(--warning);">${executionTime}ms</div>
                                        </div>
                                    </div>
                                    <div style="margin-top:15px; padding:10px; background: rgba(51,153,255,0.1); border-radius:6px;">
                                        <strong><i class="fas fa-lightbulb"></i> 優化建議：</strong><br>
                                        ${operations.includes('TABLE ACCESS FULL (全表掃描)') ? '• 考慮在 WHERE 條件欄位上創建索引以提升查詢速度<br>' : ''}
                                        ${operations.includes('SORT (排序操作)') ? '• 排序操作較耗資源，可考慮在排序欄位上創建索引<br>' : ''}
                                        ${operations.includes('HASH JOIN') ? '• JOIN 操作已使用 HASH JOIN，效能良好<br>' : ''}
                                        ${estimatedCost < 50 ? '• 查詢成本較低，執行效能佳<br>' : '• 查詢成本較高，建議優化查詢條件<br>'}
                                    </div>
                                </div>
                            `;
                        }
                    } else if (stmtUpper.includes('SELECT')) {
                        // 測量查詢執行時間
                        const startTime = performance.now();

                        // 檢查是否為JOIN查詢
                        if (stmtUpper.includes(' JOIN ')) {
                            const joinMatch = stmtUpper.match(/FROM\s+(\w+)\s+(INNER\s+JOIN|LEFT\s+JOIN|RIGHT\s+JOIN|JOIN)\s+(\w+)\s+ON\s+([\w.]+)\s*=\s*([\w.]+)/i);
                            if (joinMatch) {
                                const leftTable = joinMatch[1].toLowerCase();
                                const joinType = joinMatch[2].toUpperCase().trim();
                                const rightTable = joinMatch[3].toLowerCase();
                                const leftJoinCol = joinMatch[4].split('.').pop().toLowerCase();
                                const rightJoinCol = joinMatch[5].split('.').pop().toLowerCase();

                                if (!currentDatabase[leftTable]) {
                                    throw new Error(`資料表 "${leftTable}" 不存在`);
                                }
                                if (!currentDatabase[rightTable]) {
                                    throw new Error(`資料表 "${rightTable}" 不存在`);
                                }

                                // 執行JOIN操作
                                const joinedData = performJoin(
                                    currentDatabase[leftTable],
                                    currentDatabase[rightTable],
                                    leftJoinCol,
                                    rightJoinCol,
                                    joinType,
                                    leftTable,
                                    rightTable
                                );

                                const endTime = performance.now();
                                const executionTime = (endTime - startTime).toFixed(2);

                                lastQueryResult = joinedData;
                                executionResult.success = true;
                                executionResult.message = `已執行${joinType} JOIN查詢`;
                                executionResult.explanation = `連接表格「${leftTable}」和「${rightTable}」`;
                                executionResult.details = renderTable(joinedData);
                                executionResult.details += `<div style="margin-top:10px; padding:8px; background: rgba(0,168,255,0.1); border-radius:6px; font-size:13px;">
                                    <i class="fas fa-stopwatch"></i> <strong>執行時間：</strong>${executionTime} ms
                                </div>`;

                                // 追蹤成就
                                trackAchievementProgress('join_performed');
                            } else {
                                throw new Error('JOIN語句格式錯誤');
                            }
                        } else {
                            // 普通SELECT查詢
                            const tableMatch = stmtUpper.match(/FROM\s+(\w+)/i);
                            if (tableMatch) {
                                const tableName = tableMatch[1].toLowerCase();

                                // 檢查是否為視圖
                                if (databaseMetadata.views[tableName]) {
                                    executionResult.success = true;
                                    executionResult.message = `查詢視圖「${tableName}」（視圖功能需進一步實現）`;
                                    executionResult.explanation = '查詢視圖';
                                } else if (currentDatabase[tableName]) {
                                    const endTime = performance.now();
                                    const executionTime = (endTime - startTime).toFixed(2);

                                    // 記錄查詢結果供圖表使用
                                    lastQueryResult = {
                                        columns: currentDatabase[tableName].columns,
                                        data: currentDatabase[tableName].data
                                    };
                                    executionResult.success = true;
                                    executionResult.tableName = tableName;
                                    executionResult.message = `已查詢表格「${tableName}」`;
                                    executionResult.explanation = '從資料表中檢索資料';
                                    executionResult.details = renderTable(currentDatabase[tableName]);
                                    executionResult.details += `<div style="margin-top:10px; padding:8px; background: rgba(0,168,255,0.1); border-radius:6px; font-size:13px;">
                                        <i class="fas fa-stopwatch"></i> <strong>執行時間：</strong>${executionTime} ms | <strong>返回行數：</strong>${currentDatabase[tableName].data.length}
                                    </div>`;
                                } else {
                                    throw new Error(`資料表 "${tableName}" 不存在`);
                                }
                            } else if (stmtUpper.includes('DUAL')) {
                                // 處理 Oracle DUAL 虛擬表查詢
                                let resultValue = '';

                                // 檢查是否查詢 SYSDATE
                                if (stmtUpper.includes('SYSDATE')) {
                                    resultValue = new Date().toISOString().replace('T', ' ').substring(0, 19);
                                }
                                // 檢查是否查詢 SEQUENCE.NEXTVAL
                                const nextvalMatch = stmt.match(/SELECT\s+(\w+)\.NEXTVAL\s+FROM\s+DUAL/i);
                                if (nextvalMatch) {
                                    const seqName = nextvalMatch[1].toLowerCase();
                                    if (databaseMetadata.sequences[seqName]) {
                                        const seq = databaseMetadata.sequences[seqName];
                                        seq.currentValue += seq.incrementBy;
                                        if (seq.currentValue > seq.maxValue) {
                                            if (seq.cycle) {
                                                seq.currentValue = seq.minValue;
                                            } else {
                                                throw new Error(`序列 "${seqName}" 已達到最大值`);
                                            }
                                        }
                                        resultValue = seq.currentValue;
                                    } else {
                                        throw new Error(`序列 "${seqName}" 不存在`);
                                    }
                                }
                                // 檢查是否查詢 SEQUENCE.CURRVAL
                                const currvalMatch = stmt.match(/SELECT\s+(\w+)\.CURRVAL\s+FROM\s+DUAL/i);
                                if (currvalMatch) {
                                    const seqName = currvalMatch[1].toLowerCase();
                                    if (databaseMetadata.sequences[seqName]) {
                                        resultValue = databaseMetadata.sequences[seqName].currentValue;
                                    } else {
                                        throw new Error(`序列 "${seqName}" 不存在`);
                                    }
                                }
                                // 檢查是否有簡單的表達式或函數
                                const exprMatch = stmt.match(/SELECT\s+(.+?)\s+FROM\s+DUAL/i);
                                if (exprMatch && !nextvalMatch && !currvalMatch && !stmtUpper.includes('SYSDATE')) {
                                    const expr = exprMatch[1].trim();
                                    // 嘗試計算簡單的數學表達式
                                    try {
                                        // 安全評估（僅支持基本數學運算）
                                        if (/^[\d\s+\-*/().]+$/.test(expr)) {
                                            resultValue = eval(expr);
                                        } else {
                                            resultValue = expr;
                                        }
                                    } catch (e) {
                                        resultValue = expr;
                                    }
                                }

                                executionResult.success = true;
                                executionResult.message = '查詢成功（DUAL表）';
                                executionResult.explanation = 'DUAL是Oracle的虛擬單行表，常用於測試函數和序列';
                                executionResult.details = `<div style="padding:15px; background: rgba(0,168,255,0.1); border-radius:8px;">
                                    <strong>結果：</strong><span style="color: var(--accent); font-size: 18px; margin-left: 10px;">${resultValue}</span>
                                </div>`;
                            } else {
                                throw new Error('SELECT語句缺少FROM子句');
                            }
                        }
                    } else if (stmtUpper.includes('INSERT INTO')) {
                        if (!stmtUpper.includes('VALUES') && !stmtUpper.includes('SELECT')) {
                            throw new Error('INSERT INTO語句需要VALUES或SELECT子句');
                        }
                        const tableMatch = stmtUpper.match(/INSERT\s+INTO\s+(\w+)/i);
                        const tableName = tableMatch ? tableMatch[1].toLowerCase() : '未知';

                        // Check if table exists
                        if (!currentDatabase[tableName]) {
                            throw new Error(`資料表 "${tableName}" 不存在`);
                        }

                        // Parse and insert data
                        // Support both: INSERT INTO table VALUES (...) and INSERT INTO table (cols) VALUES (...)
                        const valuesMatch = stmt.match(/VALUES\s*\((.*?)\)(?:\s*;)?$/is);
                        if (valuesMatch) {
                            const valuesPart = valuesMatch[1];

                            // Split by comma, but not within parentheses or quotes
                            let values = [];
                            let current = '';
                            let inQuotes = false;
                            let quoteChar = '';

                            for (let i = 0; i < valuesPart.length; i++) {
                                const char = valuesPart[i];

                                if ((char === "'" || char === '"') && !inQuotes) {
                                    inQuotes = true;
                                    quoteChar = char;
                                    current += char;
                                } else if (char === quoteChar && inQuotes) {
                                    inQuotes = false;
                                    current += char;
                                } else if (char === ',' && !inQuotes) {
                                    values.push(current.trim());
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            if (current.trim()) {
                                values.push(current.trim());
                            }

                            // Process each value
                            values = values.map(v => {
                                v = v.trim();
                                // Remove quotes from strings
                                if ((v.startsWith("'") && v.endsWith("'")) || (v.startsWith('"') && v.endsWith('"'))) {
                                    return v.slice(1, -1);
                                }
                                // Handle NULL
                                if (v.toUpperCase() === 'NULL') {
                                    return null;
                                }
                                // Handle SYSDATE/CURRENT_DATE/DEFAULT
                                if (v.toUpperCase() === 'SYSDATE' || v.toUpperCase() === 'CURRENT_DATE' || v.toUpperCase() === 'DEFAULT') {
                                    const today = new Date();
                                    return today.toISOString().split('T')[0];
                                }
                                // Handle SEQUENCE.NEXTVAL (Oracle)
                                const nextvalMatch = v.match(/(\w+)\.NEXTVAL/i);
                                if (nextvalMatch) {
                                    const seqName = nextvalMatch[1].toLowerCase();
                                    if (databaseMetadata.sequences[seqName]) {
                                        const seq = databaseMetadata.sequences[seqName];
                                        seq.currentValue += seq.incrementBy;
                                        if (seq.currentValue > seq.maxValue) {
                                            if (seq.cycle) {
                                                seq.currentValue = seq.minValue;
                                            } else {
                                                throw new Error(`序列 "${seqName}" 已達到最大值`);
                                            }
                                        }
                                        return seq.currentValue;
                                    } else {
                                        throw new Error(`序列 "${seqName}" 不存在`);
                                    }
                                }
                                // Handle SEQUENCE.CURRVAL (Oracle)
                                const currvalMatch = v.match(/(\w+)\.CURRVAL/i);
                                if (currvalMatch) {
                                    const seqName = currvalMatch[1].toLowerCase();
                                    if (databaseMetadata.sequences[seqName]) {
                                        return databaseMetadata.sequences[seqName].currentValue;
                                    } else {
                                        throw new Error(`序列 "${seqName}" 不存在`);
                                    }
                                }
                                // Handle NVL function (Oracle)
                                const nvlMatch = v.match(/NVL\s*\(\s*(.+?)\s*,\s*(.+?)\s*\)/i);
                                if (nvlMatch) {
                                    const val1 = nvlMatch[1].trim();
                                    const val2 = nvlMatch[2].trim();
                                    return (val1 === 'NULL' || val1 === null) ? val2.replace(/['"]/g, '') : val1.replace(/['"]/g, '');
                                }
                                // Handle TO_DATE function (Oracle)
                                const toDateMatch = v.match(/TO_DATE\s*\(\s*'(.+?)'\s*,\s*'(.+?)'\s*\)/i);
                                if (toDateMatch) {
                                    return toDateMatch[1]; // 簡化處理，直接返回日期字符串
                                }
                                // Return as is for numbers and other values
                                return v;
                            });

                            // 約束驗證
                            const metadata = databaseMetadata.tables[tableName];
                            if (metadata && metadata.constraints) {
                                const constraints = metadata.constraints;

                                // NOT NULL 驗證
                                constraints.notNull.forEach(col => {
                                    const colIndex = currentDatabase[tableName].columns.indexOf(col);
                                    if (colIndex !== -1 && (values[colIndex] === null || values[colIndex] === '')) {
                                        throw new Error(`欄位 "${col}" 不能為NULL（NOT NULL約束）`);
                                    }
                                });

                                // UNIQUE 驗證
                                constraints.unique.forEach(col => {
                                    const colIndex = currentDatabase[tableName].columns.indexOf(col);
                                    if (colIndex !== -1) {
                                        const existingValues = currentDatabase[tableName].data.map(row => row[colIndex]);
                                        if (existingValues.includes(values[colIndex])) {
                                            throw new Error(`欄位 "${col}" 值 "${values[colIndex]}" 已存在（UNIQUE約束）`);
                                        }
                                    }
                                });

                                // PRIMARY KEY 驗證
                                constraints.primaryKey.forEach(col => {
                                    const colIndex = currentDatabase[tableName].columns.indexOf(col);
                                    if (colIndex !== -1) {
                                        if (values[colIndex] === null || values[colIndex] === '') {
                                            throw new Error(`主鍵 "${col}" 不能為NULL`);
                                        }
                                        const existingValues = currentDatabase[tableName].data.map(row => row[colIndex]);
                                        if (existingValues.includes(values[colIndex])) {
                                            throw new Error(`主鍵 "${col}" 值 "${values[colIndex]}" 已存在`);
                                        }
                                    }
                                });

                                // CHECK 驗證（簡單實現）
                                constraints.check.forEach(checkConstraint => {
                                    const col = checkConstraint.column;
                                    const condition = checkConstraint.condition;
                                    const colIndex = currentDatabase[tableName].columns.indexOf(col);

                                    if (colIndex !== -1) {
                                        // 簡單的CHECK條件驗證（例如：age >= 18）
                                        const value = values[colIndex];

                                        // 處理範圍檢查 (BETWEEN ... AND ...)
                                        const betweenMatch = condition.match(/(\w+)\s+BETWEEN\s+(\d+)\s+AND\s+(\d+)/i);
                                        if (betweenMatch) {
                                            const min = parseInt(betweenMatch[2]);
                                            const max = parseInt(betweenMatch[3]);
                                            const numValue = parseFloat(value);
                                            if (numValue < min || numValue > max) {
                                                throw new Error(`CHECK約束失敗：${col} 必須在 ${min} 到 ${max} 之間`);
                                            }
                                        }

                                        // 處理 >= 檢查
                                        const gteMatch = condition.match(/(\w+)\s*>=\s*(\d+)/i);
                                        if (gteMatch) {
                                            const minValue = parseFloat(gteMatch[2]);
                                            const numValue = parseFloat(value);
                                            if (numValue < minValue) {
                                                throw new Error(`CHECK約束失敗：${col} 必須 >= ${minValue}`);
                                            }
                                        }
                                    }
                                });
                            }

                            // Add to database
                            currentDatabase[tableName].data.push(values);
                            executionResult.success = true;
                            executionResult.tableName = tableName;
                            executionResult.message = `已插入表格「${tableName}」`;
                            executionResult.explanation = '向資料表中添加新的記錄（已驗證約束）';
                        } else {
                            throw new Error('無法解析INSERT語句中的VALUES');
                        }
                    } else if (stmtUpper.includes('UPDATE')) {
                        if (!stmtUpper.includes('SET')) {
                            throw new Error('UPDATE語句缺少SET子句');
                        }
                        const tableMatch = stmtUpper.match(/UPDATE\s+(\w+)/i);
                        const tableName = tableMatch ? tableMatch[1].toLowerCase() : '未知';

                        // Check if table exists
                        if (!currentDatabase[tableName]) {
                            throw new Error(`資料表 "${tableName}" 不存在`);
                        }

                        // Simple UPDATE implementation (updates all rows for simplicity)
                        // In a real implementation, you would parse WHERE clause
                        const setMatch = stmt.match(/SET\s+(.*?)(?:WHERE|$)/i);
                        if (setMatch) {
                            const setPart = setMatch[1].trim();
                            const assignments = setPart.split(',').map(a => a.trim());

                            assignments.forEach(assignment => {
                                const [colName, value] = assignment.split('=').map(s => s.trim());
                                const colIndex = currentDatabase[tableName].columns.indexOf(colName);

                                if (colIndex !== -1) {
                                    let newValue = value;
                                    // Remove quotes
                                    if ((newValue.startsWith("'") && newValue.endsWith("'")) ||
                                        (newValue.startsWith('"') && newValue.endsWith('"'))) {
                                        newValue = newValue.slice(1, -1);
                                    }

                                    // Update all rows (simplified - no WHERE clause parsing)
                                    currentDatabase[tableName].data.forEach(row => {
                                        row[colIndex] = newValue;
                                    });
                                }
                            });
                        }

                        executionResult.success = true;
                        executionResult.tableName = tableName;
                        executionResult.message = `已更新表格「${tableName}」`;
                        executionResult.explanation = '修改資料表中的現有記錄';
                    } else if (stmtUpper.includes('DELETE FROM')) {
                        const tableMatch = stmtUpper.match(/DELETE\s+FROM\s+(\w+)/i);
                        const tableName = tableMatch ? tableMatch[1].toLowerCase() : '未知';

                        // Check if table exists
                        if (!currentDatabase[tableName]) {
                            throw new Error(`資料表 "${tableName}" 不存在`);
                        }

                        // Simple DELETE implementation
                        // For simplicity, if there's no WHERE clause, delete all rows
                        // In a real implementation, you would parse WHERE clause
                        const deletedCount = currentDatabase[tableName].data.length;
                        currentDatabase[tableName].data = [];

                        executionResult.success = true;
                        executionResult.tableName = tableName;
                        executionResult.message = `已從表格「${tableName}」刪除 ${deletedCount} 筆資料`;
                        executionResult.explanation = '從資料表中刪除記錄';
                    } else if (stmtUpper.includes('CREATE TABLE')) {
                        const tableNameMatch = stmtUpper.match(/CREATE\s+TABLE\s+(\w+)/i);
                        if (!tableNameMatch) {
                            throw new Error('CREATE TABLE語句格式錯誤');
                        }
                        if (!stmt.includes('(') || !stmt.includes(')')) {
                            throw new Error('CREATE TABLE語句需要用括號定義欄位');
                        }
                        const tableName = tableNameMatch[1].toLowerCase();

                        // 解析欄位名稱和約束
                        const columnsMatch = stmt.match(/\((.*)\)/s);
                        let columns = ['id', 'column1'];
                        let columnTypes = {};
                        let constraints = {
                            primaryKey: [],
                            unique: [],
                            notNull: [],
                            check: [],
                            foreignKey: [],
                            default: {}
                        };

                        if (columnsMatch) {
                            const columnDefs = columnsMatch[1].split(',').map(c => c.trim());
                            columns = columnDefs.map(def => {
                                const defUpper = def.toUpperCase();
                                const parts = def.trim().split(/\s+/);
                                const colName = parts[0].toLowerCase();

                                // 解析   據類型
                                if (parts.length > 1) {
                                    const typeMatch = parts[1].match(/(NUMBER|VARCHAR2?|INT|CHAR|DATE|DECIMAL|BOOLEAN)/i);
                                    if (typeMatch) {
                                        columnTypes[colName] = typeMatch[1].toUpperCase();
                                    }
                                }

                                // 解析約束
                                if (defUpper.includes('PRIMARY KEY')) {
                                    constraints.primaryKey.push(colName);
                                }
                                if (defUpper.includes('UNIQUE')) {
                                    constraints.unique.push(colName);
                                }
                                if (defUpper.includes('NOT NULL')) {
                                    constraints.notNull.push(colName);
                                }
                                if (defUpper.includes('CHECK')) {
                                    const checkMatch = def.match(/CHECK\s*\((.*?)\)/i);
                                    if (checkMatch) {
                                        constraints.check.push({column: colName, condition: checkMatch[1]});
                                    }
                                }
                                if (defUpper.includes('DEFAULT')) {
                                    const defaultMatch = def.match(/DEFAULT\s+(\S+)/i);
                                    if (defaultMatch) {
                                        constraints.default[colName] = defaultMatch[1];
                                    }
                                }

                                return colName;
                            });
                        }

                        currentDatabase[tableName] = {
                            columns: columns,
                            data: [],
                            types: columnTypes
                        };

                        // 保存元數據
                        databaseMetadata.tables[tableName] = {
                            columns: columns,
                            types: columnTypes,
                            constraints: constraints
                        };

                        executionResult.success = true;
                        executionResult.tableName = tableName;
                        executionResult.message = `已創建表格「${tableName}」`;
                        executionResult.explanation = '創建新的資料表，包含欄位定義和約束';

                        // 追蹤成就
                        trackAchievementProgress('table_created');
                    } else if (stmtUpper.includes('DROP TABLE')) {
                        const tableMatch = stmtUpper.match(/DROP\s+TABLE\s+(\w+)/i);
                        if (tableMatch) {
                            const tableName = tableMatch[1].toLowerCase();
                            if (currentDatabase[tableName]) {
                                delete currentDatabase[tableName];
                                executionResult.success = true;
                                executionResult.tableName = tableName;
                                executionResult.message = `已刪除表格「${tableName}」`;
                                executionResult.explanation = '刪除資料表及其所有資料';
                            } else {
                                throw new Error(`資料表 "${tableName}" 不存在`);
                            }
                        }
                    } else if (stmtUpper.includes('ALTER TABLE')) {
                        const tableMatch = stmtUpper.match(/ALTER\s+TABLE\s+(\w+)/i);
                        const tableName = tableMatch ? tableMatch[1].toLowerCase() : '未知';
                        executionResult.success = true;
                        executionResult.tableName = tableName;
                        executionResult.message = `已修改表格「${tableName}」結構`;
                        executionResult.explanation = '修改資料表結構';
                    } else if (stmtUpper.includes('TRUNCATE')) {
                        const tableMatch = stmtUpper.match(/TRUNCATE\s+TABLE\s+(\w+)/i);
                        const tableName = tableMatch ? tableMatch[1].toLowerCase() : '未知';
                        if (currentDatabase[tableName]) {
                            currentDatabase[tableName].data = [];
                            executionResult.success = true;
                            executionResult.tableName = tableName;
                            executionResult.message = `已清空表格「${tableName}」所有資料`;
                            executionResult.explanation = '清空資料表所有資料';
                        } else {
                            throw new Error(`資料表 "${tableName}" 不存在`);
                        }
                    } else if (stmtUpper.includes('SET TRANSACTION') || stmtUpper.includes('SET ISOLATION LEVEL')) {
                        // 設置事務隔離級別
                        let isolationLevel = 'READ COMMITTED'; // 默認
                        if (stmtUpper.includes('READ UNCOMMITTED')) {
                            isolationLevel = 'READ UNCOMMITTED';
                        } else if (stmtUpper.includes('READ COMMITTED')) {
                            isolationLevel = 'READ COMMITTED';
                        } else if (stmtUpper.includes('REPEATABLE READ')) {
                            isolationLevel = 'REPEATABLE READ';
                        } else if (stmtUpper.includes('SERIALIZABLE')) {
                            isolationLevel = 'SERIALIZABLE';
                        }

                        if (!window.transactionState) {
                            window.transactionState = {};
                        }
                        window.transactionState.isolationLevel = isolationLevel;

                        executionResult.success = true;
                        executionResult.message = `已設置事務隔離級別：${isolationLevel}`;
                        executionResult.explanation = '控制併發事務之間的可見性和鎖定行為';
                        executionResult.details = `<div style="padding:10px; background: rgba(0,168,255,0.1); border-radius:6px;">
                            <strong>隔離級別說明：</strong><br>
                            ${isolationLevel === 'READ UNCOMMITTED' ? '• 允許讀取未提交的數據（髒讀）' : ''}
                            ${isolationLevel === 'READ COMMITTED' ? '• 只能讀取已提交的數   （避免髒讀）' : ''}
                            ${isolationLevel === 'REPEATABLE READ' ? '• 保證同一事務內重複讀取結果一致（避免不可重複讀）' : ''}
                            ${isolationLevel === 'SERIALIZABLE' ? '• 最高隔離級別，完全序列化執行（避免幻讀）' : ''}
                        </div>`;
                    } else if (stmtUpper.includes('BEGIN') || stmtUpper.includes('START TRANSACTION')) {
                        // 開始事務
                        if (!window.transactionState) {
                            window.transactionState = {
                                active: false,
                                isolationLevel: 'READ COMMITTED',
                                snapshot: null
                            };
                        }

                        // 保存當前數據庫狀態的快   
                        window.transactionState.active = true;
                        window.transactionState.snapshot = JSON.parse(JSON.stringify(currentDatabase));

                        executionResult.success = true;
                        executionResult.message = '事務已開始';
                        executionResult.explanation = `開始新的   務（隔離級別：${window.transactionState.isolationLevel}）`;
                        executionResult.details = `<div style="padding:10px; background: rgba(0,204,136,0.1); border-radius:6px;">
                            <i class="fas fa-play"></i> 事務已啟動<br>
                            <strong>隔離級別：</strong>${window.transactionState.isolationLevel}<br>
                            <em>所有修改將保留在事務中，直到 COMMIT 或 ROLLBACK</em>
                        </div>`;
                    } else if (stmtUpper.includes('COMMIT')) {
                        if (!window.transactionState) {
                            window.transactionState = { active: false };
                        }

                        window.transactionState.active = false;
                        window.transactionState.snapshot = null;

                        executionResult.success = true;
                        executionResult.message = '事務已提交 (COMMIT)';
                        executionResult.explanation = '所有更改已永久保存到數據庫';
                        executionResult.details = `<div style="padding:10px; background: rgba(0,204,136,0.1); border-radius:6px;">
                            <i class="fas fa-check-circle"></i> 事務提交成功<br>
                            <em>所有修改已持久化，具備 ACID 屬性</em>
                        </div>`;

                        // 追蹤成就
                        trackAchievementProgress('transaction_used');
                    } else if (stmtUpper.includes('ROLLBACK')) {
                        if (!window.transactionState) {
                            window.transactionState = { active: false, snapshot: null };
                        }

                        // 恢復到事務開始前的快照
                        if (window.transactionState.snapshot) {
                            currentDatabase = JSON.parse(JSON.stringify(window.transactionState.snapshot));
                        }

                        window.transactionState.active = false;
                        window.transactionState.snapshot = null;

                        executionResult.success = true;
                        executionResult.message = '事務已回滾 (ROLLBACK)';
                        executionResult.explanation = '所有更改已撤銷，數據庫恢復到事務開始前的狀態';
                        executionResult.details = `<div style="padding:10px; background: rgba(255,204,0,0.1); border-radius:6px;">
                            <i class="fas fa-undo"></i> 事務回滾成功<br>
                            <em>所有修改已撤銷，數據庫狀態已恢復</em>
                        </div>`;

                        // 追蹤成就
                        trackAchievementProgress('transaction_used');
                    } else if (stmtUpper.includes('CREATE VIEW')) {
                        const viewMatch = stmtUpper.match(/CREATE\s+VIEW\s+(\w+)\s+AS\s+(.*)/i);
                        if (!viewMatch) {
                            throw new Error('CREATE VIEW語句格式錯誤，應為：CREATE VIEW view_name AS SELECT ...');
                        }
                        const viewName = viewMatch[1].toLowerCase();
                        const viewQuery = viewMatch[2].trim();

                        // 保存視圖定義
                        databaseMetadata.views[viewName] = {
                            query: viewQuery,
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.tableName = viewName;
                        executionResult.message = `已創建視圖「${viewName}」`;
                        executionResult.explanation = '創建視圖（虛擬表），基於查詢結果';

                    } else if (stmtUpper.includes('CREATE INDEX')) {
                        const indexMatch = stmtUpper.match(/CREATE\s+INDEX\s+(\w+)\s+ON\s+(\w+)\s*\(([^)]+)\)/i);
                        if (!indexMatch) {
                            throw new Error('CREATE INDEX語句格式錯誤，應為：CREATE INDEX index_name ON table_name (column)');
                        }
                        const indexName = indexMatch[1].toLowerCase();
                        const tableName = indexMatch[2].toLowerCase();
                        const columns = indexMatch[3].split(',').map(c => c.trim().toLowerCase());

                        if (!currentDatabase[tableName]) {
                            throw new Error(`資料表 "${tableName}" 不存在`);
                        }

                        // 保存索引定義
                        if (!databaseMetadata.indexes[tableName]) {
                            databaseMetadata.indexes[tableName] = {};
                        }
                        databaseMetadata.indexes[tableName][indexName] = {
                            columns: columns,
                            type: 'BTREE',
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.tableName = tableName;
                        executionResult.message = `已在表格「${tableName}」上創建索引「${indexName}」`;
                        executionResult.explanation = `創建B-tree索引以加速查詢，索引欄位：${columns.join(', ')}`;

                    } else if (stmtUpper.includes('CREATE PROCEDURE') || stmtUpper.includes('CREATE OR REPLACE PROCEDURE')) {
                        // 創建存儲過程
                        const procMatch = stmt.match(/CREATE\s+(?:OR\s+REPLACE\s+)?PROCEDURE\s+(\w+)\s*\((.*?)\)\s+(?:IS|AS)\s+(.*?)(?:END;?)?$/is);
                        if (!procMatch) {
                            throw new Error('CREATE PROCEDURE語句格式錯誤，應為：CREATE PROCEDURE proc_name(params) AS BEGIN ... END;');
                        }
                        const procName = procMatch[1].toLowerCase();
                        const params = procMatch[2].trim();
                        const body = procMatch[3].trim();

                        databaseMetadata.procedures[procName] = {
                            name: procName,
                            parameters: params,
                            body: body,
                            type: 'PROCEDURE',
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.message = `已創建存儲過程「${procName}」`;
                        executionResult.explanation = '創建PL/SQL存儲過程，可重複調用執行業務邏輯';

                        // 追蹤成就
                        trackAchievementProgress('procedure_created');
                        executionResult.details = `<div style="padding:10px; background: rgba(0,168,255,0.1); border-radius:6px;">
                            <strong>過程名稱：</strong>${procName}<br>
                            <strong>參數：</strong>${params || '無參數'}<br>
                            <strong>類型：</strong>PROCEDURE
                        </div>`;
                    } else if (stmtUpper.includes('CREATE FUNCTION') || stmtUpper.includes('CREATE OR REPLACE FUNCTION')) {
                        // 創建函數
                        const funcMatch = stmt.match(/CREATE\s+(?:OR\s+REPLACE\s+)?FUNCTION\s+(\w+)\s*\((.*?)\)\s+RETURN\s+(\w+)\s+(?:IS|AS)\s+(.*?)(?:END;?)?$/is);
                        if (!funcMatch) {
                            throw new Error('CREATE FUNCTION語句格式錯誤，應為：CREATE FUNCTION func_name(params) RETURN type AS BEGIN ... END;');
                        }
                        const funcName = funcMatch[1].toLowerCase();
                        const params = funcMatch[2].trim();
                        const returnType = funcMatch[3].toUpperCase();
                        const body = funcMatch[4].trim();

                        databaseMetadata.procedures[funcName] = {
                            name: funcName,
                            parameters: params,
                            returnType: returnType,
                            body: body,
                            type: 'FUNCTION',
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.message = `已創建函數「${funcName}」`;
                        executionResult.explanation = `創建PL/SQL函數，返回類型：${returnType}`;

                        // 追蹤成就
                        trackAchievementProgress('procedure_created');
                        executionResult.details = `<div style="padding:10px; background: rgba(0,168,255,0.1); border-radius:6px;">
                            <strong>函數名稱：</strong>${funcName}<br>
                            <strong>參數：</strong>${params || '無參數'}<br>
                            <strong>返回類型：</strong>${returnType}<br>
                            <strong>類型：</strong>FUNCTION
                        </div>`;
                    } else if (stmtUpper.includes('CREATE TRIGGER') || stmtUpper.includes('CREATE OR REPLACE TRIGGER')) {
                        // 創建觸發器
                        const trigMatch = stmt.match(/CREATE\s+(?:OR\s+REPLACE\s+)?TRIGGER\s+(\w+)\s+(BEFORE|AFTER)\s+(INSERT|UPDATE|DELETE)(?:\s+OR\s+(INSERT|UPDATE|DELETE))?\s+ON\s+(\w+)(?:\s+FOR\s+EACH\s+ROW)?\s+(?:BEGIN\s+)?(.*?)(?:END;?)?$/is);
                        if (!trigMatch) {
                            throw new Error('CREATE TRIGGER語句格式錯誤');
                        }
                        const trigName = trigMatch[1].toLowerCase();
                        const timing = trigMatch[2].toUpperCase();
                        const event1 = trigMatch[3].toUpperCase();
                        const event2 = trigMatch[4] ? trigMatch[4].toUpperCase() : null;
                        const tableName = trigMatch[5].toLowerCase();
                        const body = trigMatch[6].trim();

                        if (!currentDatabase[tableName]) {
                            throw new Error(`資料表 "${tableName}" 不存在`);
                        }

                        if (!databaseMetadata.triggers[tableName]) {
                            databaseMetadata.triggers[tableName] = {};
                        }

                        const events = event2 ? [event1, event2] : [event1];
                        databaseMetadata.triggers[tableName][trigName] = {
                            name: trigName,
                            timing: timing,
                            events: events,
                            table: tableName,
                            body: body,
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.message = `已在表格「${tableName}」上創建觸發器「${trigName}」`;
                        executionResult.explanation = `${timing} ${events.join(' OR ')} 時自動執行`;

                        // 追蹤成就
                        trackAchievementProgress('trigger_created');
                        executionResult.details = `<div style="padding:10px; background: rgba(0,168,255,0.1); border-radius:6px;">
                            <strong>觸發器名稱：</strong>${trigName}<br>
                            <strong>時機：</strong>${timing}<br>
                            <strong>事件：</strong>${events.join(' OR ')}<br>
                            <strong>資料表：</strong>${tableName}
                        </div>`;
                    } else if (stmtUpper.includes('CREATE SEQUENCE')) {
                        // 創建序列 (Oracle SEQUENCE)
                        const seqMatch = stmt.match(/CREATE\s+SEQUENCE\s+(\w+)(?:\s+START\s+WITH\s+(\d+))?(?:\s+INCREMENT\s+BY\s+(\d+))?(?:\s+MINVALUE\s+(\d+))?(?:\s+MAXVALUE\s+(\d+))?(?:\s+(NOCYCLE|CYCLE))?/i);
                        if (!seqMatch) {
                            throw new Error('CREATE SEQUENCE語句格式錯誤，應為：CREATE SEQUENCE seq_name START WITH n INCREMENT BY m');
                        }
                        const seqName = seqMatch[1].toLowerCase();
                        const startWith = parseInt(seqMatch[2]) || 1;
                        const incrementBy = parseInt(seqMatch[3]) || 1;
                        const minValue = parseInt(seqMatch[4]) || 1;
                        const maxValue = parseInt(seqMatch[5]) || 999999999999;
                        const cycle = seqMatch[6] ? seqMatch[6].toUpperCase() === 'CYCLE' : false;

                        databaseMetadata.sequences[seqName] = {
                            name: seqName,
                            currentValue: startWith - incrementBy, // 下一個nextval會返回startWith
                            startWith: startWith,
                            incrementBy: incrementBy,
                            minValue: minValue,
                            maxValue: maxValue,
                            cycle: cycle,
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.message = `已創建序列「${seqName}」`;
                        executionResult.explanation = 'Oracle序列用於生成唯一的數字序列，常用於主鍵自增';
                        executionResult.details = `<div style="padding:10px; background: rgba(0,168,255,0.1); border-radius:6px;">
                            <strong>序列名稱：</strong>${seqName}<br>
                            <strong>起始值：</strong>${startWith}<br>
                            <strong>增量：</strong>${incrementBy}<br>
                            <strong>最小值：</strong>${minValue}<br>
                            <strong>最大值：</strong>${maxValue}<br>
                            <strong>循環：</strong>${cycle ? 'YES' : 'NO'}
                        </div>`;
                    } else if (stmtUpper.includes('CREATE SYNONYM')) {
                        // 創建同義詞 (Oracle SYNONYM)
                        const synMatch = stmt.match(/CREATE\s+(?:(PUBLIC)\s+)?SYNONYM\s+(\w+)\s+FOR\s+(\w+)/i);
                        if (!synMatch) {
                            throw new Error('CREATE SYNONYM語句格式錯誤，應為：CREATE SYNONYM syn_name FOR object_name');
                        }
                        const isPublic = !!synMatch[1];
                        const synName = synMatch[2].toLowerCase();
                        const targetObject = synMatch[3].toLowerCase();

                        databaseMetadata.synonyms[synName] = {
                            name: synName,
                            target: targetObject,
                            isPublic: isPublic,
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.message = `已創建${isPublic ? '公共' : '私有'}同義詞「${synName}」`;
                        executionResult.explanation = '同義詞為資料庫物件提供別名，簡化物件引用';
                        executionResult.details = `<div style="padding:10px; background: rgba(0,168,255,0.1); border-radius:6px;">
                            <strong>同義詞：</strong>${synName}<br>
                            <strong>目標物件：</strong>${targetObject}<br>
                            <strong>   型：</strong>${isPublic ? 'PUBLIC' : 'PRIVATE'}
                        </div>`;
                    } else if (stmtUpper.includes('CREATE PACKAGE')) {
                        // 創建包 (Oracle PACKAGE)
                        const pkgMatch = stmt.match(/CREATE\s+(?:OR\s+REPLACE\s+)?PACKAGE\s+(\w+)\s+(?:IS|AS)\s+(.*?)(?:END\s+\w+;?)?$/is);
                        if (!pkgMatch) {
                            throw new Error('CREATE PACKAGE語句格式錯誤，應為：CREATE PACKAGE pkg_name AS ... END pkg_name;');
                        }
                        const pkgName = pkgMatch[1].toLowerCase();
                        const pkgSpec = pkgMatch[2].trim();

                        databaseMetadata.packages[pkgName] = {
                            name: pkgName,
                            specification: pkgSpec,
                            body: null, // 包體需要單獨創建
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.message = `已創建包規範「${pkgName}」`;
                        executionResult.explanation = 'Package將相關的PL/SQL程序、函數、變量組織在一起';
                        executionResult.details = `<div style="padding:10px; background: rgba(0,168,255,0.1); border-radius:6px;">
                            <strong>包名稱：</strong>${pkgName}<br>
                            <strong>類型：</strong>PACKAGE SPECIFICATION<br>
                            <em>提示：使用 CREATE PACKAGE BODY 創建包體</em>
                        </div>`;
                    } else if (stmtUpper.includes('CREATE TABLESPACE')) {
                        // 創建表空間 (概念性支持)
                        const tsMatch = stmt.match(/CREATE\s+TABLESPACE\s+(\w+)/i);
                        if (!tsMatch) {
                            throw new Error('CREATE TABLESPACE語句格式錯誤');
                        }
                        const tsName = tsMatch[1].toLowerCase();

                        databaseMetadata.tablespaces[tsName] = {
                            name: tsName,
                            createdAt: new Date().toISOString()
                        };

                        executionResult.success = true;
                        executionResult.message = `已創建表空間「${tsName}」(概念性)`;
                        executionResult.explanation = '表空間是Oracle中存儲數據的邏輯容器';
                    } else if (stmtUpper.includes('EXEC ') || stmtUpper.includes('EXECUTE ')) {
                        // 執行存儲過程
                        const execMatch = stmt.match(/(?:EXEC|EXECUTE)\s+(\w+)(?:\s*\((.*?)\))?/i);
                        if (execMatch) {
                            const procName = execMatch[1].toLowerCase();
                            const args = execMatch[2] || '';

                            if (databaseMetadata.procedures[procName]) {
                                executionResult.success = true;
                                executionResult.message = `已執行${databaseMetadata.procedures[procName].type === 'FUNCTION' ? '函數' : '存儲過程'}「${procName}」`;
                                executionResult.explanation = `調用預存的業務邏輯 (模擬執行)`;
                                executionResult.details = `<div style="padding:10px; background: rgba(0,204,136,0.1); border-radius:6px;">
                                    <i class="fas fa-play-circle"></i> 執行成功 (模擬)<br>
                                    <strong>參數：</strong>${args || '無'}
                                </div>`;
                            } else {
                                throw new Error(`${procName} 不存在`);
                            }
                        }
                    } else if (stmtUpper.includes('SHOW TABLES') || stmtUpper.includes('DESC ') || stmtUpper.includes('DESCRIBE ')) {
                        executionResult.success = true;
                        executionResult.message = '顯示資料庫資訊';
                        executionResult.explanation = '查看資料庫結構資訊';
                        executionResult.details = renderDatabaseInfo();
                    } else {
                        executionResult.success = true;
                        executionResult.message = 'SQL指令執行成功';
                        executionResult.explanation = 'SQL語句已執行';
                    }
                } catch (error) {
                    hasError = true;
                    executionResult.success = false;
                    executionResult.message = error.message;

                    // 追蹤錯誤
                    trackAchievementProgress('error_encountered');

                    // 增強錯誤診斷：分類錯誤類型並提供中文解釋和修正建議
                    let errorType = '語法錯誤';
                    let errorExplanation = '語句執行失敗';
                    let suggestions = [];

                    const errorMsg = error.message.toLowerCase();

                    if (errorMsg.includes('不存在') || errorMsg.includes('not exist')) {
                        errorType = '物件不存在錯誤';
                        errorExplanation = '您引用的資料表、欄位或其他資料庫物件不存在';
                        suggestions = [
                            '使用 SHOW TABLES 查看現有的資料表',
                            '檢查物件名稱拼寫是否正確',
                            '確認該物件是否已經被創建'
                        ];
                    } else if (errorMsg.includes('括號') || errorMsg.includes('parenthes')) {
                        errorType = '括號不匹配錯誤';
                        errorExplanation = 'SQL語句中的左括號和右括號數量不匹配';
                        suggestions = [
                            '檢查每個左括號 ( 是否都有對應的右括號 )',
                            '使用代碼編輯器檢查括號配對',
                            '逐個添加或刪除括號，確保配對正確'
                        ];
                    } else if (errorMsg.includes('values') || errorMsg.includes('插入')) {
                        errorType = 'INSERT 語句錯誤';
                        errorExplanation = 'INSERT 語句格式不正確或缺少必要的部分';
                        suggestions = [
                            '確保格式為：INSERT INTO table_name VALUES (...)',
                            '檢查 VALUES 關鍵字是否存在',
                            '確認插入的值數量與表格欄位數量一致'
                        ];
                    } else if (errorMsg.includes('null') || errorMsg.includes('not null')) {
                        errorType = 'NOT NULL 約束違反';
                        errorExplanation = '嘗試向 NOT NULL 約束的欄位插入空值';
                        suggestions = [
                            '為該欄位提供有效的值（不能為 NULL）',
                            '檢查表格結構，確認哪些欄位有 NOT NULL 約束',
                            '如果該欄位可以為空，需修改表格結構移除 NOT NULL 約束'
                        ];
                    } else if (errorMsg.includes('unique') || errorMsg.includes('重複')) {
                        errorType = 'UNIQUE 約束違反';
                        errorExplanation = '嘗試插   重複的值到具有 UNIQUE 約束的欄位';
                        suggestions = [
                            '使用不同的值（該欄位值必須唯一）',
                            '檢查是否已存在相同的值',
                            '考慮使用 UPDATE 而不是 INSERT'
                        ];
                    } else if (errorMsg.includes('from') || errorMsg.includes('缺少')) {
                        errorType = 'SELECT 語句缺少 FROM 子句';
                        errorExplanation = 'SELECT 查詢缺少必要的 FROM 子句';
                        suggestions = [
                            '添加 FROM table_name 指定查詢的資料表',
                            '如果是計算表達式，使用 FROM DUAL',
                            '確保 SELECT 和 FROM 之間的語法正確'
                        ];
                    } else if (errorMsg.includes('join')) {
                        errorType = 'JOIN 語句錯誤';
                        errorExplanation = 'JOIN 連接語句格式不正確';
                        suggestions = [
                            '確保格式為：FROM table1 JOIN table2 ON table1.col = table2.col',
                            '檢查 ON 條件是否正確指定連接欄位',
                            '確認兩個表格都存在且欄位名稱正確'
                        ];
                    } else if (errorMsg.includes('格式')) {
                        errorType = 'SQL 格式錯誤';
                        errorExplanation = 'SQL 語句格式不符合標準語法';
                        suggestions = [
                            '參考範例   法重新編寫語句',
                            '檢查關鍵字順序是否正確',
                            '使用在線 SQL 格式化工具檢查語法'
                        ];
                    } else if (errorMsg.includes('primary key') || errorMsg.includes('主鍵')) {
                        errorType = 'PRIMARY KEY 約束違反';
                        errorExplanation = '嘗試插入重複的主鍵值或主鍵為 NULL';
                        suggestions = [
                            '確保主鍵值唯一且不為 NULL',
                            '檢查是否已存在相同的主鍵值',
                            '考慮使用自動遞增的 ID'
                        ];
                    } else if (errorMsg.includes('foreign key') || errorMsg.includes('外鍵')) {
                        errorType = 'FOREIGN KEY 約束違反';
                        errorExplanation = '外鍵值在參考表中不存在';
                        suggestions = [
                            '確保外鍵值存在於參考表中',
                            '先在參考表中插入該值',
                            '檢查外鍵關聯是否正確設定'
                        ];
                    } else if (errorMsg.includes('check') || errorMsg.includes('檢查約束')) {
                        errorType = 'CHECK 約束違反';
                        errorExplanation = '插入的值不符合 CHECK 約束條件';
                        suggestions = [
                            '查看表格的 CHECK 約束定義',
                            '確保插入的值符合約束條件',
                            '檢查數據類型和值範圍'
                        ];
                    } else if (errorMsg.includes('data type') || errorMsg.includes('類型') || errorMsg.includes('型別')) {
                        errorType = '資料類型不匹配';
                        errorExplanation = '嘗試將不相容的資料類型轉換或比較';
                        suggestions = [
                            '檢查欄位的資料類型定義',
                            '確保插入的值類型與欄位類型匹配',
                            '使用 CAST 或 CONVERT 函數進行類型轉換'
                        ];
                    } else if (errorMsg.includes('permission') || errorMsg.includes('權限')) {
                        errorType = '權限不足錯誤';
                        errorExplanation = '當前用戶沒有執行此操作的權限';
                        suggestions = [
                            '確認您是否有執行此操作的權限',
                            '聯繫資料庫管理員授予相應權限',
                            '使用具有足夠權限的帳戶登入'
                        ];
                    } else if (errorMsg.includes('transaction') || errorMsg.includes('事務')) {
                        errorType = '事務管理錯誤';
                        errorExplanation = '事務操作異常或事務狀態不正確';
                        suggestions = [
                            '確保使用 BEGIN 開始事務',
                            '使用 COMMIT 提交或 ROLLBACK 回滾事務',
                            '檢查事務隔離級別設定'
                        ];
                    } else if (errorMsg.includes('divide') || errorMsg.includes('除')) {
                        errorType = '除以零錯誤';
                        errorExplanation = '嘗試執行除以零的運算';
                        suggestions = [
                            '檢查除數是否為零',
                            '使用 CASE 語句避免除以零',
                            '添加條件判斷過濾零值'
                        ];
                    } else if (errorMsg.includes('aggregate') || errorMsg.includes('聚合')) {
                        errorType = '聚合函數使用錯誤';
                        errorExplanation = '聚合函數使用   當或缺少 GROUP BY';
                        suggestions = [
                            '使用聚合函數時添加 GROUP BY 子句',
                            '確保 SELECT 中的非聚合欄位都在 GROUP BY 中',
                            '檢查 HAVING 子句的使用是否正確'
                        ];
                    } else if (errorMsg.includes('order by') || errorMsg.includes('排序')) {
                        errorType = 'ORDER BY 子句錯誤';
                        errorExplanation = 'ORDER BY 排序語句使用不當';
                        suggestions = [
                            '確保 ORDER BY 中的欄位存在於 SELECT 結果中',
                            '檢查排序欄位名稱是否正確',
                            '使用 ASC 或 DESC 指定排序方向'
                        ];
                    } else if (errorMsg.includes('where') || errorMsg.includes('條件')) {
                        errorType = 'WHERE 條件錯誤';
                        errorExplanation = 'WHERE 條件子句格式或邏輯錯誤';
                        suggestions = [
                            '檢查條件運算符是否正確（=, >, <, !=）',
                            '確保比較的欄位和值類型相容',
                            '使用括號明確邏輯運算優先級'
                        ];
                    }

                    executionResult.explanation = errorExplanation;
                    executionResult.errorType = errorType;
                    executionResult.suggestions = suggestions;
                }

                // 將結果添加到陣列（最新的在前）
                executionResults.unshift(executionResult);
            });

            // 生成執行結果的HTML（最新的在頂部）
            let finalHTML = '<div style="margin-bottom: 20px;">';

            executionResults.forEach((result, index) => {
                const isNewest = index === 0;
                const borderColor = result.success ? 'var(--success)' : 'var(--error)';
                const bgColor = result.success ? 'rgba(0, 204, 136, 0.05)' : 'rgba(255, 51, 102, 0.05)';
                const icon = result.success ? 'fa-check-circle' : 'fa-exclamation-circle';
                const iconColor = result.success ? 'var(--success)' : 'var(--error)';

                finalHTML += `
                    <div style="margin-bottom: 20px; padding: 20px; background: ${bgColor}; border-radius: 10px; border-left: 4px solid ${borderColor}; ${isNewest ? 'box-shadow: 0 0 15px rgba(0, 204, 136, 0.2);' : ''}">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <i class="fas ${icon}" style="color: ${iconColor}; font-size: 18px;"></i>
                            <span style="font-weight: 600; font-size: 16px; color: ${result.success ? 'var(--success)' : 'var(--error)'}">${result.message}</span>
                            ${isNewest ? '<span style="background: var(--accent); color: var(--dark-bg); padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-left: auto;">最新</span>' : ''}
                        </div>

                        <div style="font-family: 'Courier New', monospace; color: var(--text-secondary); margin-bottom: 12px; padding: 12px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; font-size: 14px; overflow-x: auto;">
                            ${result.statement};
                        </div>

                        <div style="color: var(--text-secondary); font-size: 14px; padding: 8px 12px; background: rgba(0, 168, 255, 0.08); border-radius: 6px; border-left: 3px solid var(--secondary);">
                            <i class="fas fa-info-circle"></i> <strong>說明：</strong>${result.explanation}
                        </div>

                        ${result.errorType ? `
                            <div style="margin-top: 12px; padding: 10px; background: rgba(255,51,102,0.1); border-radius: 6px; border-left: 3px solid var(--error);">
                                <div style="font-weight:600; color: var(--error); margin-bottom:8px;">
                                    <i class="fas fa-exclamation-triangle"></i> 錯誤類型：${result.errorType}
                                </div>
                                ${result.suggestions && result.suggestions.length > 0 ? `
                                    <div style="margin-top:10px;">
                                        <strong style="color: var(--warning);"><i class="fas fa-lightbulb"></i> 修正建議：</strong>
                                        <ul style="margin:8px 0 0 20px; color: var(--text-secondary);">
                                            ${result.suggestions.map(s => `<li style="margin:4px 0;">${s}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        ${result.details ? `<div style="margin-top: 15px;">${result.details}</div>` : ''}
                    </div>
                `;
            });

            // 總結區塊
            finalHTML += `
                <div style="margin-top: 20px; padding: 15px; background: ${hasError ? 'rgba(255, 51, 102, 0.1)' : 'rgba(0, 204, 136, 0.1)'}; border-radius: 10px; border-left: 4px solid ${hasError ? 'var(--error)' : 'var(--success)'};">
                    <div style="font-weight: 600; color: ${hasError ? 'var(--error)' : 'var(--success)'};">
                        <i class="fas fa-chart-bar"></i> 執行總結: ${statements.length} 條語句 - ${executionResults.filter(r => r.success).length} 成功，${executionResults.filter(r => !r.success).length} 失敗
                    </div>
                </div>
            </div>`;

            output.innerHTML = finalHTML;

            // 更新表格預覽
            updateTablePreview();

            // 保存當前檔案狀態（確保數據不會丟失）
            saveCurrentFileState();

            // 追蹤成就進度
            userAchievements.progress.sqlExecutions++;
            checkAndUnlockAchievements();

            // 如果執行了 SELECT 查詢   有數據，自動生成圖表
            if (lastQueryResult && lastQueryResult.data && lastQueryResult.data.length > 0) {
                setTimeout(() => {
                    try {
                        generateChart();
                    } catch (error) {
                        console.log('圖表生成跳過：', error.message);
                    }
                }, 100);
            }
        }

        // 檢查並解鎖成就
        function checkAndUnlockAchievements() {
            Object.values(achievements).forEach(achievement => {
                // 如果已經獲得，跳過
                if (userAchievements.earned.includes(achievement.id)) {
                    return;
                }

                // 檢查是否滿足條件
                let unlocked = true;
                for (const [key, value] of Object.entries(achievement.requirement)) {
                    if (key === 'modelsExploredCount') {
                        if (userAchievements.progress.modelsExplored.length < value) {
                            unlocked = false;
                            break;
                        }
                    } else if (userAchievements.progress[key] < value) {
                        unlocked = false;
                        break;
                    }
                }

                if (unlocked) {
                    userAchievements.earned.push(achievement.id);
                    showAchievementNotification(achievement);
                }
            });

            // 更新側邊欄成就計數器
            const sidebarCounter = document.getElementById('sidebarAchievements');
            if (sidebarCounter) {
                sidebarCounter.textContent = `${userAchievements.earned.length}/9`;
            }
        }

        // 顯示成就通知
        function showAchievementNotification(achievement) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--accent), var(--secondary));
                color: var(--dark-bg);
                padding: 20px 25px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,255,204,0.3);
                z-index: 10000;
                animation: slideIn 0.5s ease-out, slideOut 0.5s ease-out 3.5s;
                font-weight: 600;
                max-width: 300px;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 32px;">${achievement.icon}</span>
                    <div>
                        <div style="font-size: 12px; opacity: 0.8;">成就解鎖！</div>
                        <div style="font-size: 16px; margin: 4px 0;">${achievement.name}</div>
                        <div style="font-size: 12px; opacity: 0.9;">${achievement.description}</div>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // 在需要的地   追蹤成就進度
        function trackAchievementProgress(type) {
            switch(type) {
                case 'table_created':
                    userAchievements.progress.tablesCreated++;
                    break;
                case 'join_performed':
                    userAchievements.progress.joinsPerformed++;
                    break;
                case 'procedure_created':
                    userAchievements.progress.proceduresCreated++;
                    break;
                case 'trigger_created':
                    userAchievements.progress.triggersCreated++;
                    break;
                case 'transaction_used':
                    userAchievements.progress.transactionsUsed++;
                    break;
                case 'error_encountered':
                    userAchievements.progress.errorsEncountered++;
                    break;
                case 'error_fixed':
                    userAchievements.progress.errorsFixed++;
                    break;
            }
            checkAndUnlockAchievements();
        }

        // 渲染成就模態框
        function renderAchievementsModal() {
            // 更新統計數據
            document.getElementById('totalAchievements').textContent = `${userAchievements.earned.length}/9`;
            document.getElementById('sqlExecutions').textContent = userAchievements.progress.sqlExecutions;
            document.getElementById('tablesCreated').textContent = userAchievements.progress.tablesCreated;
            document.getElementById('joinsPerformed').textContent = userAchievements.progress.joinsPerformed;

            // 渲染成就列表
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';

            Object.values(achievements).forEach(achievement => {
                const isUnlocked = userAchievements.earned.includes(achievement.id);
                const progress = getAchievementProgress(achievement);

                const card = document.createElement('div');
                card.style.cssText = `
                    padding: 20px;
                    background: ${isUnlocked ? 'linear-gradient(135deg, rgba(0, 255, 204, 0.15), rgba(0, 204, 136, 0.15))' : 'rgba(255, 255, 255, 0.03)'};
                    border-radius: 12px;
                    border: 2px solid ${isUnlocked ? 'var(--success)' : 'rgba(255, 255, 255, 0.1)'};
                    opacity: 1;
                    transition: all 0.3s ease;
                    cursor: pointer;
                `;

                // 獲取成就操作指引
                const guideTexts = {
                    first_query: '📍 SQL編輯器 → 執行任何SQL',
                    table_creator: '📍 SQL編輯器 → 使用CREATE TABLE',
                    join_master: '📍 SQL編輯器 → 使用JOIN查詢',
                    procedure_expert: '📍 側邊欄「存儲過程/函數」按鈕',
                    trigger_wizard: '📍 側邊欄「觸發器」按鈕',
                    transaction_pro: '📍 側邊欄「事務管理」按鈕',
                    error_fixer: '📍 SQL編輯器 → 修正錯誤SQL',
                    model_explorer: '📍 數據模型切換面板',
                    sql_veteran: '📍 SQL編輯器 → 持續練習'
                };

                // 獲取詳細說明文字
                const descriptionTexts = {
                    first_query: '學習執行基礎SQL查詢語句',
                    table_creator: '掌握資料表結構設計與創建',
                    join_master: '熟練運用多表關聯查詢技巧',
                    procedure_expert: '開發可重複使用的存儲過程',
                    trigger_wizard: '自動化資料變更的觸發邏輯',
                    transaction_pro: '確保資料一致性的事務控制',
                    error_fixer: '培養SQL調試與錯誤修正能力',
                    model_explorer: '探索   同類型的資料模型架構',
                    sql_veteran: '成為SQL查詢與資料操作專家'
                };

                card.innerHTML = `
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <div style="font-size: 48px;">${achievement.icon}</div>
                        <div style="flex: 1;">
                            <h4 style="color: ${isUnlocked ? 'var(--success)' : 'var(--accent)'}; margin-bottom: 5px;">
                                ${achievement.name}
                                ${isUnlocked ? '<i class="fas fa-check-circle" style="color: var(--success); margin-left: 8px;"></i>' : ''}
                            </h4>
                            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">${achievement.description}</p>

                            <div style="background: rgba(0, 255, 204, 0.08); padding: 6px 10px; border-radius: 6px; margin-bottom: 10px; font-size: 11px; color: var(--text-secondary); border-left: 2px solid var(--success);">
                                📘 ${descriptionTexts[achievement.id] || '完成此成就以提升技能'}
                            </div>

                            <div style="background: rgba(0, 168, 255, 0.15); padding: 8px 12px; border-radius: 6px; margin-bottom: 10px; font-size: 12px; color: var(--accent); border-left: 3px solid var(--accent);">
                                <i class="fas fa-map-marker-alt"></i> ${guideTexts[achievement.id] || '在模擬器頁面操作'}
                            </div>

                            <div style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; height: 8px; overflow: hidden; margin-bottom: 10px;">
                                <div style="background: ${isUnlocked ? 'var(--success)' : 'var(--accent)'}; height: 100%; width: ${progress}%; transition: width 0.3s ease;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                                <p style="color: var(--text-muted); font-size: 12px;">${isUnlocked ? '✅ 已完成' : `進度：${progress}%`}</p>
                                <button class="achievement-try-btn" data-achievement-id="${achievement.id}" style="font-size: 13px; padding: 10px 20px; background: linear-gradient(135deg, #00ffc8, #00a8ff); border: none; color: white; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; font-weight: 700; box-shadow: 0 3px 10px rgba(0, 168, 255, 0.4); position: relative; z-index: 100; ${isUnlocked ? 'display: none;' : ''}">
                                    <i class="fas fa-play"></i> 立即嘗試
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                // 為「立即嘗試」按鈕添加事件監聽器 - 使用捕獲階段確保優先執行
                const tryBtn = card.querySelector('.achievement-try-btn');
                if (tryBtn) {
                    // 點擊事件 - 使用多種事件確保響應
                    const handleClick = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        const achievementId = tryBtn.getAttribute('data-achievement-id');
                        console.log('✅ 立即嘗試按鈕被點擊:', achievementId);
                        startAchievement(achievementId);
                    };

                    // 同時監聽 click, mousedown, touchstart 確保在任何設備上都能響應
                    tryBtn.addEventListener('click', handleClick, true); // 使用捕獲階段
                    tryBtn.addEventListener('mousedown', handleClick, true);
                    tryBtn.addEventListener('touchstart', handleClick, true);

                    // 懸停效果
                    tryBtn.addEventListener('mouseenter', () => {
                        tryBtn.style.transform = 'scale(1.08)';
                        tryBtn.style.boxShadow = '0 5px 15px rgba(0, 168, 255, 0.6)';
                    });

                    tryBtn.addEventListener('mouseleave', () => {
                        tryBtn.style.transform = 'scale(1)';
                        tryBtn.style.boxShadow = '0 3px 10px rgba(0, 168, 255, 0.4)';
                    });

                    // 按下效果
                    tryBtn.addEventListener('mousedown', () => {
                        tryBtn.style.transform = 'scale(0.95)';
                    });

                    tryBtn.addEventListener('mouseup', () => {
                        tryBtn.style.transform = 'scale(1.08)';
                    });
                }

                // 卡片點擊事件（點擊卡片查看詳情）- 降低優先級
                card.addEventListener('click', (e) => {
                    // 檢查是否點擊了按鈕或按   內的元素
                    const clickedBtn = e.target.closest('.achievement-try-btn');
                    if (!clickedBtn) {
                        showAchievementDetail(achievement.id);
                    }
                }, false); // 使用冒泡階段，優先級低於按鈕

                achievementsList.appendChild(card);
            });
        }

        // 計算成就進度百分比
        function getAchievementProgress(achievement) {
            for (const [key, value] of Object.entries(achievement.requirement)) {
                if (key === 'modelsExploredCount') {
                    const current = userAchievements.progress.modelsExplored.length;
                    return Math.min(100, Math.round((current / value) * 100));
                } else {
                    const current = userAchievements.progress[key] || 0;
                    return Math.min(100, Math.round((current / value) * 100));
                }
            }
            return 0;
        }

        // 插入範例SQL到編輯器
        function insertExampleSQL(type) {
            const sqlInput = document.getElementById('sqlInput');
            let example = '';

            switch(type) {
                case 'procedure':
                    example = `-- 創建存儲過程範例
CREATE PROCEDURE add_employee(emp_name VARCHAR2, emp_salary NUMBER) AS
BEGIN
    INSERT INTO employees (name, salary) VALUES (emp_name, emp_salary);
END;

-- 執行存儲過程
EXEC add_employee('張三', 50000);`;
                    break;

                case 'trigger':
                    example = `-- 創建觸發器範例
CREATE TRIGGER salary_check
BEFORE INSERT ON employees
FOR EACH ROW
BEGIN
    -- 觸發器邏輯
END;`;
                    break;

                case 'transaction':
                    example = `-- 事務管理範例
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

BEGIN;

UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;

COMMIT;`;
                    break;

                case 'explain':
                    example = `-- 性能分析範例
EXPLAIN PLAN FOR SELECT * FROM employees WHERE salary > 50000;`;
                    break;

                case 'function':
                    example = `-- 創建函數範例
CREATE FUNCTION calculate_bonus(emp_salary NUMBER) RETURN NUMBER AS
BEGIN
    RETURN emp_salary * 0.1;
END;`;
                    break;

                case 'isolation':
                    example = `-- 設置事務隔離級別範例
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
-- 或使用其他級別：
-- SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
-- SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
-- SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;`;
                    break;

                case 'sequence':
                    example = `-- Oracle SEQUENCE    整範例
-- 步驟1：創建序列
CREATE SEQUENCE emp_seq
START WITH 1
INCREMENT BY 1
MINVALUE 1
MAXVALUE 999999;

-- 步驟2：創建員工表
CREATE TABLE employees (
    emp_id NUMBER PRIMARY KEY,
    emp_name VARCHAR2(50),
    salary NUMBER
);

-- 步驟3：使用序列插入數據（自動生成ID）
INSERT INTO employees VALUES (emp_seq.NEXTVAL, '張三', 50000);
INSERT INTO employees VALUES (emp_seq.NEXTVAL, '李四', 60000);
INSERT INTO employees VALUES (emp_seq.NEXTVAL, '王五', 55000);

-- 步驟4：查詢序列當前值
SELECT emp_seq.CURRVAL FROM DUAL;

-- 步驟5：查看插入的數據
SELECT * FROM employees;`;
                    break;

                case 'oracle_objects':
                    example = `-- Oracle 數據庫對象綜合範例

-- 1. 創建序列
CREATE SEQUENCE dept_seq START WITH 100 INCREMENT BY 10;

-- 2. 創建表
CREATE TABLE departments (
    dept_id NUMBER PRIMARY KEY,
    dept_name VARCHAR2(50) NOT NULL,
    manager VARCHAR2(50)
);

-- 3. 使用序列插入數據
INSERT INTO departments VALUES (dept_seq.NEXTVAL, 'IT部門', '張經理');
INSERT INTO departments VALUES (dept_seq.NEXTVAL, '財務部', '李經理');

-- 4. 創建視圖
CREATE VIEW dept_view AS
SELECT dept_id, dept_name FROM departments;

-- 5. 創建索引
CREATE INDEX idx_dept_name ON departments(dept_name);

-- 6. 創建同義詞
CREATE SYNONYM dept FOR departments;

-- 7. 查看所有對象
SHOW TABLES;

-- 8. 使用同義詞查詢
SELECT * FROM dept;`;
                    break;

                case 'dual_functions':
                    example = `-- Oracle DUAL 表和函數範例

-- 1. 查詢系統日期
SELECT SYSDATE FROM DUAL;

-- 2. 使用序列
SELECT emp_seq.NEXTVAL FROM DUAL;

-- 3. 數學計算
SELECT 100 + 200 FROM DUAL;
SELECT 50 * 1.5 FROM DUAL;

-- 4. NVL 函數（空值處理）
SELECT NVL(NULL, '預設值') FROM DUAL;

-- 5. 日期函數
SELECT TO_DATE('2024-12-25', 'YYYY-MM-DD') FROM DUAL;`;
                    break;

                case 'package':
                    example = `-- Oracle PACKAGE 範例
CREATE PACKAGE employee_pkg AS
    PROCEDURE hire_employee(p_name VARCHAR2, p_salary NUMBER);
    FUNCTION get_employee_count RETURN NUMBER;
END employee_pkg;

-- 查看已創建的包
SHOW TABLES;`;
                    break;

                default:
                    example = '-- 請選擇範例類型';
            }

            sqlInput.value = example;
            sqlInput.focus();

            const typeNames = {
                'procedure': '存儲過程',
                'trigger': '觸發器',
                'transaction': '事務管理',
                'function': '函數',
                'isolation': '隔離級別',
                'explain': '性能分析',
                'sequence': 'Oracle序列',
                'oracle_objects': 'Oracle對象綜合',
                'dual_functions': 'DUAL表與函數',
                'package': 'Oracle包'
            };

            showMessage(`✅ 已插入${typeNames[type] || '範例'}範例`, 'success');
        }

        // 顯示成就詳細資訊
        function showAchievementDetail(achievementId) {
            const achievement = achievements[achievementId];
            if (!achievement) return;

            const isUnlocked = userAchievements.earned.includes(achievementId);
            const progress = getAchievementProgress(achievement);

            // 詳細指引內容
            const detailGuides = {
                first_query: {
                    location: 'SQL編輯器（模擬資料庫頁面）',
                    steps: ['1. 前往「模擬資料庫」頁面', '2. 在SQL編輯器中輸入任何有效的SQL查詢', '3. 點擊「執行」按鈕', '4. 成就將自動解鎖！'],
                    example: 'SELECT * FROM employees;'
                },
                table_creator: {
                    location: 'SQL編輯器（模擬資料庫頁面）',
                    steps: ['1. 前往「模擬資料庫」頁面', '2. 使用CREATE TABLE語句創建資料表', '3. 創建5個不同的資料表', '4. 成就將自動解鎖！'],
                    example: 'CREATE TABLE my_table (id NUMBER, name VARCHAR2(50));'
                },
                join_master: {
                    location: 'SQL編輯器（模擬資料庫頁面）',
                    steps: ['1. 前往「模擬資料庫」頁面', '2. 執行包含JOIN的查詢語句', '3. 嘗試使用INNER JOIN、LEFT JOIN等', '4. 執行10次JOIN查詢即可解鎖'],
                    example: 'SELECT e.name, d.dept_name FROM employees e JOIN departments d ON e.dept_id = d.id;'
                },
                procedure_expert: {
                    location: '側邊欄「存儲過程/函數」按鈕',
                    steps: ['1. 點擊側邊欄的「存儲過程/函數」按鈕', '2. 系統會自動插入範例代碼', '3. 點擊「執行」創建存儲過程', '4. 創建3個存儲過程即可解鎖'],
                    example: 'CREATE PROCEDURE my_proc(p_name VARCHAR2) AS BEGIN INSERT INTO table VALUES (p_name); END;'
                },
                trigger_wizard: {
                    location: '側邊欄「觸發器」按鈕',
                    steps: ['1. 點擊側邊欄的「觸發器」按鈕', '2. 系統會自動插入觸發器範例', '3. 點擊「執行」創建觸發器', '4. 創建2個觸發器即可解鎖'],
                    example: 'CREATE TRIGGER my_trigger BEFORE INSERT ON table FOR EACH ROW BEGIN ... END;'
                },
                transaction_pro: {
                    location: '側邊欄「事務管理」按鈕',
                    steps: ['1. 點擊側邊欄的「事務管理」按鈕', '2. 系統會插入事務管理範例', '3. 執行BEGIN、COMMIT或ROLLBACK', '4. 使用5次事務即可解鎖'],
                    example: 'BEGIN; UPDATE table SET column = value; COMMIT;'
                },
                error_fixer: {
                    location: 'SQL編輯器（模擬資料庫頁面）',
                    steps: ['1. 執行一些有錯誤的SQL語句', '2. 閱讀系統提供的錯誤診斷', '3. 根據建議修正錯誤', '4. 成功修正3個錯誤即可解鎖'],
                    example: 'SELCT * FRM table; -- 故意寫錯，然後修正為：SELECT * FROM table;'
                },
                model_explorer: {
                    location: '數據模型切換面板（模擬資料庫頁面）',
                    steps: ['1. 在模擬資料庫頁面找到數據模型切換器', '2. 嘗試切換不同的數據模型', '3. 探索至少5種不同的模型', '4. 成就將自動解鎖'],
                    example: '點擊模型切換按鈕，探索關聯式、JSON、圖形等不同模型'
                },
                sql_veteran: {
                    location: 'SQL編輯器（模擬資料庫頁面）',
                    steps: ['1. 持續練習和執行SQL查詢', '2. 累積執行100次SQL語句', '3. 這是一個長期成就', '4. 保持練習，終將達成！'],
                    example: '繼續執行各種SQL語句，熟能生巧！'
                }
            };

            const guide = detailGuides[achievementId] || { location: '模擬器頁面', steps: ['操作說明載入中...'], example: '' };

            // 創建詳細資訊模態框
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.85);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10001;
                padding: 20px;
                backdrop-filter: blur(8px);
            `;

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 20px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 255, 204, 0.3); border: 2px solid var(--accent);">
                    <div style="padding: 30px;">
                        <div style="text-align: center; margin-bottom: 25px;">
                            <div style="font-size: 72px; margin-bottom: 15px;">${achievement.icon}</div>
                            <h2 style="color: ${isUnlocked ? 'var(--success)' : 'var(--accent)'}; margin-bottom: 10px;">
                                ${achievement.name}
                                ${isUnlocked ? '<i class="fas fa-check-circle" style="color: var(--success); margin-left: 10px;"></i>' : ''}
                            </h2>
                            <p style="color: var(--text-secondary); font-size: 16px;">${achievement.description}</p>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: var(--accent); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-map-marker-alt"></i> 操作位置
                            </h3>
                            <p style="color: var(--text); font-size: 15px; background: rgba(0, 168, 255, 0.15); padding: 12px; border-radius: 8px; border-left: 4px solid var(--accent);">
                                📍 ${guide.location}
                            </p>
                        </div>

                        <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: var(--accent); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-list-ol"></i> 完成步驟
                            </h3>
                            ${guide.steps.map((step, index) => `
                                <div style="display: flex; gap: 12px; margin-bottom: 12px; align-items: flex-start;">
                                    <div style="background: var(--gradient-accent); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px; flex-shrink: 0;">${index + 1}</div>
                                    <p style="color: var(--text); font-size: 14px; flex: 1; line-height: 24px;">${step}</p>
                                </div>
                            `).join('')}
                        </div>

                        ${guide.example ? `
                        <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: var(--accent); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-code"></i> 範例代碼
                            </h3>
                            <pre style="background: rgba(0, 0, 0, 0.5); padding: 15px; border-radius: 8px; color: var(--success); font-family: 'Courier New', monospace; font-size: 13px; overflow-x: auto; border: 1px solid rgba(0, 255, 204, 0.3);">${guide.example}</pre>
                        </div>
                        ` : ''}

                        <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 25px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="color: var(--text-secondary); font-size: 14px;">完成進度</span>
                                <span style="color: var(--accent); font-weight: bold; font-size: 16px;">${progress}%</span>
                            </div>
                            <div style="background: rgba(0, 0, 0, 0.5); border-radius: 8px; height: 12px; overflow: hidden;">
                                <div style="background: ${isUnlocked ? 'var(--success)' : 'var(--gradient-accent)'}; height: 100%; width: ${progress}%; transition: width 0.3s ease; border-radius: 8px;"></div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            ${!isUnlocked ? `
                            <button class="start-achievement-detail-btn" data-achievement-id="${achievementId}" style="flex: 1; padding: 15px; font-size: 16px; background: linear-gradient(135deg, #00ffc8, #00a8ff); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 12px rgba(0, 168, 255, 0.4);">
                                <i class="fas fa-play"></i> 立即開始
                            </button>
                            ` : ''}
                            <button class="close-detail-modal-btn" style="flex: 1; padding: 15px; font-size: 16px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-times"></i> 關閉
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // 為按鈕添加事件監聽器
            setTimeout(() => {
                const startBtn = modal.querySelector('.start-achievement-detail-btn');
                const closeBtn = modal.querySelector('.close-detail-modal-btn');

                if (startBtn) {
                    startBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const achievementId = startBtn.getAttribute('data-achievement-id');
                        console.log('💫 立即開始按鈕被點擊:', achievementId);
                        modal.remove();
                        startAchievement(achievementId);
                    });

                    // 懸停效果
                    startBtn.addEventListener('mouseenter', () => {
                        startBtn.style.transform = 'scale(1.05)';
                        startBtn.style.boxShadow = '0 6px 16px rgba(0, 168, 255, 0.6)';
                    });
                    startBtn.addEventListener('mouseleave', () => {
                        startBtn.style.transform = 'scale(1)';
                        startBtn.style.boxShadow = '0 4px 12px rgba(0, 168, 255, 0.4)';
                    });
                }

                if (closeBtn) {
                    closeBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        modal.remove();
                    });
                }
            }, 10);

            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };

            document.body.appendChild(modal);
        }

        // 開始成就挑戰
        // 頁面切換函數
        function showPage(pageName, skipFileCreation = false) {
            const introPage = document.getElementById('introPage');
            const simulatorPage = document.getElementById('simulatorPage');

            if (pageName === 'simulator') {
                if (introPage) introPage.style.display = 'none';
                if (simulatorPage) simulatorPage.style.display = 'block';

                // 如果還沒有創建任何檔案且不跳過檔案創建，顯示新建檔案對話框
                if (databaseFiles.length === 0 && !skipFileCreation) {
                    console.log('📝 自動創建第一個檔案...');
                    // 顯示新建檔案對話框
                    const newFileModal = document.getElementById('newFileModal');
                    if (newFileModal) {
                        newFileModal.classList.add('active');
                    }
                }
            } else if (pageName === 'intro') {
                if (introPage) introPage.style.display = 'flex';
                if (simulatorPage) simulatorPage.style.display = 'none';
            }
        }

        function startAchievement(achievementId) {
            console.log('🚀 startAchievement 被調用，成就ID:', achievementId);

            // 關閉成就面板
            const achievementModal = document.getElementById('achievementsModal');
            if (achievementModal) {
                achievementModal.classList.remove('active');
                console.log('✅ 成就面板已關閉');
            }

            // 為每個成就定義專屬的資料庫名稱和用戶名稱
            const achievementDatabaseInfo = {
                first_query: {
                    dbName: 'FirstQuery_DB',
                    userName: 'Beginner',
                    portName: 'Query練習'
                },
                table_creator: {
                    dbName: 'TableCreator_DB',
                    userName: 'Creator',
                    portName: '建表大師'
                },
                join_master: {
                    dbName: 'JoinMaster_DB',
                    userName: 'JoinExpert',
                    portName: 'JOIN大師'
                },
                procedure_expert: {
                    dbName: 'Procedure_DB',
                    userName: 'ProcedureExpert',
                    portName: '存儲過程'
                },
                trigger_wizard: {
                    dbName: 'Trigger_DB',
                    userName: 'TriggerWizard',
                    portName: '觸發器巫師'
                },
                transaction_pro: {
                    dbName: 'Transaction_DB',
                    userName: 'TransactionPro',
                    portName: '事務專家'
                },
                error_fixer: {
                    dbName: 'ErrorFixer_DB',
                    userName: 'Debugger',
                    portName: '調試高手'
                },
                model_explorer: {
                    dbName: 'ModelExplorer_DB',
                    userName: 'Explorer',
                    portName: '模型探索者'
                },
                sql_veteran: {
                    dbName: 'Veteran_DB',
                    userName: 'SQLVeteran',
                    portName: 'SQL老手'
                }
            };

            const dbInfo = achievementDatabaseInfo[achievementId] || {
                dbName: 'Practice_DB',
                userName: 'Player',
                portName: '練習檔案'
            };

            // 如果沒有檔案，自動創建一個專屬檔案
            if (databaseFiles.length === 0) {
                console.log('📝 自動創建成就專屬檔案:', dbInfo.dbName);

                // 創建檔案
                const newIndex = createDatabaseFile(dbInfo.dbName);

                // 設置使用者名稱和連接埠名稱
                databaseFiles[newIndex].user = dbInfo.userName;
                databaseFiles[newIndex].databaseName = dbInfo.dbName;
                databaseFiles[newIndex].portName = dbInfo.portName;

                // 設置當前檔案
                currentFileIndex = newIndex;
                currentUser = dbInfo.userName;
                currentDatabaseName = dbInfo.dbName;

                // 初始化範例資料庫
                currentDatabase = JSON.parse(JSON.stringify(sampleDatabase));
                executionHistory = [];
                lastQueryResult = null;

                // 更新UI
                updateUIAfterFileSwitch();
                renderDatabaseTabs();
                updateTablePreview();

                // 顯示歡迎訊息
                const output = document.getElementById('output');
                if (output) {
                    output.innerHTML = createMessage(
                        `🎯 歡迎 ${dbInfo.userName}！您正在挑戰「${achievements[achievementId].name}」成就！\n資料庫：${dbInfo.dbName} [${dbInfo.portName}]`,
                        'success'
                    );
                }
            }

            // 導航到模擬器頁面（跳過自動創建檔案對話框）
            console.log('🎯 正在導航到模擬器頁面...');
            showPage('simulator', true);

            // 根據成就類型插入對應的範例
            const achievementExamples = {
                first_query: 'simple',
                table_creator: 'table',
                join_master: 'join',
                procedure_expert: 'procedure',
                trigger_wizard: 'trigger',
                transaction_pro: 'transaction',
                error_fixer: 'error',
                model_explorer: 'model',
                sql_veteran: 'simple'
            };

            const exampleType = achievementExamples[achievementId];

            // 等待頁面切換完成後再執行
            setTimeout(() => {
                const sqlInput = document.getElementById('sqlInput');

                if (!sqlInput) {
                    console.warn('⚠️ SQL編輯器未找到，可能需要先創建檔案');
                    return;
                }

                if (exampleType === 'simple') {
                    sqlInput.value = '-- 執行你的第一個SQL查詢！\nSELECT * FROM employees LIMIT 5;';
                    sqlInput.focus();
                } else if (exampleType === 'table') {
                    sqlInput.value = `-- 創建你的資料表
CREATE TABLE my_table (
    id NUMBER PRIMARY KEY,
    name VARCHAR2(50) NOT NULL,
    created_date DATE
);

-- 插入測試資料
INSERT INTO my_table VALUES (1, '測試資料', SYSDATE);`;
                    sqlInput.focus();
                } else if (exampleType === 'join') {
                    sqlInput.value = `-- JOIN查詢範例
SELECT
    e.employee_id,
    e.first_name,
    e.last_name,
    d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.department_id
WHERE e.salary > 5000;`;
                    sqlInput.focus();
                } else if (exampleType === 'procedure') {
                    // 打開存儲過程面板
                    const procedureTab = document.querySelector('[data-sidebar-tab="procedure"]');
                    if (procedureTab) {
                        procedureTab.click();
                        showMessage('💡 請在存儲過程面板中創建存儲過程！', 'info');
                    }
                } else if (exampleType === 'trigger') {
                    // 打開觸發器面板
                    const triggerTab = document.querySelector('[data-sidebar-tab="trigger"]');
                    if (triggerTab) {
                        triggerTab.click();
                        showMessage('💡 請在觸發器面板中創建觸發器！', 'info');
                    }
                } else if (exampleType === 'transaction') {
                    // 打開事務管理面板
                    const transactionTab = document.querySelector('[data-sidebar-tab="transaction"]');
                    if (transactionTab) {
                        transactionTab.click();
                        showMessage('💡 請在事務管理面板中練習事務操作！', 'info');
                    }
                } else if (exampleType === 'error') {
                    sqlInput.value = `-- 嘗試修正以下錯誤的SQL
SELCT * FRM employees WERE salary > 5000;

-- 正確的寫法應該是：
-- SELECT * FROM employees WHERE salary > 5000;`;
                    sqlInput.focus();
                } else if (exampleType === 'model') {
                    // 滾動到數據模型選擇區域
                    const modelSelector = document.querySelector('.model-selector-container');
                    if (modelSelector) {
                        modelSelector.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        showMessage('💡 請在下方數據模型切換面板中探索不同的數據模型！', 'info');
                    }
                } else if (exampleType) {
                    // 對於其他類型，使用現有的 insertExampleSQL
                    insertExampleSQL(exampleType);
                }

                // 滾動到SQL編輯器（如果沒有特別指定其他位置）
                if (!['procedure', 'trigger', 'transaction', 'model'].includes(exampleType)) {
                    setTimeout(() => {
                        if (sqlInput) {
                            sqlInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 300);
                }

                showMessage(`🎯 已為你準備好「${achievements[achievementId].name}」的範例！現在開始挑戰吧！`, 'success');
            }, 500);
        }

        // 測試所有新功能
        function testAllNewFeatures() {
            const sqlInput = document.getElementById('sqlInput');
            const testSQL = `-- 🧪 新功能完整測試範例
-- 此腳本將測試所有2025版本新增的功能

-- 1️⃣ 創建測試表格
CREATE TABLE test_employees (
    emp_id NUMBER PRIMARY KEY,
    emp_name VARCHAR2(50) NOT NULL,
    salary NUMBER CHECK(salary >= 0),
    dept VARCHAR2(30)
);

-- 2️⃣ 插入測試資料
INSERT INTO test_employees VALUES (1, '張三', 50000, 'IT');
INSERT INTO test_employees VALUES (2, '李四', 60000, 'HR');

-- 3️⃣ 測試性能分析 (EXPLAIN PLAN)
EXPLAIN PLAN FOR SELECT * FROM test_employees WHERE salary > 45000;

-- 4️⃣ 創建函數
CREATE FUNCTION calc_bonus(sal NUMBER) RETURN NUMBER AS
BEGIN
    RETURN sal * 0.1;
END;

-- 5️⃣ 創建存儲過程
CREATE PROCEDURE raise_salary(emp_id NUMBER, amount NUMBER) AS
BEGIN
    UPDATE test_employees SET salary = salary + amount WHERE emp_id = emp_id;
END;

-- 6️⃣ 創建觸發器
CREATE TRIGGER salary_audit
AFTER UPDATE ON test_employees
FOR EACH ROW
BEGIN
    -- 觸發器邏輯
END;

-- 7️⃣ 測試事務管理
BEGIN;
UPDATE test_employees SET salary = salary + 1000 WHERE emp_id = 1;
COMMIT;

-- 8️⃣ 測試隔離級別
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

-- ✅ 測試完成！執行此腳本將解鎖多個成就！`;

            sqlInput.value = testSQL;
            sqlInput.focus();
            showMessage('✅ 已插入完整測試腳本！執行後將測試所有新功能並解鎖成就！', 'success');
        }

        // 當前表格類型（全局變量）
        let currentTableType = 'standard';

        // 渲染資料表
        function renderTable(table) {
            let html = `<h3>查詢結果 (${table.data.length} 筆記錄)</h3>`;
            html += `<div style="overflow-x: auto;">`;
            html += `<table class="data-table">`;

            html += `<thead><tr>`;
            table.columns.forEach(col => {
                html += `<th>${col}</th>`;
            });
            html += `</tr></thead>`;

            html += `<tbody>`;
            if (table.data.length > 0) {
                table.data.forEach(row => {
                    html += `<tr>`;
                    row.forEach(cell => {
                        html += `<td>${cell}</td>`;
                    });
                    html += `</tr>`;
                });
            } else {
                html += `<tr><td colspan="${table.columns.length}" style="text-align: center; color: var(--text-muted);">沒有資料</td></tr>`;
            }
            html += `</tbody>`;
            html += `</table></div>`;

            // 添加表格類型切換器
            html += renderTableTypeSwitcher(table);

            return html;
        }

        // 渲染表格類型切換器
        function renderTableTypeSwitcher(table) {
            const tableTypes = [
                { id: 'standard', name: '標準表格', icon: 'fa-table' },
                { id: 'partitioned', name: '分割區表', icon: 'fa-layer-group' },
                { id: 'clustered', name: '叢集表', icon: 'fa-object-group' },
                { id: 'iot', name: '索引組織表', icon: 'fa-key' },
                { id: 'external', name: '外部表', icon: 'fa-link' },
                { id: 'temporary', name: '臨時表', icon: 'fa-clock' },
                { id: 'nested', name: '巢狀表', icon: 'fa-sitemap' },
                { id: 'object', name: '物件表', icon: 'fa-cube' },
                { id: 'blockchain', name: '區塊鏈表', icon: 'fa-chain' }
            ];

            // 生成唯一 ID 並存儲表格數據在內存中
            const uniqueId = 'tableTypeContent_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

            // 將表格數據存儲在全局對象中，避免在DOM中存儲   量JSON
            if (!window.tableDataCache) {
                window.tableDataCache = {};
            }
            window.tableDataCache[uniqueId] = table;

            let html = `<div class="table-type-switcher" data-table-id="${uniqueId}">`;
            html += `<div class="table-type-header">`;
            html += `<div class="table-type-title"><i class="fas fa-shapes"></i> 表格類型視圖 <span style="font-size: 0.8rem; color: var(--accent); margin-left: 8px;">(、${tableTypes.length}種)</span></div>`;
            html += `</div>`;

            html += `<div class="table-type-tabs">`;
            // 確保渲染所有9種表格類型
            tableTypes.forEach((type, index) => {
                const activeClass = type.id === currentTableType ? 'active' : '';
                // 只存儲類型ID，不存儲完整的表格數據
                html += `<div class="table-type-tab ${activeClass}" data-type="${type.id}" data-index="${index}" onclick="switchTableTypeOptimized(this, '${type.id}', '${uniqueId}')">`;
                html += `<i class="fas ${type.icon}"></i>`;
                html += `<span>${type.name}</span>`;
                html += `</div>`;
            });
            html += `</div>`;

            // 調試：記錄渲染的標籤數量
            console.log(`表格類型切換器已渲染 ${tableTypes.length} 種類型:`, tableTypes.map(t => t.name).join(', '));

            html += `<div class="table-type-content" id="${uniqueId}">`;
            html += renderTableByType(table, currentTableType);
            html += `</div>`;

            html += `</div>`;
            return html;
        }

        // 性能優化助手：根據設備限制數據量
        function getOptimizedTableData(table) {
            const isMobile = window.innerWidth <= 768;
            const maxRows = isMobile ? 50 : 500;
            const displayData = table.data.slice(0, maxRows);
            const hasMore = table.data.length > maxRows;

            return {
                columns: table.columns,
                data: displayData,
                totalRows: table.data.length,
                displayRows: displayData.length,
                hasMore: hasMore,
                isMobile: isMobile,
                maxRows: maxRows
            };
        }

        // 根據類型渲染表格
        function renderTableByType(table, type) {
            switch(type) {
                case 'partitioned':
                    return renderPartitionedTable(table);
                case 'clustered':
                    return renderClusteredTable(table);
                case 'iot':
                    return renderIOTTable(table);
                case 'external':
                    return renderExternalTable(table);
                case 'temporary':
                    return renderTemporaryTable(table);
                case 'nested':
                    return renderNestedTable(table);
                case 'object':
                    return renderObjectTable(table);
                case 'blockchain':
                    return renderBlockchainTable(table);
                default:
                    return renderStandardTableView(table);
            }
        }

        // 優化的表格切換函數
        function switchTableTypeOptimized(element, type, tableId) {
            try {
                // 從內存緩存中獲取表格數據，而不是從DOM解析JSON
                const table = window.tableDataCache && window.tableDataCache[tableId];

                if (!table) {
                    console.error('找不到表格數據');
                    return;
                }

                currentTableType = type;

                // 找到對應的內容容器
                const content = document.getElementById(tableId);

                if (content) {
                    // 使用 requestAnimationFrame 優化渲染
                    requestAnimationFrame(() => {
                        content.innerHTML = renderTableByType(table, type);
                    });

                    // 更新標籤活動狀態
                    const switcher = element.closest('.table-type-switcher');
                    const allTabs = switcher.querySelectorAll('.table-type-tab');
                    allTabs.forEach(tab => {
                        tab.classList.remove('active');
                    });
                    element.classList.add('active');
                }
            } catch (error) {
                console.error('切換表格類型時出錯:', error);
            }
        }

        // 切換表格類型（從元素調用）- 保留舊版兼容性
        function switchTableTypeFromElement(element, type) {
            try {
                const tableData = element.getAttribute('data-table');
                const table = JSON.parse(tableData);
                currentTableType = type;

                // 找到對應的 tableTypeContent
                const switcher = element.closest('.table-type-switcher');
                const content = switcher.querySelector('.table-type-content');

                if (content) {
                    requestAnimationFrame(() => {
                        content.innerHTML = renderTableByType(table, type);
                    });

                    // 更新標籤活動狀態
                    const allTabs = switcher.querySelectorAll('.table-type-tab');
                    allTabs.forEach(tab => {
                        tab.classList.remove('active');
                    });
                    element.classList.add('active');
                }
            } catch (error) {
                console.log('切換表格類型時出錯:', error);
            }
        }

        // 切、表格類型（舊版本，保留兼容性）
        function switchTableType(type, table) {
            currentTableType = type;
            const content = document.getElementById('tableTypeContent');
            if (content) {
                content.innerHTML = renderTableByType(table, type);

                // 更新標籤活動狀態
                document.querySelectorAll('.table-type-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                if (typeof event !== 'undefined' && event.target) {
                    event.target.closest('.table-type-tab').classList.add('active');
                }
            }
        }

        // 標準表格視圖
        function renderStandardTableView(table) {
            let html = `<div style="padding: 10px;">`;
            html += `<h4 style="color: var(--text-secondary); margin-bottom: 15px;">📊 標準表格格式</h4>`;

            // 性能優化：手機版限制顯示行數
            const isMobile = window.innerWidth <= 768;
            const maxRows = isMobile ? 50 : 500; // 手機版顯示50行，桌面版顯示500行
            const displayData = table.data.slice(0, maxRows);
            const hasMore = table.data.length > maxRows;

            html += `<div style="overflow-x: auto;">`;
            html += `<table class="data-table">`;
            html += `<thead><tr>`;
            table.columns.forEach(col => {
                html += `<th>${col}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            if (displayData.length > 0) {
                displayData.forEach(row => {
                    html += `<tr>`;
                    row.forEach(cell => {
                        html += `<td>${cell}</td>`;
                    });
                    html += `</tr>`;
                });
            }
            html += `</tbody></table>`;

            if (hasMore) {
                html += `<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">`;
                html += `<i class="fas fa-info-circle"></i> 顯示前 ${maxRows} 筆，共 ${table.data.length} 筆記錄`;
                html += `</div>`;
            }

            html += `</div></div>`;
            return html;
        }

        // 分割區表
        function renderPartitionedTable(table) {
            let html = `<div class="partitioned-table-container">`;
            html += `<h4 style="color: var(--success); margin-bottom: 15px;">📦 分割區表格式</h4>`;

            // 性能優化：手機版限制數據量
            const isMobile = window.innerWidth <= 768;
            const maxRows = isMobile ? 50 : 500;
            const displayData = table.data.slice(0, maxRows);

            // 根據第一列進行分區（示例邏輯）
            const partitions = {};
            displayData.forEach((row, idx) => {
                const partitionKey = row[0] ? String(row[0]).charAt(0).toUpperCase() : 'Other';
                if (!partitions[partitionKey]) {
                    partitions[partitionKey] = [];
                }
                partitions[partitionKey].push(row);
            });

            Object.keys(partitions).forEach(partKey => {
                html += `<div class="partition-block">`;
                html += `<div class="partition-header"><i class="fas fa-layer-group"></i> 分區: ${partKey}</div>`;
                html += `<table class="data-table">`;
                html += `<thead><tr>`;
                table.columns.forEach(col => {
                    html += `<th>${col}</th>`;
                });
                html += `</tr></thead>`;
                html += `<tbody>`;
                partitions[partKey].forEach(row => {
                    html += `<tr>`;
                    row.forEach(cell => {
                        html += `<td>${cell}</td>`;
                    });
                    html += `</tr>`;
                });
                html += `</tbody></table>`;
                html += `</div>`;
            });

            html += `</div>`;
            return html;
        }

        // 叢集表
        function renderClusteredTable(table) {
            const optimized = getOptimizedTableData(table);

            let html = `<div>`;
            html += `<h4 style="color: var(--warning); margin-bottom: 15px;">🗂️ 叢集表格式</h4>`;
            html += `<div style="margin-bottom: 10px;"><span class="cluster-key-indicator">🔑 叢集鍵: ${optimized.columns[0]}</span></div>`;
            html += `<div style="overflow-x: auto;">`;
            html += `<table class="data-table clustered-table">`;
            html += `<thead><tr>`;
            optimized.columns.forEach((col, idx) => {
                html += `<th>${col} ${idx === 0 ? '<i class="fas fa-key"></i>' : ''}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            optimized.data.forEach(row => {
                html += `<tr>`;
                row.forEach(cell => {
                    html += `<td>${cell}</td>`;
                });
                html += `</tr>`;
            });
            html += `</tbody></table>`;

            if (optimized.hasMore) {
                html += `<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">`;
                html += `<i class="fas fa-info-circle"></i> 顯示前 ${optimized.maxRows} 筆，共 ${optimized.totalRows} 筆記錄`;
                html += `</div>`;
            }

            html += `</div></div>`;
            return html;
        }

        // 索引組織表
        function renderIOTTable(table) {
            const optimized = getOptimizedTableData(table);

            let html = `<div>`;
            html += `<h4 style="color: var(--info); margin-bottom: 15px;">🔑 索引組織表格式</h4>`;
            html += `<div style="overflow-x: auto; position: relative; padding-left: 30px;">`;
            html += `<table class="data-table iot-table">`;
            html += `<thead><tr>`;
            optimized.columns.forEach(col => {
                html += `<th>${col}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            optimized.data.forEach(row => {
                html += `<tr class="iot-row">`;
                row.forEach(cell => {
                    html += `<td>${cell}</td>`;
                });
                html += `</tr>`;
            });
            html += `</tbody></table>`;

            if (optimized.hasMore) {
                html += `<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">`;
                html += `<i class="fas fa-info-circle"></i> 顯示前 ${optimized.maxRows} 筆，共 ${optimized.totalRows} 筆記錄`;
                html += `</div>`;
            }

            html += `</div></div>`;
            return html;
        }

        // 外部表
        function renderExternalTable(table) {
            const optimized = getOptimizedTableData(table);

            let html = `<div class="external-table-container">`;
            html += `<h4 style="color: var(--error); margin-bottom: 15px;">🔗 外部表格式</h4>`;
            html += `<div class="external-indicator"><i class="fas fa-external-link-alt"></i> 外部數據源連接</div>`;
            html += `<div style="overflow-x: auto;">`;
            html += `<table class="data-table">`;
            html += `<thead><tr>`;
            optimized.columns.forEach(col => {
                html += `<th>${col}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            optimized.data.forEach(row => {
                html += `<tr>`;
                row.forEach(cell => {
                    html += `<td>${cell}</td>`;
                });
                html += `</tr>`;
            });
            html += `</tbody></table>`;

            if (optimized.hasMore) {
                html += `<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">`;
                html += `<i class="fas fa-info-circle"></i> 顯示前 ${optimized.maxRows} 筆，共 ${optimized.totalRows} 筆記錄`;
                html += `</div>`;
            }

            html += `</div></div>`;
            return html;
        }

        // 臨時表
        function renderTemporaryTable(table) {
            const optimized = getOptimizedTableData(table);

            let html = `<div class="temporary-table-container">`;
            html += `<div class="temp-indicator">⏱️ TEMP</div>`;
            html += `<h4 style="color: #9966ff; margin-bottom: 15px;">⏰ 臨時表格式</h4>`;
            html += `<div style="overflow-x: auto;">`;
            html += `<table class="data-table">`;
            html += `<thead><tr>`;
            optimized.columns.forEach(col => {
                html += `<th>${col}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            optimized.data.forEach(row => {
                html += `<tr>`;
                row.forEach(cell => {
                    html += `<td>${cell}</td>`;
                });
                html += `</tr>`;
            });
            html += `</tbody></table>`;

            if (optimized.hasMore) {
                html += `<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">`;
                html += `<i class="fas fa-info-circle"></i> 顯示前 ${optimized.maxRows} 筆，共 ${optimized.totalRows} 筆記錄`;
                html += `</div>`;
            }

            html += `</div></div>`;
            return html;
        }

        // 巢狀表
        function renderNestedTable(table) {
            const optimized = getOptimizedTableData(table);

            let html = `<div class="nested-table-container">`;
            html += `<h4 style="color: var(--accent); margin-bottom: 15px;">🌲 巢狀表格式</h4>`;

            // 每兩行創建   個巢狀結構
            for (let i = 0; i < optimized.data.length; i += 2) {
                html += `<div style="margin-bottom: 15px;">`;
                html += `<div class="nested-indicator">📁 父記錄</div>`;
                html += `<table class="data-table" style="margin-bottom: 10px;">`;
                html += `<thead><tr>`;
                optimized.columns.forEach(col => {
                    html += `<th>${col}</th>`;
                });
                html += `</tr></thead>`;
                html += `<tbody><tr>`;
                optimized.data[i].forEach(cell => {
                    html += `<td>${cell}</td>`;
                });
                html += `</tr></tbody></table>`;

                if (i + 1 < optimized.data.length) {
                    html += `<div class="nested-table">`;
                    html += `<div class="nested-indicator">└─ 子記錄</div>`;
                    html += `<table class="data-table">`;
                    html += `<thead><tr>`;
                    optimized.columns.forEach(col => {
                        html += `<th>${col}</th>`;
                    });
                    html += `</tr></thead>`;
                    html += `<tbody><tr>`;
                    optimized.data[i + 1].forEach(cell => {
                        html += `<td>${cell}</td>`;
                    });
                    html += `</tr></tbody></table>`;
                    html += `</div>`;
                }
                html += `</div>`;
            }

            if (optimized.hasMore) {
                html += `<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">`;
                html += `<i class="fas fa-info-circle"></i> 顯示前 ${optimized.maxRows} 筆，共 ${optimized.totalRows} 筆記錄`;
                html += `</div>`;
            }

            html += `</div>`;
            return html;
        }

        // 物件表
        function renderObjectTable(table) {
            const optimized = getOptimizedTableData(table);

            let html = `<div class="object-table-container">`;
            html += `<h4 style="color: var(--accent); margin-bottom: 15px;">📦 物件表格式</h4>`;

            optimized.data.forEach((row, idx) => {
                html += `<div style="margin-bottom: 20px; padding: 15px; background: rgba(0, 0, 0, 0.2); border-radius: 8px;">`;
                html += `<div style="font-weight: 600; color: var(--accent); margin-bottom: 10px;">物件 #${idx + 1}</div>`;
                row.forEach((cell, cellIdx) => {
                    html += `<div class="object-field">`;
                    html += `<span style="color: var(--warning);">${optimized.columns[cellIdx]}:</span> `;
                    html += `<span style="color: var(--text-primary);">${cell}</span>`;
                    html += `</div>`;
                });
                html += `</div>`;
            });

            if (optimized.hasMore) {
                html += `<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">`;
                html += `<i class="fas fa-info-circle"></i> 顯示前 ${optimized.maxRows} 筆，共 ${optimized.totalRows} 筆記錄`;
                html += `</div>`;
            }

            html += `</div>`;
            return html;
        }

        // 區塊鏈表
        function renderBlockchainTable(table) {
            const optimized = getOptimizedTableData(table);

            let html = `<div class="blockchain-table-container">`;
            html += `<h4 style="color: var(--secondary); margin-bottom: 15px;">⛓️ 區塊鏈表格式</h4>`;

            optimized.data.forEach((row, idx) => {
                // 生成簡單的哈希值
                const hash = 'Hash: 0x' + Math.random().toString(16).substr(2, 16);
                const prevHash = idx > 0 ? '0x' + Math.random().toString(16).substr(2, 16) : '0x0000000000000000';

                html += `<div class="blockchain-block">`;
                html += `<div style="font-weight: 600; color: var(--secondary); margin-bottom: 10px;">區塊 #${idx + 1}</div>`;
                html += `<table class="data-table">`;
                html += `<thead><tr>`;
                optimized.columns.forEach(col => {
                    html += `<th>${col}</th>`;
                });
                html += `</tr></thead>`;
                html += `<tbody><tr>`;
                row.forEach(cell => {
                    html += `<td>${cell}</td>`;
                });
                html += `</tr></tbody></table>`;
                html += `<div class="blockchain-hash">前一個區塊: ${prevHash}</div>`;
                html += `<div class="blockchain-hash">當前區塊: ${hash}</div>`;
                html += `</div>`;
            });

            if (optimized.hasMore) {
                html += `<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">`;
                html += `<i class="fas fa-info-circle"></i> 顯示前 ${optimized.maxRows} 筆，共 ${optimized.totalRows} 筆記錄`;
                html += `</div>`;
            }

            html += `</div>`;
            return html;
        }

        // 顯示資料表
        function showTables() {
            let html = `<h3>資料庫中的資料表</h3>`;
            html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">`;

            for (const tableName in currentDatabase) {
                const table = currentDatabase[tableName];
                html += `
                    <div class="card" style="padding: 20px; cursor: pointer;" onclick="document.getElementById('sqlInput').value='SELECT * FROM ${tableName};'; executeSQL();">
                        <h4><i class="fas fa-table"></i> ${tableName.toUpperCase()}</h4>
                        <p style="color: var(--text-secondary); margin-top: 10px;">欄位: ${table.columns.join(', ')}</p>
                        <p style="color: var(--text-muted); font-size: 14px;">${table.data.length} 筆記錄</p>
                    </div>
                `;
            }

            html += `</div>`;
            output.innerHTML = html;
        }

        // 顯示資料庫資訊
        function renderDatabaseInfo() {
            let html = `<h3 style="color: var(--accent); margin-bottom: 20px;"><i class="fas fa-database"></i> 資料庫完整資訊 (Oracle Database Objects)</h3>`;

            // 資料表 (Tables)
            html += `<div style="margin-bottom: 25px;">`;
            html += `<h4 style="color: var(--secondary); border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 15px;">
                <i class="fas fa-table"></i> 資料表 (Tables) - ${Object.keys(currentDatabase).length} 個
            </h4>`;
            html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">`;

            for (const tableName in currentDatabase) {
                const table = currentDatabase[tableName];
                html += `
                    <div class="card" style="padding: 15px; background: rgba(0,168,255,0.05);">
                        <h5 style="color: var(--accent); margin-bottom: 8px;"><i class="fas fa-table"></i> ${tableName}</h5>
                        <div style="color: var(--text-secondary); font-size: 13px;">
                            <div>欄位數: ${table.columns.length}</div>
                            <div>記錄數: ${table.data.length}</div>
                        </div>
                    </div>
                `;
            }
            html += `</div></div>`;

            // 視圖 (Views)
            const viewCount = Object.keys(databaseMetadata.views).length;
            if (viewCount > 0) {
                html += `<div style="margin-bottom: 25px;">`;
                html += `<h4 style="color: var(--secondary); border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 15px;">
                    <i class="fas fa-eye"></i> 視圖 (Views) - ${viewCount} 個
                </h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">`;
                for (const viewName in databaseMetadata.views) {
                    const view = databaseMetadata.views[viewName];
                    html += `
                        <div class="card" style="padding: 15px; background: rgba(0,204,136,0.05);">
                            <h5 style="color: var(--success);"><i class="fas fa-eye"></i> ${viewName}</h5>
                            <div style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">
                                查詢: ${view.query.substring(0, 50)}...
                            </div>
                        </div>
                    `;
                }
                html += `</div></div>`;
            }

            // 序列 (Sequences)
            const seqCount = Object.keys(databaseMetadata.sequences).length;
            if (seqCount > 0) {
                html += `<div style="margin-bottom: 25px;">`;
                html += `<h4 style="color: var(--secondary); border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 15px;">
                    <i class="fas fa-sort-numeric-up"></i> 序列 (Sequences) - ${seqCount} 個
                </h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">`;
                for (const seqName in databaseMetadata.sequences) {
                    const seq = databaseMetadata.sequences[seqName];
                    html += `
                        <div class="card" style="padding: 15px; background: rgba(255,204,0,0.05);">
                            <h5 style="color: var(--warning);"><i class="fas fa-sort-numeric-up"></i> ${seqName}</h5>
                            <div style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                                <div>當前值: ${seq.currentValue}</div>
                                <div>增量: ${seq.incrementBy}</div>
                            </div>
                        </div>
                    `;
                }
                html += `</div></div>`;
            }

            // 索引 (Indexes)
            const indexCount = Object.values(databaseMetadata.indexes).reduce((sum, tbl) => sum + Object.keys(tbl).length, 0);
            if (indexCount > 0) {
                html += `<div style="margin-bottom: 25px;">`;
                html += `<h4 style="color: var(--secondary); border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 15px;">
                    <i class="fas fa-search"></i> 索引 (Indexes) - ${indexCount} 個
                </h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">`;
                for (const tableName in databaseMetadata.indexes) {
                    for (const indexName in databaseMetadata.indexes[tableName]) {
                        const index = databaseMetadata.indexes[tableName][indexName];
                        html += `
                            <div class="card" style="padding: 15px; background: rgba(51,153,255,0.05);">
                                <h5 style="color: var(--info);"><i class="fas fa-search"></i> ${indexName}</h5>
                                <div style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                                    <div>表: ${tableName}</div>
                                    <div>欄位: ${index.columns.join(', ')}</div>
                                    <div>類型: ${index.type}</div>
                                </div>
                            </div>
                        `;
                    }
                }
                html += `</div></div>`;
            }

            // 存儲過程和函數 (Procedures & Functions)
            const procCount = Object.keys(databaseMetadata.procedures).length;
            if (procCount > 0) {
                html += `<div style="margin-bottom: 25px;">`;
                html += `<h4 style="color: var(--secondary); border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 15px;">
                    <i class="fas fa-code"></i> 存儲過程與函數 (Procedures & Functions) - ${procCount} 個
                </h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">`;
                for (const procName in databaseMetadata.procedures) {
                    const proc = databaseMetadata.procedures[procName];
                    html += `
                        <div class="card" style="padding: 15px; background: rgba(138,43,226,0.05);">
                            <h5 style="color: #8a2be2;"><i class="fas fa-code"></i> ${procName}</h5>
                            <div style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                                <div>類型: ${proc.type}</div>
                                ${proc.returnType ? `<div>返回: ${proc.returnType}</div>` : ''}
                            </div>
                        </div>
                    `;
                }
                html += `</div></div>`;
            }

            // 觸發器 (Triggers)
            const triggerCount = Object.values(databaseMetadata.triggers).reduce((sum, tbl) => sum + Object.keys(tbl).length, 0);
            if (triggerCount > 0) {
                html += `<div style="margin-bottom: 25px;">`;
                html += `<h4 style="color: var(--secondary); border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 15px;">
                    <i class="fas fa-bolt"></i> 觸發器 (Triggers) - ${triggerCount} 個
                </h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">`;
                for (const tableName in databaseMetadata.triggers) {
                    for (const trigName in databaseMetadata.triggers[tableName]) {
                        const trigger = databaseMetadata.triggers[tableName][trigName];
                        html += `
                            <div class="card" style="padding: 15px; background: rgba(255,99,71,0.05);">
                                <h5 style="color: #ff6347;"><i class="fas fa-bolt"></i> ${trigName}</h5>
                                <div style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                                    <div>表: ${tableName}</div>
                                    <div>時機: ${trigger.timing}</div>
                                    <div>事件: ${trigger.events.join(', ')}</div>
                                </div>
                            </div>
                        `;
                    }
                }
                html += `</div></div>`;
            }

            // 包 (Packages)
            const pkgCount = Object.keys(databaseMetadata.packages).length;
            if (pkgCount > 0) {
                html += `<div style="margin-bottom: 25px;">`;
                html += `<h4 style="color: var(--secondary); border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 15px;">
                    <i class="fas fa-box"></i> 包 (Packages) - ${pkgCount} 個
                </h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">`;
                for (const pkgName in databaseMetadata.packages) {
                    const pkg = databaseMetadata.packages[pkgName];
                    html += `
                        <div class="card" style="padding: 15px; background: rgba(255,165,0,0.05);">
                            <h5 style="color: #ffa500;"><i class="fas fa-box"></i> ${pkgName}</h5>
                            <div style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                                <div>類型: PACKAGE</div>
                            </div>
                        </div>
                    `;
                }
                html += `</div></div>`;
            }

            // 同義詞 (Synonyms)
            const synCount = Object.keys(databaseMetadata.synonyms).length;
            if (synCount > 0) {
                html += `<div style="margin-bottom: 25px;">`;
                html += `<h4 style="color: var(--secondary); border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 15px;">
                    <i class="fas fa-link"></i> 同義詞 (Synonyms) - ${synCount} 個
                </h4>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">`;
                for (const synName in databaseMetadata.synonyms) {
                    const syn = databaseMetadata.synonyms[synName];
                    html += `
                        <div class="card" style="padding: 15px; background: rgba(0,255,255,0.05);">
                            <h5 style="color: #00ffff;"><i class="fas fa-link"></i> ${synName}</h5>
                            <div style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                                <div>目標: ${syn.target}</div>
                                <div>類型: ${syn.isPublic ? 'PUBLIC' : 'PRIVATE'}</div>
                            </div>
                        </div>
                    `;
                }
                html += `</div></div>`;
            }

            return html;
        }

        // 更新表格預覽
        function updateTablePreview() {
            const previewContent = document.getElementById('tablePreviewContent');
            const previewBadge = document.getElementById('tablePreviewBadge');
            const previewTableName = document.getElementById('previewTableName');
            const previewContainer = document.getElementById('tablePreview');

            // 獲取所有表格，優先顯示有數據的表
            const tableEntries = Object.entries(currentDatabase);

            // 排序：有數據的表排在前面
            tableEntries.sort(([nameA, tableA], [nameB, tableB]) => {
                if (tableA.data.length > 0 && tableB.data.length === 0) return -1;
                if (tableA.data.length === 0 && tableB.data.length > 0) return 1;
                return 0;
            });

            // 選擇要顯示的表（有數據的表優先，否則顯示最後創建的表）
            let latestTable = null;
            let latestTableName = null;

            if (tableEntries.length > 0) {
                [latestTableName, latestTable] = tableEntries[0];
            }

            if (latestTable && latestTableName) {
                // 顯示表格預覽
                previewContainer.classList.add('has-data');
                previewBadge.style.display = 'flex';
                previewTableName.textContent = latestTableName.toUpperCase();

                let html = `
                    <div style="margin-bottom: 15px;">
                        <span class="table-info-badge">
                            <i class="fas fa-database"></i>
                            資料表名稱: ${latestTableName.toUpperCase()}
                        </span>
                        <span class="table-info-badge" style="margin-left: 10px;">
                            <i class="fas fa-columns"></i>
                            欄位數: ${latestTable.columns.length}
                        </span>
                        <span class="table-info-badge" style="margin-left: 10px; ${latestTable.data.length > 0 ? 'background: rgba(0, 204, 136, 0.15); color: var(--success);' : 'background: rgba(255, 204, 0, 0.15); color: var(--warning);'}">
                            <i class="fas fa-list"></i>
                            資料筆數: ${latestTable.data.length}
                        </span>
                        <span class="table-info-badge" style="margin-left: 10px; background: rgba(0, 168, 255, 0.15); color: var(--secondary);">
                            <i class="fas fa-layer-group"></i>
                            模型: ${dataModels[currentDataModel].name}
                        </span>
                    </div>
                `;

                // 根據當前數據模型選擇顯示格式
                html += renderTableByModel(latestTableName, latestTable, currentDataModel);

                previewContent.innerHTML = html;
            } else {
                // 沒有表格時顯示空狀態
                previewContainer.classList.remove('has-data');
                previewBadge.style.display = 'none';
                previewContent.innerHTML = `
                    <div class="table-preview-empty">
                        <i class="fas fa-inbox"></i>
                        <p>執行 CREATE TABLE 或 INSERT 語句後，這裡將顯示資料表的完成品預覽</p>
                        <p style="font-size: 0.9rem; margin-top: 10px; opacity: 0.7;">建議：先創建表格結構，再插入資料</p>
                    </div>
                `;
            }
        }

        // 根據不同數據模型渲染表格
        function renderTableByModel(tableName, table, modelId) {
            switch(modelId) {
                case 'relational':
                    return renderModelRelationalView(tableName, table);
                case 'json':
                            borderColor = '#ffd700';
                    return renderModelJSONView(tableName, table);
                case 'xml':
                    return renderModelXMLView(tableName, table);
                case 'graph':
                            borderColor = '#00ffcc';
                    return renderModelGraphView(tableName, table);
                case 'spatial':
                            borderColor = '#99ff00';
                    return renderModelSpatialView(tableName, table);
                case 'blockchain':
                    return renderModelBlockchainView(tableName, table);
                case 'keyvalue':
                            borderColor = '#bb99ff';
                    return renderModelKeyValueView(tableName, table);
                case 'timeseries':
                            borderColor = '#ff6699';
                    return renderModelTimeSeriesView(tableName, table);
                case 'fulltext':
                    return renderModelFullTextView(tableName, table);
                case 'object':
                    return renderModelObjectView(tableName, table);
                case 'semistructured':
                    return renderModelSemiStructuredView(tableName, table);
                case 'streaming':
                    return renderModelStreamingView(tableName, table);
                case 'inmemory':
                    return renderModelInMemoryView(tableName, table);
                case 'distributed':
                    return renderModelDistributedView(tableName, table);
                case 'multitenant':
                    return renderModelMultiTenantView(tableName, table);
                default:
                    return renderModelRelationalView(tableName, table);
            }
        }

        // 1. 關聯式模型 - 標準表格格式
        function renderModelRelationalView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<table class="preview-table" style="table-layout: auto; width: max-content; min-width: 100%;">`;

            html += `<thead><tr>`;
            html += `<th style="background: rgba(0, 168, 255, 0.2); text-align: center; min-width: 40px; width: 40px; font-weight: 700; position: sticky; left: 0; z-index: 10;">#</th>`;
            table.columns.forEach(col => {
                html += `<th style="min-width: 100px; white-space: nowrap; padding: 10px 8px;">${col.toUpperCase()}</th>`;
            });
            html += `</tr></thead>`;

            html += `<tbody>`;
            if (table.data.length > 0) {
                table.data.forEach((row, index) => {
                    html += `<tr>`;
                    html += `<td style="background: rgba(0, 168, 255, 0.05); text-align: center; font-weight: 600; color: var(--accent); position: sticky; left: 0; z-index: 9; padding: 8px 4px; width: 40px; min-width: 40px;">${index + 1}</td>`;
                    table.columns.forEach((col, colIndex) => {
                        const cellValue = row[colIndex];
                        let displayValue = cellValue === null || cellValue === undefined
                            ? '<span style="color: var(--text-muted); font-style: italic;">NULL</span>'
                            : String(cellValue);
                        html += `<td style="white-space: nowrap; padding: 8px;" title="${cellValue}">${displayValue}</td>`;
                    });
                    html += `</tr>`;
                });
            } else {
                html += `<tr><td colspan="${table.columns.length + 1}" style="text-align: center; color: var(--text-muted); padding: 20px; font-style: italic;">
                    <i class="fas fa-info-circle"></i> 資料表已創建，但尚未插入任何資料
                </td></tr>`;
            }
            html += `</tbody></table></div>`;
            return html;
        }

        // 2. JSON文件模型 - JSON格式化顯示
        function renderModelJSONView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;

            if (table.data.length > 0) {
                html += `<div style="background: rgba(16, 22, 36, 0.6); border-radius: 8px; padding: 15px; font-family: 'Courier New', monospace; font-size: 13px;">`;
                html += `<div style="color: var(--text-secondary); margin-bottom: 10px;"><i class="fas fa-code"></i> JSON 文檔視圖</div>`;
                html += `<pre style="color: var(--accent); line-height: 1.6; margin: 0;">[`;

                table.data.forEach((row, index) => {
                    const jsonObj = {};
                    table.columns.forEach((col, colIndex) => {
                        jsonObj[col] = row[colIndex];
                    });
                    const jsonStr = JSON.stringify(jsonObj, null, 2).split('\n').map(line => '  ' + line).join('\n');
                    html += `\n${jsonStr}${index < table.data.length - 1 ? ',' : ''}`;
                });

                html += `\n]</pre></div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無 JSON 文檔
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 3. 圖形資料庫 - 節點和邊的視覺化
        function renderModelGraphView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;

            if (tableName.toLowerCase().includes('node') || table.columns.some(col => col.toLowerCase().includes('type'))) {
                // 節點視圖
                html += `<div style="margin-bottom: 15px; color: var(--secondary);"><i class="fas fa-circle-nodes"></i> 節點視圖</div>`;
                html += `<div style="display: flex; flex-wrap: wrap; gap: 15px;">`;

                table.data.forEach((row, index) => {
                    html += `<div style="background: rgba(0, 168, 255, 0.1); border: 2px solid var(--secondary); border-radius: 50%; width: 120px; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px; text-align: center;">`;
                    html += `<div style="font-size: 24px; margin-bottom: 5px;">🔵</div>`;
                    html += `<div style="font-size: 12px; font-weight: 600; color: var(--text-primary);">${row[table.columns.indexOf('name')] || row[table.columns.indexOf('id')] || 'Node ' + (index + 1)}</div>`;
                    html += `<div style="font-size: 10px; color: var(--text-secondary);">${row[table.columns.indexOf('type')] || 'Node'}</div>`;
                    html += `</div>`;
                });

                html += `</div>`;
            } else if (tableName.toLowerCase().includes('edge') || table.columns.some(col => col.toLowerCase().includes('relationship'))) {
                // 邊視圖
                html += `<div style="margin-bottom: 15px; color: var(--accent);"><i class="fas fa-arrow-right-arrow-left"></i> 關係視圖</div>`;
                html += `<table class="preview-table" style="width: 100%;">`;
                html += `<thead><tr>`;
                html += `<th style="text-align: center; padding: 10px;">起始節點</th>`;
                html += `<th style="text-align: center; padding: 10px;">關係類型</th>`;
                html += `<th style="text-align: center; padding: 10px;">目標節點</th>`;
                html += `</tr></thead><tbody>`;

                table.data.forEach((row, index) => {
                    const fromIdx = table.columns.findIndex(col => col.toLowerCase().includes('from'));
                    const toIdx = table.columns.findIndex(col => col.toLowerCase().includes('to'));
                    const relIdx = table.columns.findIndex(col => col.toLowerCase().includes('relationship'));

                    html += `<tr>`;
                    html += `<td style="text-align: center; padding: 10px;"><div style="display: inline-block; background: rgba(0, 168, 255, 0.2); padding: 8px 15px; border-radius: 20px;">${row[fromIdx] || 'N/A'}</div></td>`;
                    html += `<td style="text-align: center; padding: 10px;"><i class="fas fa-arrow-right" style="color: var(--accent);"></i> ${row[relIdx] || 'LINK'}</td>`;
                    html += `<td style="text-align: center; padding: 10px;"><div style="display: inline-block; background: rgba(0, 255, 204, 0.2); padding: 8px 15px; border-radius: 20px;">${row[toIdx] || 'N/A'}</div></td>`;
                    html += `</tr>`;
                });

                html += `</tbody></table>`;
            } else {
                html += renderModelRelationalView(tableName, table);
            }

            html += `</div>`;
            return html;
        }

        // 4. 區塊鏈模型 - 區塊鏈格式
        function renderModelBlockchainView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: var(--accent);"><i class="fas fa-cubes"></i> 區塊鏈視圖（不可變記錄）</div>`;

            if (table.data.length > 0) {
                html += `<div style="display: flex; flex-direction: column; gap: 15px;">`;

                table.data.forEach((row, index) => {
                    html += `<div style="background: linear-gradient(135deg, rgba(0, 168, 255, 0.1), rgba(0, 255, 204, 0.1)); border: 2px solid var(--border-color); border-radius: 12px; padding: 15px; position: relative;">`;
                    html += `<div style="position: absolute; top: -12px; left: 15px; background: var(--card-bg); padding: 5px 15px; border-radius: 20px; border: 2px solid var(--accent); font-weight: 600; color: var(--accent);">區塊 #${index + 1}</div>`;
                    html += `<div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">`;

                    table.columns.forEach((col, colIndex) => {
                        html += `<div>`;
                        html += `<div style="font-size: 11px; color: var(--text-muted); margin-bottom: 3px;">${col.toUpperCase()}</div>`;
                        html += `<div style="font-size: 13px; color: var(--text-primary); font-weight: 500;">${row[colIndex] || 'N/A'}</div>`;
                        html += `</div>`;
                    });

                    html += `</div>`;
                    html += `<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0, 168, 255, 0.2); font-size: 11px; color: var(--text-muted);">`;
                    html += `<i class="fas fa-lock"></i> 此區塊已加密並鎖定，無法修改`;
                    html += `</div>`;
                    html += `</div>`;

                    if (index < table.data.length - 1) {
                        html += `<div style="text-align: center; color: var(--accent); font-size: 20px;"><i class="fas fa-link"></i></div>`;
                    }
                });

                html += `</div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無區塊記錄
                </div>`;
            }

            html += `</div>`;
            return html;
        }

        // 5. 空間資料模型 - 地圖式視圖
        function renderModelSpatialView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: var(--info);"><i class="fas fa-map-marked-alt"></i> 空間資料視圖</div>`;

            if (table.data.length > 0) {
                const hasLatLon = table.columns.some(col => col.toLowerCase().includes('lat')) &&
                                 table.columns.some(col => col.toLowerCase().includes('lon'));

                if (hasLatLon) {
                    // 地圖標記視圖
                    html += `<div style="background: rgba(16, 22, 36, 0.6); border-radius: 12px; padding: 20px; min-height: 200px; position: relative;">`;
                    html += `<div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;">`;

                    table.data.forEach((row, index) => {
                        const nameIdx = table.columns.findIndex(col => col.toLowerCase().includes('name'));
                        const latIdx = table.columns.findIndex(col => col.toLowerCase().includes('lat'));
                        const lonIdx = table.columns.findIndex(col => col.toLowerCase().includes('lon'));

                        html += `<div style="background: rgba(0, 168, 255, 0.15); border: 2px solid var(--info); border-radius: 12px; padding: 15px; min-width: 200px; text-align: center;">`;
                        html += `<div style="font-size: 32px; margin-bottom: 10px;">📍</div>`;
                        html += `<div style="font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">${row[nameIdx] || '位置 ' + (index + 1)}</div>`;
                        html += `<div style="font-size: 12px; color: var(--text-secondary);">`;
                        html += `<div>緯度: ${row[latIdx] || 'N/A'}°</div>`;
                        html += `<div>經度: ${row[lonIdx] || 'N/A'}°</div>`;
                        html += `</div>`;
                        html += `</div>`;
                    });

                    html += `</div></div>`;
                } else {
                    html += renderModelRelationalView(tableName, table);
                }
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無空間資料
                </div>`;
            }

            html += `</div>`;
            return html;
        }

        // 6. 時間序列模型 - 時間線視圖
        function renderModelTimeSeriesView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: var(--success);"><i class="fas fa-chart-line"></i> 時間序列視圖</div>`;

            if (table.data.length > 0) {
                const timestampIdx = table.columns.findIndex(col =>
                    col.toLowerCase().includes('time') || col.toLowerCase().includes('date')
                );

                html += `<div style="background: rgba(16, 22, 36, 0.6); border-radius: 12px; padding: 20px;">`;
                html += `<div style="position: relative; padding-left: 40px;">`;

                table.data.forEach((row, index) => {
                    html += `<div style="position: relative; margin-bottom: 25px; padding-left: 25px; border-left: 3px solid var(--success);">`;
                    html += `<div style="position: absolute; left: -9px; top: 5px; width: 15px; height: 15px; background: var(--success); border-radius: 50%; box-shadow: 0 0 10px var(--success);"></div>`;

                    html += `<div style="background: rgba(0, 204, 136, 0.1); border: 1px solid rgba(0, 204, 136, 0.3); border-radius: 8px; padding: 12px;">`;
                    html += `<div style="font-size: 11px; color: var(--success); margin-bottom: 8px; font-weight: 600;">`;
                    html += `<i class="fas fa-clock"></i> ${timestampIdx >= 0 ? row[timestampIdx] : '時間點 ' + (index + 1)}`;
                    html += `</div>`;

                    html += `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">`;
                    table.columns.forEach((col, colIdx) => {
                        if (colIdx !== timestampIdx) {
                            html += `<div>`;
                            html += `<div style="font-size: 10px; color: var(--text-muted);">${col.toUpperCase()}</div>`;
                            html += `<div style="font-size: 14px; color: var(--text-primary); font-weight: 500;">${row[colIdx] || 'N/A'}</div>`;
                            html += `</div>`;
                        }
                    });
                    html += `</div>`;
                    html += `</div>`;
                    html += `</div>`;
                });

                html += `</div></div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無時間序列資料
                </div>`;
            }

            html += `</div>`;
            return html;
        }

        // 7. XML模型 - XML格式化顯示
        function renderModelXMLView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;

            if (table.data.length > 0) {
                html += `<div style="background: rgba(16, 22, 36, 0.6); border-radius: 8px; padding: 15px; font-family: 'Courier New', monospace; font-size: 13px;">`;
                html += `<div style="color: var(--text-secondary); margin-bottom: 10px;"><i class="fas fa-code"></i> XML 文檔視圖</div>`;
                html += `<pre style="color: var(--accent); line-height: 1.6; margin: 0;">&lt;documents&gt;`;

                table.data.forEach((row, index) => {
                    html += `\n  &lt;document id="${index + 1}"&gt;`;
                    table.columns.forEach((col, colIndex) => {
                        const value = row[colIndex] || '';
                        html += `\n    &lt;${col}&gt;${value}&lt;/${col}&gt;`;
                    });
                    html += `\n  &lt;/document&gt;`;
                });

                html += `\n&lt;/documents&gt;</pre></div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無 XML 文檔
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 8. 鍵值儲存 - 鍵值對顯示
        function renderModelKeyValueView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: var(--warning);"><i class="fas fa-key"></i> 鍵值對視圖</div>`;

            if (table.data.length > 0) {
                html += `<div style="display: grid; gap: 10px;">`;
                table.data.forEach((row, index) => {
                    html += `<div style="background: rgba(255, 204, 0, 0.1); border-left: 4px solid var(--warning); border-radius: 8px; padding: 12px;">`;
                    html += `<div style="display: flex; align-items: center; gap: 15px;">`;
                    html += `<div style="flex: 0 0 auto; font-weight: 600; color: var(--warning);">`;
                    html += `<i class="fas fa-key" style="margin-right: 8px;"></i>${row[0] || 'key'}`;
                    html += `</div>`;
                    html += `<div style="flex: 0 0 auto; color: var(--text-muted);">→</div>`;
                    html += `<div style="flex: 1; color: var(--text-primary); font-family: 'Courier New', monospace;">`;
                    html += `${row[1] || 'value'}`;
                    html += `</div></div></div>`;
                });
                html += `</div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無鍵值對
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 9. 全文搜尋 - 文檔列表顯示
        function renderModelFullTextView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: var(--accent);"><i class="fas fa-search"></i> 全文檢索視圖</div>`;

            if (table.data.length > 0) {
                html += `<div style="display: grid; gap: 15px;">`;
                table.data.forEach((row, index) => {
                    html += `<div style="background: rgba(0, 168, 255, 0.1); border: 1px solid rgba(0, 168, 255, 0.3); border-radius: 12px; padding: 15px;">`;
                    html += `<div style="display: flex; align-items: center; margin-bottom: 10px;">`;
                    html += `<span style="background: var(--gradient-primary); padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">文檔 #${index + 1}</span>`;
                    html += `</div>`;
                    table.columns.forEach((col, colIdx) => {
                        html += `<div style="margin-bottom: 8px;">`;
                        html += `<span style="color: var(--text-muted); font-size: 0.9rem;">${col.toUpperCase()}: </span>`;
                        html += `<span style="color: var(--text-primary);">${row[colIdx] || 'N/A'}</span>`;
                        html += `</div>`;
                    });
                    html += `</div>`;
                });
                html += `</div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無文檔資料
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 10. 物件關聯模型 - 物件顯示
        function renderModelObjectView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: #9b59b6;"><i class="fas fa-cube"></i> 物件視圖</div>`;

            if (table.data.length > 0) {
                html += `<div style="display: grid; gap: 15px;">`;
                table.data.forEach((row, index) => {
                    html += `<div style="background: rgba(155, 89, 182, 0.1); border: 2px solid rgba(155, 89, 182, 0.3); border-radius: 12px; padding: 15px;">`;
                    html += `<div style="font-weight: 600; color: #9b59b6; margin-bottom: 12px; font-size: 1.1rem;">`;
                    html += `<i class="fas fa-box"></i> Object #${index + 1}`;
                    html += `</div>`;
                    html += `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">`;
                    table.columns.forEach((col, colIdx) => {
                        html += `<div style="background: rgba(155, 89, 182, 0.05); padding: 10px; border-radius: 6px;">`;
                        html += `<div style="color: var(--text-muted); font-size: 0.85rem;">${col}</div>`;
                        html += `<div style="color: var(--text-primary); font-weight: 500; margin-top: 5px;">${row[colIdx] || 'null'}</div>`;
                        html += `</div>`;
                    });
                    html += `</div></div>`;
                });
                html += `</div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無物件資料
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 11. 、結構化資料 - 混合格式顯示
        function renderModelSemiStructuredView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: #e67e22;"><i class="fas fa-random"></i> 半結構化視圖</div>`;

            if (table.data.length > 0) {
                html += `<div style="display: grid; gap: 12px;">`;
                table.data.forEach((row, index) => {
                    html += `<div style="background: rgba(230, 126, 34, 0.1); border-left: 4px solid #e67e22; border-radius: 8px; padding: 12px;">`;
                    html += `<div style="font-family: 'Courier New', monospace; font-size: 0.9rem; color: var(--text-primary);">`;
                    const dataObj = {};
                    table.columns.forEach((col, colIdx) => {
                        dataObj[col] = row[colIdx];
                    });
                    html += `<pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">${JSON.stringify(dataObj, null, 2)}</pre>`;
                    html += `</div></div>`;
                });
                html += `</div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無半結構化資料
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 12. 流資料處理 - 事件流顯示
        function renderModelStreamingView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: #3498db;"><i class="fas fa-stream"></i> 事件流視圖</div>`;

            if (table.data.length > 0) {
                html += `<div style="background: rgba(52, 152, 219, 0.05); border-radius: 12px; padding: 15px;">`;
                table.data.forEach((row, index) => {
                    html += `<div style="display: flex; align-items: center; margin-bottom: 12px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 8px; border-left: 3px solid #3498db;">`;
                    html += `<div style="flex: 0 0 auto; margin-right: 15px;">`;
                    html += `<div style="width: 40px; height: 40px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);">${index + 1}</div>`;
                    html += `</div>`;
                    html += `<div style="flex: 1;">`;
                    table.columns.forEach((col, colIdx) => {
                        if (colIdx < 3) {
                            html += `<span style="margin-right: 15px;"><span style="color: var(--text-muted); font-size: 0.85rem;">${col}:</span> <span style="color: var(--text-primary); font-weight: 500;">${row[colIdx] || 'N/A'}</span></span>`;
                        }
                    });
                    html += `</div></div>`;
                });
                html += `</div>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無事件流資料
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 13. 記憶體資料庫 - 高速快取視圖
        function renderModelInMemoryView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: #f39c12;"><i class="fas fa-bolt"></i> 記憶體快取視圖 <span style="background: rgba(243, 156, 18, 0.2); padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; margin-left: 8px;">⚡ 高速</span></div>`;

            if (table.data.length > 0) {
                html += `<table class="preview-table" style="table-layout: auto; width: 100%;">`;
                html += `<thead><tr style="background: rgba(243, 156, 18, 0.2);">`;
                html += `<th style="min-width: 40px; width: 40px;">#</th>`;
                table.columns.forEach(col => {
                    html += `<th style="min-width: 100px;">${col.toUpperCase()}</th>`;
                });
                html += `<th style="min-width: 80px;"><i class="fas fa-tachometer-alt"></i> 狀態</th>`;
                html += `</tr></thead><tbody>`;

                table.data.forEach((row, index) => {
                    html += `<tr>`;
                    html += `<td style="text-align: center; font-weight: 600; color: #f39c12;">${index + 1}</td>`;
                    table.columns.forEach((col, colIdx) => {
                        html += `<td>${row[colIdx] || 'NULL'}</td>`;
                    });
                    html += `<td style="text-align: center;"><span style="background: rgba(0, 204, 136, 0.2); color: var(--success); padding: 3px 8px; border-radius: 4px; font-size: 0.85rem;">已快、</span></td>`;
                    html += `</tr>`;
                });
                html += `</tbody></table>`;
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 快取中尚無資料
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 14. 分佈式資料 - 分片顯示
        function renderModelDistributedView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: #16a085;"><i class="fas fa-server"></i> 分佈式分片視圖</div>`;

            if (table.data.length > 0) {
                const regionIdx = table.columns.findIndex(col => col.toLowerCase().includes('region') || col.toLowerCase().includes('shard'));
                const regions = {};

                table.data.forEach((row, index) => {
                    const region = regionIdx >= 0 ? row[regionIdx] : 'Default';
                    if (!regions[region]) regions[region] = [];
                    regions[region].push({row, index});
                });

                Object.keys(regions).forEach(region => {
                    html += `<div style="margin-bottom: 20px; background: rgba(22, 160, 133, 0.1); border: 2px solid rgba(22, 160, 133, 0.3); border-radius: 12px; padding: 15px;">`;
                    html += `<div style="font-weight: 600; color: #16a085; margin-bottom: 10px; font-size: 1.05rem;">`;
                    html += `<i class="fas fa-hdd"></i> 分片區域: ${region} <span style="background: rgba(22, 160, 133, 0.2); padding: 2px 8px; border-radius: 4px; font-size: 0.85rem; margin-left: 8px;">${regions[region].length} 筆</span>`;
                    html += `</div>`;

                    html += `<table class="preview-table" style="width: 100%;">`;
                    html += `<thead><tr>`;
                    table.columns.forEach(col => {
                        html += `<th>${col.toUpperCase()}</th>`;
                    });
                    html += `</tr></thead><tbody>`;

                    regions[region].forEach(({row}) => {
                        html += `<tr>`;
                        table.columns.forEach((col, colIdx) => {
                            html += `<td>${row[colIdx] || 'NULL'}</td>`;
                        });
                        html += `</tr>`;
                    });
                    html += `</tbody></table></div>`;
                });
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無分佈式資料
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 15. 多租戶模型 - 租戶分組顯示
        function renderModelMultiTenantView(tableName, table) {
            let html = `<div style="overflow-x: auto; max-width: 100%; -webkit-overflow-scrolling: touch;">`;
            html += `<div style="margin-bottom: 15px; color: #8e44ad;"><i class="fas fa-building"></i> 多租戶視圖</div>`;

            if (table.data.length > 0) {
                const tenantIdx = table.columns.findIndex(col => col.toLowerCase().includes('tenant'));
                const tenants = {};

                table.data.forEach((row, index) => {
                    const tenant = tenantIdx >= 0 ? row[tenantIdx] : 'Tenant ' + (index + 1);
                    if (!tenants[tenant]) tenants[tenant] = [];
                    tenants[tenant].push({row, index});
                });

                Object.keys(tenants).forEach(tenant => {
                    html += `<div style="margin-bottom: 20px; background: rgba(142, 68, 173, 0.1); border: 2px solid rgba(142, 68, 173, 0.3); border-radius: 12px; padding: 15px;">`;
                    html += `<div style="font-weight: 600; color: #8e44ad; margin-bottom: 10px; font-size: 1.05rem;">`;
                    html += `<i class="fas fa-users"></i> 租戶: ${tenant} <span style="background: rgba(142, 68, 173, 0.2); padding: 2px 8px; border-radius: 4px; font-size: 0.85rem; margin-left: 8px;">${tenants[tenant].length} 筆資料</span>`;
                    html += `</div>`;

                    tenants[tenant].forEach(({row, index}) => {
                        html += `<div style="background: rgba(142, 68, 173, 0.05); padding: 10px; border-radius: 6px; margin-bottom: 8px;">`;
                        table.columns.forEach((col, colIdx) => {
                            if (colIdx !== tenantIdx) {
                                html += `<span style="margin-right: 15px;"><span style="color: var(--text-muted); font-size: 0.85rem;">${col}:</span> <span style="color: var(--text-primary);">${row[colIdx] || 'N/A'}</span></span>`;
                            }
                        });
                        html += `</div>`;
                    });
                    html += `</div>`;
                });
            } else {
                html += `<div style="text-align: center; color: var(--text-muted); padding: 20px;">
                    <i class="fas fa-info-circle"></i> 尚無租戶資料
                </div>`;
            }
            html += `</div>`;
            return html;
        }

        // 創建訊息元素
        function createMessage(text, type) {
            const icons = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle'
            };

            // 將換行符轉換為 <br> 標籤以支援多行顯示
            const formattedText = text.replace(/\n/g, '<br>');

            return `
                <div class="message message-${type}">
                    <i class="${icons[type]} message-icon"></i>
                    <div>${formattedText}</div>
                </div>
            `;
        }

        // 所有儲存功能
        function saveAllData() {
            savedData = {
                user: currentUser,
                databaseName: currentDatabaseName,
                database: JSON.parse(JSON.stringify(currentDatabase)),
                executionHistory: [...executionHistory],
                mode: currentMode,
                timestamp: new Date().toISOString(),
                sqlInput: sqlInput.value
            };

            showMessage('✅ 所有資料已成功儲存！ All Data Saved Successfully!\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n💾 已儲存內容 SAVED CONTENTS\n━━━━━━━━━━━━━━━━━、━━━━━━━━━━━━\n\n✓ 資料庫結構 Database Structure\n✓ 所有資料表及資料 All Tables & Data\n✓ SQL執行歷史 SQL Execution History\n✓ 當前工作狀態 Current Working State\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n⚠️ 重要提醒 IMPORTANT NOTICE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n❌ 資料儲存於瀏覽器記憶體中\n   Data is stored in browser memory\n\n❌ 關閉分頁後將會遺失\n   Will be lost when tab is closed\n\n✅ 建議立即使用「匯出報告」功能\n   Recommend using "Export Report" immediately\n\n✅ 匯出的PDF可永久保存到、置\n   Exported PDF will be saved permanently\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   ', 'success');

            // 視覺反饋
            const btn = document.getElementById('saveAllBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> 已儲存';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        // 創建文字圖片（支持中文）的輔助函數
        function createTextImage(text, options = {}) {
            const {
                fontSize = 16,
                fontFamily = 'Arial, "Microsoft YaHei", "微軟正黑體", sans-serif',
                color = '#000000',
                backgroundColor = 'transparent',
                padding = 10,
                maxWidth = 600
            } = options;

            // 創建臨時 canvas
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // 設置字體
            ctx.font = `${fontSize}px ${fontFamily}`;

            // 測量文字寬度並處理換行
            const lines = [];
            const words = text.split('');
            let currentLine = '';

            for (let char of words) {
                const testLine = currentLine + char;
                const metrics = ctx.measureText(testLine);

                if (metrics.width > maxWidth && currentLine.length > 0) {
                    lines.push(currentLine);
                    currentLine = char;
                } else {
                    currentLine = testLine;
                }
            }
            if (currentLine) {
                lines.push(currentLine);
            }

            // 計算 canvas 尺寸
            const lineHeight = fontSize * 1.2;
            const canvasWidth = maxWidth + padding * 2;
            const canvasHeight = lines.length * lineHeight + padding * 2;

            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            // 重新設置字體（canvas 尺寸改變會重置樣式）
            ctx.font = `${fontSize}px ${fontFamily}`;
            ctx.textBaseline = 'top';

            // 背景
            if (backgroundColor !== 'transparent') {
                ctx.fillStyle = backgroundColor;
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            }

            // 繪製文字
            ctx.fillStyle = color;
            lines.forEach((line, index) => {
                ctx.fillText(line, padding, padding + index * lineHeight);
            });

            return {
                dataUrl: canvas.toDataURL('image/png'),
                width: canvasWidth,
                height: canvasHeight
            };
        }

        // 匯出資料功能
async function exportData() {
            if (Object.keys(currentDatabase).length === 0) {
                showMessage('❌ 目前沒有可匯出的資料，請先執行一些 SQL 語句創建資料表\n❌ No data to export. Please execute SQL statements to create tables first.', 'error');
                return;
            }

            try {
                // 顯示處理中訊息
                output.innerHTML = createMessage('⏳ 正在生成專業PDF報告... Generating Professional PDF Report...', 'info');

                // 使用 jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4',
                    compress: true
                });

                const timestamp = new Date().toLocaleString('zh-TW', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                let yPos = 20;

                // 專業深色科技主題標題區域
                const titleCanvas = document.createElement('canvas');
                const titleCtx = titleCanvas.getContext('2d');
                titleCanvas.width = 1600;
                titleCanvas.height = 520;

                // 深色漸層背景
                const gradient = titleCtx.createLinearGradient(0, 0, 1600, 520);
                gradient.addColorStop(0, '#0a0e27');
                gradient.addColorStop(0.5, '#1a1f3a');
                gradient.addColorStop(1, '#0f1420');
                titleCtx.fillStyle = gradient;
                titleCtx.fillRect(0, 0, 1600, 520);

                // 科技感裝飾線條
                titleCtx.strokeStyle = '#00a8ff';
                titleCtx.lineWidth = 3;
                titleCtx.beginPath();
                titleCtx.moveTo(0, 0);
                titleCtx.lineTo(1600, 0);
                titleCtx.stroke();

                titleCtx.strokeStyle = '#00ffcc';
                titleCtx.lineWidth = 2;
                titleCtx.beginPath();
                titleCtx.moveTo(0, 515);
                titleCtx.lineTo(1600, 515);
                titleCtx.stroke();

                // 左側裝飾條
                const sideGradient = titleCtx.createLinearGradient(0, 0, 0, 520);
                sideGradient.addColorStop(0, '#00a8ff');
                sideGradient.addColorStop(1, '#00ffcc');
                titleCtx.fillStyle = sideGradient;
                titleCtx.fillRect(0, 0, 8, 520);

                // 主標題 - 科技感字體
                titleCtx.shadowColor = 'rgba(0, 168, 255, 0.8)';
                titleCtx.shadowBlur = 20;
                titleCtx.fillStyle = '#00ffcc';
                titleCtx.font = 'bold 72px "Segoe UI", "Microsoft YaHei", Arial, sans-serif';
                titleCtx.textAlign = 'center';
                titleCtx.textBaseline = 'top';
                titleCtx.fillText('數據庫訓練報告', 800, 40);

                titleCtx.fillStyle = '#ffffff';
                titleCtx.font = 'bold 56px "Segoe UI", Arial, sans-serif';
                titleCtx.fillText('DATABASE TRAINING REPORT', 800, 120);
                titleCtx.shadowBlur = 0;

                // 詳細資訊區域 - 左對齊
                titleCtx.textAlign = 'left';
                titleCtx.font = 'bold 28px "Microsoft YaHei", Arial, sans-serif';
                const modelInfo = dataModels[currentDataModel];

                // 使用不同顏色標示關鍵資訊
                let infoY = 230;
                const lineHeight = 50;

                // 資料庫名稱
                titleCtx.fillStyle = '#00a8ff';
                titleCtx.fillText('資料庫 DATABASE:', 80, infoY);
                titleCtx.fillStyle = '#ffffff';
                titleCtx.font = '28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillText(currentDatabaseName, 380, infoY);

                // 使用者
                infoY += lineHeight;
                titleCtx.font = 'bold 28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillStyle = '#00a8ff';
                titleCtx.fillText('使用者 USER:', 80, infoY);
                titleCtx.fillStyle = '#ffffff';
                titleCtx.font = '28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillText(currentUser, 380, infoY);

                // 模式
                infoY += lineHeight;
                titleCtx.font = 'bold 28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillStyle = '#00a8ff';
                titleCtx.fillText('模式 MODE:', 80, infoY);
                titleCtx.fillStyle = '#00ffcc';
                titleCtx.font = '28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillText(currentMode === 'free' ? '自由練習 Free Practice' : '訓練模式 Training Mode', 380, infoY);

                // 數據模型
                infoY += lineHeight;
                titleCtx.font = 'bold 28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillStyle = '#00a8ff';
                titleCtx.fillText('數據模型 DATA MODEL:', 80, infoY);
                titleCtx.fillStyle = '#ffffff';
                titleCtx.font = '28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillText(`${modelInfo.icon} ${modelInfo.name} (${modelInfo.category})`, 380, infoY);

                // 匯出時間
                infoY += lineHeight;
                titleCtx.font = 'bold 28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillStyle = '#00a8ff';
                titleCtx.fillText('匯出時間 EXPORT TIME:', 80, infoY);
                titleCtx.fillStyle = '#ffffff';
                titleCtx.font = '28px "Microsoft YaHei", Arial, sans-serif';
                titleCtx.fillText(timestamp, 380, infoY);

                // 將標題 canvas 轉為圖片並添加到 PDF
                const titleImage = titleCanvas.toDataURL('image/png');
                doc.addImage(titleImage, 'PNG', 0, 0, 210, 68);

                yPos = 78;

                // 統計摘要區域（深色科技主題）
                const statsCanvas = document.createElement('canvas');
                const statsCtx = statsCanvas.getContext('2d');
                statsCanvas.width = 1600;
                statsCanvas.height = 180;

                // 深色背景
                statsCtx.fillStyle = '#1a1f3a';
                statsCtx.fillRect(0, 0, 1600, 180);

                // 邊框
                statsCtx.strokeStyle = '#00a8ff';
                statsCtx.lineWidth = 2;
                statsCtx.strokeRect(0, 0, 1600, 180);

                // 標題
                statsCtx.fillStyle = '#00ffcc';
                statsCtx.font = 'bold 36px "Microsoft YaHei", Arial, sans-serif';
                statsCtx.textAlign = 'left';
                statsCtx.fillText('📊 統計摘要 STATISTICS SUMMARY', 30, 45);

                // 統計資訊
                const tableCount = Object.keys(currentDatabase).length;
                let totalRows = 0;
                let totalColumns = 0;
                for (const tableName in currentDatabase) {
                    totalRows += currentDatabase[tableName].data.length;
                    totalColumns += currentDatabase[tableName].columns.length;
                }

                statsCtx.font = 'bold 28px "Microsoft YaHei", Arial, sans-serif';
                statsCtx.fillStyle = '#ffffff';

                const stats = [
                    `資料表數量 Tables: ${tableCount}`,
                    `總資料筆數 Total Rows: ${totalRows}`,
                    `總欄位數 Total Columns: ${totalColumns}`,
                    `執行命令 Commands: ${executionHistory.length}`
                ];

                statsCtx.textAlign = 'left';
                let statsX = 30;
                stats.forEach((stat, index) => {
                    statsCtx.fillStyle = '#00a8ff';
                    statsCtx.fillText('▶', statsX, 100);
                    statsCtx.fillStyle = '#ffffff';
                    statsCtx.fillText(stat, statsX + 40, 100);
                    if (index === 1) {
                        statsX = 30;
                        statsCtx.fillText('▶', statsX, 140);
                        statsCtx.fillStyle = '#ffffff';
                        statsCtx.fillText(stats[2], statsX + 40, 140);
                        statsX = 800;
                        statsCtx.fillStyle = '#00a8ff';
                        statsCtx.fillText('▶', statsX, 140);
                        statsCtx.fillStyle = '#ffffff';
                        statsCtx.fillText(stats[3], statsX + 40, 140);
                    } else if (index === 0) {
                        statsX = 800;
                    }
                });

                const statsImage = statsCanvas.toDataURL('image/png');
                doc.addImage(statsImage, 'PNG', 10, yPos, 190, 23);
                yPos += 28;

                // 資料表預覽標題（深色科技主題）
                const sectionTitleCanvas = document.createElement('canvas');
                const sectionTitleCtx = sectionTitleCanvas.getContext('2d');
                sectionTitleCanvas.width = 1600;
                sectionTitleCanvas.height = 100;

                // 漸層背景
                const secGradient = sectionTitleCtx.createLinearGradient(0, 0, 1600, 0);
                secGradient.addColorStop(0, '#0a0e27');
                secGradient.addColorStop(1, '#1a1f3a');
                sectionTitleCtx.fillStyle = secGradient;
                sectionTitleCtx.fillRect(0, 0, 1600, 100);

                // 左側裝飾條
                sectionTitleCtx.fillStyle = '#00ffcc';
                sectionTitleCtx.fillRect(0, 0, 8, 100);

                sectionTitleCtx.font = 'bold 48px "Microsoft YaHei", Arial, sans-serif';
                sectionTitleCtx.fillStyle = '#00ffcc';
                sectionTitleCtx.textBaseline = 'middle';
                sectionTitleCtx.textAlign = 'left';
                sectionTitleCtx.fillText('🗄️ 資料表預覽', 30, 35);
                sectionTitleCtx.fillStyle = '#ffffff';
                sectionTitleCtx.font = 'bold 36px "Segoe UI", Arial, sans-serif';
                sectionTitleCtx.fillText('TABLE PREVIEW', 30, 75);

                const sectionTitleImage = sectionTitleCanvas.toDataURL('image/png');
                doc.addImage(sectionTitleImage, 'PNG', 10, yPos, 190, 13);
                yPos += 18;

                // 為每個資料表生成表格
                for (const tableName in currentDatabase) {
                    const table = currentDatabase[tableName];

                    // 檢查是否需要換頁
                    if (yPos > 240) {
                        doc.addPage();
                        yPos = 20;
                    }

                    // 表格標題區域（深色科技主題）
                    const tableHeaderCanvas = document.createElement('canvas');
                    const tableHeaderCtx = tableHeaderCanvas.getContext('2d');
                    tableHeaderCanvas.width = 1600;
                    tableHeaderCanvas.height = 120;

                    // 深色漸層背景
                    const tableGradient = tableHeaderCtx.createLinearGradient(0, 0, 1600, 120);
                    tableGradient.addColorStop(0, '#1a1f3a');
                    tableGradient.addColorStop(1, '#0f1420');
                    tableHeaderCtx.fillStyle = tableGradient;
                    tableHeaderCtx.fillRect(0, 0, 1600, 120);

                    // 左側裝飾條
                    tableHeaderCtx.fillStyle = '#00a8ff';
                    tableHeaderCtx.fillRect(0, 0, 6, 120);

                    // 表格圖標和名稱
                    tableHeaderCtx.font = 'bold 36px "Microsoft YaHei", Arial, sans-serif';
                    tableHeaderCtx.fillStyle = '#00ffcc';
                    tableHeaderCtx.textBaseline = 'top';
                    tableHeaderCtx.textAlign = 'left';
                    tableHeaderCtx.fillText(`📋 資料表 TABLE: ${tableName}`, 20, 15);

                    // 資料表詳細資訊（中英對照）
                    tableHeaderCtx.font = '22px "Microsoft YaHei", Arial, sans-serif';
                    tableHeaderCtx.fillStyle = '#ffffff';
                    const tableStats = `欄位 Columns: ${table.columns.length} | 資料筆數 Rows: ${table.data.length} | 模型 Model: ${modelInfo.icon} ${modelInfo.name}`;
                    tableHeaderCtx.fillText(tableStats, 20, 65);

                    const tableHeaderImage = tableHeaderCanvas.toDataURL('image/png');
                    doc.addImage(tableHeaderImage, 'PNG', 10, yPos, 190, 15);
                    yPos += 17;

                    // 使用 canvas 渲染表格以支持中文
                    const tableCanvas = document.createElement('canvas');
                    const tableCtx = tableCanvas.getContext('2d');

                    // 根據數據模型決定表格樣式
                    let headerColor = '#00a8ff'; // 默認科技藍
                    let headerBgColor = '#1a2332'; // 深色背景
                    let cellBgColor = '#0f1420'; // 更深的單元格背景
                    let cellAltBgColor = '#1a1f3a'; // 交替行背景
                    let borderColor = '#00a8ff'; // 邊框顏色

                    // 根據不同數據模型調整樣式
                    switch(currentDataModel) {
                        case 'blockchain':
                            headerColor = '#00d4ff';
                            borderColor = '#00d4ff';
                            break;
                        case 'graph':
                            headerColor = '#00ffcc';
                            borderColor = '#00ffcc';
                            break;
                        case 'json':
                            headerColor = '#ffd700';
                            borderColor = '#ffd700';
                            break;
                        case 'timeseries':
                            headerColor = '#ff6699';
                            borderColor = '#ff6699';
                            break;
                        case 'spatial':
                            headerColor = '#99ff00';
                            borderColor = '#99ff00';
                            break;
                        case 'keyvalue':
                            headerColor = '#bb99ff';
                            borderColor = '#bb99ff';
                            break;
                    }

                    // 計算表格尺寸（優化以適應更多內容）
                    const cellPadding = 10;
                    const headerHeight = 38;
                    const rowHeight = 30;
                    const colWidth = Math.min(150, 1400 / table.columns.length);

                    const tableWidth = colWidth * table.columns.length;
                    const tableHeight = headerHeight + (table.data.length * rowHeight);

                    tableCanvas.width = tableWidth;
                    tableCanvas.height = tableHeight;

                    tableCtx.font = '16px "Microsoft YaHei", Arial, sans-serif';

                    let currentY = 0;

                    // 繪製表頭（深色科技主題）
                    const headerGradient = tableCtx.createLinearGradient(0, currentY, 0, currentY + headerHeight);
                    headerGradient.addColorStop(0, headerBgColor);
                    headerGradient.addColorStop(1, '#0a0e17');
                    tableCtx.fillStyle = headerGradient;
                    tableCtx.fillRect(0, currentY, tableWidth, headerHeight);

                    // 表頭發光邊框
                    tableCtx.strokeStyle = borderColor;
                    tableCtx.lineWidth = 2;
                    tableCtx.strokeRect(0, currentY, tableWidth, headerHeight);

                    tableCtx.fillStyle = headerColor;
                    tableCtx.textBaseline = 'middle';
                    tableCtx.font = 'bold 18px "Microsoft YaHei", Arial, sans-serif';

                    table.columns.forEach((col, i) => {
                        const text = String(col);
                        const x = i * colWidth + cellPadding;
                        const y = currentY + headerHeight / 2;

                        // 列分隔線
                        if (i > 0) {
                            tableCtx.strokeStyle = borderColor;
                            tableCtx.globalAlpha = 0.3;
                            tableCtx.beginPath();
                            tableCtx.moveTo(i * colWidth, currentY);
                            tableCtx.lineTo(i * colWidth, currentY + headerHeight);
                            tableCtx.stroke();
                            tableCtx.globalAlpha = 1.0;
                        }

                        tableCtx.fillStyle = headerColor;
                        tableCtx.fillText(text, x, y, colWidth - cellPadding * 2);
                    });

                    currentY += headerHeight;

                    //    製資料行（深色科技主題）
                    tableCtx.font = '16px "Microsoft YaHei", Arial, sans-serif';
                    table.data.forEach((row, rowIndex) => {
                        const yStart = currentY + (rowIndex * rowHeight);

                        // 深色背景（交替行）
                        tableCtx.fillStyle = rowIndex % 2 === 0 ? cellBgColor : cellAltBgColor;
                        tableCtx.fillRect(0, yStart, tableWidth, rowHeight);

                        // 細邊框
                        tableCtx.strokeStyle = borderColor;
                        tableCtx.globalAlpha = 0.2;
                        tableCtx.lineWidth = 1;
                        tableCtx.strokeRect(0, yStart, tableWidth, rowHeight);
                        tableCtx.globalAlpha = 1.0;

                        // 資料文字（白色）
                        tableCtx.fillStyle = '#ffffff';
                        table.columns.forEach((col, colIndex) => {
                            const value = row[colIndex];
                            const text = value !== undefined && value !== null ? String(value) : '';
                            const x = colIndex * colWidth + cellPadding;
                            const y = yStart + rowHeight / 2;

                            // 截斷過長文字
                            const maxWidth = colWidth - cellPadding * 2;
                            const metrics = tableCtx.measureText(text);
                            let displayText = text;
                            if (metrics.width > maxWidth) {
                                let truncated = text;
                                while (tableCtx.measureText(truncated + '...').width > maxWidth && truncated.length > 0) {
                                    truncated = truncated.slice(0, -1);
                                }
                                displayText = truncated + '...';
                            }

                            tableCtx.fillText(displayText, x, y);
                        });
                    });

                    // 繪製外框（深色科技主題）
                    tableCtx.strokeStyle = borderColor;
                    tableCtx.lineWidth = 2;
                    tableCtx.strokeRect(0, 0, tableWidth, tableHeight);

                    // 將表格轉為圖片並添加到 PDF
                    const tableImage = tableCanvas.toDataURL('image/png');
                    const pdfTableWidth = 170;
                    const pdfTableHeight = (tableHeight / tableWidth) * pdfTableWidth;

                    // 檢查是否需要換頁
                    if (yPos + pdfTableHeight > 270) {
                        doc.addPage();
                        yPos = 20;
                    }

                    doc.addImage(tableImage, 'PNG', 20, yPos, pdfTableWidth, pdfTableHeight);
                    yPos += pdfTableHeight + 5;

                    // 表格資訊（使用 canvas 渲染）
                    const infoCanvas = document.createElement('canvas');
                    const infoCtx = infoCanvas.getContext('2d');
                    infoCanvas.width = 1200;
                    infoCanvas.height = 80;
                    infoCtx.font = '20px "Microsoft YaHei", Arial, sans-serif';
                    infoCtx.fillStyle = '#666666';
                    infoCtx.textBaseline = 'top';
                    infoCtx.fillText(`欄位數 Columns: ${table.columns.length} | 資料筆數 Records: ${table.data.length}`, 0, 5);
                    // 添加數據模型特性說明
                    infoCtx.font = '18px "Microsoft YaHei", Arial, sans-serif';
                    infoCtx.fillStyle = '#0066cc';
                    const modelDesc = modelInfo.description.substring(0, 60) + (modelInfo.description.length > 60 ? '...' : '');
                    infoCtx.fillText(`特性: ${modelDesc}`, 0, 35);
                    const infoImage = infoCanvas.toDataURL('image/png');
                    doc.addImage(infoImage, 'PNG', 20, yPos, 160, 8);
                    yPos += 12;
                }

                // 添加圖表（如果   在）
                if (currentChart) {
                    try {
                        const canvas = document.getElementById('dataChart');
                        if (canvas) {
                            const chartImage = canvas.toDataURL('image/png');

                            if (yPos > 200) {
                                doc.addPage();
                                yPos = 20;
                            }

                            // 圖表標題（使用 canvas 渲染中文）
                            const chartTitleCanvas = document.createElement('canvas');
                            const chartTitleCtx = chartTitleCanvas.getContext('2d');
                            chartTitleCanvas.width = 800;
                            chartTitleCanvas.height = 80;
                            chartTitleCtx.font = 'bold 42px "Microsoft YaHei", Arial, sans-serif';
                            chartTitleCtx.fillStyle = '#0066cc';
                            chartTitleCtx.textBaseline = 'top';
                            chartTitleCtx.fillText('視覺圖表 Visual Chart', 0, 10);
                            const chartTitleImage = chartTitleCanvas.toDataURL('image/png');
                            doc.addImage(chartTitleImage, 'PNG', 20, yPos, 100, 8);
                            yPos += 12;

                            // 添加圖表圖片
                            doc.addImage(chartImage, 'PNG', 20, yPos, 170, 100);
                            yPos += 110;
                        }
                    } catch (e) {
                        console.error('Chart export failed:', e);
                    }
                }

                // SQL執行歷史
                if (executionHistory.length > 0) {
                    // 新頁面顯示SQL歷史
                    doc.addPage();
                    yPos = 20;

                    // SQL 歷史標題（使用 canvas 渲染中文）
                    const sqlTitleCanvas = document.createElement('canvas');
                    const sqlTitleCtx = sqlTitleCanvas.getContext('2d');
                    sqlTitleCanvas.width = 1000;
                    sqlTitleCanvas.height = 80;
                    sqlTitleCtx.font = 'bold 42px "Microsoft YaHei", Arial, sans-serif';
                    sqlTitleCtx.fillStyle = '#0066cc';
                    sqlTitleCtx.textBaseline = 'top';
                    sqlTitleCtx.fillText('SQL 執行歷史 Execution History', 0, 10);
                    const sqlTitleImage = sqlTitleCanvas.toDataURL('image/png');
                    doc.addImage(sqlTitleImage, 'PNG', 20, yPos, 120, 8);
                    yPos += 15;

                    // 渲染 SQL 語句（使用 canvas 以支持可能的中文注釋）
                    const historyToShow = executionHistory.slice(-30); // 最多顯示30條
                    historyToShow.forEach((sql, index) => {
                        // 每條 SQL 使用 canvas 渲染
                        const sqlCanvas = document.createElement('canvas');
                        const sqlCtx = sqlCanvas.getContext('2d');

                        // 設置字體
                        sqlCtx.font = '14px "Consolas", "Microsoft YaHei", monospace';

                        // 分割長 SQL 語句
                        const maxWidth = 1200;
                        const words = sql.split(' ');
                        const lines = [];
                        let currentLine = `${index + 1}. `;

                        for (let word of words) {
                            const testLine = currentLine + word + ' ';
                            const metrics = sqlCtx.measureText(testLine);

                            if (metrics.width > maxWidth && currentLine.length > `${index + 1}. `.length) {
                                lines.push(currentLine);
                                currentLine = '    ' + word + ' ';
                            } else {
                                currentLine = testLine;
                            }
                        }
                        if (currentLine.trim()) {
                            lines.push(currentLine);
                        }

                        // 計算 canvas 尺寸
                        const lineHeight = 20;
                        const canvasHeight = lines.length * lineHeight + 10;
                        sqlCanvas.width = 1300;
                        sqlCanvas.height = canvasHeight;

                        // 重新設置字體
                        sqlCtx.font = '14px "Consolas", "Microsoft YaHei", monospace';
                        sqlCtx.fillStyle = '#f5f5f5';
                        sqlCtx.fillRect(0, 0, 1300, canvasHeight);

                        // 左側藍色標記
                        sqlCtx.fillStyle = '#0066cc';
                        sqlCtx.fillRect(0, 0, 3, canvasHeight);

                        // 繪製文字
                        sqlCtx.fillStyle = '#000000';
                        sqlCtx.textBaseline = 'top';
                        lines.forEach((line, i) => {
                            sqlCtx.fillText(line, 10, i * lineHeight + 5);
                        });

                        // 檢查是否需要換頁
                        const pdfHeight = (canvasHeight / 1300) * 170;
                        if (yPos + pdfHeight > 270) {
                            doc.addPage();
                            yPos = 20;
                        }

                        // 添加到 PDF
                        const sqlImage = sqlCanvas.toDataURL('image/png');
                        doc.addImage(sqlImage, 'PNG', 20, yPos, 170, pdfHeight);
                        yPos += pdfHeight + 3;
                    });
                }

                // 添加數據模型說明頁（新頁面）
                // SQL執行歷史頁面（深色科技主題）
                if (executionHistory.length > 0) {
                    doc.addPage();
                    yPos = 20;

                    // SQL歷史標題
                    const sqlTitleCanvas = document.createElement('canvas');
                    const sqlTitleCtx = sqlTitleCanvas.getContext('2d');
                    sqlTitleCanvas.width = 1600;
                    sqlTitleCanvas.height = 100;

                    // 深色漸層背景
                    const sqlGradient = sqlTitleCtx.createLinearGradient(0, 0, 1600, 0);
                    sqlGradient.addColorStop(0, '#0a0e27');
                    sqlGradient.addColorStop(1, '#1a1f3a');
                    sqlTitleCtx.fillStyle = sqlGradient;
                    sqlTitleCtx.fillRect(0, 0, 1600, 100);

                    sqlTitleCtx.fillStyle = '#00ffcc';
                    sqlTitleCtx.fillRect(0, 0, 8, 100);

                    sqlTitleCtx.font = 'bold 48px "Microsoft YaHei", Arial, sans-serif';
                    sqlTitleCtx.fillStyle = '#00ffcc';
                    sqlTitleCtx.textBaseline = 'middle';
                    sqlTitleCtx.textAlign = 'left';
                    sqlTitleCtx.fillText('📜 SQL 執行歷史', 30, 35);
                    sqlTitleCtx.fillStyle = '#ffffff';
                    sqlTitleCtx.font = 'bold 36px "Segoe UI", Arial, sans-serif';
                    sqlTitleCtx.fillText('SQL EXECUTION HISTORY', 30, 75);

                    const sqlTitleImage = sqlTitleCanvas.toDataURL('image/png');
                    doc.addImage(sqlTitleImage, 'PNG', 10, yPos, 190, 13);
                    yPos += 18;

                    // 顯示SQL命令（限制前15條，深色主題）
                    const displayHistory = executionHistory.slice(0, 15);
                    displayHistory.forEach((cmd, index) => {
                        if (yPos > 260) {
                            doc.addPage();
                            yPos = 20;
                        }

                        const sqlCanvas = document.createElement('canvas');
                        const sqlCtx = sqlCanvas.getContext('2d');
                        sqlCanvas.width = 1600;
                        sqlCanvas.height = 80;

                        // 深色背景
                        sqlCtx.fillStyle = index % 2 === 0 ? '#1a1f3a' : '#0f1420';
                        sqlCtx.fillRect(0, 0, 1600, 80);

                        // 左側編號條
                        sqlCtx.fillStyle = '#00a8ff';
                        sqlCtx.fillRect(0, 0, 6, 80);

                        // 編號
                        sqlCtx.font = 'bold 24px "Microsoft YaHei", Arial, sans-serif';
                        sqlCtx.fillStyle = '#00a8ff';
                        sqlCtx.textBaseline = 'middle';
                        sqlCtx.textAlign = 'left';
                        sqlCtx.fillText(`${index + 1}.`, 20, 40);

                        // SQL命令文字
                        sqlCtx.font = '20px "Courier New", monospace';
                        sqlCtx.fillStyle = '#00ffcc';
                        const truncatedCmd = cmd.length > 110 ? cmd.substring(0, 110) + '...' : cmd;
                        sqlCtx.fillText(truncatedCmd, 80, 40);

                        const sqlImage = sqlCanvas.toDataURL('image/png');
                        doc.addImage(sqlImage, 'PNG', 10, yPos, 190, 10);
                        yPos += 11;
                    });

                    if (executionHistory.length > 15) {
                        const moreCanvas = document.createElement('canvas');
                        const moreCtx = moreCanvas.getContext('2d');
                        moreCanvas.width = 1600;
                        moreCanvas.height = 60;
                        moreCtx.fillStyle = '#1a1f3a';
                        moreCtx.fillRect(0, 0, 1600, 60);
                        moreCtx.font = 'bold 22px "Microsoft YaHei", Arial, sans-serif';
                        moreCtx.fillStyle = '#00a8ff';
                        moreCtx.textAlign = 'center';
                        moreCtx.textBaseline = 'middle';
                        moreCtx.fillText(`... 以及其他 ${executionHistory.length - 15} 條命令 (... and ${executionHistory.length - 15} more commands)`, 800, 30);
                        const moreImage = moreCanvas.toDataURL('image/png');
                        doc.addImage(moreImage, 'PNG', 10, yPos, 190, 8);
                    }
                }

                doc.addPage();
                yPos = 20;

                // 數據模型頁面標題（深色科技主題）
                const modelPageTitleCanvas = document.createElement('canvas');
                const modelPageTitleCtx = modelPageTitleCanvas.getContext('2d');
                modelPageTitleCanvas.width = 1600;
                modelPageTitleCanvas.height = 100;

                const modelGradient = modelPageTitleCtx.createLinearGradient(0, 0, 1600, 0);
                modelGradient.addColorStop(0, '#0a0e27');
                modelGradient.addColorStop(1, '#1a1f3a');
                modelPageTitleCtx.fillStyle = modelGradient;
                modelPageTitleCtx.fillRect(0, 0, 1600, 100);

                modelPageTitleCtx.fillStyle = '#00ffcc';
                modelPageTitleCtx.fillRect(0, 0, 8, 100);

                modelPageTitleCtx.font = 'bold 48px "Microsoft YaHei", Arial, sans-serif';
                modelPageTitleCtx.fillStyle = '#00ffcc';
                modelPageTitleCtx.textBaseline = 'middle';
                modelPageTitleCtx.textAlign = 'left';
                modelPageTitleCtx.fillText('📚 支援的數據模型', 30, 35);
                modelPageTitleCtx.fillStyle = '#ffffff';
                modelPageTitleCtx.font = 'bold 36px "Segoe UI", Arial, sans-serif';
                modelPageTitleCtx.fillText('SUPPORTED DATA MODELS', 30, 75);

                const modelPageTitleImage = modelPageTitleCanvas.toDataURL('image/png');
                doc.addImage(modelPageTitleImage, 'PNG', 10, yPos, 190, 13);
                yPos += 18;

                // 顯示當前使用的模型（高亮）
                const currentModelCanvas = document.createElement('canvas');
                const currentModelCtx = currentModelCanvas.getContext('2d');
                currentModelCanvas.width = 1000;
                currentModelCanvas.height = 100;
                currentModelCtx.fillStyle = '#00cc88';
                currentModelCtx.fillRect(0, 0, 1000, 100);
                currentModelCtx.font = 'bold 32px "Microsoft YaHei", Arial, sans-serif';
                currentModelCtx.fillStyle = '#ffffff';
                currentModelCtx.textBaseline = 'top';
                currentModelCtx.fillText(`✓ 本次使用: ${modelInfo.icon} ${modelInfo.name}`, 20, 15);
                currentModelCtx.font = '20px "Microsoft YaHei", Arial, sans-serif';
                currentModelCtx.fillText(modelInfo.description, 20, 55);
                const currentModelImage = currentModelCanvas.toDataURL('image/png');
                doc.addImage(currentModelImage, 'PNG', 20, yPos, 170, 10);
                yPos += 15;

                // 列出所有15種數據模型（精簡   ）
                const modelListCanvas = document.createElement('canvas');
                const modelListCtx = modelListCanvas.getContext('2d');
                modelListCanvas.width = 1400;
                modelListCanvas.height = 1200;

                let listY = 10;
                modelListCtx.font = '20px "Microsoft YaHei", Arial, sans-serif';
                modelListCtx.textBaseline = 'top';

                Object.values(dataModels).forEach((model, index) => {
                    // 如果是當前模型，用不同顏色
                    if (model.id === currentDataModel) {
                        modelListCtx.fillStyle = '#00cc88';
                    } else {
                        modelListCtx.fillStyle = '#333333';
                    }

                    const text = `${model.icon} ${model.name} - ${model.category}`;
                    modelListCtx.fillText(text, 10, listY);
                    listY += 30;

                    // 每5個換一次組
                    if ((index + 1) % 5 === 0) {
                        listY += 10;
                    }
                });

                const modelListImage = modelListCanvas.toDataURL('image/png');
                doc.addImage(modelListImage, 'PNG', 20, yPos, 170, 120);

                // 專業頁尾資訊（中英對照）
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);

                    // 深色分隔線
                    doc.setDrawColor(0, 168, 255);
                    doc.setLineWidth(0.5);
                    doc.line(20, 285, 190, 285);

                    // 頁碼（左側）
                    doc.setFontSize(9);
                    doc.setTextColor(100, 149, 237);
                    doc.text(`第 ${i} 頁 / 共 ${totalPages} 頁`, 20, 290);
                    doc.setTextColor(150, 150, 150);
                    doc.setFontSize(8);
                    doc.text(`Page ${i} of ${totalPages}`, 20, 293);

                    // 生成資訊（中央）
                    doc.setFontSize(7);
                    doc.setTextColor(120, 120, 120);
                    doc.text('資料數據庫模擬訓練遊戲平台 Database Simulator Training Platform', 105, 290, { align: 'center' });
                    doc.setTextColor(100, 100, 100);
                    doc.text('© 2024 Professional Database Training System | 專業數據庫訓練系統', 105, 293, { align: 'center' });

                    // 時間戳記（右側）
                    doc.setFontSize(7);
                    doc.setTextColor(100, 149, 237);
                    doc.text(`匯出 Exported:`, 190, 290, { align: 'right' });
                    doc.setTextColor(150, 150, 150);
                    doc.text(new Date().toLocaleString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }), 190, 293, { align: 'right' });
                }

                // 生成檔案名稱
                const fileName = `Database_Report_${currentDatabaseName}_${currentUser}_${new Date().toLocaleString('zh-TW', {year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'}).replace(/\//g, '-').replace(/:/g, '-').replace(/ /g, '_')}.pdf`;

                // 儲存 PDF
                doc.save(fileName);

                // 檢測裝置類型並顯示對應的下載位置
                const userAgent = navigator.userAgent.toLowerCase();
                let locationInfo = '';

                if (/android/.test(userAgent)) {
                    locationInfo = '📱 Android 手機：請到「檔案管理員」→「下載」資料夾查看\n或路徑：/storage/emulated/0/Download/';
                } else if (/iphone|ipad|ipod/.test(userAgent)) {
                    locationInfo = '📱 iPhone/iPad：請到「檔案」App → 「下載項目」資料夾查看';
                } else if (/mac/.test(userAgent)) {
                    locationInfo = '💻 Mac 電腦：請到「下載項目」資料夾查看\n或路徑：/Users/[你的使用者名稱]/Downloads/';
                } else if (/win/.test(userAgent)) {
                    locationInfo = '💻 Windows 電腦：請到「下載」資料夾查看\n或路徑：C:\\Users\\[你的使用者名稱]\\Downloads\\';
                } else {
                    locationInfo = '請到您的瀏覽器預設「下載」、料夾查看';
                }

                showMessage(`✅ 專業PDF報告匯出成功！ Professional PDF Report Exported Successfully!\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n📄 檔案資訊 FILE INFORMATION\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n檔案名稱 Filename:\n${fileName}\n\n檔案格式 Format: PDF (跨平台支援 Cross-platform)\n頁數 Pages: ${doc.internal.getNumberOfPages()} 頁\n包含內容 Contents:\n  ✓ 專業深色主題封面 Professional Dark Theme Cover\n  ✓ 詳細統計摘要 Detailed Statistics Summary\n  ✓ 資料表預覽（中英對照）Table Preview (Bilingual)\n  ✓ SQL執行歷史 SQL Execution History (${executionHistory.length} 條命令)\n  ✓ 數據模型說明 Data Models Documentation\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n📂 下載位置 DOWNLOAD LOCATION\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n${locationInfo}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n💡 使用提示 TIPS\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n✓ PDF 可在所有裝置、查看（電腦、手機、平板）\n  PDF can be viewed on all devices (PC, mobile, tablet)\n\n✓ 可使用 Adobe Reader、瀏覽器等開啟\n  Open with Adobe Reader, browser, etc.\n\n✓ 適合列印、分享、長期保存\n  Perfect for printing, sharing, long-term storage\n\n✓ 支援搜尋和複製文字內容\n  Supports text search and copy`, 'success');

            } catch (error) {
                console.error('Export error:', error);
                showMessage(`❌ PDF匯出失敗 Export Failed\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n錯誤詳情 Error Details:\n${error.message}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n🔧 建議解決方式 Suggested Solutions:\n\n1. 請稍後重試 Please try again later\n2. 確認瀏覽器允許下載 Check browser download permissions\n3. 嘗試清除瀏覽器快取 Try clearing browser cache\n4. 如問題持續，請聯繫技術支援 Contact support if issue persists\n\n━━━━━━━━━━━━━━━━━━━   ━━━━━━━━━━`, 'error');
            }
        }

        // 生成匯出的 HTML
        function generateExportHTML() {
            const timestamp = new Date().toLocaleString('zh-TW');
            let tablesHTML = '';

            // 生成每個資料表的 HTML
            for (const tableName in currentDatabase) {
                const table = currentDatabase[tableName];
                tablesHTML += `
                    <div style="margin-bottom: 40px; page-break-inside: avoid;">
                        <h3 style="color: #0066cc; border-bottom: 2px solid #0066cc; padding-bottom: 10px; margin-bottom: 20px;">
                            <i class="fas fa-table"></i> 資料表：${tableName}
                        </h3>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; background: white;">
                                <thead>
                                    <tr style="background: #0066cc; color: white;">
                                        ${table.columns.map(col => `<th style="padding: 12px; border: 1px solid #ddd; text-align: left;">${col}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${table.data.map(row => `
                                        <tr style="border-bottom: 1px solid #ddd;">
                                            ${table.columns.map((col, colIndex) => `<td style="padding: 10px; border: 1px solid #ddd;">${row[colIndex] !== undefined && row[colIndex] !== null ? row[colIndex] : ''}</td>`).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                            <div style="font-size: 14px; color: #666;">
                                <i class="fas fa-info-circle"></i> 欄位數：${table.columns.length} | 資料筆數：${table.data.length}
                            </div>
                        </div>
                    </div>
                `;
            }

            // 生成圖表的 base64 圖片（如果存在）
            let chartImageHTML = '';
            if (currentChart) {
                try {
                    const canvas = document.getElementById('dataChart');
                    const chartImage = canvas.toDataURL('image/png');
                    chartImageHTML = `
                        <div style="margin-bottom: 40px; page-break-inside: avoid;">
                            <h3 style="color: #0066cc; border-bottom: 2px solid #0066cc; padding-bottom: 10px; margin-bottom: 20px;">
                                <i class="fas fa-chart-bar"></i> 視覺圖表
                            </h3>
                            <img src="${chartImage}" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px;" alt="資料視覺圖表">
                        </div>
                    `;
                } catch (e) {
                    console.error('圖表匯出失敗:', e);
                }
            }

            // 生成執行歷史
            let historyHTML = '';
            if (executionHistory.length > 0) {
                historyHTML = `
                    <div style="margin-bottom: 40px; page-break-inside: avoid;">
                        <h3 style="color: #0066cc; border-bottom: 2px solid #0066cc; padding-bottom: 10px; margin-bottom: 20px;">
                            <i class="fas fa-history"></i> SQL 執行歷史
                        </h3>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 14px;">
                            ${executionHistory.slice(-20).map((sql, index) => `
                                <div style="margin-bottom: 10px; padding: 10px; background: white; border-left: 3px solid #0066cc;">
                                    <strong>${index + 1}.</strong> ${sql}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            return `
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${currentDatabaseName} - ${currentUser} 的資料庫報告</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f8f9fa;
            color: #333;
        }
        .header {
            background: linear-gradient(135deg, #0066cc, #00a8ff);
            color: white;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }
        .header p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        @media print {
            body { background: white; }
            .header, .content { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-database"></i> 資料庫訓練報告</h1>
        <p><i class="fas fa-server"></i> <strong>資料庫名稱：</strong>${currentDatabaseName}</p>
        <p><i class="fas fa-user"></i> <strong>使用者：</strong>${currentUser}</p>
        <p><i class="fas fa-calendar"></i> <strong>匯出時間：</strong>${timestamp}</p>
        <p><i class="fas fa-gamepad"></i> <strong>練習模式：</strong>${currentMode === 'free' ? '自由練習模式' : '訓練題目模式'}</p>
    </div>

    <div class="content">
        <h2 style="color: #0066cc; margin-top: 0;"><i class="fas fa-table"></i> 資料表預覽</h2>
        ${tablesHTML}

        ${chartImageHTML}

        ${historyHTML}

        <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; text-align: center; color: #999; font-size: 14px;">
            <p>本報告由數據庫模擬訓練平台自動生成</p>
            <p>© ${new Date().getFullYear()} Database Simulator</p>
        </div>
    </div>
</body>
</html>
            `;
        }

        // 生成圖表功能（、動調用）
        function generateChart() {
            if (!lastQueryResult || !lastQueryResult.columns || lastQueryResult.data.length === 0) {
                // 靜默返回，不顯示錯誤訊息（因為這是自動調用）
                return;
            }

            const chartType = document.getElementById('chartType').value;
            const canvas = document.getElementById('dataChart');
            const ctx = canvas.getContext('2d');

            // 銷毀舊圖表
            if (currentChart) {
                currentChart.destroy();
            }

            // 準備圖表資料
            const result = lastQueryResult;
            const labels = result.data.map((row, index) => {
                // 使用第一個欄位作為標籤，或使用索引
                return row[result.columns[0]] || `項目 ${index + 1}`;
            });

            // 獲取數值欄位
            const numericColumns = result.columns.filter(col => {
                return result.data.some(row => typeof row[col] === 'number');
            });

            if (numericColumns.length === 0) {
                // 靜默返回，查詢結果沒有數值欄位時不生成圖表
                console.log('查詢結果中沒有數值欄位，跳過圖表生成');
                return;
            }

            // 生成數據集
            const datasets = numericColumns.map((col, index) => {
                const colors = [
                    'rgba(0, 102, 204, 0.8)',
                    'rgba(0, 168, 255, 0.8)',
                    'rgba(0, 255, 204, 0.8)',
                    'rgba(255, 204, 0, 0.8)',
                    'rgba(255, 102, 102, 0.8)',
                    'rgba(153, 102, 255, 0.8)'
                ];

                return {
                    label: col,
                    data: result.data.map(row => row[col] || 0),
                    backgroundColor: chartType === 'pie' || chartType === 'doughnut'
                        ? colors
                        : colors[index % colors.length],
                    borderColor: colors[index % colors.length].replace('0.8', '1'),
                    borderWidth: 2
                };
            });

            // 圓餅圖和甜甜圈圖只使用第一個數值欄位
            const chartData = (chartType === 'pie' || chartType === 'doughnut')
                ? {
                    labels: labels,
                    datasets: [{
                        data: datasets[0].data,
                        backgroundColor: datasets[0].backgroundColor,
                        borderColor: datasets[0].borderColor,
                        borderWidth: 2
                    }]
                }
                : {
                    labels: labels,
                    datasets: datasets
                };

            // 創建圖表
            currentChart = new Chart(ctx, {
                type: chartType,
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#ffffff',
                                font: {
                                    size: 14
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: '資料視覺化圖表',
                            color: '#ffffff',
                            font: {
                                size: 18,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: (chartType === 'pie' || chartType === 'doughnut') ? {} : {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#a0b3d9'
                            },
                            grid: {
                                color: 'rgba(0, 168, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#a0b3d9'
                            },
                            grid: {
                                color: 'rgba(0, 168, 255, 0.1)'
                            }
                        }
                    }
                }
            });

            // 顯示圖表，隱藏空狀態
            document.getElementById('chartEmptyState').style.display = 'none';
            canvas.style.display = 'block';

            // 自動生成時不顯示成功訊息，避免干擾用戶
        }

        // 顯示訊息
        function showMessage(text, type) {
            output.innerHTML = createMessage(text, type);
        }

        // 手機版：懸浮題目按鈕功能
        function toggleQuickQuestionPanel() {
            const panel = document.getElementById('quickQuestionPanel');
            if (panel) {
                panel.classList.toggle('active');
            }
        }

        function updateFloatingQuestionButton() {
            const floatingBtn = document.getElementById('floatingQuestionBtn');
            if (floatingBtn) {
                if (currentMode === 'exercise' && exercises.length > 0) {
                    floatingBtn.classList.add('active');
                } else {
                    floatingBtn.classList.remove('active');
                }
            }
        }

        function updateQuickQuestionPanel() {
            const exercise = exercises[currentExerciseIndex];
            if (!exercise) return;

            const panelContent = document.getElementById('quickQuestionPanelContent');
            if (panelContent) {
                panelContent.innerHTML = `
                    <h3 style="color: var(--accent); margin-bottom: 15px;">
                        <i class="fas fa-tasks"></i> ${exercise.title}
                    </h3>
                    <div style="margin-bottom: 15px;">
                        <span style="background: rgba(0, 168, 255, 0.2); padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; margin-right: 10px;">
                            📊 ${exercise.category}
                        </span>
                        <span style="background: rgba(255, 204, 0, 0.2); padding: 6px 12px; border-radius: 6px; font-size: 0.9rem;">
                            ${'⭐'.repeat(Math.floor(exercise.difficultyStars))} ${exercise.difficulty}
                        </span>
                    </div>
                    <div style="background: rgba(0, 168, 255, 0.08); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--accent);">
                        ${exercise.description}
                    </div>
                    <div style="background: rgba(255, 204, 0, 0.08); padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--warning);">
                        ${exercise.hint}
                    </div>
                    <div style="text-align: center; color: var(--text-muted); font-size: 0.9rem;">
                        題目 ${currentExerciseIndex + 1} / ${exercises.length}
                    </div>
                `;
            }
        }

        // 測驗相關函數
        function resetQuiz() {
            currentQuizIndex = 0;
            quizAnswers = new Array(100).fill(null);
            quizStartTime = null;
        }

        function showQuizQuestion() {
            const question = quizQuestions[currentQuizIndex];

            // 更新題目編號
            document.getElementById('currentQuestionNum').textContent = currentQuizIndex + 1;

            // 更新進度條
            const progress = ((currentQuizIndex + 1) / 100) * 100;
            document.getElementById('quizProgress').style.width = progress + '%';

            // 更新已答題數
            const answered = quizAnswers.filter(a => a !== null).length;
            document.getElementById('answeredCount').textContent = answered;

            // 顯示題目
            document.getElementById('questionText').textContent = `${currentQuizIndex + 1}. ${question.q}`;

            // 顯示選項
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            question.o.forEach((option, index) => {
                const isSelected = quizAnswers[currentQuizIndex] === index;
                const optionDiv = document.createElement('div');
                optionDiv.style.cssText = `
                    padding: 15px 20px;
                    margin-bottom: 12px;
                    background: ${isSelected ? 'linear-gradient(135deg, rgba(0, 168, 255, 0.2), rgba(0, 102, 204, 0.2))' : 'rgba(0, 168, 255, 0.05)'};
                    border: 2px solid ${isSelected ? 'var(--secondary)' : 'rgba(0, 168, 255, 0.2)'};
                    border-radius: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    font-size: 1rem;
                    color: var(--text-primary);
                `;
                optionDiv.textContent = option;
                optionDiv.addEventListener('click', () => selectOption(index));
                optionDiv.addEventListener('mouseenter', () => {
                    if (!isSelected) {
                        optionDiv.style.background = 'rgba(0, 168, 255, 0.1)';
                        optionDiv.style.transform = 'translateX(5px)';
                    }
                });
                optionDiv.addEventListener('mouseleave', () => {
                    if (!isSelected) {
                        optionDiv.style.background = 'rgba(0, 168, 255, 0.05)';
                        optionDiv.style.transform = 'translateX(0)';
                    }
                });
                optionsContainer.appendChild(optionDiv);
            });

            // 更新按鈕狀態
            document.getElementById('prevQuestionBtn').disabled = currentQuizIndex === 0;
            document.getElementById('nextQuestionBtn').style.display = currentQuizIndex < 99 ? 'flex' : 'none';
            document.getElementById('submitQuizBtn').style.display = currentQuizIndex === 99 ? 'flex' : 'none';
        }

        function selectOption(optionIndex) {
            quizAnswers[currentQuizIndex] = optionIndex;
            showQuizQuestion();
        }

        function submitQuiz() {
            // 檢查是否全部作答
            const unanswered = quizAnswers.filter(a => a === null).length;
            if (unanswered > 0) {
                const confirmSubmit = confirm(`還有 ${unanswered} 題未作答，確定要提交嗎？`);
                if (!confirmSubmit) return;
            }

            // 計算成績
            let correct = 0;
            const wrongQuestions = [];

            quizQuestions.forEach((q, index) => {
                if (quizAnswers[index] === q.a) {
                    correct++;
                } else {
                    wrongQuestions.push({
                        num: index + 1,
                        question: q.q,
                        yourAnswer: quizAnswers[index] !== null ? q.o[quizAnswers[index]] : '未作答',
                        correctAnswer: q.o[q.a]
                    });
                }
            });

            const wrong = 100 - correct;
            const accuracy = (correct / 100 * 100).toFixed(1);
            const score = correct;

            // 顯示結果
            document.getElementById('quizContent').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';

            document.getElementById('quizScoreDisplay').textContent = `${score} 分`;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('wrongCount').textContent = wrong;
            document.getElementById('accuracyRate').textContent = accuracy + '%';

            // 根據成績顯示不同訊息
            let message = '';
            if (score >= 90) {
                message = '🎉 優秀！您已熟練掌握資料庫知識！';
            } else if (score >= 80) {
                message = '👍 很好！繼續加油，向滿分進發！';
            } else if (score >= 70) {
                message = '💪 不錯！多加練習可以更上一層樓！';
            } else if (score >= 60) {
                message = '📚 及格！建議複習錯題鞏固知識！';
            } else {
                message = '🔄 需要加強！建議重新學習並多做練習！';
            }
            document.getElementById('quizResultMessage').textContent = message;

            // 存儲錯題供查看
            window.quizWrongQuestions = wrongQuestions;
        }

        function showWrongQuestions() {
            if (!window.quizWrongQuestions || window.quizWrongQuestions.length === 0) {
                alert('恭喜！沒有錯題！');
                return;
            }

            let html = '<div style="max-height: 500px; overflow-y: auto;">';
            html += '<h3 style="color: var(--error); margin-bottom: 20px;"><i class="fas fa-list"></i> 錯題複習</h3>';

            window.quizWrongQuestions.forEach((item, index) => {
                html += `
                    <div style="padding: 20px; margin-bottom: 15px; background: rgba(255, 51, 102, 0.05); border-left: 4px solid var(--error); border-radius: 8px;">
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 10px;">
                            第 ${item.num} 題：${item.question}
                        </div>
                        <div style="margin-bottom: 8px; color: var(--error);">
                            ❌ 你的答案：${item.yourAnswer}
                        </div>
                        <div style="color: var(--success);">
                            ✅ 正確答案：${item.correctAnswer}
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            // 創建自定義模態框顯示錯題
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2 class="gradient-text">錯題複習</h2>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">×</button>
                    </div>
                    ${html}
                </div>
            `;
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            document.body.appendChild(modal);
        }
    </script>

    <!-- 手機版：懸浮題目按鈕 -->
    <div id="floatingQuestionBtn" class="floating-question-btn" onclick="toggleQuickQuestionPanel()">
        <i class="fas fa-question-circle"></i>
    </div>

    <!-- 手機版：快速題目面板 -->
    <div id="quickQuestionPanel" class="quick-question-panel">
        <div class="quick-question-content">
            <div class="quick-question-header">
                <h2 class="gradient-text" style="margin: 0;">📋 查看題目</h2>
                <button class="close-quick-panel" onclick="toggleQuickQuestionPanel()">×</button>
            </div>
            <div id="quickQuestionPanelContent">
                <!-- 題目內容將由 JavaScript 動態填充 -->
            </div>
        </div>
    </div>
</body>
</html>


